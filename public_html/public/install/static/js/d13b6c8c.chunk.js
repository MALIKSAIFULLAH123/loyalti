"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["packages_framework_metafox-lexical_src_components_ImageComponent_tsx"],{26105(e,t,l){let n=l(99518);e.exports=n},99518(e,t,l){var n=l(96540);let r=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],a=r[Math.floor(Math.random()*r.length)],o=n.createContext({clientID:0,color:a[1],isCollabActive:!1,name:a[0],yjsDocMap:new Map});t.CollaborationContext=o,t.useCollaborationContext=function(e,t){let l=n.useContext(o);return null!=e&&(l.name=e),null!=t&&(l.color=t),l}},20616(e,t,l){let n=l(9625);e.exports=n},9625(e,t,l){var n=l(26105),r=l(5744),a=l(96540);t.LexicalNestedComposer=function({initialEditor:e,children:t,initialNodes:l,initialTheme:o,skipCollabChecks:i}){let s=a.useRef(!1),c=a.useContext(r.LexicalComposerContext);null==c&&function(e){let t=new URLSearchParams;t.append("code",e);for(let l=1;l<arguments.length;l++)t.append("v",arguments[l]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(9);let[u,{getTheme:d}]=c,m=a.useMemo(()=>{var t=o||d()||void 0;let n=r.createLexicalComposerContext(c,t);if(void 0!==t&&(e._config.theme=t),e._parentEditor=u,l)for(var a of l){var i=t=null;"function"!=typeof a&&(a=(i=a).replace,t=i.with,i=i.withKlass||null);let s=e._nodes.get(a.getType());e._nodes.set(a.getType(),{exportDOM:s?s.exportDOM:void 0,klass:a,replace:t,replaceWithKlass:i,transforms:new Set})}else for(let[m,g]of a=e._nodes=new Map(u._nodes))e._nodes.set(m,{exportDOM:g.exportDOM,klass:g.klass,replace:g.replace,replaceWithKlass:g.replaceWithKlass,transforms:new Set});return e._config.namespace=u._config.namespace,e._editable=u._editable,[e,n]},[]),{isCollabActive:g,yjsDocMap:f}=n.useCollaborationContext(),_=i||s.current||f.has(e.getKey());return a.useEffect(()=>{_&&(s.current=!0)},[_]),a.useEffect(()=>u.registerEditableListener(t=>{e.setEditable(t)}),[e,u]),a.createElement(r.LexicalComposerContext.Provider,{value:m},!g||_?t:null)}},8579(e,t,l){l.r(t),l.d(t,{$getAncestor:()=>O,INSERT_LINK_IMAGE_COMMAND:()=>L,RIGHT_CLICK_IMAGE_COMMAND:()=>A,default:()=>I});var n=l(17591),r=l(5744),a=l(42421),o=l.n(a),i=l(20616),s=l(57451),c=l(49028),u=l(12962),d=l(53579),m=l(96540),g=l(82774),f=l(21271);function _(){return m.createElement(g.LinkPlugin,{validateUrl:f.wv})}var p=l(90894),C=l(35928),h=l(35390),E=l(38298),b=l(63461),M=l(72871),N=l(91557);let v=/((https?:\/\/(www\.)?)|(www\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;function k({onSubmit:e,values:t,onClose:l}){let{i18n:n}=(0,N.PCX)(),r={component:"Form",validation:{type:"object",properties:{link:{type:"string",errors:{matches:n.formatMessage({id:"invalid_link_url"})},matches:{regex:v,excludeEmptyString:!0},label:n.formatMessage({id:"link_url"})}}},elements:{link:{name:"link",component:"Text",label:n.formatMessage({id:"link_url"}),fullWidth:!0,placeholder:n.formatMessage({id:"link_url"}),variant:"outlined",size:"small"},target:{name:"target",component:"Checkbox",label:n.formatMessage({id:"open_link_in_new_window"}),checkedValue:"_blank",uncheckedValue:"_self",fullWidth:!0,variant:"outlined",size:"small"},footer:{name:"_footer",component:"FormFooter",elements:{submit:{name:"_submit",component:"Submit",label:n.formatMessage({id:"ok"}),variant:"contained",color:"primary"}}}}};return m.createElement(M.ok,{formSchema:r,onSubmit(t){e(t),l()},initialValues:t})}var x=l(88182);function O(e,t){let l=e;for(;null!==l&&null!==l.getParent()&&!t(l);)l=l.getParentOrThrow();return t(l)?l:null}let R=new Set,A=(0,d.createCommand)("RIGHT_CLICK_IMAGE_COMMAND"),L=(0,d.createCommand)("INSERT_LINK_IMAGE_COMMAND");function S({altText:e,className:t,imageRef:l,src:n,width:r,height:a,maxWidth:o}){return!function(e){if(!R.has(e))throw new Promise(t=>{let l=new Image;l.src=e,l.onload=()=>{R.add(e),t(null)}})}(n),m.createElement("img",{className:t||void 0,src:n,alt:e,ref:l,style:{height:a,maxWidth:o,width:r},draggable:"false"})}function I({src:e,altText:t,nodeKey:l,width:a,height:g,maxWidth:f,resizable:M,showCaption:v,caption:R,captionsEnabled:I}){let D=(0,m.useRef)(null),w=(0,m.useRef)(null),[T,$,P]=(0,c.useLexicalNodeSelection)(l),[y,K]=(0,m.useState)(!1),[W]=(0,r.useLexicalComposerContext)(),[Y,B]=(0,m.useState)(null),G=(0,m.useRef)(null),[z,F]=(0,x.A)(),{i18n:U}=(0,N.PCX)(),H=(0,m.useCallback)(e=>{if(T&&(0,d.$isNodeSelection)((0,d.$getSelection)())){e.preventDefault();let t=(0,d.$getNodeByKey)(l);(0,C.Eh)(t)&&t.remove()}return!1},[T,l]),Z=(0,m.useCallback)(e=>{let t=(0,d.$getSelection)(),l=w.current;if(T&&(0,d.$isNodeSelection)(t)&&1===t.getNodes().length){if(v)return(0,d.$setSelection)(null),e.preventDefault(),R.focus(),!0;if(null!==l&&l!==document.activeElement)return e.preventDefault(),l.focus(),!0}return!1},[R,T,v]),j=(0,m.useCallback)(e=>(G.current===R||w.current===e.target)&&((0,d.$setSelection)(null),W.update(()=>{$(!0);let e=W.getRootElement();null!==e&&e.focus()}),!0),[R,W,$]),V=(0,m.useCallback)(e=>!!y||e.target===D.current&&(e.shiftKey?$(!T):(P(),$(!0)),!0),[y,T,$,P]),q=(0,m.useCallback)(e=>{W.getEditorState().read(()=>{let t=(0,d.$getSelection)(),l=e.target;"IMG"===l.tagName&&(0,d.$isRangeSelection)(t)&&1===t.getNodes().length&&W.dispatchCommand(A,e)})},[W]),X=(e,t)=>{e.preventDefault(),W.getEditorState().read(()=>{let{nodeKey:e}=t,l=(0,d.$createNodeSelection)();l.add(e);let n=(0,d.$getNodeByKey)(e),r=n.getParent(),a=(0,h.$isLinkNode)(r)?r.getURL():"",o=((0,h.$isLinkNode)(r)?r.getTarget():"")||"_blank";F("rich_text_editor_insert_link",e=>m.createElement(k,{onSubmit(e){W.dispatchCommand(L,e)},values:{...t,link:a,target:o},onClose:e}))})},J=(0,m.useCallback)(e=>{W.update(()=>{!function(e={}){let{target:t,title:l,nodeKey:n,link:r}=e,a=void 0===e.rel?"noreferrer":e.rel,o=(0,d.$createNodeSelection)();o.add(n);let i=(0,d.$getNodeByKey)(n),s=[i];if(r){if(1===s.length){let c=s[0],u=O(c,h.$isLinkNode);if(null!==u){u.setURL(r),void 0!==t&&u.setTarget(t),null!==a&&u.setRel(a),void 0!==l&&u.setTitle(l);return}}let m=null,g=null;s.forEach(e=>{let n=e.getParent();if(!(n===g||null===n||(0,d.$isElementNode)(e)&&!e.isInline())){if((0,h.$isLinkNode)(n)){g=n,n.setURL(r),void 0!==t&&n.setTarget(t),null!==a&&g.setRel(a),void 0!==l&&g.setTitle(l);return}if(n.is(m)||(m=n,g=(0,h.$createLinkNode)(r,{rel:a,target:t,title:l}),(0,h.$isLinkNode)(n)?null===e.getPreviousSibling()?n.insertBefore(g):n.insertAfter(g):e.insertBefore(g)),(0,h.$isLinkNode)(e)){if(e.is(g))return;if(null!==g){let o=e.getChildren();for(let i=0;i<o.length;i++)g.append(o[i])}e.remove();return}null!==g&&g.append(e)}})}else s.forEach(e=>{let t=e.getParent();if((0,h.$isLinkNode)(t)){let l=t.getChildren();for(let n=0;n<l.length;n++)t.insertBefore(l[n]);t.remove()}})}(e)})},[W]);(0,m.useEffect)(()=>{let e=!0,t=W.getRootElement(),l=(0,u.mergeRegister)(W.registerUpdateListener(({editorState:t})=>{e&&B(t.read(()=>(0,d.$getSelection)()))}),W.registerCommand(d.SELECTION_CHANGE_COMMAND,(e,t)=>(G.current=t,!1),d.COMMAND_PRIORITY_LOW),W.registerCommand(d.CLICK_COMMAND,V,d.COMMAND_PRIORITY_LOW),W.registerCommand(A,V,d.COMMAND_PRIORITY_LOW),W.registerCommand(L,J,d.COMMAND_PRIORITY_LOW),W.registerCommand(d.DRAGSTART_COMMAND,e=>e.target===D.current&&(e.preventDefault(),!0),d.COMMAND_PRIORITY_LOW),W.registerCommand(d.KEY_DELETE_COMMAND,H,d.COMMAND_PRIORITY_LOW),W.registerCommand(d.KEY_BACKSPACE_COMMAND,H,d.COMMAND_PRIORITY_LOW),W.registerCommand(d.KEY_ENTER_COMMAND,Z,d.COMMAND_PRIORITY_LOW),W.registerCommand(d.KEY_ESCAPE_COMMAND,j,d.COMMAND_PRIORITY_LOW));return null==t||t.addEventListener("contextmenu",q),()=>{e=!1,l(),null==t||t.removeEventListener("contextmenu",q)}},[P,W,y,T,l,H,Z,j,V,q,$,J]);let Q=()=>{W.update(()=>{let e=(0,d.$getNodeByKey)(l);(0,C.Eh)(e)&&e.setShowCaption(!0)})},ee=(e,t)=>{setTimeout(()=>{K(!1)},200),W.update(()=>{let n=(0,d.$getNodeByKey)(l);(0,C.Eh)(n)&&n.setWidthAndHeight(e,t)})},et=()=>{K(!0)},el=T&&(0,d.$isNodeSelection)(Y)&&!y,en=T||y;return m.createElement(m.Suspense,{fallback:null},m.createElement(m.Fragment,null,m.createElement("div",{draggable:el},m.createElement(S,{className:en?`focused ${(0,d.$isNodeSelection)(Y)?"draggable":""}`:null,src:e,altText:t,imageRef:D,width:a,height:g,maxWidth:f})),en?m.createElement(b.A,{size:"small",role:"button",onClick:e=>X(e,{nodeKey:l}),title:U.formatMessage({id:"rich_text_editor_insert_link"}),sx:{position:"absolute",top:"4px",right:"4px",background:"rgba(0,0,0,0.5) !important","&:hover":{background:"rgba(0,0,0,0.7) !important"}}},m.createElement(E.A,null)):null,v&&m.createElement("div",{className:"image-caption-container"},m.createElement(i.LexicalNestedComposer,{initialEditor:R},m.createElement(n.AutoFocusPlugin,null),m.createElement(_,null),m.createElement(s.RichTextPlugin,{contentEditable:m.createElement(p.ar,{className:"ImageNode__contentEditable"}),placeholder:m.createElement(p.Or,{className:"ImageNode__placeholder"},"Enter a caption..."),ErrorBoundary:o()}))),M&&(0,d.$isNodeSelection)(Y)&&en&&m.createElement(p.wz,{showCaption:v,setShowCaption:Q,editor:W,buttonRef:w,imageRef:D,maxWidth:f,onResizeStart:et,onResizeEnd:ee,captionsEnabled:I}),z))}}}]);