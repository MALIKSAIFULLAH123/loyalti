"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-livestreaming-components-LiveVideoPlayer"],{43498(e,t,i){let n;i.d(t,{LL:()=>h,Ui:()=>g,ET:()=>_});var a=i(96602),r=i(96540),s=i(91557),l=i(70223),o=i(11497),d=i(656),u=i(78292);let c=new class{bootstrap(e,t){this.manager=e,this.settingApp=this.manager.getSetting("firebase"),this.settingApp&&this.init(this.settingApp,t)}checkActive(){return this.isActive}init(e,t){if(this.mounted)return this.firebaseApp;this.mounted=!0;let i={apiKey:s.z0J,authDomain:s.wRL,projectId:s.wWR,storageBucket:s.npo,messagingSenderId:s.AfL,appId:s.Kou};this.config=e;try{let n=(0,l.Wp)(i),a=(0,d.xI)(n),{user_firebase_email:r,user_firebase_password:o,requiredSignin:u}=this.settingApp||{};return u&&(0,d.x9)(a,r,o).then(e=>{}).catch(e=>{console.log("Live Video - Firebase signInWithEmailAndPassword error",e),"auth/user-not-found"===e.code&&(0,d.eJ)(a,r,o)}),t(!0),this.firebaseApp=n,this.isActive=!0,n}catch(c){this.isActive=!1}}getFirebaseApp(){return this.firebaseApp}getFirestore(){if(!this.firebaseApp)return null;if(!this.firestore){let e=(0,o.aU)(this.firebaseApp);e&&(this.firestore=e)}return this.firestore}getMessaging(){if(!this.firebaseApp)return null;if(!this.cloudMessage){let e=(0,u.dG)(this.firebaseApp);e&&(this.cloudMessage=e)}return this.cloudMessage}},f=!1,p=!1;function m(){let e=(0,s.PCX)(),[t,i]=r.useState(!1);return t||f||(f=!0,c.bootstrap(e,()=>{p=!0,i(!0)})),[t||p,c]}function h(){let[e,t]=r.useState(),[i,s]=r.useState(!1),[l,o]=m(),d=r.useRef(0);if(!l)return["",()=>{},!0];if(!n&&!i&&l)try{n=o.getMessaging()}catch(u){s(!0)}let c=e=>{(0,a.gf)(n).then(i=>{e(i),t(i)}).catch(()=>{d.current>5||(d.current=d.current+1,c(e))})};return[e,c,i]}function g(){let[e,t]=m();if(!e)return!1;let i=t.getFirestore();return i}let v=(e,t)=>{let[i,n]=(0,r.useState)();return(0,r.useEffect)(()=>{let i;if(e&&(null==t?void 0:t.collection)&&(null==t?void 0:t.docID)){try{let a=(0,o.H9)(e,t.collection,t.docID);i=(0,o.aQ)(a,async e=>{n(e.data())})}catch(r){}return()=>{null==i||i()}}},[]),i},_=v},71927(e,t,i){i.r(t),i.d(t,{default:()=>v});var n=i(91557),a=i(96540),r=i(3556),s=i(8051),l=i(60780),o=i(67725),d=i(67338),u=i(40515),c=i(43498),f=i(62193),p=i.n(f);let m=(0,r.Ay)(s.A,{name:"EndPlayer",shouldForwardProp:e=>"dialog"!==e})(({theme:e,dialog:t})=>({position:"relative",backgroundColor:"#333",color:"#fff",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:"24px",...t&&{width:"100%",height:"100%"},"&:before":{content:'""',display:"block",paddingBottom:"56.25%"}})),h=(0,r.Ay)(s.A,{name:"EndPlayer",shouldForwardProp:e=>"dialog"!==e})(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"absolute",top:0,left:0,right:0,bottom:0})),g=(0,r.Ay)(s.A)(({theme:e})=>({display:"flex",justifyContent:"center",alignItems:"center","& > *":{marginRight:`${e.spacing(1)} !important`}})),v=function({item:e,dialog:t,actions:i,dashboard:r}){let{i18n:s,dialogBackend:f,moment:v,dispatch:_,jsxBackend:b}=(0,n.PCX)(),{video_url:y,thumbnail_url:A,is_owner:E,is_streaming:x,extra:w,is_pending:I,stream_key:k,webcamConfig:D={}}=e||{},M=(0,c.Ui)(),C=(0,c.ET)(M,{collection:"live_video",docID:k}),P=b.get("livevideo.ui.webcamPlayer"),L=a.useCallback(()=>{i.deleteItem()},[]),S=["idle","deleted"].includes(null==C?void 0:C.status)||!x,F=null==C?void 0:C.is_approved,W=x&&E&&r&&(null==C?void 0:C.time_limit_warning),R=(null==C?void 0:C.end_date)?v(null==C?void 0:C.end_date).diff(new Date,"minutes"):"",z=()=>{E&&r&&f.alert({message:s.formatMessage({id:"live_video_approved_successfully_notification"})})};if(a.useEffect(()=>{e._identity&&F&&I&&_({type:n.yDX,payload:{identity:e._identity},meta:{onSuccess:z}})},[F,I,e._identity]),a.useEffect(()=>(S&&i&&i.updateStatusOffline(),()=>{S&&i&&i.removeLiveWatching()}),[S,i]),a.useEffect(()=>{W&&R>0&&f.alert({title:s.formatMessage({id:"timeout"}),message:s.formatMessage({id:"the_live_video_will_end_in_n_minutes"},{value:R})})},[W,R]),!e)return null;let V=(0,o.AE)(A,"500","");return S?a.createElement(m,{dialog:t},a.createElement(h,null,a.createElement(u.s4,{icon:"ico-video",sx:{fontSize:40,mb:2}}),s.formatMessage({id:E?"your_live_video_has_ended":"live_video_had_ended"}),E?a.createElement(g,{mt:2},(null==w?void 0:w.can_delete)?a.createElement(l.A,{"data-testid":"buttonDeleteLiveVideo",role:"button",tabIndex:1,autoFocus:!0,variant:"contained",disableRipple:!0,size:"medium",color:"error",onClick:L,sx:{minWidth:100}},s.formatMessage({id:"delete"})):null,a.createElement(l.A,{"data-testid":"buttonViewLiveVideo",role:"button",tabIndex:2,variant:"contained",disableRipple:!0,size:"medium",color:"primary",href:e.link||`/live-video/${null==e?void 0:e.id}`,sx:{minWidth:100}},s.formatMessage({id:"view"}))):null)):r&&E&&!p()(D)?a.createElement(P,{sxDeviceWrapper:{p:2},streamKey:k,deviceDefault:D,id:e.id}):a.createElement(d.A,{src:y,thumb_url:V,autoPlay:!0})}}}]);