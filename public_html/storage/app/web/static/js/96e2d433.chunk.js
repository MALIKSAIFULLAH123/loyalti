"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["vendors-node_modules_firebase_app_dist_esm_index_esm_js-node_modules_firebase_auth_dist_esm_i-9ab8d9"],{36743(e,t,n){n.d(t,{Am:()=>O,FA:()=>D,Fy:()=>v,I9:()=>R,Im:()=>N,Ku:()=>V,T9:()=>g,Tj:()=>f,Uj:()=>o,XA:()=>m,ZQ:()=>w,bD:()=>function e(t,n){if(t===n)return!0;let i=Object.keys(t),r=Object.keys(n);for(let s of i){if(!r.includes(s))return!1;let a=t[s],o=n[s];if(x(a)&&x(o)){if(!e(a,o))return!1}else if(a!==o)return!1}for(let l of r)if(!i.includes(l))return!1;return!0},cY:()=>y,eX:()=>k,g:()=>C,hp:()=>M,jZ:()=>b,lT:()=>E,lV:()=>T,nr:()=>_,sr:()=>I,tD:()=>P,u:()=>l,yU:()=>p,zW:()=>S});let i=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):(64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},r=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let a=e[n++],o=e[n++],l=e[n++],u=((7&r)<<18|(63&a)<<12|(63&o)<<6|63&l)-65536;t[i++]=String.fromCharCode(55296+(u>>10)),t[i++]=String.fromCharCode(56320+(1023&u))}else{let h=e[n++],c=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&h)<<6|63&c)}}return t.join("")},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<e.length;r+=3){let s=e[r],a=r+1<e.length,o=a?e[r+1]:0,l=r+2<e.length,u=l?e[r+2]:0,h=s>>2,c=(3&s)<<4|o>>4,d=(15&o)<<2|u>>6,f=63&u;l||(f=64,a||(d=64)),i.push(n[h],n[c],n[d],n[f])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):r(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<e.length;){let s=n[e.charAt(r++)],a=r<e.length,o=a?n[e.charAt(r)]:0;++r;let l=r<e.length,u=l?n[e.charAt(r)]:64;++r;let h=r<e.length,c=h?n[e.charAt(r)]:64;if(++r,null==s||null==o||null==u||null==c)throw Error();let d=s<<2|o>>4;if(i.push(d),64!==u){let f=o<<4&240|u>>2;if(i.push(f),64!==c){let p=u<<6&192|c;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},a=function(e){let t=i(e);return s.encodeByteArray(t,!0)},o=function(e){return a(e).replace(/\./g,"")},l=function(e){try{return s.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null},u=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,h=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},c=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}let n=e&&l(e[1]);return n&&JSON.parse(n)},d=()=>{try{return u()||h()||c()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},f=e=>{var t,n;return null===(n=null===(t=d())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},p=e=>{let t=f(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},g=()=>{var e;return null===(e=d())||void 0===e?void 0:e.config},m=e=>{var t;return null===(t=d())||void 0===t?void 0:t[`_${e}`]};class y{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function v(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(s)),""].join(".")}function w(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function b(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())}function I(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function T(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function E(){let e=w();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function _(){return!function(){var e;let t=null===(e=d())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(i){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function S(){try{return"object"==typeof indexedDB}catch(e){return!1}}function k(){return new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(s){t(s)}})}class C extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,C.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,D.prototype.create)}}class D{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?r.replace(A,(e,t)=>{let i=n[t];return null!=i?String(i):`<${t}?>`}):"Error",a=`${this.serviceName}: ${s} (${i}).`,o=new C(i,a,n);return o}}let A=/\{\$([^}]+)}/g;function N(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function x(e){return null!==e&&"object"==typeof e}function O(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function R(e){let t={},n=e.replace(/^\?/,"").split("&");return n.forEach(e=>{if(e){let[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function M(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function P(e,t){let n=new L(e,t);return n.subscribe.bind(n)}class L{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=F),void 0===i.error&&(i.error=F),void 0===i.complete&&(i.complete=F);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function F(){}function V(e){return e&&e._delegate?e._delegate:e}},842(e,t,n){n.d(t,{KO:()=>T,MF:()=>w,Sx:()=>I,Wp:()=>b,j6:()=>m,om:()=>g});var i=n(5125),r=n(63424),s=n(36743),a=n(96148);class o{constructor(e){this.container=e}getPlatformInfoString(){let e=this.container.getProviders();return e.map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let l="@firebase/app",u="0.9.3",h=new r.Vy("@firebase/app"),c="[DEFAULT]",d={[l]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},f=new Map,p=new Map;function g(e){let t=e.name;if(p.has(t))return h.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(p.set(t,e),f.values()))!function(e,t){try{e.container.addComponent(t)}catch(n){h.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}(n,e);return!0}function m(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}let y=new s.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class v{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw y.create("app-deleted",{appName:this._name})}}let w="9.17.1";function b(e,t={}){let n=e;if("object"!=typeof t){let r=t;t={name:r}}let a=Object.assign({name:c,automaticDataCollectionEnabled:!1},t),o=a.name;if("string"!=typeof o||!o)throw y.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.T9)()),!n)throw y.create("no-options");let l=f.get(o);if(l){if((0,s.bD)(n,l.options)&&(0,s.bD)(a,l.config))return l;throw y.create("duplicate-app",{appName:o})}let u=new i.h1(o);for(let h of p.values())u.addComponent(h);let d=new v(n,a,u);return f.set(o,d),d}function I(e=c){let t=f.get(e);if(!t&&e===c)return b();if(!t)throw y.create("no-app",{appName:e});return t}function T(e,t,n){var r;let s=null!==(r=d[e])&&void 0!==r?r:e;n&&(s+=`-${n}`);let a=s.match(/\s|\//),o=t.match(/\s|\//);if(a||o){let l=[`Unable to register library "${s}" with version "${t}":`];a&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),a&&o&&l.push("and"),o&&l.push(`version name "${t}" contains illegal characters (whitespace or "/")`),h.warn(l.join(" "));return}g(new i.uA(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}let E="firebase-heartbeat-store",_=null;function S(){return _||(_=(0,a.P2)("firebase-heartbeat-database",1,{upgrade(e,t){0===t&&e.createObjectStore(E)}}).catch(e=>{throw y.create("idb-open",{originalErrorMessage:e.message})})),_}async function k(e){try{let t=await S();return t.transaction(E).objectStore(E).get(D(e))}catch(i){if(i instanceof s.g)h.warn(i.message);else{let n=y.create("idb-get",{originalErrorMessage:null==i?void 0:i.message});h.warn(n.message)}}}async function C(e,t){try{let n=await S(),i=n.transaction(E,"readwrite"),r=i.objectStore(E);return await r.put(t,D(e)),i.done}catch(o){if(o instanceof s.g)h.warn(o.message);else{let a=y.create("idb-set",{originalErrorMessage:null==o?void 0:o.message});h.warn(a.message)}}}function D(e){return`${e.name}!${e.options.appId}`}class A{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new x(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){let e=this.container.getProvider("platform-logger").getImmediate(),t=e.getPlatformInfoString(),n=N();return(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))?void 0:(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf(),n=Date.now();return n-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";let e=N(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let s=n.find(e=>e.agent===r.agent);if(s){if(s.dates.push(r.date),O(n)>t){s.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),O(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=(0,s.Uj)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function N(){let e=new Date;return e.toISOString().substring(0,10)}class x{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.zW)()&&(0,s.eX)().then(()=>!0).catch(()=>!1)}async read(){let e=await this._canUseIndexedDBPromise;if(!e)return{heartbeats:[]};{let t=await k(this.app);return t||{heartbeats:[]}}}async overwrite(e){var t;let n=await this._canUseIndexedDBPromise;if(n){let i=await this.read();return C(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;let n=await this._canUseIndexedDBPromise;if(n){let i=await this.read();return C(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}}}function O(e){return(0,s.Uj)(JSON.stringify({version:2,heartbeats:e})).length}g(new i.uA("platform-logger",e=>new o(e),"PRIVATE")),g(new i.uA("heartbeat",e=>new A(e),"PRIVATE")),T(l,u,""),T(l,u,"esm2017"),T("fire-js","")},5125(e,t,n){n.d(t,{h1:()=>o,uA:()=>r});var i=n(36743);class r{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let s="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let n=new i.cY;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(s){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:s})}catch(t){}for(let[n,i]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(n);try{let a=this.getOrInitializeService({instanceIdentifier:r});i.resolve(a)}catch(o){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[r,s]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(r);n===a&&s.resolve(i)}return i}onInit(e,t){var n;let i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);let s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch(r){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:e===s?void 0:e,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(i){}return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class o{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){let t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},69559(e,t,n){var i=n(842),r=n(5125),s=n(36743),a=n(96148);let o="@firebase/installations",l="0.6.3",u=`w:${l}`,h="FIS_v2",c=new s.FA("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function d(e){return e instanceof s.g&&e.code.includes("request-failed")}function f({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function p(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function g(e,t){let n=await t.json(),i=n.error;return c.create("request-failed",{requestName:e,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function m({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function y(e){let t=await e();return t.status>=500&&t.status<600?e():t}async function v({appConfig:e,heartbeatServiceProvider:t},{fid:n}){let i=f(e),r=m(e),s=t.getImmediate({optional:!0});if(s){let a=await s.getHeartbeatsHeader();a&&r.append("x-firebase-client",a)}let o={fid:n,authVersion:h,appId:e.appId,sdkVersion:u},l={method:"POST",headers:r,body:JSON.stringify(o)},c=await y(()=>fetch(i,l));if(c.ok){let d=await c.json(),v={fid:d.fid||n,registrationStatus:2,refreshToken:d.refreshToken,authToken:p(d.authToken)};return v}throw await g("Create Installation",c)}function w(e){return new Promise(t=>{setTimeout(t,e)})}let b=/^[cdef][\w-]{21}$/;function I(e){return`${e.appName}!${e.appId}`}let T=new Map;function E(e,t){let n=I(e);_(n,t),function(e,t){let n=(!S&&"BroadcastChannel"in self&&((S=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{_(e.data.key,e.data.fid)}),S);n&&n.postMessage({key:e,fid:t}),0===T.size&&S&&(S.close(),S=null)}(n,t)}function _(e,t){let n=T.get(e);if(n)for(let i of n)i(t)}let S=null,k="firebase-installations-store",C=null;function D(){return C||(C=(0,a.P2)("firebase-installations-database",1,{upgrade(e,t){0===t&&e.createObjectStore(k)}})),C}async function A(e,t){let n=I(e),i=await D(),r=i.transaction(k,"readwrite"),s=r.objectStore(k),a=await s.get(n);return await s.put(t,n),await r.done,a&&a.fid===t.fid||E(e,t.fid),t}async function N(e){let t=I(e),n=await D(),i=n.transaction(k,"readwrite");await i.objectStore(k).delete(t),await i.done}async function x(e,t){let n=I(e),i=await D(),r=i.transaction(k,"readwrite"),s=r.objectStore(k),a=await s.get(n),o=t(a);return void 0===o?await s.delete(n):await s.put(o,n),await r.done,o&&(!a||a.fid!==o.fid)&&E(e,o.fid),o}async function O(e){let t;let n=await x(e.appConfig,n=>{let i=function(e){let t=e||{fid:function(){try{let e=new Uint8Array(17),t=self.crypto||self.msCrypto;t.getRandomValues(e),e[0]=112+e[0]%16;let n=function(e){let t=function(e){let t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(e);return b.test(n)?n:""}catch(i){return""}}(),registrationStatus:0};return L(t)}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){let n=Promise.reject(c.create("app-offline"));return{installationEntry:t,registrationPromise:n}}let i={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=R(e,i);return{installationEntry:i,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:M(e)}:{installationEntry:t}}(e,i);return t=r.registrationPromise,r.installationEntry});return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function R(e,t){try{let n=await v(e,t);return A(e.appConfig,n)}catch(i){throw d(i)&&409===i.customData.serverCode?await N(e.appConfig):await A(e.appConfig,{fid:t.fid,registrationStatus:0}),i}}async function M(e){let t=await P(e.appConfig);for(;1===t.registrationStatus;)await w(100),t=await P(e.appConfig);if(0===t.registrationStatus){let{installationEntry:n,registrationPromise:i}=await O(e);return i||n}return t}function P(e){return x(e,e=>{if(!e)throw c.create("installation-not-found");return L(e)})}function L(e){return 1===e.registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function F({appConfig:e,heartbeatServiceProvider:t},n){let i=function(e,{fid:t}){return`${f(e)}/${t}/authTokens:generate`}(e,n),r=function(e,{refreshToken:t}){let n=m(e);return n.append("Authorization",`${h} ${t}`),n}(e,n),s=t.getImmediate({optional:!0});if(s){let a=await s.getHeartbeatsHeader();a&&r.append("x-firebase-client",a)}let o={installation:{sdkVersion:u,appId:e.appId}},l={method:"POST",headers:r,body:JSON.stringify(o)},c=await y(()=>fetch(i,l));if(c.ok){let d=await c.json(),v=p(d);return v}throw await g("Generate Auth Token",c)}async function V(e,t=!1){let n;let i=await x(e.appConfig,i=>{var r;if(!B(i))throw c.create("not-registered");let s=i.authToken;if(!t&&2===(r=s).requestStatus&&!function(e){let t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(r))return i;if(1===s.requestStatus)return n=U(e,t),i;{if(!navigator.onLine)throw c.create("app-offline");let a=function(e){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=q(e,a),a}}),r=n?await n:i.authToken;return r}async function U(e,t){let n=await j(e.appConfig);for(;1===n.authToken.requestStatus;)await w(100),n=await j(e.appConfig);let i=n.authToken;return 0===i.requestStatus?V(e,t):i}function j(e){return x(e,e=>{if(!B(e))throw c.create("not-registered");let t=e.authToken;return 1===t.requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function q(e,t){try{let n=await F(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await A(e.appConfig,i),n}catch(s){if(d(s)&&(401===s.customData.serverCode||404===s.customData.serverCode))await N(e.appConfig);else{let r=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await A(e.appConfig,r)}throw s}}function B(e){return void 0!==e&&2===e.registrationStatus}async function K(e){let{installationEntry:t,registrationPromise:n}=await O(e);return n?n.catch(console.error):V(e).catch(console.error),t.fid}async function $(e,t=!1){await G(e);let n=await V(e,t);return n.token}async function G(e){let{registrationPromise:t}=await O(e);t&&await t}function z(e){return c.create("missing-app-config-values",{valueName:e})}let H="installations",W=e=>{let t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw z("App Configuration");if(!e.name)throw z("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw z(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),r=(0,i.j6)(t,"heartbeat");return{app:t,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},Q=e=>{let t=e.getProvider("app").getImmediate(),n=(0,i.j6)(t,H).getImmediate();return{getId:()=>K(n),getToken:e=>$(n,e)}};(0,i.om)(new r.uA(H,W,"PUBLIC")),(0,i.om)(new r.uA("installations-internal",Q,"PRIVATE")),(0,i.KO)(o,l),(0,i.KO)(o,l,"esm2017")},63424(e,t,n){var i,r;n.d(t,{$b:()=>i,Vy:()=>h});let s=[];(r=i||(i={}))[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT";let a={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,l={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},u=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=l[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class h{constructor(e){this.name=e,this._logLevel=o,this._logHandler=u,this._userLogHandler=null,s.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?a[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}},70223(e,t,n){n.d(t,{Wp:()=>i.Wp});var i=n(842);(0,i.KO)("firebase","9.17.1","app")},656(e,t,n){n.d(t,{eJ:()=>eQ,xI:()=>t1,x9:()=>eY});var i,r=n(36743),s=n(842),a=n(63424);function o(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)0>t.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}var l=n(5125);function u(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let h=new r.FA("auth","Firebase",u()),c=new a.Vy("@firebase/auth");function d(e,...t){c.logLevel<=a.$b.ERROR&&c.error(`Auth (${s.MF}): ${e}`,...t)}function f(e,...t){throw m(e,...t)}function p(e,...t){return m(e,...t)}function g(e,t,n){let i=Object.assign(Object.assign({},u()),{[t]:n}),s=new r.FA("auth","Firebase",i);return s.create(t,{appName:e.name})}function m(e,...t){if("string"!=typeof e){let n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return h.create(e,...t)}function y(e,t,...n){if(!e)throw m(t,...n)}function v(e){let t="INTERNAL ASSERTION FAILED: "+e;throw d(t),Error(t)}let w=new Map;function b(e){e instanceof Function||v("Expected a class definition");let t=w.get(e);return t?(t instanceof e||v("Instance stored in cache mismatched with class"),t):(t=new e,w.set(e,t),t)}function I(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function T(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class E{constructor(e,t){this.shortDelay=e,this.longDelay=t,t>e||v("Short delay should be less than long delay!"),this.isMobile=(0,r.jZ)()||(0,r.lV)()}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===T()||"https:"===T()||(0,r.sr)()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function _(e,t){e.emulator||v("Emulator should always be set here");let{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class S{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void v("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void v("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void v("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let k={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},C=new E(3e4,6e4);function D(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function A(e,t,n,i,s={}){return N(e,s,async()=>{let s={},a={};i&&("GET"===t?a=i:s={body:JSON.stringify(i)});let o=(0,r.Am)(Object.assign({key:e.config.apiKey},a)).slice(1),l=await e._getAdditionalHeaders();return l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode),S.fetch()(O(e,e.config.apiHost,n,o),Object.assign({method:t,headers:l,referrerPolicy:"no-referrer"},s))})}async function N(e,t,n){e._canInitEmulator=!1;let i=Object.assign(Object.assign({},k),t);try{let s=new R(e),a=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();let o=await a.json();if("needConfirmation"in o)throw M(e,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{let l=a.ok?o.errorMessage:o.error.message,[u,h]=l.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===u)throw M(e,"credential-already-in-use",o);if("EMAIL_EXISTS"===u)throw M(e,"email-already-in-use",o);if("USER_DISABLED"===u)throw M(e,"user-disabled",o);let c=i[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw g(e,c,h);f(e,c)}}catch(d){if(d instanceof r.g)throw d;f(e,"network-request-failed")}}async function x(e,t,n,i,r={}){let s=await A(e,t,n,i,r);return"mfaPendingCredential"in s&&f(e,"multi-factor-auth-required",{_serverResponse:s}),s}function O(e,t,n,i){let r=`${t}${n}?${i}`;return e.config.emulator?_(e.config,r):`${e.config.apiScheme}://${r}`}class R{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(p(this.auth,"network-request-failed")),C.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function M(e,t,n){let i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);let r=p(e,t,i);return r.customData._tokenResponse=n,r}async function P(e,t){return A(e,"POST","/v1/accounts:delete",t)}async function L(e,t){return A(e,"POST","/v1/accounts:lookup",t)}function F(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(n){}}async function V(e,t=!1){let n=(0,r.Ku)(e),i=await n.getIdToken(t),s=j(i);y(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");let a="object"==typeof s.firebase?s.firebase:void 0,o=null==a?void 0:a.sign_in_provider;return{claims:s,token:i,authTime:F(U(s.auth_time)),issuedAtTime:F(U(s.iat)),expirationTime:F(U(s.exp)),signInProvider:o||null,signInSecondFactor:(null==a?void 0:a.sign_in_second_factor)||null}}function U(e){return 1e3*Number(e)}function j(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return d("JWT malformed, contained fewer than 3 sections"),null;try{let s=(0,r.u)(n);if(!s)return d("Failed to decode base64 JWT payload"),null;return JSON.parse(s)}catch(a){return d("Caught error parsing JWT payload as JSON",null==a?void 0:a.toString()),null}}async function q(e,t,n=!1){if(n)return t;try{return await t}catch(i){throw i instanceof r.g&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(i)&&e.auth.currentUser===e&&await e.auth.signOut(),i}}class B{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let n=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),n}{this.errorBackoff=3e4;let i=null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0,r=i-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class K{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=F(this.lastLoginAt),this.creationTime=F(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function $(e){var t;let n=e.auth,i=await e.getIdToken(),r=await q(e,L(n,{idToken:i}));y(null==r?void 0:r.users.length,n,"internal-error");let s=r.users[0];e._notifyReloadListener(s);let a=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map(e=>{var{providerId:t}=e,n=o(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],l=function(e,t){let n=e.filter(e=>!t.some(t=>t.providerId===e.providerId));return[...n,...t]}(e.providerData,a),u=e.isAnonymous,h=!(e.email&&s.passwordHash)&&!(null==l?void 0:l.length),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:l,metadata:new K(s.createdAt,s.lastLoginAt),isAnonymous:!!u&&h};Object.assign(e,c)}async function G(e){let t=(0,r.Ku)(e);await $(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}async function z(e,t){let n=await N(e,{},async()=>{let n=(0,r.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,a=O(e,i,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",S.fetch()(a,{method:"POST",headers:o,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}class H{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){y(e.idToken,"internal-error"),y(void 0!==e.idToken,"internal-error"),y(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){let t=j(e);return y(t,"internal-error"),y(void 0!==t.exp,"internal-error"),y(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return(y(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired)?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:i,expiresIn:r}=await z(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new H;return n&&(y("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(y("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(y("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new H,this.toJSON())}_performRefresh(){return v("not implemented")}}function W(e,t){y("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Q{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=o(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new B(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new K(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){let t=await q(this,this.stsTokenManager.getToken(this.auth,e));return y(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return V(this,e)}reload(){return G(this)}_assign(e){this!==e&&(y(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Q(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){y(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await $(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){let e=await this.getIdToken();return await q(this,P(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,a,o,l,u;let h=null!==(n=t.displayName)&&void 0!==n?n:void 0,c=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(a=t.tenantId)&&void 0!==a?a:void 0,g=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,m=null!==(l=t.createdAt)&&void 0!==l?l:void 0,v=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:w,emailVerified:b,isAnonymous:I,providerData:T,stsTokenManager:E}=t;y(w&&E,e,"internal-error");let _=H.fromJSON(this.name,E);y("string"==typeof w,e,"internal-error"),W(h,e.name),W(c,e.name),y("boolean"==typeof b,e,"internal-error"),y("boolean"==typeof I,e,"internal-error"),W(d,e.name),W(f,e.name),W(p,e.name),W(g,e.name),W(m,e.name),W(v,e.name);let S=new Q({uid:w,auth:e,email:c,emailVerified:b,displayName:h,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:_,createdAt:m,lastLoginAt:v});return T&&Array.isArray(T)&&(S.providerData=T.map(e=>Object.assign({},e))),g&&(S._redirectEventId=g),S}static async _fromIdTokenResponse(e,t,n=!1){let i=new H;i.updateFromServerResponse(t);let r=new Q({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await $(r),r}}class Y{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function X(e,t,n){return`firebase:${e}:${t}:${n}`}Y.type="NONE";class J{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:i,name:r}=this.auth;this.fullUserKey=X(this.userKey,i.apiKey,r),this.fullPersistenceKey=X("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);return e?Q._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new J(b(Y),e,n);let i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),r=i[0]||b(Y),s=X(n,e.config.apiKey,e.name),a=null;for(let o of t)try{let l=await o._get(s);if(l){let u=Q._fromJSON(e,l);o!==r&&(a=u),r=o;break}}catch(h){}let c=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&c.length&&(r=c[0],a&&await r._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(s)}catch(t){}}))),new J(r,e,n)}}function Z(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ei(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";{if(t.includes("edge/"))return"Edge";if(ee(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(es(t))return"Blackberry";if(ea(t))return"Webos";if(et(t))return"Safari";if((t.includes("chrome/")||en(t))&&!t.includes("edge/"))return"Chrome";if(er(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==n?void 0:n.length)===2)return n[1]}return"Other"}function ee(e=(0,r.ZQ)()){return/firefox\//i.test(e)}function et(e=(0,r.ZQ)()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function en(e=(0,r.ZQ)()){return/crios\//i.test(e)}function ei(e=(0,r.ZQ)()){return/iemobile/i.test(e)}function er(e=(0,r.ZQ)()){return/android/i.test(e)}function es(e=(0,r.ZQ)()){return/blackberry/i.test(e)}function ea(e=(0,r.ZQ)()){return/webos/i.test(e)}function eo(e=(0,r.ZQ)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function el(e=(0,r.ZQ)()){return eo(e)||er(e)||ea(e)||es(e)||/windows phone/i.test(e)||ei(e)}function eu(e,t=[]){let n;switch(e){case"Browser":n=Z((0,r.ZQ)());break;case"Worker":n=`${Z((0,r.ZQ)())}-${e}`;break;default:n=e}let i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${s.MF}/${i}`}class eh{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,i)=>{try{let r=e(t);n(r)}catch(s){i(s)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(s){for(let i of(t.reverse(),t))try{i()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==s?void 0:s.message})}}}class ec{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ef(this),this.idTokenSubscription=new ef(this),this.beforeStateQueue=new eh(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=h,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=b(t)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await J.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(r){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser(),i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let s=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,a=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);(!s||s===a)&&(null==o?void 0:o.user)&&(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(l){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return(y(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId)?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await $(e)}catch(t){if((null==t?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){let t=e?(0,r.Ku)(e):null;return t&&y(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&y(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(b(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new r.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&b(e)||this._popupRedirectResolver;y(t,this,"argument-error"),this.redirectPersistenceManager=await J.create(this,[b(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return(this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e)?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let r="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return(y(s,this,"internal-error"),s.then(()=>r(this.currentUser)),"function"==typeof t)?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return y(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=eu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=await (null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function ed(e){return(0,r.Ku)(e)}class ef{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,r.tD)(e=>this.observer=e)}get next(){return y(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function ep(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function eg(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class em{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return v("not implemented")}_getIdTokenResponse(e){return v("not implemented")}_linkToIdToken(e,t){return v("not implemented")}_getReauthenticationResolver(e){return v("not implemented")}}async function ey(e,t){return A(e,"POST","/v1/accounts:update",t)}async function ev(e,t){return x(e,"POST","/v1/accounts:signInWithPassword",D(e,t))}async function ew(e,t){return x(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}async function eb(e,t){return x(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}class eI extends em{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new eI(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new eI(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return ev(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return ew(e,{email:this._email,oobCode:this._password});default:f(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ey(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return eb(e,{idToken:t,email:this._email,oobCode:this._password});default:f(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function eT(e,t){return x(e,"POST","/v1/accounts:signInWithIdp",D(e,t))}class eE extends em{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new eE(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):f("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=o(t,["providerId","signInMethod"]);if(!n||!i)return null;let s=new eE(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){let t=this.buildRequest();return eT(e,t)}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,eT(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,eT(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,r.Am)(t)}return e}}async function e_(e,t){return A(e,"POST","/v1/accounts:sendVerificationCode",D(e,t))}async function eS(e,t){return x(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,t))}async function ek(e,t){let n=await x(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,t));if(n.temporaryProof)throw M(e,"account-exists-with-different-credential",n);return n}let eC={USER_NOT_FOUND:"user-not-found"};async function eD(e,t){let n=Object.assign(Object.assign({},t),{operation:"REAUTH"});return x(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,n),eC)}class eA extends em{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new eA({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new eA({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return eS(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return ek(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return eD(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new eA({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class eN{constructor(e){var t,n,i,s,a,o;let l=(0,r.I9)((0,r.hp)(e)),u=null!==(t=l.apiKey)&&void 0!==t?t:null,h=null!==(n=l.oobCode)&&void 0!==n?n:null,c=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=l.mode)&&void 0!==i?i:null);y(u&&h&&c,"argument-error"),this.apiKey=u,this.operation=c,this.code=h,this.continueUrl=null!==(s=l.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(a=l.languageCode)&&void 0!==a?a:null,this.tenantId=null!==(o=l.tenantId)&&void 0!==o?o:null}static parseLink(e){let t=function(e){let t=(0,r.I9)((0,r.hp)(e)).link,n=t?(0,r.I9)((0,r.hp)(t)).deep_link_id:null,i=(0,r.I9)((0,r.hp)(e)).deep_link_id,s=i?(0,r.I9)((0,r.hp)(i)).link:null;return s||i||n||t||e}(e);try{return new eN(t)}catch(n){return null}}}class ex{constructor(){this.providerId=ex.PROVIDER_ID}static credential(e,t){return eI._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=eN.parseLink(t);return y(n,"argument-error"),eI._fromEmailAndCode(e,n.code,n.tenantId)}}ex.PROVIDER_ID="password",ex.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ex.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class eO{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class eR extends eO{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class eM extends eR{constructor(){super("facebook.com")}static credential(e){return eE._fromParams({providerId:eM.PROVIDER_ID,signInMethod:eM.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return eM.credentialFromTaggedObject(e)}static credentialFromError(e){return eM.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return eM.credential(e.oauthAccessToken)}catch(t){return null}}}eM.FACEBOOK_SIGN_IN_METHOD="facebook.com",eM.PROVIDER_ID="facebook.com";class eP extends eR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return eE._fromParams({providerId:eP.PROVIDER_ID,signInMethod:eP.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return eP.credentialFromTaggedObject(e)}static credentialFromError(e){return eP.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return eP.credential(t,n)}catch(i){return null}}}eP.GOOGLE_SIGN_IN_METHOD="google.com",eP.PROVIDER_ID="google.com";class eL extends eR{constructor(){super("github.com")}static credential(e){return eE._fromParams({providerId:eL.PROVIDER_ID,signInMethod:eL.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return eL.credentialFromTaggedObject(e)}static credentialFromError(e){return eL.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return eL.credential(e.oauthAccessToken)}catch(t){return null}}}eL.GITHUB_SIGN_IN_METHOD="github.com",eL.PROVIDER_ID="github.com";class eF extends eR{constructor(){super("twitter.com")}static credential(e,t){return eE._fromParams({providerId:eF.PROVIDER_ID,signInMethod:eF.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return eF.credentialFromTaggedObject(e)}static credentialFromError(e){return eF.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return eF.credential(t,n)}catch(i){return null}}}async function eV(e,t){return x(e,"POST","/v1/accounts:signUp",D(e,t))}eF.TWITTER_SIGN_IN_METHOD="twitter.com",eF.PROVIDER_ID="twitter.com";class eU{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){let r=await Q._fromIdTokenResponse(e,n,i),s=ej(n),a=new eU({user:r,providerId:s,_tokenResponse:n,operationType:t});return a}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);let i=ej(n);return new eU({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function ej(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class eq extends r.g{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,eq.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new eq(e,t,n,i)}}function eB(e,t,n,i){let r="reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e);return r.catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw eq._fromErrorAndOperation(e,n,t,i);throw n})}async function eK(e,t,n=!1){let i=await q(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return eU._forOperation(e,"link",i)}async function e$(e,t,n=!1){let{auth:i}=e,r="reauthenticate";try{let s=await q(e,eB(i,r,t,e),n);y(s.idToken,i,"internal-error");let a=j(s.idToken);y(a,i,"internal-error");let{sub:o}=a;return y(e.uid===o,i,"user-mismatch"),eU._forOperation(e,r,s)}catch(l){throw(null==l?void 0:l.code)==="auth/user-not-found"&&f(i,"user-mismatch"),l}}async function eG(e,t,n=!1){let i="signIn",r=await eB(e,i,t),s=await eU._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}async function ez(e,t){return eG(ed(e),t)}class eH{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?eW._fromServerResponse(e,t):f(e,"internal-error")}}class eW extends eH{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new eW(t)}}async function eQ(e,t,n){let i=ed(e),r=await eV(i,{returnSecureToken:!0,email:t,password:n}),s=await eU._fromIdTokenResponse(i,"signIn",r);return await i._updateCurrentUser(s.user),s}function eY(e,t,n){return ez((0,r.Ku)(e),ex.credential(t,n))}class eX{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class eJ{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new eJ("enroll",e,t)}static _fromMfaPendingCredential(e){return new eJ("signin",e)}toJSON(){let e="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:{[e]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return eJ._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return eJ._fromIdtoken(e.multiFactorSession.idToken)}return null}}class eZ{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){let n=ed(e),i=t.customData._serverResponse,r=(i.mfaInfo||[]).map(e=>eH._fromServerResponse(n,e));y(i.mfaPendingCredential,n,"internal-error");let s=eJ._fromMfaPendingCredential(i.mfaPendingCredential);return new eZ(s,r,async e=>{let r=await e._process(n,s);delete i.mfaInfo,delete i.mfaPendingCredential;let a=Object.assign(Object.assign({},i),{idToken:r.idToken,refreshToken:r.refreshToken});switch(t.operationType){case"signIn":let o=await eU._fromIdTokenResponse(n,t.operationType,a);return await n._updateCurrentUser(o.user),o;case"reauthenticate":return y(t.user,n,"internal-error"),eU._forOperation(t.user,t.operationType,a);default:f(n,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class e0{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>eH._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new e0(e)}async getSession(){return eJ._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){let n=await this.getSession(),i=await q(this.user,e._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{var i;let r=await q(this.user,(i=this.user.auth,A(i,"POST","/v2/accounts/mfaEnrollment:withdraw",D(i,{idToken:n,mfaEnrollmentId:t}))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(r),await this.user.reload()}catch(s){throw s}}}new WeakMap;let e1="__sak";class e2{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(e1,"1"),this.storage.removeItem(e1),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class e3 extends e2{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){let e=(0,r.ZQ)();return et(e)||eo(e)}()&&function(){try{return!!(window&&window!==window.top)}catch(e){return!1}}(),this.fallbackToPolling=el(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});return}let n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){let i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}let s=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},a=this.storage.getItem(n);(0,r.lT)()&&10===document.documentMode&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,10):s()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}e3.type="LOCAL";class e4 extends e2{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}e4.type="SESSION";class e6{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new e6(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:i}=e.data,r=this.handlersMap[n];if(!(null==r?void 0:r.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(r).map(async t=>t(e.origin,i)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(n){return{fulfilled:!1,reason:n}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function e5(e="",t=10){let n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}e6.receivers=[];class e8{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let i,r;let s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=e5("",20);s.port1.start();let u=setTimeout(()=>{o(Error("unsupported_event"))},n);r={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(e.data.response);break;default:clearTimeout(u),clearTimeout(i),o(Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function e9(){return window}function e7(){return void 0!==e9().WorkerGlobalScope&&"function"==typeof e9().importScripts}async function te(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{let e=await navigator.serviceWorker.ready;return e.active}catch(t){return null}}let tt="firebaseLocalStorageDb",tn="firebaseLocalStorage",ti="fbase_key";class tr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ts(e,t){return e.transaction([tn],t?"readwrite":"readonly").objectStore(tn)}function ta(){let e=indexedDB.open(tt,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(tn,{keyPath:ti})}catch(i){n(i)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(tn)?t(n):(n.close(),await function(){let e=indexedDB.deleteDatabase(tt);return new tr(e).toPromise()}(),t(await ta()))})})}async function to(e,t,n){let i=ts(e,!0).put({[ti]:t,value:n});return new tr(i).toPromise()}async function tl(e,t){let n=ts(e,!1).get(t),i=await new tr(n).toPromise();return void 0===i?null:i.value}function tu(e,t){let n=ts(e,!0).delete(t);return new tr(n).toPromise()}class th{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await ta()),this.db}async _withRetries(e){let t=0;for(;;)try{let n=await this._openDb();return await e(n)}catch(i){if(t++>3)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return e7()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=e6._getInstance(e7()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{let n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await te(),!this.activeServiceWorker)return;this.sender=new e8(this.activeServiceWorker);let n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null==navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(n){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await ta();return await to(e,e1,"1"),await tu(e,e1),!0}catch(t){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>to(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>tl(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>tu(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>{let t=ts(e,!1).getAll();return new tr(t).toPromise()});if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;for(let{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(let s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function tc(e){return`__${e}${Math.floor(1e6*Math.random())}`}async function td(e,t,n){var i,r,s;let a=await n.verify();try{let o;if(y("string"==typeof a,e,"argument-error"),y("recaptcha"===n.type,e,"argument-error"),o="string"==typeof t?{phoneNumber:t}:t,"session"in o){let l=o.session;if("phoneNumber"in o){y("enroll"===l.type,e,"internal-error");let u=await (r={idToken:l.credential,phoneEnrollmentInfo:{phoneNumber:o.phoneNumber,recaptchaToken:a}},A(e,"POST","/v2/accounts/mfaEnrollment:start",D(e,r)));return u.phoneSessionInfo.sessionInfo}{y("signin"===l.type,e,"internal-error");let h=(null===(i=o.multiFactorHint)||void 0===i?void 0:i.uid)||o.multiFactorUid;y(h,e,"missing-multi-factor-info");let c=await (s={mfaPendingCredential:l.credential,mfaEnrollmentId:h,phoneSignInInfo:{recaptchaToken:a}},A(e,"POST","/v2/accounts/mfaSignIn:start",D(e,s)));return c.phoneResponseInfo.sessionInfo}}{let{sessionInfo:d}=await e_(e,{phoneNumber:o.phoneNumber,recaptchaToken:a});return d}}finally{n._reset()}}th.type="LOCAL",tc("rcb"),new E(3e4,6e4);class tf{constructor(e){this.providerId=tf.PROVIDER_ID,this.auth=ed(e)}verifyPhoneNumber(e,t){return td(this.auth,e,(0,r.Ku)(t))}static credential(e,t){return eA._fromVerification(e,t)}static credentialFromResult(e){return tf.credentialFromTaggedObject(e)}static credentialFromError(e){return tf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?eA._fromTokenResponse(t,n):null}}tf.PROVIDER_ID="phone",tf.PHONE_SIGN_IN_METHOD="phone";class tp extends em{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return eT(e,this._buildIdpRequest())}_linkToIdToken(e,t){return eT(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return eT(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function tg(e){return eG(e.auth,new tp(e),e.bypassAuthState)}function tm(e){let{auth:t,user:n}=e;return y(n,t,"internal-error"),e$(n,new tp(e),e.bypassAuthState)}async function ty(e){let{auth:t,user:n}=e;return y(n,t,"internal-error"),eK(n,new tp(e),e.bypassAuthState)}class tv{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:a}=e;if(s){this.reject(s);return}let o={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return tg;case"linkViaPopup":case"linkViaRedirect":return ty;case"reauthViaPopup":case"reauthViaRedirect":return tm;default:f(this.auth,"internal-error")}}resolve(e){this.pendingPromise||v("Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){this.pendingPromise||v("Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let tw=new E(2e3,1e4);class tb extends tv{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,tb.currentPopupAction&&tb.currentPopupAction.cancel(),tb.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return y(e,this.auth,"internal-error"),e}async onExecution(){1===this.filter.length||v("Popup operations only handle one event");let e=e5();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(p(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(p(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,tb.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,n;if(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(p(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,tw.get())};e()}}tb.currentPopupAction=null;let tI=new Map;class tT extends tv{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=tI.get(this.auth._key());if(!e){try{let t=await tE(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(i){e=()=>Promise.reject(i)}tI.set(this.auth._key(),e)}return this.bypassAuthState||tI.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type){this.resolve(null);return}if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function tE(e,t){let n=tk(t),i=tS(e);if(!await i._isAvailable())return!1;let r=await i._get(n)==="true";return await i._remove(n),r}function t_(e,t){tI.set(e._key(),t)}function tS(e){return b(e._redirectPersistence)}function tk(e){return X("pendingRedirect",e.config.apiKey,e.name)}async function tC(e,t,n=!1){var i,r;let s=ed(e),a=(i=s,(r=t)?b(r):(y(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)),o=new tT(s,a,n),l=await o.execute();return l&&!n&&(delete l.user._redirectEventId,await s._persistUserIfCurrent(l.user),await s._setRedirectUser(null,t)),l}class tD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return tN(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!tN(e)){let i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(p(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(tA(e))}saveEventToCache(e){this.cachedEventUids.add(tA(e)),this.lastProcessedEventTime=Date.now()}}function tA(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function tN({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function tx(e,t={}){return A(e,"GET","/v1/projects",t)}let tO=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tR=/^https?/;async function tM(e){if(e.config.emulator)return;let{authorizedDomains:t}=await tx(e);for(let n of t)try{if(function(e){let t=I(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){let r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!tR.test(n))return!1;if(tO.test(e))return i===e;let s=e.replace(/\./g,"\\."),a=RegExp("^(.+\\."+s+"|"+s+")$","i");return a.test(i)}(n))return}catch(i){}f(e,"unauthorized-domain")}let tP=new E(3e4,6e4);function tL(){let e=e9().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}}let tF=null,tV=new E(5e3,15e3),tU={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},tj=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function tq(e){let t=await (tF=tF||new Promise((t,n)=>{var i,r,s,a;function o(){tL(),gapi.load("gapi.iframes",{callback(){t(gapi.iframes.getContext())},ontimeout(){tL(),n(p(e,"network-request-failed"))},timeout:tP.get()})}if(null===(r=null===(i=e9().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else if(null===(s=e9().gapi)||void 0===s?void 0:s.load)o();else{let l=tc("iframefcb");return e9()[l]=()=>{gapi.load?o():n(p(e,"network-request-failed"))},(a=`https://apis.google.com/js/api.js?onload=${l}`,new Promise((e,t)=>{var n,i;let r=document.createElement("script");r.setAttribute("src",a),r.onload=e,r.onerror=e=>{let n=p("internal-error");n.customData=e,t(n)},r.type="text/javascript",r.charset="UTF-8",(null!==(i=null===(n=document.getElementsByTagName("head"))||void 0===n?void 0:n[0])&&void 0!==i?i:document).appendChild(r)})).catch(e=>n(e))}}).catch(e=>{throw tF=null,e})),n=e9().gapi;return y(n,e,"internal-error"),t.open({where:document.body,url:function(e){let t=e.config;y(t.authDomain,e,"auth-domain-config-required");let n=t.emulator?_(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:s.MF},a=tj.get(e.config.apiHost);a&&(i.eid=a);let o=e._getFrameworks();return o.length&&(i.fw=o.join(",")),`${n}?${(0,r.Am)(i).slice(1)}`}(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:tU,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});let r=p(e,"network-request-failed"),s=e9().setTimeout(()=>{i(r)},tV.get());function a(){e9().clearTimeout(s),n(t)}t.ping(a).then(a,()=>{i(r)})}))}let tB={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class tK{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function t$(e,t,n,i,a,o){y(e.config.authDomain,e,"auth-domain-config-required"),y(e.config.apiKey,e,"invalid-api-key");let l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:s.MF,eventId:a};if(t instanceof eO)for(let[u,h]of(t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,r.Im)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(o||{})))l[u]=h;if(t instanceof eR){let c=t.getScopes().filter(e=>""!==e);c.length>0&&(l.scopes=c.join(","))}e.tenantId&&(l.tid=e.tenantId);let d=l;for(let f of Object.keys(d))void 0===d[f]&&delete d[f];return`${function({config:e}){return e.emulator?_(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,r.Am)(d).slice(1)}`}let tG="webStorageSupport",tz=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=e4,this._completeRedirectFn=tC,this._overrideRedirectResult=t_}async _openPopup(e,t,n,i){var s;(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager)||v("_initialize() not called before _openPopup()");let a=t$(e,t,n,I(),i);return function(e,t,n,i=500,s=600){let a=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),l="",u=Object.assign(Object.assign({},tB),{width:i.toString(),height:s.toString(),top:a,left:o}),h=(0,r.ZQ)().toLowerCase();n&&(l=en(h)?"_blank":n),ee(h)&&(t=t||"http://localhost",u.scrollbars="yes");let c=Object.entries(u).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=(0,r.ZQ)()){var t;return eo(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(h)&&"_self"!==l)return function(e,t){let n=document.createElement("a");n.href=e,n.target=t;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",l),new tK(null);let d=window.open(t||"",l,c);y(d,e,"popup-blocked");try{d.focus()}catch(f){}return new tK(d)}(e,a,e5())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=t$(e,t,n,I(),i),e9().location.href=r,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:n,promise:i}=this.eventManagers[t];return n?Promise.resolve(n):(i||v("If manager is not set, promise should be"),i)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await tq(e),n=new tD(e);return t.register("authEvent",t=>{y(null==t?void 0:t.authEvent,e,"invalid-auth-event");let i=n.onEvent(t.authEvent);return{status:i?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){let n=this.iframes[e._key()];n.send(tG,{type:tG},n=>{var i;let r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[tG];void 0!==r&&t(!!r),f(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=tM(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return el()||et()||eo()}};class tH{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return v("unexpected MultiFactorSessionType")}}}class tW extends tH{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new tW(e)}_finalizeEnroll(e,t,n){return A(e,"POST","/v2/accounts/mfaEnrollment:finalize",D(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return A(e,"POST","/v2/accounts/mfaSignIn:finalize",D(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}var tQ="@firebase/auth",tY="0.21.3";class tX{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;let t=await this.auth.currentUser.getIdToken(e);return{accessToken:t}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){y(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let tJ=(0,r.XA)("authIdTokenMaxAge")||300,tZ=null,t0=e=>async t=>{let n=t&&await t.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>tJ)return;let r=null==n?void 0:n.token;tZ!==r&&(tZ=r,await fetch(e,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function t1(e=(0,s.Sx)()){let t=(0,s.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=(0,s.j6)(e,"auth");if(n.isInitialized()){let i=n.getImmediate(),a=n.getOptions();if((0,r.bD)(a,null!=t?t:{}))return i;f(i,"already-initialized")}let o=n.initialize({options:t});return o}(e,{popupRedirectResolver:tz,persistence:[th,e3,e4]}),i=(0,r.XA)("authTokenSyncURL");if(i){var a,o;let l=t0(i);a=()=>l(n.currentUser),(0,r.Ku)(n).beforeAuthStateChanged(l,a),o=e=>l(e),(0,r.Ku)(n).onIdTokenChanged(o,void 0,void 0)}let u=(0,r.Tj)("auth");return u&&function(e,t,n){let i=ed(e);y(i._canInitEmulator,i,"emulator-config-failed"),y(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=!!(null==n?void 0:n.disableWarnings),s=ep(t),{host:a,port:o}=function(e){let t=ep(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let s=r[1];return{host:s,port:eg(i.substr(s.length+1))}}{let[a,o]=i.split(":");return{host:a,port:eg(o)}}}(t),l=null===o?"":`:${o}`;i.config.emulator={url:`${s}//${a}${l}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${u}`),n}i="Browser",(0,s.om)(new l.uA("auth",(e,{options:t})=>{let n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:s,authDomain:a}=n.options;return((e,n)=>{y(s&&!s.includes(":"),"invalid-api-key",{appName:e.name}),y(!(null==a?void 0:a.includes(":")),"argument-error",{appName:e.name});let r={apiKey:s,authDomain:a,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:eu(i)},o=new ec(e,n,r);return function(e,t){let n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(b);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{let i=e.getProvider("auth-internal");i.initialize()})),(0,s.om)(new l.uA("auth-internal",e=>{let t=ed(e.getProvider("auth").getImmediate());return new tX(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,s.KO)(tQ,tY,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(i)),(0,s.KO)(tQ,tY,"esm2017")},11497(e,t,n){n.d(t,{H9:()=>uR,aU:()=>u$,aQ:()=>hC});var i,r,s,a,o,l,u,h,c=n(842),d=n(5125),f=n(63424),p=n(36743),g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},m={},y=y||{},v=g||self;function w(){}function b(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function I(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function T(e,t,n){return e.call.apply(e.bind,arguments)}function E(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function _(e,t,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?T:E).apply(null,arguments)}function S(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function k(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function C(){this.s=this.s,this.o=this.o}C.prototype.s=!1,C.prototype.na=function(){this.s||(this.s=!0,this.M())},C.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let D=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function A(e){let t=e.length;if(0<t){let n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function N(e,t){for(let n=1;n<arguments.length;n++){let i=arguments[n];if(b(i)){let r=e.length||0,s=i.length||0;e.length=r+s;for(let a=0;a<s;a++)e[r+a]=i[a]}else e.push(i)}}function x(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}x.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!v.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{v.addEventListener("test",w,t),v.removeEventListener("test",w,t)}catch(n){}return e}();function R(e){return/^[\s\xa0]*$/.test(e)}var M=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function P(e,t){return e<t?-1:e>t?1:0}function L(){var e=v.navigator;return e&&(e=e.userAgent)?e:""}function F(e){return -1!=L().indexOf(e)}function V(e){return V[" "](e),e}V[" "]=w;var U=F("Opera"),j=F("Trident")||F("MSIE"),q=F("Edge"),B=q||j,K=F("Gecko")&&!(-1!=L().toLowerCase().indexOf("webkit")&&!F("Edge"))&&!(F("Trident")||F("MSIE"))&&!F("Edge"),$=-1!=L().toLowerCase().indexOf("webkit")&&!F("Edge");function G(){var e=v.document;return e?e.documentMode:void 0}e:{var z,H="",W=(z=L(),K?/rv:([^\);]+)(\)|;)/.exec(z):q?/Edge\/([\d\.]+)/.exec(z):j?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(z):$?/WebKit\/(\S+)/.exec(z):U?/(?:Version)[ \/]?(\S+)/.exec(z):void 0);if(W&&(H=W?W[1]:""),j){var Q=G();if(null!=Q&&Q>parseFloat(H)){r=String(Q);break e}}r=H}var Y={},X=v.document&&j&&(G()||parseInt(r,10))||void 0;function J(e,t){if(x.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(K){e:{try{V(t.nodeName);var r=!0;break e}catch(s){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Z[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&J.X.h.call(this)}}k(J,x);var Z={2:"touch",3:"pen",4:"mouse"};J.prototype.h=function(){J.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ee="closure_listenable_"+(1e6*Math.random()|0),et=0;function en(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=r,this.key=++et,this.ba=this.ea=!1}function ei(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function er(e,t,n){for(let i in e)t.call(n,e[i],i,e)}function es(e){let t={};for(let n in e)t[n]=e[n];return t}let ea="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function eo(e,t){let n,i;for(let r=1;r<arguments.length;r++){for(n in i=arguments[r])e[n]=i[n];for(let s=0;s<ea.length;s++)n=ea[s],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function el(e){this.src=e,this.g={},this.h=0}function eu(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=D(r,t);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(ei(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function eh(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.ba&&s.listener==t&&!!n==s.capture&&s.ha==i)return r}return -1}el.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=eh(e,t,i,r);return -1<a?(t=e[a],n||(t.ea=!1)):((t=new en(t,this.src,s,!!i,r)).ea=n,e.push(t)),t};var ec="closure_lm_"+(1e6*Math.random()|0),ed={};function ef(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var a=I(r)?!!r.capture:!!r,o=ey(e);if(o||(e[ec]=o=new el(e)),(n=o.add(t,n,i,a,s)).proxy)return n;if(i=function e(t){return em.call(e.src,e.listener,t)},n.proxy=i,i.src=e,i.listener=n,e.addEventListener)O||(r=a),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(eg(t.toString()),i);else if(e.addListener&&e.removeListener)e.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ep(e){if("number"!=typeof e&&e&&!e.ba){var t=e.src;if(t&&t[ee])eu(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(eg(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=ey(t))?(eu(n,e),0==n.h&&(n.src=null,t[ec]=null)):ei(e)}}}function eg(e){return e in ed?ed[e]:ed[e]="on"+e}function em(e,t){if(e.ba)e=!0;else{t=new J(t,this);var n=e.listener,i=e.ha||e.src;e.ea&&ep(e),e=n.call(i,t)}return e}function ey(e){return(e=e[ec])instanceof el?e:null}var ev="__closure_events_fn_"+(1e9*Math.random()>>>0);function ew(e){return"function"==typeof e?e:(e[ev]||(e[ev]=function(t){return e.handleEvent(t)}),e[ev])}function eb(){C.call(this),this.i=new el(this),this.P=this,this.I=null}function eI(e,t){var n,i=e.I;if(i)for(n=[];i;i=i.I)n.push(i);if(e=e.P,i=t.type||t,"string"==typeof t)t=new x(t,e);else if(t instanceof x)t.target=t.target||e;else{var r=t;eo(t=new x(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];r=eT(a,i,!0,t)&&r}if(r=eT(a=t.g=e,i,!0,t)&&r,r=eT(a,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=eT(a=t.g=n[s],i,!1,t)&&r}function eT(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.ba&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.ea&&eu(e.i,a),r=!1!==o.call(l,i)&&r}}return r&&!i.defaultPrevented}k(eb,C),eb.prototype[ee]=!0,eb.prototype.removeEventListener=function(e,t,n,i){!function e(t,n,i,r,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],i,r,s);else(r=I(r)?!!r.capture:!!r,i=ew(i),t&&t[ee])?(t=t.i,(n=String(n).toString())in t.g&&-1<(i=eh(a=t.g[n],i,r,s))&&(ei(a[i]),Array.prototype.splice.call(a,i,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=ey(t))&&(n=t.g[n.toString()],t=-1,n&&(t=eh(n,i,r,s)),(i=-1<t?n[t]:null)&&ep(i))}(this,e,t,n,i)},eb.prototype.M=function(){if(eb.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)ei(n[i]);delete t.g[e],t.h--}}this.I=null},eb.prototype.N=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},eb.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var eE=v.JSON.stringify,e_=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new eS,e=>e.reset());class eS{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ek(e,t){var n;a||(n=v.Promise.resolve(void 0),a=function(){n.then(eA)}),eC||(a(),eC=!0),eD.add(e,t)}var eC=!1,eD=new class{constructor(){this.h=this.g=null}add(e,t){let n=e_.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function eA(){let e;for(;e=null,(n=eD).g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),i=e;){try{i.h.call(i.g)}catch(t){!function(e){v.setTimeout(()=>{throw e},0)}(t)}var n,i,r=e_;r.j(i),100>r.h&&(r.h++,i.next=r.g,r.g=i)}eC=!1}function eN(e,t){eb.call(this),this.h=e||1,this.g=t||v,this.j=_(this.lb,this),this.l=Date.now()}function ex(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function eO(e,t,n){if("function"==typeof e)n&&(e=_(e,n));else if(e&&"function"==typeof e.handleEvent)e=_(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:v.setTimeout(e,t||0)}k(eN,eb),(h=eN.prototype).ca=!1,h.R=null,h.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),eI(this,"tick"),this.ca&&(ex(this),this.start()))}},h.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},h.M=function(){eN.X.M.call(this),ex(this),delete this.g};class eR extends C{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eO(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(v.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eM(e){C.call(this),this.h=e,this.g={}}k(eM,C);var eP=[];function eL(e,t,n,i){Array.isArray(n)||(n&&(eP[0]=n.toString()),n=eP);for(var r=0;r<n.length;r++){var s=function e(t,n,i,r,s){if(r&&r.once)return function e(t,n,i,r,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],i,r,s);return null}return i=ew(i),t&&t[ee]?t.O(n,i,I(r)?!!r.capture:!!r,s):ef(t,n,i,!0,r,s)}(t,n,i,r,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],i,r,s);return null}return i=ew(i),t&&t[ee]?t.N(n,i,I(r)?!!r.capture:!!r,s):ef(t,n,i,!1,r,s)}(t,n[r],i||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function eF(e){er(e.g,function(e,t){this.g.hasOwnProperty(t)&&ep(e)},e),e.g={}}function eV(){this.g=!0}function eU(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<r.length;a++)r[a]=""}}}}return eE(n)}catch(o){return t}}(e,n)+(i?" "+i:"")})}eM.prototype.M=function(){eM.X.M.call(this),eF(this)},eM.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},eV.prototype.Aa=function(){this.g=!1},eV.prototype.info=function(){};var ej={},eq=null;function eB(){return eq=eq||new eb}function eK(e){x.call(this,ej.Pa,e)}function e$(e){let t=eB();eI(t,new eK(t))}function eG(e,t){x.call(this,ej.STAT_EVENT,e),this.stat=t}function ez(e){let t=eB();eI(t,new eG(t,e))}function eH(e,t){x.call(this,ej.Qa,e),this.size=t}function eW(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return v.setTimeout(function(){e()},t)}ej.Pa="serverreachability",k(eK,x),ej.STAT_EVENT="statevent",k(eG,x),ej.Qa="timingevent",k(eH,x);var eQ={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},eY={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function eX(){}function eJ(e){return e.h||(e.h=e.i())}function eZ(){}eX.prototype.h=null;var e0={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function e1(){x.call(this,"d")}function e2(){x.call(this,"c")}function e3(){}function e4(e,t,n,i){this.l=e,this.j=t,this.m=n,this.U=i||1,this.S=new eM(this),this.O=e5,e=B?125:void 0,this.T=new eN(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new e6}function e6(){this.i=null,this.g="",this.h=!1}k(e1,x),k(e2,x),k(e3,eX),e3.prototype.g=function(){return new XMLHttpRequest},e3.prototype.i=function(){return{}},o=new e3;var e5=45e3,e8={},e9={};function e7(e,t,n){e.K=1,e.v=ty(td(t)),e.s=n,e.P=!0,te(e,null)}function te(e,t){e.F=Date.now(),ti(e),e.A=td(e.v);var n=e.A,i=e.U;Array.isArray(i)||(i=[String(i)]),tN(n.i,"t",i),e.C=0,n=e.l.H,e.h=new e6,e.g=nw(e.l,n?t:null,!e.s),0<e.N&&(e.L=new eR(_(e.La,e,e.g),e.N)),eL(e.S,e.g,"readystatechange",e.ib),t=e.H?es(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),e$(),function(e,t,n,i,r,s){e.info(function(){if(e.g){if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var u=o[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");a=2<=c.length&&"type"==c[1]?a+(h+"=")+u+"&":a+(h+"=redacted&")}}else a=null}else a=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+a})}(e.j,e.u,e.A,e.m,e.U,e.s)}function tt(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function tn(e,t,n){let i=!0,r;for(;!e.I&&e.C<n.length;)if((r=function(e,t){var n=e.C,i=t.indexOf("\n",n);return -1==i?e9:isNaN(n=Number(t.substring(n,i)))?e8:(i+=1)+n>t.length?e9:(t=t.substr(i,n),e.C=i+n,t)}(e,n))==e9){4==t&&(e.o=4,ez(14),i=!1),eU(e.j,e.m,null,"[Incomplete Response]");break}else if(r==e8){e.o=4,ez(15),eU(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}else eU(e.j,e.m,r,null),tl(e,r);tt(e)&&r!=e9&&r!=e8&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,ez(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),nc(t),t.K=!0,ez(11))):(eU(e.j,e.m,n,"[Invalid Chunked Response]"),to(e),ta(e))}function ti(e){e.V=Date.now()+e.O,tr(e,e.O)}function tr(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eW(_(e.gb,e),t)}function ts(e){e.B&&(v.clearTimeout(e.B),e.B=null)}function ta(e){0==e.l.G||e.I||np(e.l,e)}function to(e){ts(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,ex(e.T),eF(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function tl(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||tF(n.h,e))){if(!e.J&&tF(n.h,e)&&3==n.G){try{var i=n.Fa.g.parse(t)}catch(r){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){e:if(!n.u){if(n.g){if(n.g.F+3e3<e.F)nf(n),ni(n);else break e}nh(n),ez(18)}}else n.Ba=s[1],0<n.Ba-n.T&&37500>s[2]&&n.L&&0==n.A&&!n.v&&(n.v=eW(_(n.cb,n),6e3));if(1>=tL(n.h)&&n.ja){try{n.ja()}catch(a){}n.ja=void 0}}else nm(n,11)}else if((e.J||n.g==e)&&nf(n),!R(t))for(s=n.Fa.g.parse(t),t=0;t<s.length;t++){let o=s[t];if(n.T=o[0],o=o[1],2==n.G){if("c"==o[0]){n.I=o[1],n.ka=o[2];let l=o[3];null!=l&&(n.ma=l,n.j.info("VER="+n.ma));let u=o[4];null!=u&&(n.Ca=u,n.j.info("SVER="+n.Ca));let h=o[5];null!=h&&"number"==typeof h&&0<h&&(i=1.5*h,n.J=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;let c=e.g;if(c){let d=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(d){var f=i.h;f.g||-1==d.indexOf("spdy")&&-1==d.indexOf("quic")&&-1==d.indexOf("h2")||(f.j=f.l,f.g=new Set,f.h&&(tV(f,f.h),f.h=null))}if(i.D){let p=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;p&&(i.za=p,tm(i.F,i.D,p))}}if(n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms")),(i=n).sa=nv(i,i.H?i.ka:null,i.V),e.J){tU(i.h,e);var g=i.J;g&&e.setTimeout(g),e.B&&(ts(e),ti(e)),i.g=e}else nu(i);0<n.i.length&&ns(n)}else"stop"!=o[0]&&"close"!=o[0]||nm(n,7)}else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?nm(n,7):nn(n):"noop"!=o[0]&&n.l&&n.l.wa(o),n.A=0)}}e$(4)}catch(m){}}function tu(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(b(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(b(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let i in t=[],n=0,e)t[n++]=i;return t}}}(e),i=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(b(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}(h=e4.prototype).setTimeout=function(e){this.O=e},h.ib=function(e){e=e.target;let t=this.L;t&&3==t5(e)?t.l():this.La(e)},h.La=function(e){try{if(e==this.g)e:{let t=t5(this.g);var n=this.g.Ea();let i=this.g.aa();if(!(3>t)&&(3!=t||B||this.g&&(this.h.h||this.g.fa()||t8(this.g)))){this.I||4!=t||7==n||(8==n||0>=i?e$(3):e$(2)),ts(this);var r=this.g.aa();this.Y=r;t:if(tt(this)){var s=t8(this.g);e="";var a=s.length,o=4==t5(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){to(this),ta(this);var l="";break t}this.h.i=new v.TextDecoder}for(n=0;n<a;n++)this.h.h=!0,e+=this.h.i.decode(s[n],{stream:o&&n==a-1});s.splice(0,a),this.h.g+=e,this.C=0,l=this.h.g}else l=this.g.fa();if(this.i=200==r,function(e,t,n,i,r,s,a){e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+s+" "+a})}(this.j,this.u,this.A,this.m,this.U,t,r),this.i){if(this.Z&&!this.J){t:{if(this.g){var u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!R(u)){var c=u;break t}}c=null}if(r=c)eU(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,tl(this,r);else{this.i=!1,this.o=3,ez(12),to(this),ta(this);break e}}this.P?(tn(this,t,l),B&&this.i&&3==t&&(eL(this.S,this.T,"tick",this.hb),this.T.start())):(eU(this.j,this.m,l,null),tl(this,l)),4==t&&to(this),this.i&&!this.I&&(4==t?np(this.l,this):(this.i=!1,ti(this)))}else 400==r&&0<l.indexOf("Unknown SID")?(this.o=3,ez(12)):(this.o=0,ez(13)),to(this),ta(this)}}}catch(d){}finally{}},h.hb=function(){if(this.g){var e=t5(this.g),t=this.g.fa();this.C<t.length&&(ts(this),tn(this,e,t),this.i&&4!=e&&ti(this))}},h.cancel=function(){this.I=!0,to(this)},h.gb=function(){this.B=null;let e=Date.now();0<=e-this.V?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(e$(),ez(17)),to(this),this.o=2,ta(this)):tr(this,this.V-e)};var th=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tc(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof tc){this.h=void 0!==t?t:e.h,tf(this,e.j),this.s=e.s,this.g=e.g,tp(this,e.m),this.l=e.l,t=e.i;var n=new tk;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tg(this,n),this.o=e.o}else e&&(n=String(e).match(th))?(this.h=!!t,tf(this,n[1]||"",!0),this.s=tv(n[2]||""),this.g=tv(n[3]||"",!0),tp(this,n[4]),this.l=tv(n[5]||"",!0),tg(this,n[6]||"",!0),this.o=tv(n[7]||"")):(this.h=!!t,this.i=new tk(null,this.h))}function td(e){return new tc(e)}function tf(e,t,n){e.j=n?tv(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tp(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function tg(e,t,n){var i,r;t instanceof tk?(e.i=t,i=e.i,(r=e.h)&&!i.j&&(tC(i),i.i=null,i.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tD(this,t),tN(this,n,e))},i)),i.j=r):(n||(t=tw(t,t_)),e.i=new tk(t,e.h))}function tm(e,t,n){e.i.set(t,n)}function ty(e){return tm(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function tv(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tw(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,tb),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function tb(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}tc.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tw(t,tI,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(tw(t,tI,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tw(n,"/"==n.charAt(0)?tE:tT,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tw(n,tS)),e.join("")};var tI=/[#\/\?@]/g,tT=/[#\?:]/g,tE=/[#\?]/g,t_=/[#\?@]/g,tS=/#/g;function tk(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tC(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tD(e,t){tC(e),t=tx(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tA(e,t){return tC(e),t=tx(e,t),e.g.has(t)}function tN(e,t,n){tD(e,t),0<n.length&&(e.i=null,e.g.set(tx(e,t),A(n)),e.h+=n.length)}function tx(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(h=tk.prototype).add=function(e,t){tC(this),this.i=null,e=tx(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},h.forEach=function(e,t){tC(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},h.oa=function(){tC(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){let r=e[i];for(let s=0;s<r.length;s++)n.push(t[i])}return n},h.W=function(e){tC(this);let t=[];if("string"==typeof e)tA(this,e)&&(t=t.concat(this.g.get(tx(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},h.set=function(e,t){return tC(this),this.i=null,tA(this,e=tx(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},h.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},h.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];let r=encodeURIComponent(String(i)),s=this.W(i);for(i=0;i<s.length;i++){var a=r;""!==s[i]&&(a+="="+encodeURIComponent(String(s[i]))),e.push(a)}}return this.i=e.join("&")};var tO=class{constructor(e,t){this.h=e,this.g=t}};function tR(e){this.l=e||tM,e=v.PerformanceNavigationTiming?0<(e=v.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(v.g&&v.g.Ga&&v.g.Ga()&&v.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var tM=10;function tP(e){return!!e.h||!!e.g&&e.g.size>=e.j}function tL(e){return e.h?1:e.g?e.g.size:0}function tF(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function tV(e,t){e.g?e.g.add(t):e.h=t}function tU(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function tj(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return A(e.i)}function tq(){}function tB(){this.g=new tq}function tK(e,t,n,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch(s){}}function t$(e){this.l=e.ac||null,this.j=e.jb||!1}function tG(e,t){eb.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=tz,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}tR.prototype.cancel=function(){if(this.i=tj(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}},tq.prototype.stringify=function(e){return v.JSON.stringify(e,void 0)},tq.prototype.parse=function(e){return v.JSON.parse(e,void 0)},k(t$,eX),t$.prototype.g=function(){return new tG(this.l,this.j)},t$.prototype.i=(i={},function(){return i}),k(tG,eb);var tz=0;function tH(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function tW(e){e.readyState=4,e.l=null,e.j=null,e.A=null,tQ(e)}function tQ(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(h=tG.prototype).open=function(e,t){if(this.readyState!=tz)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,tQ(this)},h.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||v).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},h.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tW(this)),this.readyState=tz},h.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tQ(this)),this.g&&(this.readyState=3,tQ(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==v.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;tH(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))}},h.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tW(this):tQ(this),3==this.readyState&&tH(this)}},h.Va=function(e){this.g&&(this.response=this.responseText=e,tW(this))},h.Ua=function(e){this.g&&(this.response=e,tW(this))},h.ga=function(){this.g&&tW(this)},h.setRequestHeader=function(e,t){this.v.append(e,t)},h.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},h.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tG.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var tY=v.JSON.parse;function tX(e){eb.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=tJ,this.K=this.L=!1}k(tX,eb);var tJ="",tZ=/^https?$/i,t0=["POST","PUT"];function t1(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,t2(e),t4(e)}function t2(e){e.D||(e.D=!0,eI(e,"complete"),eI(e,"error"))}function t3(e){if(e.h&&void 0!==y&&(!e.C[1]||4!=t5(e)||2!=e.aa())){if(e.v&&4==t5(e))eO(e.Ha,0,e);else if(eI(e,"readystatechange"),4==t5(e)){e.h=!1;try{let t=e.aa();e:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var n,i,r=!0;break e;default:r=!1}if(!(n=r)){if(i=0===t){var s=String(e.H).match(th)[1]||null;if(!s&&v.self&&v.self.location){var a=v.self.location.protocol;s=a.substr(0,a.length-1)}i=!tZ.test(s?s.toLowerCase():"")}n=i}if(n)eI(e,"complete"),eI(e,"success");else{e.m=6;try{var o=2<t5(e)?e.g.statusText:""}catch(l){o=""}e.j=o+" ["+e.aa()+"]",t2(e)}}finally{t4(e)}}}}function t4(e,t){if(e.g){t6(e);let n=e.g,i=e.C[0]?w:null;e.g=null,e.C=null,t||eI(e,"ready");try{n.onreadystatechange=i}catch(r){}}}function t6(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(v.clearTimeout(e.A),e.A=null)}function t5(e){return e.g?e.g.readyState:0}function t8(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case tJ:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function t9(e){let t="";return er(e,function(e,n){t=n+":"+e+"\r\n"}),t}function t7(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=t9(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tm(e,t,n))}function ne(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function nt(e){this.Ca=0,this.i=[],this.j=new eV,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=ne("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=ne("baseRetryDelayMs",5e3,e),this.bb=ne("retryDelaySeedMs",1e4,e),this.$a=ne("forwardChannelMaxRetries",2,e),this.ta=ne("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new tR(e&&e.concurrentRequestLimit),this.Fa=new tB,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function nn(e){if(nr(e),3==e.G){var t=e.U++,n=td(e.F);tm(n,"SID",e.I),tm(n,"RID",t),tm(n,"TYPE","terminate"),no(e,n),(t=new e4(e,e.j,t,void 0)).K=2,t.v=ty(td(n)),n=!1,v.navigator&&v.navigator.sendBeacon&&(n=v.navigator.sendBeacon(t.v.toString(),"")),!n&&v.Image&&((new Image).src=t.v,n=!0),n||(t.g=nw(t.l,null),t.g.da(t.v)),t.F=Date.now(),ti(t)}ny(e)}function ni(e){e.g&&(nc(e),e.g.cancel(),e.g=null)}function nr(e){ni(e),e.u&&(v.clearTimeout(e.u),e.u=null),nf(e),e.h.cancel(),e.m&&("number"==typeof e.m&&v.clearTimeout(e.m),e.m=null)}function ns(e){tP(e.h)||e.m||(e.m=!0,ek(e.Ja,e),e.C=0)}function na(e,t){var n;n=t?t.m:e.U++;let i=td(e.F);tm(i,"SID",e.I),tm(i,"RID",n),tm(i,"AID",e.T),no(e,i),e.o&&e.s&&t7(i,e.o,e.s),n=new e4(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=nl(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),tV(e.h,n),e7(n,i,t)}function no(e,t){e.ia&&er(e.ia,function(e,n){tm(t,n,e)}),e.l&&tu({},function(e,n){tm(t,n,e)})}function nl(e,t,n){n=Math.min(e.i.length,n);var i=e.l?_(e.l.Ra,e.l,e):null;e:{var r=e.i;let s=-1;for(;;){let a=["count="+n];-1==s?0<n?(s=r[0].h,a.push("ofs="+s)):s=0:a.push("ofs="+s);let o=!0;for(let l=0;l<n;l++){let u=r[l].h,h=r[l].g;if(0>(u-=s))s=Math.max(0,r[l].h-100),o=!1;else try{!function(e,t,n){let i=n||"";try{tu(e,function(e,n){let r=e;I(e)&&(r=eE(e)),t.push(i+n+"="+encodeURIComponent(r))})}catch(r){throw t.push(i+"type="+encodeURIComponent("_badmap")),r}}(h,a,"req"+u+"_")}catch(c){i&&i(h)}}if(o){i=a.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,i}function nu(e){e.g||e.u||(e.Z=1,ek(e.Ia,e),e.A=0)}function nh(e){return!e.g&&!e.u&&!(3<=e.A)&&(e.Z++,e.u=eW(_(e.Ia,e),ng(e,e.A)),e.A++,!0)}function nc(e){null!=e.B&&(v.clearTimeout(e.B),e.B=null)}function nd(e){e.g=new e4(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=td(e.sa);tm(t,"RID","rpc"),tm(t,"SID",e.I),tm(t,"CI",e.L?"0":"1"),tm(t,"AID",e.T),tm(t,"TYPE","xmlhttp"),no(e,t),e.o&&e.s&&t7(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=ty(td(t)),n.s=null,n.P=!0,te(n,e)}function nf(e){null!=e.v&&(v.clearTimeout(e.v),e.v=null)}function np(e,t){var n=null;if(e.g==t){nf(e),nc(e),e.g=null;var i=2}else{if(!tF(e.h,t))return;n=t.D,tU(e.h,t),i=1}if(0!=e.G){if(e.pa=t.Y,t.i){if(1==i){n=t.s?t.s.length:0,t=Date.now()-t.F;var r,s,a=e.C;eI(i=eB(),new eH(i,n)),ns(e)}else nu(e)}else if(3==(a=t.o)||0==a&&0<e.pa||!(1==i&&(r=e,s=t,!(tL(r.h)>=r.h.j-(r.m?1:0))&&(r.m?(r.i=s.D.concat(r.i),!0):1!=r.G&&2!=r.G&&!(r.C>=(r.Za?0:r.$a))&&(r.m=eW(_(r.Ja,r,s),ng(r,r.C)),r.C++,!0)))||2==i&&nh(e)))switch(n&&0<n.length&&((t=e.h).i=t.i.concat(n)),a){case 1:nm(e,5);break;case 4:nm(e,10);break;case 3:nm(e,6);break;default:nm(e,2)}}}function ng(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function nm(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var i=_(e.kb,e);n||(n=new tc("//www.google.com/images/cleardot.gif"),v.location&&"http"==v.location.protocol||tf(n,"https"),ty(n)),function(e,t){let n=new eV;if(v.Image){let i=new Image;i.onload=S(tK,n,i,"TestLoadImage: loaded",!0,t),i.onerror=S(tK,n,i,"TestLoadImage: error",!1,t),i.onabort=S(tK,n,i,"TestLoadImage: abort",!1,t),i.ontimeout=S(tK,n,i,"TestLoadImage: timeout",!1,t),v.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(n.toString(),i)}else ez(2);e.G=0,e.l&&e.l.va(t),ny(e),nr(e)}function ny(e){if(e.G=0,e.la=[],e.l){let t=tj(e.h);(0!=t.length||0!=e.i.length)&&(N(e.la,t),N(e.la,e.i),e.h.i.length=0,A(e.i),e.i.length=0),e.l.ua()}}function nv(e,t,n){var i=n instanceof tc?td(n):new tc(n,void 0);if(""!=i.g)t&&(i.g=t+"."+i.g),tp(i,i.m);else{var r=v.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new tc(null,void 0);i&&tf(s,i),t&&(s.g=t),r&&tp(s,r),n&&(s.l=n),i=s}return n=e.D,t=e.za,n&&t&&tm(i,n,t),tm(i,"VER",e.ma),no(e,i),i}function nw(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tX(n&&e.Da&&!e.ra?new t$({jb:!0}):e.ra)).Ka(e.H),t}function nb(){}function nI(){if(j&&!(10<=Number(X)))throw Error("Environmental error: no available transport.")}function nT(e,t){eb.call(this),this.g=new nt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!R(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!R(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new nS(this)}function nE(e){e1.call(this);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function n_(){e2.call(this),this.status=1}function nS(e){this.g=e}(h=tX.prototype).Ka=function(e){this.L=e},h.da=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():o.g(),this.C=this.u?eJ(this.u):eJ(o),this.g.onreadystatechange=_(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){t1(this,s);return}if(e=n||"",n=new Map(this.headers),i){if(Object.getPrototypeOf(i)===Object.prototype)for(var a in i)n.set(a,i[a]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let l of i.keys())n.set(l,i.get(l));else throw Error("Unknown input type for opt_headers: "+String(i))}for(let[u,h]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),a=v.FormData&&e instanceof v.FormData,!(0<=D(t0,t))||i||a||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(u,h);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{var c,d;t6(this),0<this.B&&((this.K=(c=this.g,j&&(d=Y,Object.prototype.hasOwnProperty.call(d,9)?d[9]:d[9]=function(){let e=0,t=M(String(r)).split("."),n=M("9").split("."),i=Math.max(t.length,n.length);for(let s=0;0==e&&s<i;s++){var a=t[s]||"",o=n[s]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==a[0].length&&0==o[0].length)break;e=P(0==a[1].length?0:parseInt(a[1],10),0==o[1].length?0:parseInt(o[1],10))||P(0==a[2].length,0==o[2].length)||P(a[2],o[2]),a=a[3],o=o[3]}while(0==e)}return 0<=e}(9))&&"number"==typeof c.timeout&&void 0!==c.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=_(this.qa,this)):this.A=eO(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(f){t1(this,f)}},h.qa=function(){void 0!==y&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,eI(this,"timeout"),this.abort(8))},h.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,eI(this,"complete"),eI(this,"abort"),t4(this))},h.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),t4(this,!0)),tX.X.M.call(this)},h.Ha=function(){this.s||(this.F||this.v||this.l?t3(this):this.fb())},h.fb=function(){t3(this)},h.aa=function(){try{return 2<t5(this)?this.g.status:-1}catch(e){return -1}},h.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},h.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),tY(t)}},h.Ea=function(){return this.m},h.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(h=nt.prototype).ma=8,h.G=1,h.Ja=function(e){if(this.m){if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let t=new e4(this,this.j,e,void 0),n=this.s;if(this.S&&(n?eo(n=es(n),this.S):n=this.S),null!==this.o||this.N||(t.H=n,n=null),this.O)e:{for(var i=0,r=0;r<this.i.length;r++){t:{var s=this.i[r];if("__data__"in s.g&&"string"==typeof(s=s.g.__data__)){s=s.length;break t}s=void 0}if(void 0===s)break;if(4096<(i+=s)){i=r;break e}if(4096===i||r===this.i.length-1){i=r+1;break e}}i=1e3}else i=1e3;i=nl(this,t,i),tm(r=td(this.F),"RID",e),tm(r,"CVER",22),this.D&&tm(r,"X-HTTP-Session-Id",this.D),no(this,r),n&&(this.N?i="headers="+encodeURIComponent(String(t9(n)))+"&"+i:this.o&&t7(r,this.o,n)),tV(this.h,t),this.Ya&&tm(r,"TYPE","init"),this.O?(tm(r,"$req",i),tm(r,"SID","null"),t.Z=!0,e7(t,r,null)):e7(t,r,i),this.G=2}}else 3==this.G&&(e?na(this,e):0==this.i.length||tP(this.h)||na(this))}},h.Ia=function(){if(this.u=null,nd(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=eW(_(this.eb,this),e)}},h.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,ez(10),ni(this),nd(this))},h.cb=function(){null!=this.v&&(this.v=null,ni(this),nh(this),ez(19))},h.kb=function(e){e?(this.j.info("Successfully pinged google.com"),ez(2)):(this.j.info("Failed to ping google.com"),ez(1))},(h=nb.prototype).xa=function(){},h.wa=function(){},h.va=function(){},h.ua=function(){},h.Ra=function(){},nI.prototype.g=function(e,t){return new nT(e,t)},k(nT,eb),nT.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;ez(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=nv(e,null,e.V),ns(e)},nT.prototype.close=function(){nn(this.g)},nT.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=eE(e),e=n);t.i.push(new tO(t.ab++,e)),3==t.G&&ns(t)},nT.prototype.M=function(){this.g.l=null,delete this.j,nn(this.g),delete this.g,nT.X.M.call(this)},k(nE,e1),k(n_,e2),k(nS,nb),nS.prototype.xa=function(){eI(this.g,"a")},nS.prototype.wa=function(e){eI(this.g,new nE(e))},nS.prototype.va=function(e){eI(this.g,new n_)},nS.prototype.ua=function(){eI(this.g,"b")},nI.prototype.createWebChannel=nI.prototype.g,nT.prototype.send=nT.prototype.u,nT.prototype.open=nT.prototype.m,nT.prototype.close=nT.prototype.close,eQ.NO_ERROR=0,eQ.TIMEOUT=8,eQ.HTTP_ERROR=6,eY.COMPLETE="complete",eZ.EventType=e0,e0.OPEN="a",e0.CLOSE="b",e0.ERROR="c",e0.MESSAGE="d",eb.prototype.listen=eb.prototype.N,tX.prototype.listenOnce=tX.prototype.O,tX.prototype.getLastError=tX.prototype.Oa,tX.prototype.getLastErrorCode=tX.prototype.Ea,tX.prototype.getStatus=tX.prototype.aa,tX.prototype.getResponseJson=tX.prototype.Sa,tX.prototype.getResponseText=tX.prototype.fa,tX.prototype.send=tX.prototype.da,tX.prototype.setWithCredentials=tX.prototype.Ka;var nk=m.createWebChannelTransport=function(){return new nI},nC=m.getStatEventTarget=function(){return eB()},nD=m.ErrorCode=eQ,nA=m.EventType=eY,nN=m.Event=ej,nx=m.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},nO=m.FetchXmlHttpFactory=t$,nR=m.WebChannel=eZ,nM=m.XhrIo=tX;let nP="@firebase/firestore";class nL{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}nL.UNAUTHENTICATED=new nL(null),nL.GOOGLE_CREDENTIALS=new nL("google-credentials-uid"),nL.FIRST_PARTY=new nL("first-party-uid"),nL.MOCK_USER=new nL("mock-user");let nF="9.17.1",nV=new f.Vy("@firebase/firestore");function nU(){return nV.logLevel}function nj(e,...t){if(nV.logLevel<=f.$b.DEBUG){let n=t.map(nK);nV.debug(`Firestore (${nF}): ${e}`,...n)}}function nq(e,...t){if(nV.logLevel<=f.$b.ERROR){let n=t.map(nK);nV.error(`Firestore (${nF}): ${e}`,...n)}}function nB(e,...t){if(nV.logLevel<=f.$b.WARN){let n=t.map(nK);nV.warn(`Firestore (${nF}): ${e}`,...n)}}function nK(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function n$(e="Unexpected state"){let t=`FIRESTORE (${nF}) INTERNAL ASSERTION FAILED: `+e;throw nq(t),Error(t)}let nG={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class nz extends p.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class nH{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class nW{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nQ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(nL.UNAUTHENTICATED))}shutdown(){}}class nY{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class nX{constructor(e){this.t=e,this.currentUser=nL.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),r=new nH;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new nH,e.enqueueRetryable(()=>i(this.currentUser))};let s=()=>{let t=r;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},a=e=>{nj("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(nj("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new nH)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(nj("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||n$(),new nW(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||n$(),new nL(e)}}class nJ{constructor(e,t,n,i){this.h=e,this.l=t,this.m=n,this.g=i,this.type="FirstParty",this.user=nL.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():("object"==typeof this.h&&null!==this.h&&this.h.auth&&this.h.auth.getAuthHeaderValueForFirstParty||n$(),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);let e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class nZ{constructor(e,t,n,i){this.h=e,this.l=t,this.m=n,this.g=i}getToken(){return Promise.resolve(new nJ(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(nL.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class n0{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class n1{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){let n=e=>{null!=e.error&&nj("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.A;return this.A=e.token,nj("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let i=e=>{nj("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){let e=this.T.getImmediate({optional:!0});e?i(e):nj("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||n$(),this.A=e.token,new n0(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class n2{static R(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let i=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let i=0;i<e;i++)n[i]=Math.floor(256*Math.random());return n}(40);for(let r=0;r<i.length;++r)n.length<20&&i[r]<t&&(n+=e.charAt(i[r]%e.length))}return n}}function n3(e,t){return e<t?-1:e>t?1:0}function n4(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}class n6{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new nz(nG.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800||e>=253402300800)throw new nz(nG.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n6.fromMillis(Date.now())}static fromDate(e){return n6.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3);return new n6(t,Math.floor(1e6*(e-1e3*t)))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?n3(this.nanoseconds,e.nanoseconds):n3(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class n5{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n5(e)}static min(){return new n5(new n6(0,0))}static max(){return new n5(new n6(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class n8{constructor(e,t,n){void 0===t?t=0:t>e.length&&n$(),void 0===n?n=e.length-t:n>e.length-t&&n$(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===n8.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n8?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let r=e.get(i),s=t.get(i);if(r<s)return -1;if(r>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class n9 extends n8{construct(e,t,n){return new n9(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new nz(nG.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new n9(t)}static emptyPath(){return new n9([])}}let n7=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ie extends n8{construct(e,t,n){return new ie(e,t,n)}static isValidIdentifier(e){return n7.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ie.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ie(["__name__"])}static fromServerFormat(e){let t=[],n="",i=0,r=()=>{if(0===n.length)throw new nz(nG.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;i<e.length;){let a=e[i];if("\\"===a){if(i+1===e.length)throw new nz(nG.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let o=e[i+1];if("\\"!==o&&"."!==o&&"`"!==o)throw new nz(nG.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=o,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(n+=a,i++):(r(),i++)}if(r(),s)throw new nz(nG.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ie(t)}static emptyPath(){return new ie([])}}class it{constructor(e){this.path=e}static fromPath(e){return new it(n9.fromString(e))}static fromName(e){return new it(n9.fromString(e).popFirst(5))}static empty(){return new it(n9.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===n9.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return n9.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new it(new n9(e.slice()))}}class ii{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function ir(e){return e.fields.find(e=>2===e.kind)}function is(e){return e.fields.filter(e=>2!==e.kind)}ii.UNKNOWN_ID=-1;class ia{constructor(e,t){this.fieldPath=e,this.kind=t}}class io{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new io(0,ih.min())}}function il(e,t){let n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,r=n5.fromTimestamp(1e9===i?new n6(n+1,0):new n6(n,i));return new ih(r,it.empty(),t)}function iu(e){return new ih(e.readTime,e.key,-1)}class ih{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ih(n5.min(),it.empty(),-1)}static max(){return new ih(n5.max(),it.empty(),-1)}}function ic(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=it.comparator(e.documentKey,t.documentKey))?n:n3(e.largestBatchId,t.largestBatchId)}let id="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ip{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ig(e){if(e.code!==nG.FAILED_PRECONDITION||e.message!==id)throw e;nj("LocalStore","Unexpectedly lost primary lease")}class im{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&n$(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new im((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof im?t:im.resolve(t)}catch(n){return im.reject(n)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):im.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):im.reject(t)}static resolve(e){return new im((t,n)=>{t(e)})}static reject(e){return new im((t,n)=>{n(e)})}static waitFor(e){return new im((t,n)=>{let i=0,r=0,s=!1;e.forEach(e=>{++i,e.next(()=>{++r,s&&r===i&&t()},e=>n(e))}),s=!0,r===i&&t()})}static or(e){let t=im.resolve(!1);for(let n of e)t=t.next(e=>e?im.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new im((n,i)=>{let r=e.length,s=Array(r),a=0;for(let o=0;o<r;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===r&&n(s)},e=>i(e))}})}static doWhile(e,t){return new im((n,i)=>{let r=()=>{!0===e()?t().next(()=>{r()},i):n()};r()})}}class iy{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new nH,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new ib(e,t.error)):this.P.resolve()},this.transaction.onerror=t=>{let n=iS(t.target.error);this.P.reject(new ib(e,n))}}static open(e,t,n,i){try{return new iy(t,e.transaction(i,n))}catch(r){throw new ib(t,r)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(nj("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){let t=this.transaction.objectStore(e);return new iT(t)}}class iv{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===iv.D((0,p.ZQ)())&&nq("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return nj("SimpleDb","Removing database:",e),iE(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,p.zW)())return!1;if(iv.N())return!0;let e=(0,p.ZQ)(),t=iv.D(e),n=iv.k(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){let t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(e){return this.db||(nj("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{let n=e.target.result;t(n)},i.onblocked=()=>{n(new ib(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=t=>{let i=t.target.error;"VersionError"===i.name?n(new nz(nG.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===i.name?n(new nz(nG.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+i)):n(new ib(e,i))},i.onupgradeneeded=e=>{nj("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.S.$(t,i.transaction,e.oldVersion,this.version).next(()=>{nj("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,i){let r="readonly"===t,s=0;for(;;){++s;try{this.db=await this.F(e);let a=iy.open(this.db,e,r?"readonly":"readwrite",n),o=i(a).next(e=>(a.V(),e)).catch(e=>(a.abort(e),im.reject(e))).toPromise();return o.catch(()=>{}),await a.v,o}catch(u){let l="FirebaseError"!==u.name&&s<3;if(nj("SimpleDb","Transaction failed with error:",u.message,"Retrying:",l),this.close(),!l)return Promise.reject(u)}}}close(){this.db&&this.db.close(),this.db=void 0}}class iw{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return iE(this.q.delete())}}class ib extends nz{constructor(e,t){super(nG.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function iI(e){return"IndexedDbTransactionError"===e.name}class iT{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(nj("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(nj("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),iE(n)}add(e){return nj("SimpleDb","ADD",this.store.name,e,e),iE(this.store.add(e))}get(e){return iE(this.store.get(e)).next(t=>(void 0===t&&(t=null),nj("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return nj("SimpleDb","DELETE",this.store.name,e),iE(this.store.delete(e))}count(){return nj("SimpleDb","COUNT",this.store.name),iE(this.store.count())}W(e,t){let n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){let i=this.cursor(n),r=[];return this.H(i,(e,t)=>{r.push(t)}).next(()=>r)}{let s=this.store.getAll(n.range);return new im((e,t)=>{s.onerror=e=>{t(e.target.error)},s.onsuccess=t=>{e(t.target.result)}})}}J(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new im((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}Y(e,t){nj("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.X=!1;let i=this.cursor(n);return this.H(i,(e,t,n)=>n.delete())}Z(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.H(i,t)}tt(e){let t=this.cursor({});return new im((n,i)=>{t.onerror=e=>{let t=iS(e.target.error);i(t)},t.onsuccess=t=>{let i=t.target.result;i?e(i.primaryKey,i.value).next(e=>{e?i.continue():n()}):n()}})}H(e,t){let n=[];return new im((i,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{let r=e.target.result;if(!r)return void i();let s=new iw(r),a=t(r.primaryKey,r.value,s);if(a instanceof im){let o=a.catch(e=>(s.done(),im.reject(e)));n.push(o)}s.isDone?i():null===s.G?r.continue():r.continue(s.G)}}).next(()=>im.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function iE(e){return new im((t,n)=>{e.onsuccess=e=>{let n=e.target.result;t(n)},e.onerror=e=>{let t=iS(e.target.error);n(t)}})}let i_=!1;function iS(e){let t=iv.D((0,p.ZQ)());if(t>=12.2&&t<13){let n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){let i=new nz("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return i_||(i_=!0,setTimeout(()=>{throw i},0)),i}}return e}class ik{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){nj("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{nj("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(e){iI(e)?nj("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await ig(e)}await this.nt(6e4)})}}class iC{constructor(e,t){this.localStore=e,this.persistence=t}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.it(t,e))}it(e,t){let n=new Set,i=t,r=!0;return im.doWhile(()=>!0===r&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return nj("IndexBackiller",`Processing collection: ${t}`),this.rt(e,t,i).next(e=>{i-=e,n.add(t)});r=!1})).next(()=>t-i)}rt(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(n=>{let r=n.changes;return this.localStore.indexManager.updateIndexEntries(e,r).next(()=>this.ot(i,n)).next(n=>(nj("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>r.size)}))}ot(e,t){let n=e;return t.changes.forEach((e,t)=>{let i=iu(t);ic(i,n)>0&&(n=i)}),new ih(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class iD{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ct&&this.ct(e),e}}iD.at=-1;class iA{constructor(e,t,n,i,r,s,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class iN{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new iN("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof iN&&e.projectId===this.projectId&&e.database===this.database}}function ix(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function iO(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function iR(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function iM(e){return null==e}function iP(e){return 0===e&&1/e==-1/0}function iL(e){return"number"==typeof e&&Number.isInteger(e)&&!iP(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class iF{constructor(e){this.binaryString=e}static fromBase64String(e){let t=atob(e);return new iF(t)}static fromUint8Array(e){let t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new iF(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return n3(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}iF.EMPTY_BYTE_STRING=new iF("");let iV=RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function iU(e){if(e||n$(),"string"==typeof e){let t=0,n=iV.exec(e);if(n||n$(),n[1]){let i=n[1];t=Number(i=(i+"000000000").substr(0,9))}let r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ij(e.seconds),nanos:ij(e.nanos)}}function ij(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function iq(e){return"string"==typeof e?iF.fromBase64String(e):iF.fromUint8Array(e)}function iB(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function iK(e){let t=iU(e.mapValue.fields.__local_write_time__.timestampValue);return new n6(t.seconds,t.nanos)}let i$={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},iG={nullValue:"NULL_VALUE"};function iz(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?iB(e)?4:i6(e)?9007199254740991:10:n$()}function iH(e,t){if(e===t)return!0;let n=iz(e);if(n!==iz(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return iK(e).isEqual(iK(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=iU(e.timestampValue),i=iU(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return iq(e.bytesValue).isEqual(iq(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return ij(e.geoPointValue.latitude)===ij(t.geoPointValue.latitude)&&ij(e.geoPointValue.longitude)===ij(t.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ij(e.integerValue)===ij(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=ij(e.doubleValue),i=ij(t.doubleValue);return n===i?iP(n)===iP(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return n4(e.arrayValue.values||[],t.arrayValue.values||[],iH);case 10:return function(e,t){let n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(ix(n)!==ix(i))return!1;for(let r in n)if(n.hasOwnProperty(r)&&(void 0===i[r]||!iH(n[r],i[r])))return!1;return!0}(e,t);default:return n$()}}function iW(e,t){return void 0!==(e.values||[]).find(e=>iH(e,t))}function iQ(e,t){if(e===t)return 0;let n=iz(e),i=iz(t);if(n!==i)return n3(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return n3(e.booleanValue,t.booleanValue);case 2:return function(e,t){let n=ij(e.integerValue||e.doubleValue),i=ij(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return iY(e.timestampValue,t.timestampValue);case 4:return iY(iK(e),iK(t));case 5:return n3(e.stringValue,t.stringValue);case 6:return function(e,t){let n=iq(e),i=iq(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),i=t.split("/");for(let r=0;r<n.length&&r<i.length;r++){let s=n3(n[r],i[r]);if(0!==s)return s}return n3(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=n3(ij(e.latitude),ij(t.latitude));return 0!==n?n:n3(ij(e.longitude),ij(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){let n=e.values||[],i=t.values||[];for(let r=0;r<n.length&&r<i.length;++r){let s=iQ(n[r],i[r]);if(s)return s}return n3(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===i$.mapValue&&t===i$.mapValue)return 0;if(e===i$.mapValue)return 1;if(t===i$.mapValue)return -1;let n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let a=0;a<i.length&&a<s.length;++a){let o=n3(i[a],s[a]);if(0!==o)return o;let l=iQ(n[i[a]],r[s[a]]);if(0!==l)return l}return n3(i.length,s.length)}(e.mapValue,t.mapValue);default:throw n$()}}function iY(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return n3(e,t);let n=iU(e),i=iU(t),r=n3(n.seconds,i.seconds);return 0!==r?r:n3(n.nanos,i.nanos)}function iX(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=iU(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?iq(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,it.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(let i of e.values||[])n?n=!1:t+=",",t+=iX(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",i=!0;for(let r of t)i?i=!1:n+=",",n+=`${r}:${iX(e.fields[r])}`;return n+"}"}(e.mapValue):n$()}function iJ(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function iZ(e){return!!e&&"integerValue"in e}function i0(e){return!!e&&"arrayValue"in e}function i1(e){return!!e&&"nullValue"in e}function i2(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function i3(e){return!!e&&"mapValue"in e}function i4(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return iO(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=i4(n)),t}if(e.arrayValue){let n={arrayValue:{values:[]}};for(let i=0;i<(e.arrayValue.values||[]).length;++i)n.arrayValue.values[i]=i4(e.arrayValue.values[i]);return n}return Object.assign({},e)}function i6(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function i5(e,t){let n=iQ(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function i8(e,t){let n=iQ(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class i9{constructor(e,t){this.position=e,this.inclusive=t}}function i7(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){let s=t[r],a=e.position[r];if(i=s.field.isKeyField()?it.comparator(it.fromName(a.referenceValue),n.key):iQ(a,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function re(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!iH(e.position[n],t.position[n]))return!1;return!0}class rt{}class rn extends rt{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ru(e,t,n):"array-contains"===t?new rf(e,n):"in"===t?new rp(e,n):"not-in"===t?new rg(e,n):"array-contains-any"===t?new rm(e,n):new rn(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new rh(e,n):new rc(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(iQ(t,this.value)):null!==t&&iz(this.value)===iz(t)&&this.matchesComparison(iQ(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return n$()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ri extends rt{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new ri(e,t)}matches(e){return rr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){let e=this.lt(e=>e.isInequality());return null!==e?e.field:null}lt(e){for(let t of this.getFlattenedFilters())if(e(t))return t;return null}}function rr(e){return"and"===e.op}function rs(e){return"or"===e.op}function ra(e){return ro(e)&&rr(e)}function ro(e){for(let t of e.filters)if(t instanceof ri)return!1;return!0}function rl(e,t){let n=e.filters.concat(t);return ri.create(n,e.op)}class ru extends rn{constructor(e,t,n){super(e,t,n),this.key=it.fromName(n.referenceValue)}matches(e){let t=it.comparator(e.key,this.key);return this.matchesComparison(t)}}class rh extends rn{constructor(e,t){super(e,"in",t),this.keys=rd("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rc extends rn{constructor(e,t){super(e,"not-in",t),this.keys=rd("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rd(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>it.fromName(e.referenceValue))}class rf extends rn{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return i0(t)&&iW(t.arrayValue,this.value)}}class rp extends rn{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&iW(this.value.arrayValue,t)}}class rg extends rn{constructor(e,t){super(e,"not-in",t)}matches(e){if(iW(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!iW(this.value.arrayValue,t)}}class rm extends rn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!i0(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>iW(this.value.arrayValue,e))}}class ry{constructor(e,t="asc"){this.field=e,this.dir=t}}class rv{constructor(e,t){this.comparator=e,this.root=t||rb.EMPTY}insert(e,t){return new rv(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rb.BLACK,null,null))}remove(e){return new rv(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rb.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new rw(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new rw(this.root,e,this.comparator,!1)}getReverseIterator(){return new rw(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new rw(this.root,e,this.comparator,!0)}}class rw{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class rb{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:rb.RED,this.left=null!=i?i:rb.EMPTY,this.right=null!=r?r:rb.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new rb(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return rb.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,i=this;if(0>t(e,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return rb.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,rb.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,rb.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw n$();let e=this.left.check();if(e!==this.right.check())throw n$();return e+(this.isRed()?0:1)}}rb.EMPTY=null,rb.RED=!0,rb.BLACK=!1,rb.EMPTY=new class{constructor(){this.size=0}get key(){throw n$()}get value(){throw n$()}get color(){throw n$()}get left(){throw n$()}get right(){throw n$()}copy(e,t,n,i,r){return this}insert(e,t,n){return new rb(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class rI{constructor(e){this.comparator=e,this.data=new rv(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rT(this.data.getIterator())}getIteratorFrom(e){return new rT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof rI)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(i,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new rI(this.comparator);return t.data=e,t}}class rT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function rE(e){return e.hasNext()?e.getNext():void 0}class r_{constructor(e){this.fields=e,e.sort(ie.comparator)}static empty(){return new r_([])}unionWith(e){let t=new rI(ie.comparator);for(let n of this.fields)t=t.add(n);for(let i of e)t=t.add(i);return new r_(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return n4(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class rS{constructor(e){this.value=e}static empty(){return new rS({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!i3(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=i4(t)}setAll(e){let t=ie.emptyPath(),n={},i=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){let s=this.getFieldsMap(t);this.applyChanges(s,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=i4(e):i.push(r.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){let t=this.field(e.popLast());i3(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return iH(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];i3(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){for(let i of(iO(t,(t,n)=>e[t]=n),n))delete e[i]}clone(){return new rS(i4(this.value))}}class rk{constructor(e,t,n,i,r,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=a}static newInvalidDocument(e){return new rk(e,0,n5.min(),n5.min(),n5.min(),rS.empty(),0)}static newFoundDocument(e,t,n,i){return new rk(e,1,t,n5.min(),n,i,0)}static newNoDocument(e,t){return new rk(e,2,t,n5.min(),n5.min(),rS.empty(),0)}static newUnknownDocument(e,t){return new rk(e,3,t,n5.min(),n5.min(),rS.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(n5.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rS.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rS.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=n5.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof rk&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rk(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rC{constructor(e,t=null,n=[],i=[],r=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=a,this.ft=null}}function rD(e,t=null,n=[],i=[],r=null,s=null,a=null){return new rC(e,t,n,i,r,s,a)}function rA(e){let t=e;if(null===t.ft){let n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n="|f:"+t.filters.map(e=>(function e(t){if(t instanceof rn)return t.field.canonicalString()+t.op.toString()+iX(t.value);if(ra(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(",")+"|ob:"+t.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==t.limit||(n="|l:"+t.limit),t.startAt&&(n="|lb:"+(t.startAt.inclusive?"b:":"a:")+t.startAt.position.map(e=>iX(e)).join(",")),t.endAt&&(n="|ub:"+(t.endAt.inclusive?"a:":"b:")+t.endAt.position.map(e=>iX(e)).join(",")),t.ft=n}return t.ft}function rN(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++){var i,r;if(i=e.orderBy[n],r=t.orderBy[n],!(i.dir===r.dir&&i.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!function e(t,n){return t instanceof rn?n instanceof rn&&t.op===n.op&&t.field.isEqual(n.field)&&iH(t.value,n.value):t instanceof ri?n instanceof ri&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,i,r)=>t&&e(i,n.filters[r]),!0):void n$()}(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!re(e.startAt,t.startAt)&&re(e.endAt,t.endAt)}function rx(e){return it.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function rO(e,t){return e.filters.filter(e=>e instanceof rn&&e.field.isEqual(t))}function rR(e,t,n){let i=iG,r=!0;for(let s of rO(e,t)){let a=iG,o=!0;switch(s.op){case"<":case"<=":var l;a="nullValue"in(l=s.value)?iG:"booleanValue"in l?{booleanValue:!1}:"integerValue"in l||"doubleValue"in l?{doubleValue:NaN}:"timestampValue"in l?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in l?{stringValue:""}:"bytesValue"in l?{bytesValue:""}:"referenceValue"in l?iJ(iN.empty(),it.empty()):"geoPointValue"in l?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in l?{arrayValue:{}}:"mapValue"in l?{mapValue:{}}:n$();break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,o=!1;break;case"!=":case"not-in":a=iG}0>i5({value:i,inclusive:r},{value:a,inclusive:o})&&(i=a,r=o)}if(null!==n){for(let u=0;u<e.orderBy.length;++u)if(e.orderBy[u].field.isEqual(t)){let h=n.position[u];0>i5({value:i,inclusive:r},{value:h,inclusive:n.inclusive})&&(i=h,r=n.inclusive);break}}return{value:i,inclusive:r}}function rM(e,t,n){let i=i$,r=!0;for(let s of rO(e,t)){let a=i$,o=!0;switch(s.op){case">=":case">":var l;a="nullValue"in(l=s.value)?{booleanValue:!1}:"booleanValue"in l?{doubleValue:NaN}:"integerValue"in l||"doubleValue"in l?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in l?{stringValue:""}:"stringValue"in l?{bytesValue:""}:"bytesValue"in l?iJ(iN.empty(),it.empty()):"referenceValue"in l?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in l?{arrayValue:{}}:"arrayValue"in l?{mapValue:{}}:"mapValue"in l?i$:n$(),o=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,o=!1;break;case"!=":case"not-in":a=i$}i8({value:i,inclusive:r},{value:a,inclusive:o})>0&&(i=a,r=o)}if(null!==n){for(let u=0;u<e.orderBy.length;++u)if(e.orderBy[u].field.isEqual(t)){let h=n.position[u];i8({value:i,inclusive:r},{value:h,inclusive:n.inclusive})>0&&(i=h,r=n.inclusive);break}}return{value:i,inclusive:r}}class rP{constructor(e,t=null,n=[],i=[],r=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=a,this.endAt=o,this.dt=null,this._t=null,this.startAt,this.endAt}}function rL(e){return new rP(e)}function rF(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function rV(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function rU(e){for(let t of e.filters){let n=t.getFirstInequalityField();if(null!==n)return n}return null}function rj(e){return null!==e.collectionGroup}function rq(e){let t=e;if(null===t.dt){t.dt=[];let n=rU(t),i=rV(t);if(null!==n&&null===i)n.isKeyField()||t.dt.push(new ry(n)),t.dt.push(new ry(ie.keyField(),"asc"));else{let r=!1;for(let s of t.explicitOrderBy)t.dt.push(s),s.field.isKeyField()&&(r=!0);if(!r){let a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.dt.push(new ry(ie.keyField(),a))}}}return t.dt}function rB(e){let t=e;if(!t._t){if("F"===t.limitType)t._t=rD(t.path,t.collectionGroup,rq(t),t.filters,t.limit,t.startAt,t.endAt);else{let n=[];for(let i of rq(t)){let r="desc"===i.dir?"asc":"desc";n.push(new ry(i.field,r))}let s=t.endAt?new i9(t.endAt.position,t.endAt.inclusive):null,a=t.startAt?new i9(t.startAt.position,t.startAt.inclusive):null;t._t=rD(t.path,t.collectionGroup,n,t.filters,t.limit,s,a)}}return t._t}function rK(e,t){t.getFirstInequalityField(),rU(e);let n=e.filters.concat([t]);return new rP(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function r$(e,t,n){return new rP(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function rG(e,t){return rN(rB(e),rB(t))&&e.limitType===t.limitType}function rz(e){return`${rA(rB(e))}|lt:${e.limitType}`}function rH(e){var t;let n;return`Query(target=${n=(t=rB(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof rn?`${t.field.canonicalString()} ${t.op} ${iX(t.value)}`:t instanceof ri?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n=", startAt: "+(t.startAt.inclusive?"b:":"a:")+t.startAt.position.map(e=>iX(e)).join(",")),t.endAt&&(n=", endAt: "+(t.endAt.inclusive?"a:":"b:")+t.endAt.position.map(e=>iX(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function rW(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):it.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of rq(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let i=i7(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,rq(e),t))&&(!e.endAt||!!function(e,t,n){let i=i7(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,rq(e),t))}function rQ(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function rY(e){return(t,n)=>{let i=!1;for(let r of rq(e)){let s=function(e,t,n){let i=e.field.isKeyField()?it.comparator(t.key,n.key):function(e,t,n){let i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?iQ(i,r):n$()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return -1*i;default:return n$()}}(r,t,n);if(0!==s)return s;i=i||r.field.isKeyField()}return 0}}function rX(e,t){if(e.wt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:iP(t)?"-0":t}}function rJ(e){return{integerValue:""+e}}class rZ{constructor(){this._=void 0}}function r0(e,t){return e instanceof r5?iZ(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class r1 extends rZ{}class r2 extends rZ{constructor(e){super(),this.elements=e}}function r3(e,t){let n=r9(t);for(let i of e.elements)n.some(e=>iH(e,i))||n.push(i);return{arrayValue:{values:n}}}class r4 extends rZ{constructor(e){super(),this.elements=e}}function r6(e,t){let n=r9(t);for(let i of e.elements)n=n.filter(e=>!iH(e,i));return{arrayValue:{values:n}}}class r5 extends rZ{constructor(e,t){super(),this.yt=e,this.gt=t}}function r8(e){return ij(e.integerValue||e.doubleValue)}function r9(e){return i0(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class r7{constructor(e,t){this.field=e,this.transform=t}}class se{constructor(e,t){this.version=e,this.transformResults=t}}class st{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new st}static exists(e){return new st(void 0,e)}static updateTime(e){return new st(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function sn(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class si{}function sr(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new sd(e.key,st.none()):new so(e.key,e.data,st.none());{let n=e.data,i=rS.empty(),r=new rI(ie.comparator);for(let s of t.fields)if(!r.has(s)){let a=n.field(s);null===a&&s.length>1&&(s=s.popLast(),a=n.field(s)),null===a?i.delete(s):i.set(s,a),r=r.add(s)}return new sl(e.key,i,new r_(r.toArray()),st.none())}}function ss(e,t,n,i){return e instanceof so?function(e,t,n,i){if(!sn(e.precondition,t))return n;let r=e.value.clone(),s=sc(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof sl?function(e,t,n,i){if(!sn(e.precondition,t))return n;let r=sc(e.fieldTransforms,i,t),s=t.data;return(s.setAll(su(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):sn(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function sa(e,t){var n,i;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,i=t.fieldTransforms,!!(void 0===n&&void 0===i||!(!n||!i)&&n4(n,i,(e,t)=>{var n,i;return e.field.isEqual(t.field)&&(n=e.transform,i=t.transform,n instanceof r2&&i instanceof r2||n instanceof r4&&i instanceof r4?n4(n.elements,i.elements,iH):n instanceof r5&&i instanceof r5?iH(n.gt,i.gt):n instanceof r1&&i instanceof r1)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class so extends si{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class sl extends si{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function su(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let i=e.data.field(n);t.set(n,i)}}),t}function sh(e,t,n){var i;let r=new Map;e.length===n.length||n$();for(let s=0;s<n.length;s++){let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof r2?r3(o,l):o instanceof r4?r6(o,l):i))}return r}function sc(e,t,n){let i=new Map;for(let r of e){let s=r.transform,a=n.data.field(r.field);i.set(r.field,s instanceof r1?function(e,t){let n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(t,a):s instanceof r2?r3(s,a):s instanceof r4?r6(s,a):function(e,t){let n=r0(e,t),i=r8(n)+r8(e.gt);return iZ(n)&&iZ(e.gt)?rJ(i):rX(e.yt,i)}(s,a))}return i}class sd extends si{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sf extends si{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class sp{constructor(e){this.count=e}}function sg(e){if(void 0===e)return nq("GRPC error has no .code"),nG.UNKNOWN;switch(e){case l.OK:return nG.OK;case l.CANCELLED:return nG.CANCELLED;case l.UNKNOWN:return nG.UNKNOWN;case l.DEADLINE_EXCEEDED:return nG.DEADLINE_EXCEEDED;case l.RESOURCE_EXHAUSTED:return nG.RESOURCE_EXHAUSTED;case l.INTERNAL:return nG.INTERNAL;case l.UNAVAILABLE:return nG.UNAVAILABLE;case l.UNAUTHENTICATED:return nG.UNAUTHENTICATED;case l.INVALID_ARGUMENT:return nG.INVALID_ARGUMENT;case l.NOT_FOUND:return nG.NOT_FOUND;case l.ALREADY_EXISTS:return nG.ALREADY_EXISTS;case l.PERMISSION_DENIED:return nG.PERMISSION_DENIED;case l.FAILED_PRECONDITION:return nG.FAILED_PRECONDITION;case l.ABORTED:return nG.ABORTED;case l.OUT_OF_RANGE:return nG.OUT_OF_RANGE;case l.UNIMPLEMENTED:return nG.UNIMPLEMENTED;case l.DATA_LOSS:return nG.DATA_LOSS;default:return n$()}}(u=l||(l={}))[u.OK=0]="OK",u[u.CANCELLED=1]="CANCELLED",u[u.UNKNOWN=2]="UNKNOWN",u[u.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",u[u.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",u[u.NOT_FOUND=5]="NOT_FOUND",u[u.ALREADY_EXISTS=6]="ALREADY_EXISTS",u[u.PERMISSION_DENIED=7]="PERMISSION_DENIED",u[u.UNAUTHENTICATED=16]="UNAUTHENTICATED",u[u.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",u[u.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",u[u.ABORTED=10]="ABORTED",u[u.OUT_OF_RANGE=11]="OUT_OF_RANGE",u[u.UNIMPLEMENTED=12]="UNIMPLEMENTED",u[u.INTERNAL=13]="INTERNAL",u[u.UNAVAILABLE=14]="UNAVAILABLE",u[u.DATA_LOSS=15]="DATA_LOSS";class sm{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[i,r]of n)if(this.equalsFn(i,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){iO(this.inner,(t,n)=>{for(let[i,r]of n)e(i,r)})}isEmpty(){return iR(this.inner)}size(){return this.innerSize}}let sy=new rv(it.comparator),sv=new rv(it.comparator);function sw(...e){let t=sv;for(let n of e)t=t.insert(n.key,n);return t}function sb(e){let t=sv;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function sI(){return new sm(e=>e.toString(),(e,t)=>e.isEqual(t))}let sT=new rv(it.comparator),sE=new rI(it.comparator);function s_(...e){let t=sE;for(let n of e)t=t.add(n);return t}let sS=new rI(n3);class sk{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,sC.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new sk(n5.min(),i,sS,sy,s_())}}class sC{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new sC(n,t,s_(),s_(),s_())}}class sD{constructor(e,t,n,i){this.It=e,this.removedTargetIds=t,this.key=n,this.Tt=i}}class sA{constructor(e,t){this.targetId=e,this.Et=t}}class sN{constructor(e,t,n=iF.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class sx{constructor(){this.At=0,this.Rt=sM(),this.bt=iF.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=s_(),t=s_(),n=s_();return this.Rt.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:n$()}}),new sC(this.bt,this.Pt,e,t,n)}xt(){this.vt=!1,this.Rt=sM()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class sO{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=sy,this.qt=sR(),this.Ut=new rI(n3)}Kt(e){for(let t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(let n of e.removedTargetIds)this.Qt(n,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{let n=this.Wt(t);switch(e.state){case 0:this.zt(t)&&n.Dt(e.resumeToken);break;case 1:n.Mt(),n.Vt||n.xt(),n.Dt(e.resumeToken);break;case 2:n.Mt(),n.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(n.Ft(),n.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),n.Dt(e.resumeToken));break;default:n$()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((e,n)=>{this.zt(n)&&t(n)})}Jt(e){let t=e.targetId,n=e.Et.count,i=this.Yt(t);if(i){let r=i.target;if(rx(r)){if(0===n){let s=new it(r.path);this.Qt(t,s,rk.newNoDocument(s,n5.min()))}else 1===n||n$()}else this.Xt(t)!==n&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){let t=new Map;this.Bt.forEach((n,i)=>{let r=this.Yt(i);if(r){if(n.current&&rx(r.target)){let s=new it(r.target.path);null!==this.Lt.get(s)||this.te(i,s)||this.Qt(i,s,rk.newNoDocument(s,e))}n.St&&(t.set(i,n.Ct()),n.xt())}});let n=s_();this.qt.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{let t=this.Yt(e);return!t||2===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.Lt.forEach((t,n)=>n.setReadTime(e));let i=new sk(e,t,this.Ut,this.Lt,n);return this.Lt=sy,this.qt=sR(),this.Ut=new rI(n3),i}Gt(e,t){if(!this.zt(e))return;let n=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,n){if(!this.zt(e))return;let i=this.Wt(e);this.te(e,t)?i.Nt(t,1):i.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}removeTarget(e){this.Bt.delete(e)}Xt(e){let t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new sx,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new rI(n3),this.qt=this.qt.insert(e,t)),t}zt(e){let t=null!==this.Yt(e);return t||nj("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){let t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new sx),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function sR(){return new rv(it.comparator)}function sM(){return new rv(it.comparator)}let sP={asc:"ASCENDING",desc:"DESCENDING"},sL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sF={and:"AND",or:"OR"};class sV{constructor(e,t){this.databaseId=e,this.wt=t}}function sU(e,t){return e.wt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function sj(e,t){return e.wt?t.toBase64():t.toUint8Array()}function sq(e){return e||n$(),n5.fromTimestamp(function(e){let t=iU(e);return new n6(t.seconds,t.nanos)}(e))}function sB(e,t){return new n9(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function sK(e){let t=n9.fromString(e);return s6(t)||n$(),t}function s$(e,t){return sB(e.databaseId,t.path)}function sG(e,t){let n=sK(t);if(n.get(1)!==e.databaseId.projectId)throw new nz(nG.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new nz(nG.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new it(sQ(n))}function sz(e,t){return sB(e.databaseId,t)}function sH(e){let t=sK(e);return 4===t.length?n9.emptyPath():sQ(t)}function sW(e){return new n9(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function sQ(e){return e.length>4&&"documents"===e.get(4)||n$(),e.popFirst(5)}function sY(e,t,n){return{name:s$(e,t),fields:n.value.mapValue.fields}}function sX(e,t,n){let i=sG(e,t.name),r=sq(t.updateTime),s=t.createTime?sq(t.createTime):n5.min(),a=new rS({mapValue:{fields:t.fields}}),o=rk.newFoundDocument(i,r,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function sJ(e,t){var n;let i;if(t instanceof so)i={update:sY(e,t.key,t.value)};else if(t instanceof sd)i={delete:s$(e,t.key)};else if(t instanceof sl)i={update:sY(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof sf))return n$();i={verify:s$(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof r1)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof r2)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof r4)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof r5)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw n$()})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:sU(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:n$()),i}function sZ(e,t){var n;let i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?st.updateTime(sq(n.updateTime)):void 0!==n.exists?st.exists(n.exists):st.none():st.none(),r=t.updateTransforms?t.updateTransforms.map(t=>(function(e,t){let n=null;if("setToServerValue"in t)"REQUEST_TIME"===t.setToServerValue||n$(),n=new r1;else if("appendMissingElements"in t){let i=t.appendMissingElements.values||[];n=new r2(i)}else if("removeAllFromArray"in t){let r=t.removeAllFromArray.values||[];n=new r4(r)}else"increment"in t?n=new r5(e,t.increment):n$();let s=ie.fromServerFormat(t.fieldPath);return new r7(s,n)})(e,t)):[];if(t.update){t.update.name;let s=sG(e,t.update.name),a=new rS({mapValue:{fields:t.update.fields}});if(t.updateMask){let o=function(e){let t=e.fieldPaths||[];return new r_(t.map(e=>ie.fromServerFormat(e)))}(t.updateMask);return new sl(s,a,o,i,r)}return new so(s,a,i,r)}if(t.delete){let l=sG(e,t.delete);return new sd(l,i)}if(t.verify){let u=sG(e,t.verify);return new sf(u,i)}return n$()}function s0(e,t){return{documents:[sz(e,t.path)]}}function s1(e,t){var n,i,r;let s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(s.parent=sz(e,a),s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s.parent=sz(e,a.popLast()),s.structuredQuery.from=[{collectionId:a.lastSegment()}]);let o=function(e){if(0!==e.length)return function e(t){return t instanceof rn?function(e){if("=="===e.op){if(i2(e.value))return{unaryFilter:{field:s3(e.field),op:"IS_NAN"}};if(i1(e.value))return{unaryFilter:{field:s3(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(i2(e.value))return{unaryFilter:{field:s3(e.field),op:"IS_NOT_NAN"}};if(i1(e.value))return{unaryFilter:{field:s3(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:s3(e.field),op:sL[e.op],value:e.value}}}(t):t instanceof ri?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:sF[t.op],filters:n}}}(t):n$()}(ri.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:s3(e.field),direction:sP[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=(i=t.limit,e.wt||null==i?i:{value:i});return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),s}function s2(e){var t,n,i,r,s,a,o,l;let u,h=sH(e.parent),c=e.structuredQuery,d=c.from?c.from.length:0,f=null;if(d>0){1===d||n$();let p=c.from[0];p.allDescendants?f=p.collectionId:h=h.child(p.collectionId)}let g=[];c.where&&(g=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=s4(e.unaryFilter.field);return rn.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=s4(e.unaryFilter.field);return rn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=s4(e.unaryFilter.field);return rn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=s4(e.unaryFilter.field);return rn.create(r,"!=",{nullValue:"NULL_VALUE"});default:return n$()}}(t):void 0!==t.fieldFilter?rn.create(s4(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return n$()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?ri.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return n$()}}(t.compositeFilter.op)):n$()}(e);return t instanceof ri&&ra(t)?t.getFilters():[t]}(c.where));let m=[];c.orderBy&&(m=c.orderBy.map(e=>new ry(s4(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let y=null;c.limit&&(y=null==(u="object"==typeof(t=c.limit)?t.value:t)?null:u);let v=null;c.startAt&&(v=function(e){let t=!!e.before,n=e.values||[];return new i9(n,t)}(c.startAt));let w=null;return c.endAt&&(w=function(e){let t=!e.before,n=e.values||[];return new i9(n,t)}(c.endAt)),n=h,i=f,r=m,s=g,a=y,o=v,l=w,new rP(n,i,r,s,a,"F",o,l)}function s3(e){return{fieldPath:e.canonicalString()}}function s4(e){return ie.fromServerFormat(e.fieldPath)}function s6(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function s5(e){var t,n;let i="";for(let r=0;r<e.length;r++)i.length>0&&(i+="\x01\x01"),i=function(e,t){let n=t,i=e.length;for(let r=0;r<i;r++){let s=e.charAt(r);switch(s){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=s}}return n}(e.get(r),i);return i+"\x01\x01"}function s8(e){let t=e.length;if(t>=2||n$(),2===t)return"\x01"===e.charAt(0)&&"\x01"===e.charAt(1)||n$(),n9.emptyPath();let n=t-2,i=[],r="";for(let s=0;s<t;){let a=e.indexOf("\x01",s);switch((a<0||a>n)&&n$(),e.charAt(a+1)){case"\x01":let o;let l=e.substring(s,a);0===r.length?o=l:(r+=l,o=r,r=""),i.push(o);break;case"\x10":r=e.substring(s,a)+"\0";break;case"\x11":r+=e.substring(s,a+1);break;default:n$()}s=a+2}return new n9(i)}let s9=["userId","batchId"],s7={},ae=["prefixPath","collectionGroup","readTime","documentId"],at=["prefixPath","collectionGroup","documentId"],an=["collectionGroup","readTime","prefixPath","documentId"],ai=["canonicalId","targetId"],ar=["targetId","path"],as=["path","targetId"],aa=["collectionId","parent"],ao=["indexId","uid"],al=["uid","sequenceNumber"],au=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ah=["indexId","uid","orderedDocumentKey"],ac=["userId","collectionPath","documentId"],ad=["userId","collectionPath","largestBatchId"],af=["userId","collectionGroup","largestBatchId"],ap=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ag=[...ap,"documentOverlays"],am=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ay=[...am,"indexConfiguration","indexState","indexEntries"];class av extends ip{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function aw(e,t){return iv.M(e.se,t)}class ab{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let r=this.mutations[i];if(r.key.isEqual(e.key)){var s;s=n[i],r instanceof so?function(e,t,n){let i=e.value.clone(),r=sh(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(r,e,s):r instanceof sl?function(e,t,n){if(!sn(e.precondition,t))return void t.convertToUnknownDocument(n.version);let i=sh(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(su(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(r,e,s):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,s)}}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=ss(n,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=ss(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=sI();return this.mutations.forEach(i=>{let r=e.get(i.key),s=r.overlayedDocument,a=this.applyToLocalView(s,r.mutatedFields);a=t.has(i.key)?null:a;let o=sr(s,a);null!==o&&n.set(i.key,o),s.isValidDocument()||s.convertToNoDocument(n5.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),s_())}isEqual(e){return this.batchId===e.batchId&&n4(this.mutations,e.mutations,(e,t)=>sa(e,t))&&n4(this.baseMutations,e.baseMutations,(e,t)=>sa(e,t))}}class aI{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){e.mutations.length===n.length||n$();let i=sT,r=e.mutations;for(let s=0;s<r.length;s++)i=i.insert(r[s].key,n[s].version);return new aI(e,t,n,i)}}class aT{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class aE{constructor(e,t,n,i,r=n5.min(),s=n5.min(),a=iF.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}withSequenceNumber(e){return new aE(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new aE(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new aE(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class a_{constructor(e){this.ie=e}}function aS(e,t){let n=t.key,i={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:ak(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var r;i.document={name:s$(r=e.ie,t.key),fields:t.data.value.mapValue.fields,updateTime:sU(r,t.version.toTimestamp()),createTime:sU(r,t.createTime.toTimestamp())}}else if(t.isNoDocument())i.noDocument={path:n.path.toArray(),readTime:aC(t.version)};else{if(!t.isUnknownDocument())return n$();i.unknownDocument={path:n.path.toArray(),version:aC(t.version)}}return i}function ak(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function aC(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function aD(e){let t=new n6(e.seconds,e.nanoseconds);return n5.fromTimestamp(t)}function aA(e,t){let n=(t.baseMutations||[]).map(t=>sZ(e.ie,t));for(let i=0;i<t.mutations.length-1;++i){let r=t.mutations[i];if(i+1<t.mutations.length&&void 0!==t.mutations[i+1].transform){let s=t.mutations[i+1];r.updateTransforms=s.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}let a=t.mutations.map(t=>sZ(e.ie,t)),o=n6.fromMillis(t.localWriteTimeMs);return new ab(t.batchId,o,n,a)}function aN(e){var t;let n;let i=aD(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?aD(e.lastLimboFreeSnapshotVersion):n5.min();return void 0!==e.query.documents?(1===(t=e.query).documents.length||n$(),n=rB(rL(sH(t.documents[0])))):n=rB(s2(e.query)),new aE(n,e.targetId,0,e.lastListenSequenceNumber,i,r,iF.fromBase64String(e.resumeToken))}function ax(e,t){let n;let i=aC(t.snapshotVersion),r=aC(t.lastLimboFreeSnapshotVersion);n=rx(t.target)?s0(e.ie,t.target):s1(e.ie,t.target);let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:rA(t.target),readTime:i,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:n}}function aO(e){let t=s2({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?r$(t,t.limit,"L"):t}function aR(e,t){return new aT(t.largestBatchId,sZ(e.ie,t.overlayMutation))}function aM(e,t){let n=t.path.lastSegment();return[e,s5(t.path.popLast()),n]}function aP(e,t,n,i){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:aC(i.readTime),documentKey:s5(i.documentKey.path),largestBatchId:i.largestBatchId}}class aL{getBundleMetadata(e,t){return aF(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:aD(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return aF(e).put({bundleId:t.id,createTime:aC(sq(t.createTime)),version:t.version})}getNamedQuery(e,t){return aV(e).get(t).next(e=>{if(e)return{name:e.name,query:aO(e.bundledQuery),readTime:aD(e.readTime)}})}saveNamedQuery(e,t){return aV(e).put({name:t.name,readTime:aC(sq(t.readTime)),bundledQuery:t.bundledQuery})}}function aF(e){return aw(e,"bundles")}function aV(e){return aw(e,"namedQueries")}class aU{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){let n=t.uid||"";return new aU(e,n)}getOverlay(e,t){return aj(e).get(aM(this.userId,t)).next(e=>e?aR(this.yt,e):null)}getOverlays(e,t){let n=sI();return im.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((n,r)=>{let s=new aT(t,r);i.push(this.oe(e,s))}),im.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(e=>i.add(s5(e.getCollectionPath())));let r=[];return i.forEach(t=>{let i=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);r.push(aj(e).Y("collectionPathOverlayIndex",i))}),im.waitFor(r)}getOverlaysForCollection(e,t,n){let i=sI(),r=s5(t),s=IDBKeyRange.bound([this.userId,r,n],[this.userId,r,Number.POSITIVE_INFINITY],!0);return aj(e).W("collectionPathOverlayIndex",s).next(e=>{for(let t of e){let n=aR(this.yt,t);i.set(n.getKey(),n)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let r;let s=sI(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return aj(e).Z({index:"collectionGroupOverlayIndex",range:a},(e,t,n)=>{let a=aR(this.yt,t);s.size()<i||a.largestBatchId===r?(s.set(a.getKey(),a),r=a.largestBatchId):n.done()}).next(()=>s)}oe(e,t){return aj(e).put(function(e,t,n){let[i,r,s]=aM(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:sJ(e.ie,n.mutation)}}(this.yt,this.userId,t))}}function aj(e){return aw(e,"documentOverlays")}class aq{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(ij(e.integerValue));else if("doubleValue"in e){let n=ij(e.doubleValue);isNaN(n)?this.he(t,13):(this.he(t,15),iP(n)?t.le(0):t.le(n))}else if("timestampValue"in e){let i=e.timestampValue;this.he(t,20),"string"==typeof i?t.fe(i):(t.fe(`${i.seconds||""}`),t.le(i.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(iq(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.he(t,45),t.le(r.latitude||0),t.le(r.longitude||0)}else"mapValue"in e?i6(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):n$()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){let n=e.fields||{};for(let i of(this.he(t,55),Object.keys(n)))this.de(i,t),this.ce(n[i],t)}ye(e,t){let n=e.values||[];for(let i of(this.he(t,50),n))this.ce(i,t)}me(e,t){this.he(t,37),it.fromName(e).path.forEach(e=>{this.he(t,60),this.pe(e,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function aB(e){let t=64-function(e){let t=0;for(let n=0;n<8;++n){let i=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[n]);if(t+=i,8!==i)break}return t}(e);return Math.ceil(t/8)}aq.Ie=new aq;class aK{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ee(n.value),n=t.next();this.Ae()}Re(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.be(n.value),n=t.next();this.Pe()}ve(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ee(n);else if(n<2048)this.Ee(960|n>>>6),this.Ee(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|n>>>12),this.Ee(128|63&n>>>6),this.Ee(128|63&n);else{let i=t.codePointAt(0);this.Ee(240|i>>>18),this.Ee(128|63&i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i)}}this.Ae()}Ve(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.be(n);else if(n<2048)this.be(960|n>>>6),this.be(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.be(480|n>>>12),this.be(128|63&n>>>6),this.be(128|63&n);else{let i=t.codePointAt(0);this.be(240|i>>>18),this.be(128|63&i>>>12),this.be(128|63&i>>>6),this.be(128|63&i)}}this.Pe()}Se(e){let t=this.De(e),n=aB(t);this.Ce(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}xe(e){let t=this.De(e),n=aB(t);this.Ce(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ee(e){let t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){let t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class a${constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class aG{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class az{constructor(){this.$e=new aK,this.Be=new a$(this.$e),this.Le=new aG(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class aH{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Ue(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new aH(this.indexId,this.documentKey,this.arrayValue,n)}}function aW(e,t){let n=e.indexId-t.indexId;return 0!==n?n:0!==(n=aQ(e.arrayValue,t.arrayValue))?n:0!==(n=aQ(e.directionalValue,t.directionalValue))?n:it.comparator(e.documentKey,t.documentKey)}function aQ(e,t){for(let n=0;n<e.length&&n<t.length;++n){let i=e[n]-t[n];if(0!==i)return i}return e.length-t.length}class aY{constructor(e){for(let t of(this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[],e.filters)){let n=t;n.isInequality()?this.Qe=n:this.Ge.push(n)}}je(e){e.collectionGroup===this.collectionId||n$();let t=ir(e);if(void 0!==t&&!this.We(t))return!1;let n=is(e),i=0,r=0;for(;i<n.length&&this.We(n[i]);++i);if(i===n.length)return!0;if(void 0!==this.Qe){let s=n[i];if(!this.ze(this.Qe,s)||!this.He(this.Ke[r++],s))return!1;++i}for(;i<n.length;++i){let a=n[i];if(r>=this.Ke.length||!this.He(this.Ke[r++],a))return!1}return!0}We(e){for(let t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function aX(e){return e instanceof rn}function aJ(e){return e instanceof ri&&ra(e)}function aZ(e){return aX(e)||aJ(e)||function(e){if(e instanceof ri&&rs(e)){for(let t of e.getFilters())if(!aX(t)&&!aJ(t))return!1;return!0}return!1}(e)}function a0(e,t){return e instanceof rn||e instanceof ri||n$(),t instanceof rn||t instanceof ri||n$(),a2(e instanceof rn?t instanceof rn?ri.create([e,t],"and"):a1(e,t):t instanceof rn?a1(t,e):function(e,t){if(e.filters.length>0&&t.filters.length>0||n$(),rr(e)&&rr(t))return rl(e,t.getFilters());let n=rs(e)?e:t,i=rs(e)?t:e,r=n.filters.map(e=>a0(e,i));return ri.create(r,"or")}(e,t))}function a1(e,t){if(rr(t))return rl(t,e.getFilters());{let n=t.filters.map(t=>a0(e,t));return ri.create(n,"or")}}function a2(e){if(e instanceof rn||e instanceof ri||n$(),e instanceof rn)return e;let t=e.getFilters();if(1===t.length)return a2(t[0]);if(ro(e))return e;let n=t.map(e=>a2(e)),i=[];return n.forEach(t=>{t instanceof rn?i.push(t):t instanceof ri&&(t.op===e.op?i.push(...t.filters):i.push(t))}),1===i.length?i[0]:ri.create(i,e.op)}class a3{constructor(){this.Je=new a4}addToCollectionParentIndex(e,t){return this.Je.add(t),im.resolve()}getCollectionParents(e,t){return im.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return im.resolve()}deleteFieldIndex(e,t){return im.resolve()}getDocumentsMatchingTarget(e,t){return im.resolve(null)}getIndexType(e,t){return im.resolve(0)}getFieldIndexes(e,t){return im.resolve([])}getNextCollectionGroupToUpdate(e){return im.resolve(null)}getMinOffset(e,t){return im.resolve(ih.min())}getMinOffsetFromCollectionGroup(e,t){return im.resolve(ih.min())}updateCollectionGroup(e,t,n){return im.resolve()}updateIndexEntries(e,t){return im.resolve()}}class a4{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new rI(n9.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new rI(n9.comparator)).toArray()}}let a6=new Uint8Array(0);class a5{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new a4,this.Xe=new sm(e=>rA(e),(e,t)=>rN(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});let r={collectionId:n,parent:s5(i)};return a8(e).put(r)}return im.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return a8(e).W(i).next(e=>{for(let i of e){if(i.collectionId!==t)break;n.push(s8(i.parent))}return n})}addFieldIndex(e,t){let n=a7(e),i={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete i.indexId;let r=n.add(i);if(t.indexState){let s=oe(e);return r.next(e=>{s.put(aP(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return r.next()}deleteFieldIndex(e,t){let n=a7(e),i=oe(e),r=a9(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){let n=a9(e),i=!0,r=new Map;return im.forEach(this.Ze(t),t=>this.tn(e,t).next(e=>{i&&(i=!!e),r.set(t,e)})).next(()=>{if(i){let e=s_(),s=[];return im.forEach(r,(i,r)=>{nj("IndexedDbIndexManager",`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${rA(t)}`);let a=function(e,t){let n=ir(t);if(void 0===n)return null;for(let i of rO(e,n.fieldPath))switch(i.op){case"array-contains-any":return i.value.arrayValue.values||[];case"array-contains":return[i.value]}return null}(r,i),o=function(e,t){let n=new Map;for(let i of is(t))for(let r of rO(e,i.fieldPath))switch(r.op){case"==":case"in":n.set(i.fieldPath.canonicalString(),r.value);break;case"not-in":case"!=":return n.set(i.fieldPath.canonicalString(),r.value),Array.from(n.values())}return null}(r,i),l=function(e,t){let n=[],i=!0;for(let r of is(t)){let s=0===r.kind?rR(e,r.fieldPath,e.startAt):rM(e,r.fieldPath,e.startAt);n.push(s.value),i&&(i=s.inclusive)}return new i9(n,i)}(r,i),u=function(e,t){let n=[],i=!0;for(let r of is(t)){let s=0===r.kind?rM(e,r.fieldPath,e.endAt):rR(e,r.fieldPath,e.endAt);n.push(s.value),i&&(i=s.inclusive)}return new i9(n,i)}(r,i),h=this.en(i,r,l),c=this.en(i,r,u),d=this.nn(i,r,o),f=this.sn(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return im.forEach(f,i=>n.J(i,t.limit).next(t=>{t.forEach(t=>{let n=it.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),s.push(n))})}))}).next(()=>s)}return im.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(t instanceof rn||t instanceof ri||n$(),t instanceof rn)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),i=ri.create(n,t.op);return aZ(i=a2(i))?i:(i instanceof ri||n$(),rr(i)||n$(),i.filters.length>1||n$(),i.filters.reduce((e,t)=>a0(e,t)))}(function e(t){var n,i;if(t instanceof rn||t instanceof ri||n$(),t instanceof rn){if(t instanceof rp){let r=(null===(i=null===(n=t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(e=>rn.create(t.field,"==",e)))||[];return ri.create(r,"or")}return t}let s=t.filters.map(t=>e(t));return ri.create(s,t.op)}(e));return aZ(t)||n$(),aX(t)||aJ(t)?[t]:t.getFilters()})(ri.create(e.filters,"and")).map(t=>rD(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t)),t}sn(e,t,n,i,r,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,r.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let c=t?this.rn(t[h/l]):a6,d=this.on(e,c,n[h%l],i),f=this.un(e,c,r[h%l],s),p=a.map(t=>this.on(e,c,t,!0));u.push(...this.createRange(d,f,p))}return u}on(e,t,n,i){let r=new aH(e,it.empty(),t,n);return i?r:r.Ue()}un(e,t,n,i){let r=new aH(e,it.empty(),t,n);return i?r.Ue():r}tn(e,t){let n=new aY(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(e=>{let t=null;for(let i of e)n.je(i)&&(!t||i.fields.length>t.fields.length)&&(t=i);return t})}getIndexType(e,t){let n=2,i=this.Ze(t);return im.forEach(i,t=>this.tn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new rI(ie.comparator),n=!1;for(let i of e.filters)for(let r of i.getFlattenedFilters())r.field.isKeyField()||("array-contains"===r.op||"array-contains-any"===r.op?n=!0:t=t.add(r.field));for(let s of e.orderBy)s.field.isKeyField()||(t=t.add(s.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}cn(e,t){let n=new az;for(let i of is(e)){let r=t.data.field(i.fieldPath);if(null==r)return null;let s=n.qe(i.kind);aq.Ie.ue(r,s)}return n.Fe()}rn(e){let t=new az;return aq.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){let n=new az;return aq.Ie.ue(iJ(this.databaseId,t),n.qe(function(e){let t=is(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Fe()}nn(e,t,n){if(null===n)return[];let i=[];i.push(new az);let r=0;for(let s of is(e)){let a=n[r++];for(let o of i)if(this.hn(t,s.fieldPath)&&i0(a))i=this.ln(i,s,a);else{let l=o.qe(s.kind);aq.Ie.ue(a,l)}}return this.fn(i)}en(e,t,n){return this.nn(e,t,n.position)}fn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Fe();return t}ln(e,t,n){let i=[...e],r=[];for(let s of n.arrayValue.values||[])for(let a of i){let o=new az;o.seed(a.Fe()),aq.Ie.ue(s,o.qe(t.kind)),r.push(o)}return r}hn(e,t){return!!e.filters.find(e=>e instanceof rn&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=a7(e),i=oe(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{let t=[];return im.forEach(e,e=>i.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){let n=t?new io(t.sequenceNumber,new ih(aD(t.readTime),new it(s8(t.documentKey)),t.largestBatchId)):io.empty(),i=e.fields.map(([e,t])=>new ia(ie.fromServerFormat(e),t));return new ii(e.indexId,e.collectionGroup,i,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:n3(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=a7(e),r=oe(e);return this.dn(e).next(e=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>im.forEach(t,t=>r.put(aP(t.indexId,this.user,e,n)))))}updateIndexEntries(e,t){let n=new Map;return im.forEach(t,(t,i)=>{let r=n.get(t.collectionGroup);return(r?im.resolve(r):this.getFieldIndexes(e,t.collectionGroup)).next(r=>(n.set(t.collectionGroup,r),im.forEach(r,n=>this._n(e,t,n).next(t=>{let r=this.wn(i,n);return t.isEqual(r)?im.resolve():this.mn(e,i,n,t,r)}))))})}gn(e,t,n,i){return a9(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.an(n,t.key),documentKey:t.key.path.toArray()})}yn(e,t,n,i){return a9(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.an(n,t.key),t.key.path.toArray()])}_n(e,t,n){let i=a9(e),r=new rI(aW);return i.Z({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.an(n,t)])},(e,i)=>{r=r.add(new aH(n.indexId,t,i.arrayValue,i.directionalValue))}).next(()=>r)}wn(e,t){let n=new rI(aW),i=this.cn(t,e);if(null==i)return n;let r=ir(t);if(null!=r){let s=e.data.field(r.fieldPath);if(i0(s))for(let a of s.arrayValue.values||[])n=n.add(new aH(t.indexId,e.key,this.rn(a),i))}else n=n.add(new aH(t.indexId,e.key,a6,i));return n}mn(e,t,n,i,r){nj("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,i,r){let s=e.getIterator(),a=t.getIterator(),o=rE(s),l=rE(a);for(;o||l;){let u=!1,h=!1;if(o&&l){let c=n(o,l);c<0?h=!0:c>0&&(u=!0)}else null!=o?h=!0:u=!0;u?(i(l),l=rE(a)):h?(r(o),o=rE(s)):(o=rE(s),l=rE(a))}}(i,r,aW,i=>{s.push(this.gn(e,t,n,i))},i=>{s.push(this.yn(e,t,n,i))}),im.waitFor(s)}dn(e){let t=1;return oe(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,i)=>{i.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>aW(e,t)).filter((e,t,n)=>!t||0!==aW(e,n[t-1]));let i=[];for(let r of(i.push(e),n)){let s=aW(r,e),a=aW(r,t);if(0===s)i[0]=e.Ue();else if(s>0&&a<0)i.push(r),i.push(r.Ue());else if(a>0)break}i.push(t);let o=[];for(let l=0;l<i.length;l+=2){if(this.pn(i[l],i[l+1]))return[];let u=[i[l].indexId,this.uid,i[l].arrayValue,i[l].directionalValue,a6,[]],h=[i[l+1].indexId,this.uid,i[l+1].arrayValue,i[l+1].directionalValue,a6,[]];o.push(IDBKeyRange.bound(u,h))}return o}pn(e,t){return aW(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ot)}getMinOffset(e,t){return im.mapArray(this.Ze(t),t=>this.tn(e,t).next(e=>e||n$())).next(ot)}}function a8(e){return aw(e,"collectionParents")}function a9(e){return aw(e,"indexEntries")}function a7(e){return aw(e,"indexConfiguration")}function oe(e){return aw(e,"indexState")}function ot(e){0!==e.length||n$();let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){let r=e[i].indexState.offset;0>ic(r,t)&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new ih(t.readTime,t.documentKey,n)}let on={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class oi{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new oi(e,oi.DEFAULT_COLLECTION_PERCENTILE,oi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function or(e,t,n){let i=e.store("mutations"),r=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=i.Z({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{1===o||n$()}));let u=[];for(let h of n.mutations){var c,d;let f=(c=h.key.path,d=n.batchId,[t,s5(c),d]);s.push(r.delete(f)),u.push(h.key)}return im.waitFor(s).next(()=>u)}function os(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw n$();t=e.noDocument}return JSON.stringify(t).length}oi.DEFAULT_COLLECTION_PERCENTILE=10,oi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,oi.DEFAULT=new oi(41943040,oi.DEFAULT_COLLECTION_PERCENTILE,oi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),oi.DISABLED=new oi(-1,0,0);class oa{constructor(e,t,n,i){this.userId=e,this.yt=t,this.indexManager=n,this.referenceDelegate=i,this.In={}}static re(e,t,n,i){""!==e.uid||n$();let r=e.isAuthenticated()?e.uid:"";return new oa(r,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ol(e).Z({index:"userMutationsIndex",range:n},(e,n,i)=>{t=!1,i.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let r=ou(e),s=ol(e);return s.add({}).next(a=>{"number"==typeof a||n$();let o=new ab(a,t,n,i),l=function(e,t,n){let i=n.baseMutations.map(t=>sJ(e.ie,t)),r=n.mutations.map(t=>sJ(e.ie,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:i,mutations:r}}(this.yt,this.userId,o),u=[],h=new rI((e,t)=>n3(e.canonicalString(),t.canonicalString()));for(let c of i){let d=[this.userId,s5(c.key.path),a];h=h.add(c.key.path.popLast()),u.push(s.put(l)),u.push(r.put(d,s7))}return h.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.In[a]=o.keys()}),im.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return ol(e).get(t).next(e=>e?(e.userId===this.userId||n$(),aA(this.yt,e)):null)}Tn(e,t){return this.In[t]?im.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.In[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),r=null;return ol(e).Z({index:"userMutationsIndex",range:i},(e,t,i)=>{t.userId===this.userId&&(t.batchId>=n||n$(),r=aA(this.yt,t)),i.done()}).next(()=>r)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ol(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(e,t,i)=>{n=t.batchId,i.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ol(e).W("userMutationsIndex",t).next(e=>e.map(e=>aA(this.yt,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,s5(t.path)],i=IDBKeyRange.lowerBound(n),r=[];return ou(e).Z({range:i},(n,i,s)=>{let[a,o,l]=n,u=s8(o);if(a===this.userId&&t.path.isEqual(u))return ol(e).get(l).next(e=>{if(!e)throw n$();e.userId===this.userId||n$(),r.push(aA(this.yt,e))});s.done()}).next(()=>r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new rI(n3),i=[];return t.forEach(t=>{let r=[this.userId,s5(t.path)],s=IDBKeyRange.lowerBound(r),a=ou(e).Z({range:s},(e,i,r)=>{let[s,a,o]=e,l=s8(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):r.done()});i.push(a)}),im.waitFor(i).next(()=>this.En(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,r=[this.userId,s5(n)],s=IDBKeyRange.lowerBound(r),a=new rI(n3);return ou(e).Z({range:s},(e,t,r)=>{let[s,o,l]=e,u=s8(o);s===this.userId&&n.isPrefixOf(u)?u.length===i&&(a=a.add(l)):r.done()}).next(()=>this.En(e,a))}En(e,t){let n=[],i=[];return t.forEach(t=>{i.push(ol(e).get(t).next(e=>{if(null===e)throw n$();e.userId===this.userId||n$(),n.push(aA(this.yt,e))}))}),im.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return or(e.se,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),im.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return im.resolve();let n=IDBKeyRange.lowerBound([this.userId]),i=[];return ou(e).Z({range:n},(e,t,n)=>{if(e[0]===this.userId){let r=s8(e[1]);i.push(r)}else n.done()}).next(()=>{0===i.length||n$()})})}containsKey(e,t){return oo(e,this.userId,t)}Rn(e){return oh(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function oo(e,t,n){let i=[t,s5(n.path)],r=i[1],s=IDBKeyRange.lowerBound(i),a=!1;return ou(e).Z({range:s,X:!0},(e,n,i)=>{let[s,o,l]=e;s===t&&o===r&&(a=!0),i.done()}).next(()=>a)}function ol(e){return aw(e,"mutations")}function ou(e){return aw(e,"documentMutations")}function oh(e){return aw(e,"mutationQueues")}class oc{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new oc(0)}static vn(){return new oc(-1)}}class od{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{let n=new oc(t.highestTargetId);return t.highestTargetId=n.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(e=>n5.fromTimestamp(new n6(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Vn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Sn(e,i)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(n=>(n.targetCount+=1,this.Cn(t,n),this.Sn(e,n))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>of(e).delete(t.targetId)).next(()=>this.Vn(e)).next(t=>(t.targetCount>0||n$(),t.targetCount-=1,this.Sn(e,t)))}removeTargets(e,t,n){let i=0,r=[];return of(e).Z((s,a)=>{let o=aN(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(i++,r.push(this.removeTargetData(e,o)))}).next(()=>im.waitFor(r)).next(()=>i)}forEachTarget(e,t){return of(e).Z((e,n)=>{let i=aN(n);t(i)})}Vn(e){return op(e).get("targetGlobalKey").next(e=>(null!==e||n$(),e))}Sn(e,t){return op(e).put("targetGlobalKey",t)}Dn(e,t){return of(e).put(ax(this.yt,t))}Cn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Vn(e).next(e=>e.targetCount)}getTargetData(e,t){let n=rA(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),r=null;return of(e).Z({range:i,index:"queryTargetsIndex"},(e,n,i)=>{let s=aN(n);rN(t,s.target)&&(r=s,i.done())}).next(()=>r)}addMatchingKeys(e,t,n){let i=[],r=og(e);return t.forEach(t=>{let s=s5(t.path);i.push(r.put({targetId:n,path:s})),i.push(this.referenceDelegate.addReference(e,n,t))}),im.waitFor(i)}removeMatchingKeys(e,t,n){let i=og(e);return im.forEach(t,t=>{let r=s5(t.path);return im.waitFor([i.delete([n,r]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=og(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=og(e),r=s_();return i.Z({range:n,X:!0},(e,t,n)=>{let i=s8(e[1]),s=new it(i);r=r.add(s)}).next(()=>r)}containsKey(e,t){let n=s5(t.path),i=IDBKeyRange.bound([n],[n+"\0"],!1,!0),r=0;return og(e).Z({index:"documentTargetsIndex",X:!0,range:i},([e,t],n,i)=>{0!==e&&(r++,i.done())}).next(()=>r>0)}ne(e,t){return of(e).get(t).next(e=>e?aN(e):null)}}function of(e){return aw(e,"targets")}function op(e){return aw(e,"targetGlobal")}function og(e){return aw(e,"targetDocuments")}function om([e,t],[n,i]){let r=n3(e,n);return 0===r?n3(t,i):r}class oy{constructor(e){this.xn=e,this.buffer=new rI(om),this.Nn=0}kn(){return++this.Nn}On(e){let t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();0>om(t,n)&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ov{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){nj("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){iI(e)?nj("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ig(e)}await this.Fn(3e5)})}}class ow{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return im.resolve(iD.at);let n=new oy(t);return this.$n.forEachTarget(e,e=>n.On(e.sequenceNumber)).next(()=>this.$n.Ln(e,e=>n.On(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.$n.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(nj("LruGarbageCollector","Garbage collection skipped; disabled"),im.resolve(on)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(nj("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),on):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let n,i,r,s,a,o,l;let u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(nj("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,s=Date.now(),this.nthSequenceNumber(e,i))).next(i=>(n=i,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(r=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),nU()<=f.$b.DEBUG&&nj("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${i} in `+(a-s)+"ms\n"+`	Removed ${r} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),im.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:e})))}}class ob{constructor(e,t){this.db=e,this.garbageCollector=new ow(this,t)}Bn(e){let t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Un(e){let t=0;return this.Ln(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(e,n)=>t(n))}addReference(e,t,n){return oI(e,n)}removeReference(e,t,n){return oI(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return oI(e,t)}Gn(e,t){let n;return n=!1,oh(e).tt(i=>oo(e,i,t).next(e=>(e&&(n=!0),im.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],r=0;return this.Kn(e,(s,a)=>{if(a<=t){let o=this.Gn(e,s).next(t=>{if(!t)return r++,n.getEntry(e,s).next(()=>(n.removeEntry(s,n5.min()),og(e).delete([0,s5(s.path)])))});i.push(o)}}).next(()=>im.waitFor(i)).next(()=>n.apply(e)).next(()=>r)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return oI(e,t)}Kn(e,t){let n=og(e),i,r=iD.at;return n.Z({index:"documentTargetsIndex"},([e,n],{path:s,sequenceNumber:a})=>{0===e?(r!==iD.at&&t(new it(s8(i)),r),r=a,i=s):r=iD.at}).next(()=>{r!==iD.at&&t(new it(s8(i)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function oI(e,t){var n;return og(e).put((n=e.currentSequenceNumber,{targetId:0,path:s5(t.path),sequenceNumber:n}))}class oT{constructor(){this.changes=new sm(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rk.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?im.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class oE{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return ok(e).put(n)}removeEntry(e,t,n){return ok(e).delete(function(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],ak(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Qn(e,n)))}getEntry(e,t){let n=rk.newInvalidDocument(t);return ok(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(oC(t))},(e,i)=>{n=this.jn(t,i)}).next(()=>n)}Wn(e,t){let n={size:0,document:rk.newInvalidDocument(t)};return ok(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(oC(t))},(e,i)=>{n={document:this.jn(t,i),size:os(i)}}).next(()=>n)}getEntries(e,t){let n=sy;return this.zn(e,t,(e,t)=>{let i=this.jn(e,t);n=n.insert(e,i)}).next(()=>n)}Hn(e,t){let n=sy,i=new rv(it.comparator);return this.zn(e,t,(e,t)=>{let r=this.jn(e,t);n=n.insert(e,r),i=i.insert(e,os(t))}).next(()=>({documents:n,Jn:i}))}zn(e,t,n){if(t.isEmpty())return im.resolve();let i=new rI(oA);t.forEach(e=>i=i.add(e));let r=IDBKeyRange.bound(oC(i.first()),oC(i.last())),s=i.getIterator(),a=s.getNext();return ok(e).Z({index:"documentKeyIndex",range:r},(e,t,i)=>{let r=it.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>oA(a,r);)n(a,null),a=s.getNext();a&&a.isEqual(r)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?i.j(oC(a)):i.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,i){let r=t.path,s=[r.popLast().toArray(),r.lastSegment(),ak(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[r.popLast().toArray(),r.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ok(e).W(IDBKeyRange.bound(s,a,!0)).next(e=>{let n=sy;for(let r of e){let s=this.jn(it.fromSegments(r.prefixPath.concat(r.collectionGroup,r.documentId)),r);s.isFoundDocument()&&(rW(t,s)||i.has(s.key))&&(n=n.insert(s.key,s))}return n})}getAllFromCollectionGroup(e,t,n,i){let r=sy,s=oD(t,n),a=oD(t,ih.max());return ok(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.jn(it.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(r=r.insert(s.key,s)).size===i&&n.done()}).next(()=>r)}newChangeBuffer(e){return new o_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return oS(e).get("remoteDocumentGlobalKey").next(e=>(e||n$(),e))}Qn(e,t){return oS(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){let n=function(e,t){let n;if(t.document)n=sX(e.ie,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let i=it.fromSegments(t.noDocument.path),r=aD(t.noDocument.readTime);n=rk.newNoDocument(i,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return n$();{let s=it.fromSegments(t.unknownDocument.path),a=aD(t.unknownDocument.version);n=rk.newUnknownDocument(s,a)}}return t.readTime&&n.setReadTime(function(e){let t=new n6(e[0],e[1]);return n5.fromTimestamp(t)}(t.readTime)),n}(this.yt,t);if(!(n.isNoDocument()&&n.version.isEqual(n5.min())))return n}return rk.newInvalidDocument(e)}}class o_ extends oT{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new sm(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,i=new rI((e,t)=>n3(e.canonicalString(),t.canonicalString()));return this.changes.forEach((r,s)=>{let a=this.Xn.get(r);if(t.push(this.Yn.removeEntry(e,r,a.readTime)),s.isValidDocument()){let o=aS(this.Yn.yt,s);i=i.add(r.path.popLast());let l=os(o);n+=l-a.size,t.push(this.Yn.addEntry(e,r,o))}else if(n-=a.size,this.trackRemovals){let u=aS(this.Yn.yt,s.convertToNoDocument(n5.min()));t.push(this.Yn.addEntry(e,r,u))}}),i.forEach(n=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Yn.updateMetadata(e,n)),im.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(e=>(this.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:e,Jn:t})=>(t.forEach((t,n)=>{this.Xn.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function oS(e){return aw(e,"remoteDocumentGlobal")}function ok(e){return aw(e,"remoteDocumentsV14")}function oC(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function oD(e,t){let n=t.documentKey.path.toArray();return[e,ak(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function oA(e,t){let n=e.path.toArray(),i=t.path.toArray(),r=0;for(let s=0;s<n.length-2&&s<i.length-2;++s)if(r=n3(n[s],i[s]))return r;return(r=n3(n.length,i.length))||(r=n3(n[n.length-2],i[i.length-2]))||n3(n[n.length-1],i[i.length-1])}class oN{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ox{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ss(n.mutation,e,r_.empty(),n6.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,s_()).next(()=>t))}getLocalViewOfDocuments(e,t,n=s_()){let i=sI();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=sw();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=sI();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,s_()))}populateOverlays(e,t,n){let i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let r=sy,s=sI(),a=sI();return t.forEach((e,t)=>{let a=n.get(t.key);i.has(t.key)&&(void 0===a||a.mutation instanceof sl)?r=r.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),ss(a.mutation,t,a.mutation.getFieldMask(),n6.now())):s.set(t.key,r_.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new oN(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=sI(),i=new rv((e,t)=>e-t),r=s_();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let r of e)r.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||r_.empty();a=r.applyToLocalView(s,a),n.set(e,a);let o=(i.get(r.batchId)||s_()).add(e);i=i.insert(r.batchId,o)})}).next(()=>{let s=[],a=i.getReverseIterator();for(;a.hasNext();){let o=a.getNext(),l=o.key,u=o.value,h=sI();u.forEach(e=>{if(!r.has(e)){let i=sr(t.get(e),n.get(e));null!==i&&h.set(e,i),r=r.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,l,h))}return im.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n){return it.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):rj(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(r=>{let s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):im.resolve(sI()),a=-1,o=r;return s.next(t=>im.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),r.get(t)?im.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,o,t,s_())).next(e=>({batchId:a,changes:sb(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new it(t)).next(e=>{let t=sw();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n){let i=t.collectionGroup,r=sw();return this.indexManager.getCollectionParents(e,i).next(s=>im.forEach(s,s=>{var a;let o=(a=s.child(i),new rP(a,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(e,o,n).next(e=>{e.forEach((e,t)=>{r=r.insert(e,t)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,t,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i))).next(e=>{i.forEach((t,n)=>{let i=n.getKey();null===e.get(i)&&(e=e.insert(i,rk.newInvalidDocument(i)))});let n=sw();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&ss(s.mutation,r,r_.empty(),n6.now()),rW(t,r)&&(n=n.insert(e,r))}),n})}}class oO{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return im.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){return this.Zn.set(t.id,{id:t.id,version:t.version,createTime:sq(t.createTime)}),im.resolve()}getNamedQuery(e,t){return im.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:t.name,query:aO(t.bundledQuery),readTime:sq(t.readTime)}),im.resolve()}}class oR{constructor(){this.overlays=new rv(it.comparator),this.es=new Map}getOverlay(e,t){return im.resolve(this.overlays.get(t))}getOverlays(e,t){let n=sI();return im.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.oe(e,t,i)}),im.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.es.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.es.delete(n)),im.resolve()}getOverlaysForCollection(e,t,n){let i=sI(),r=t.length+1,s=new it(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let o=a.getNext().value,l=o.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===r&&o.largestBatchId>n&&i.set(o.getKey(),o)}return im.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new rv((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let a=s.getNext().value;if(a.getKey().getCollectionGroup()===t&&a.largestBatchId>n){let o=r.get(a.largestBatchId);null===o&&(o=sI(),r=r.insert(a.largestBatchId,o)),o.set(a.getKey(),a)}}let l=sI(),u=r.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((e,t)=>l.set(e,t)),!(l.size()>=i)););return im.resolve(l)}oe(e,t,n){let i=this.overlays.get(n.key);if(null!==i){let r=this.es.get(i.largestBatchId).delete(n.key);this.es.set(i.largestBatchId,r)}this.overlays=this.overlays.insert(n.key,new aT(t,n));let s=this.es.get(t);void 0===s&&(s=s_(),this.es.set(t,s)),this.es.set(t,s.add(n.key))}}class oM{constructor(){this.ns=new rI(oP.ss),this.rs=new rI(oP.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){let n=new oP(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.cs(new oP(e,t))}hs(e,t){e.forEach(e=>this.removeReference(e,t))}ls(e){let t=new it(new n9([])),n=new oP(t,e),i=new oP(t,e+1),r=[];return this.rs.forEachInRange([n,i],e=>{this.cs(e),r.push(e.key)}),r}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){let t=new it(new n9([])),n=new oP(t,e),i=new oP(t,e+1),r=s_();return this.rs.forEachInRange([n,i],e=>{r=r.add(e.key)}),r}containsKey(e){let t=new oP(e,0),n=this.ns.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class oP{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return it.comparator(e.key,t.key)||n3(e._s,t._s)}static os(e,t){return n3(e._s,t._s)||it.comparator(e.key,t.key)}}class oL{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new rI(oP.ss)}checkEmpty(e){return im.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){let r=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ab(r,t,n,i);for(let a of(this.mutationQueue.push(s),i))this.gs=this.gs.add(new oP(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return im.resolve(s)}lookupMutationBatch(e,t){return im.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ps(t+1),i=n<0?0:n;return im.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return im.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return im.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new oP(t,0),i=new oP(t,Number.POSITIVE_INFINITY),r=[];return this.gs.forEachInRange([n,i],e=>{let t=this.ys(e._s);r.push(t)}),im.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new rI(n3);return t.forEach(e=>{let t=new oP(e,0),i=new oP(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,i],e=>{n=n.add(e._s)})}),im.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,r=n;it.isDocumentKey(r)||(r=r.child(""));let s=new oP(new it(r),0),a=new rI(n3);return this.gs.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(a=a.add(e._s)),!0)},s),im.resolve(this.Is(a))}Is(e){let t=[];return e.forEach(e=>{let n=this.ys(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){0===this.Ts(t.batchId,"removed")||n$(),this.mutationQueue.shift();let n=this.gs;return im.forEach(t.mutations,i=>{let r=new oP(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.gs=n})}An(e){}containsKey(e,t){let n=new oP(t,0),i=this.gs.firstAfterOrEqual(n);return im.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,im.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){let t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class oF{constructor(e){this.Es=e,this.docs=new rv(it.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return im.resolve(n?n.document.mutableCopy():rk.newInvalidDocument(t))}getEntries(e,t){let n=sy;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():rk.newInvalidDocument(e))}),im.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=sy,s=t.path,a=new it(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:l,value:{document:u}}=o.getNext();if(!s.isPrefixOf(l.path))break;l.path.length>s.length+1||0>=ic(iu(u),n)||(i.has(u.key)||rW(t,u))&&(r=r.insert(u.key,u.mutableCopy()))}return im.resolve(r)}getAllFromCollectionGroup(e,t,n,i){n$()}As(e,t){return im.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new oV(this)}getSize(e){return im.resolve(this.size)}}class oV extends oT{constructor(e){super(),this.Yn=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Yn.addEntry(e,i)):this.Yn.removeEntry(n)}),im.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class oU{constructor(e){this.persistence=e,this.Rs=new sm(e=>rA(e),rN),this.lastRemoteSnapshotVersion=n5.min(),this.highestTargetId=0,this.bs=0,this.Ps=new oM,this.targetCount=0,this.vs=oc.Pn()}forEachTarget(e,t){return this.Rs.forEach((e,n)=>t(n)),im.resolve()}getLastRemoteSnapshotVersion(e){return im.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return im.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),im.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),im.resolve()}Dn(e){this.Rs.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.vs=new oc(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,im.resolve()}updateTargetData(e,t){return this.Dn(t),im.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,im.resolve()}removeTargets(e,t,n){let i=0,r=[];return this.Rs.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Rs.delete(s),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),im.waitFor(r).next(()=>i)}getTargetCount(e){return im.resolve(this.targetCount)}getTargetData(e,t){let n=this.Rs.get(t)||null;return im.resolve(n)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),im.resolve()}removeMatchingKeys(e,t,n){this.Ps.hs(t,n);let i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(t=>{r.push(i.markPotentiallyOrphaned(e,t))}),im.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),im.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Ps.ds(t);return im.resolve(n)}containsKey(e,t){return im.resolve(this.Ps.containsKey(t))}}class oj{constructor(e,t){var n;this.Vs={},this.overlays={},this.Ss=new iD(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new oU(this),this.indexManager=new a3,this.remoteDocumentCache=(n=e=>this.referenceDelegate.xs(e),new oF(n)),this.yt=new a_(t),this.Ns=new oO(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new oR,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new oL(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){nj("MemoryPersistence","Starting transaction:",e);let i=new oq(this.Ss.next());return this.referenceDelegate.ks(),n(i).next(e=>this.referenceDelegate.Os(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Ms(e,t){return im.or(Object.values(this.Vs).map(n=>()=>n.containsKey(e,t)))}}class oq extends ip{constructor(e){super(),this.currentSequenceNumber=e}}class oB{constructor(e){this.persistence=e,this.Fs=new oM,this.$s=null}static Bs(e){return new oB(e)}get Ls(){if(this.$s)return this.$s;throw n$()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),im.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),im.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),im.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(e=>this.Ls.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ls.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return im.forEach(this.Ls,n=>{let i=it.fromPath(n);return this.qs(e,i).next(e=>{e||t.removeEntry(i,n5.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return im.or([()=>im.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class oK{constructor(e){this.yt=e}$(e,t,n,i){let r=new iy("createOrUpgrade",t);n<1&&i>=1&&(function(e){e.createObjectStore("owner")}(e),e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",s9,{unique:!0}),e.createObjectStore("documentMutations"),o$(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=im.resolve();return n<3&&i>=3&&(0!==n&&(e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal"),o$(e)),s=s.next(()=>(function(e){let t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:n5.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)})(r))),n<4&&i>=4&&(0!==n&&(s=s.next(()=>r.store("mutations").W().next(t=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",s9,{unique:!0});let n=r.store("mutations"),i=t.map(e=>n.put(e));return im.waitFor(i)}))),s=s.next(()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(s=s.next(()=>this.Us(r))),n<6&&i>=6&&(s=s.next(()=>((function(e){e.createObjectStore("remoteDocumentGlobal")})(e),this.Ks(r)))),n<7&&i>=7&&(s=s.next(()=>this.Gs(r))),n<8&&i>=8&&(s=s.next(()=>this.Qs(e,r))),n<9&&i>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&i>=10&&(s=s.next(()=>this.js(r))),n<11&&i>=11&&(s=s.next(()=>{(function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(s=s.next(()=>{!function(e){let t=e.createObjectStore("documentOverlays",{keyPath:ac});t.createIndex("collectionPathOverlayIndex",ad,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",af,{unique:!1})}(e)})),n<13&&i>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore("remoteDocumentsV14",{keyPath:ae});t.createIndex("documentKeyIndex",at),t.createIndex("collectionGroupIndex",an)})(e)).next(()=>this.Ws(e,r)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(s=s.next(()=>this.zs(e,r))),n<15&&i>=15&&(s=s.next(()=>{e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:ao}).createIndex("sequenceNumberIndex",al,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:au}).createIndex("documentKeyIndex",ah,{unique:!1})})),s}Ks(e){let t=0;return e.store("remoteDocuments").Z((e,n)=>{t+=os(n)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Us(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next(t=>im.forEach(t,t=>{let i=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",i).next(n=>im.forEach(n,n=>{n.userId===t.userId||n$();let i=aA(this.yt,n);return or(e,t.userId,i).next(()=>{})}))}))}Gs(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{let i=[];return n.Z((n,r)=>{let s=new n9(n),a=[0,s5(s)];i.push(t.get(a).next(n=>n?im.resolve():t.put({targetId:0,path:s5(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>im.waitFor(i))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:aa});let n=t.store("collectionParents"),i=new a4,r=e=>{if(i.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:s5(r)})}};return t.store("remoteDocuments").Z({X:!0},(e,t)=>{let n=new n9(e);return r(n.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([e,t,n],i)=>{let s=s8(t);return r(s.popLast())}))}js(e){let t=e.store("targets");return t.Z((e,n)=>{let i=aN(n),r=ax(this.yt,i);return t.put(r)})}Ws(e,t){let n=t.store("remoteDocuments"),i=[];return n.Z((e,n)=>{let r=t.store("remoteDocumentsV14"),s=(n.document?new it(n9.fromString(n.document.name).popFirst(5)):n.noDocument?it.fromSegments(n.noDocument.path):n.unknownDocument?it.fromSegments(n.unknownDocument.path):n$()).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};i.push(r.put(a))}).next(()=>im.waitFor(i))}zs(e,t){var n;let i=t.store("mutations"),r=(n=this.yt,new oE(n)),s=new oj(oB.Bs,this.yt.ie);return i.W().next(e=>{let n=new Map;return e.forEach(e=>{var t;let i=null!==(t=n.get(e.userId))&&void 0!==t?t:s_();aA(this.yt,e).keys().forEach(e=>i=i.add(e)),n.set(e.userId,i)}),im.forEach(n,(e,n)=>{let i=new nL(n),a=aU.re(this.yt,i),o=s.getIndexManager(i),l=oa.re(i,this.yt,o,s.referenceDelegate);return new ox(r,l,a,o).recalculateAndSaveOverlaysForDocumentKeys(new av(t,iD.at),e).next()})})}}function o$(e){e.createObjectStore("targetDocuments",{keyPath:ar}).createIndex("documentTargetsIndex",as,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ai,{unique:!0}),e.createObjectStore("targetGlobal")}let oG="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class oz{constructor(e,t,n,i,r,s,a,o,l,u,h=15){var c;if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Hs=r,this.window=s,this.document=a,this.Js=l,this.Ys=u,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=e=>Promise.resolve(),!oz.C())throw new nz(nG.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ob(this,i),this.ii=t+"main",this.yt=new a_(o),this.ri=new iv(this.ii,this.Xs,new oK(this.yt)),this.Cs=new od(this.referenceDelegate,this.yt),this.remoteDocumentCache=(c=this.yt,new oE(c)),this.Ns=new aL,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===u&&nq("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new nz(nG.FAILED_PRECONDITION,oG);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new iD(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){return this.si=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>oW(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(iI(e))return nj("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return nj("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return oH(e).get("owner").next(e=>im.resolve(this.mi(e)))}gi(e){return oW(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=aw(e,"clientMetadata");return t.W().next(e=>{let n=this.Ii(e,18e5),i=e.filter(e=>-1===n.indexOf(e));return im.forEach(i,e=>t.delete(e.clientId)).next(()=>i)})}).catch(()=>[]);if(this.oi)for(let t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?im.resolve(!0):oH(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new nz(nG.FAILED_PRECONDITION,oG);return!1}}return!(!this.networkEnabled||!this.inForeground)||oW(e).W().next(e=>void 0===this.Ii(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,i=this.networkEnabled===e.networkEnabled;if(t||n&&i)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&nj("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new av(e,iD.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(e=>this.pi(e.updateTimeMs,t)&&!this.Ei(e.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>oW(e).W().next(e=>this.Ii(e,18e5).map(e=>e.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return oa.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new a5(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return aU.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,n){var i;let r;nj("IndexedDbPersistence","Starting transaction:",e);let s=15===(i=this.Xs)?ay:14===i?am:13===i?am:12===i?ag:11===i?ap:void n$();return this.ri.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,i=>(r=new av(i,this.Ss?this.Ss.next():iD.at),"readwrite-primary"===t?this.fi(r).next(e=>!!e||this.di(r)).next(t=>{if(!t)throw nq(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new nz(nG.FAILED_PRECONDITION,id);return n(r)}).next(e=>this.wi(r).next(()=>e)):this.Vi(r).next(()=>n(r)))).then(e=>(r.raiseOnCommittedEvent(),e))}Vi(e){return oH(e).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new nz(nG.FAILED_PRECONDITION,oG)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return oH(e).put("owner",t)}static C(){return iv.C()}_i(e){let t=oH(e);return t.get("owner").next(e=>this.mi(e)?(nj("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):im.resolve())}pi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(nq(`Detected an update time that is in the future: ${e} > ${n}`),!1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,p.nr)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{let n=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return nj("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(i){return nq("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){nq("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function oH(e){return aw(e,"owner")}function oW(e){return aw(e,"clientMetadata")}class oQ{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=i}static Ci(e,t){let n=s_(),i=s_();for(let r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new oQ(e,t.fromCache,n,i)}}class oY{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,n,i){return this.ki(e,t).next(r=>r||this.Oi(e,t,i,n)).next(n=>n||this.Mi(e,t))}ki(e,t){if(rF(t))return im.resolve(null);let n=rB(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(n=rB(t=r$(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{let r=s_(...i);return this.Ni.getDocuments(e,r).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Fi(t,i);return this.$i(t,s,r,n.readTime)?this.ki(e,r$(t,null,"F")):this.Bi(e,s,t,n)}))})))}Oi(e,t,n,i){return rF(t)||i.isEqual(n5.min())?this.Mi(e,t):this.Ni.getDocuments(e,n).next(r=>{let s=this.Fi(t,r);return this.$i(t,s,n,i)?this.Mi(e,t):(nU()<=f.$b.DEBUG&&nj("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),rH(t)),this.Bi(e,s,t,il(i,-1)))})}Fi(e,t){let n=new rI(rY(e));return t.forEach((t,i)=>{rW(e,i)&&(n=n.add(i))}),n}$i(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Mi(e,t){return nU()<=f.$b.DEBUG&&nj("QueryEngine","Using full collection scan to execute query:",rH(t)),this.Ni.getDocumentsMatchingQuery(e,t,ih.min())}Bi(e,t,n,i){return this.Ni.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class oX{constructor(e,t,n,i){this.persistence=e,this.Li=t,this.yt=i,this.qi=new rv(n3),this.Ui=new sm(e=>rA(e),rN),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ox(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}async function oJ(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(r=>(i=r,e.Qi(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let r=[],s=[],a=s_();for(let o of i)for(let l of(r.push(o.batchId),o.mutations))a=a.add(l.key);for(let u of t)for(let h of(s.push(u.batchId),u.mutations))a=a.add(h.key);return e.localDocuments.getDocuments(n,a).next(e=>({ji:e,removedBatchIds:r,addedBatchIds:s}))})})}function oZ(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function o0(e,t,n){let i=s_(),r=s_();return n.forEach(e=>i=i.add(e)),t.getEntries(e,i).next(e=>{let i=sy;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(r=r.add(n)),s.isNoDocument()&&s.version.isEqual(n5.min())?(t.removeEntry(n,s.readTime),i=i.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),i=i.insert(n,s)):nj("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{Wi:i,zi:r}})}function o1(e,t){let n=e;return n.persistence.runTransaction("Allocate target","readwrite",e=>{let i;return n.Cs.getTargetData(e,t).next(r=>r?(i=r,im.resolve(i)):n.Cs.allocateTargetId(e).next(r=>(i=new aE(t,r,0,e.currentSequenceNumber),n.Cs.addTargetData(e,i).next(()=>i))))}).then(e=>{let i=n.qi.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.qi=n.qi.insert(e.targetId,e),n.Ui.set(t,e.targetId)),e})}async function o2(e,t,n){let i=e,r=i.qi.get(t);try{n||await i.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",e=>i.persistence.referenceDelegate.removeTarget(e,r))}catch(s){if(!iI(s))throw s;nj("LocalStore",`Failed to update sequence numbers for target ${t}: ${s}`)}i.qi=i.qi.remove(t),i.Ui.delete(r.target)}function o3(e,t,n){let i=n5.min(),r=s_();return e.persistence.runTransaction("Execute query","readonly",s=>(function(e,t,n){let i=e.Ui.get(n);return void 0!==i?im.resolve(e.qi.get(i)):e.Cs.getTargetData(t,n)})(e,s,rB(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,e.Cs.getMatchingKeysForTargetId(s,t.targetId).next(e=>{r=e})}).next(()=>e.Li.getDocumentsMatchingQuery(s,t,n?i:n5.min(),n?r:s_())).next(n=>(o5(e,rQ(t),n),{documents:n,Hi:r})))}function o4(e,t){let n=e.Cs,i=e.qi.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",e=>n.ne(e,t).next(e=>e?e.target:null))}function o6(e,t){let n=e.Ki.get(t)||n5.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.Gi.getAllFromCollectionGroup(i,t,il(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(o5(e,t,n),n))}function o5(e,t,n){let i=e.Ki.get(t)||n5.min();n.forEach((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)}),e.Ki.set(t,i)}function o8(e,t){return`firestore_clients_${e}_${t}`}function o9(e,t,n){let i=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(i+=`_${t.uid}`),i}function o7(e,t){return`firestore_targets_${e}_${t}`}class le{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Zi(e,t,n){let i=JSON.parse(n),r,s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new nz(i.error.code,i.error.message)),s?new le(e,t,i.state,r):(nq("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}tr(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lt{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){let n=JSON.parse(t),i,r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new nz(n.error.code,n.error.message)),r?new lt(e,n.state,i):(nq("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ln{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){let n=JSON.parse(t),i="object"==typeof n&&n.activeTargetIds instanceof Array,r=sS;for(let s=0;i&&s<n.activeTargetIds.length;++s)i=iL(n.activeTargetIds[s]),r=r.add(n.activeTargetIds[s]);return i?new ln(e,r):(nq("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class li{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new li(t.clientId,t.onlineState):(nq("SharedClientState",`Failed to parse online state: ${e}`),null)}}class lr{constructor(){this.activeTargetIds=sS}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ls{constructor(){this.Lr=new lr,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,n){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new lr,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class la{Ur(e){}shutdown(){}}class lo{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){for(let e of(nj("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.Wr))e(0)}jr(){for(let e of(nj("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.Wr))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ll={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lu{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class lh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,n,i,r){let s=this.ho(e,t);nj("RestConnection","Sending: ",s,n);let a={};return this.lo(a,i,r),this.fo(e,s,a,n).then(e=>(nj("RestConnection","Received: ",e),e),t=>{throw nB("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t})}_o(e,t,n,i,r,s){return this.ao(e,t,n,i,r)}lo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+nF,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}ho(e,t){let n=ll[e];return`${this.oo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,n,i){return new Promise((r,s)=>{let a=new nM;a.setWithCredentials(!0),a.listenOnce(nA.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case nD.NO_ERROR:let t=a.getResponseJson();nj("Connection","XHR received:",JSON.stringify(t)),r(t);break;case nD.TIMEOUT:nj("Connection",'RPC "'+e+'" timed out'),s(new nz(nG.DEADLINE_EXCEEDED,"Request time out"));break;case nD.HTTP_ERROR:let n=a.getStatus();if(nj("Connection",'RPC "'+e+'" failed with status:',n,"response text:",a.getResponseText()),n>0){let i=a.getResponseJson();Array.isArray(i)&&(i=i[0]);let o=null==i?void 0:i.error;if(o&&o.status&&o.message){let l=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(nG).indexOf(t)>=0?t:nG.UNKNOWN}(o.status);s(new nz(l,o.message))}else s(new nz(nG.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new nz(nG.UNAVAILABLE,"Connection failed."));break;default:n$()}}finally{nj("Connection",'RPC "'+e+'" completed.')}});let o=JSON.stringify(i);a.send(t,"POST",o,n,15)})}wo(e,t,n){let i=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=nk(),s=nC(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new nO({})),this.lo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;let o=i.join("");nj("Connection","Creating WebChannel: "+o,a);let u=r.createWebChannel(o,a),h=!1,c=!1,d=new lu({Hr(e){c?nj("Connection","Not sending because WebChannel is closed:",e):(h||(nj("Connection","Opening WebChannel transport."),u.open(),h=!0),nj("Connection","WebChannel sending:",e),u.send(e))},Jr:()=>u.close()}),f=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return f(u,nR.EventType.OPEN,()=>{c||nj("Connection","WebChannel transport opened.")}),f(u,nR.EventType.CLOSE,()=>{c||(c=!0,nj("Connection","WebChannel transport closed"),d.io())}),f(u,nR.EventType.ERROR,e=>{c||(c=!0,nB("Connection","WebChannel transport errored:",e),d.io(new nz(nG.UNAVAILABLE,"The operation could not be completed")))}),f(u,nR.EventType.MESSAGE,e=>{var t;if(!c){let n=e.data[0];n||n$();let i=n.error||(null===(t=n[0])||void 0===t?void 0:t.error);if(i){nj("Connection","WebChannel received error:",i);let r=i.status,s=function(e){let t=l[e];if(void 0!==t)return sg(t)}(r),a=i.message;void 0===s&&(s=nG.INTERNAL,a="Unknown error status: "+r+" with message "+i.message),c=!0,d.io(new nz(s,a)),u.close()}else nj("Connection","WebChannel received:",n),d.ro(n)}}),f(s,nN.STAT_EVENT,e=>{e.stat===nx.PROXY?nj("Connection","Detected buffering proxy"):e.stat===nx.NOPROXY&&nj("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}function lc(){return"undefined"!=typeof document?document:null}function ld(e){return new sV(e,!0)}class lf{constructor(e,t,n=1e3,i=1.5,r=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=i,this.po=r,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();let t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),i=Math.max(0,t-n);i>0&&nj("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,i,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class lp{constructor(e,t,n,i,r,s,a,o){this.Hs=e,this.vo=n,this.Vo=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new lf(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===nG.RESOURCE_EXHAUSTED?(nq(t.toString()),nq("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===nG.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;let e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.So===t&&this.Go(e,n)},t=>{e(()=>{let e=new nz(nG.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)})})}Go(e,t){let n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{n(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(e=>{n(()=>this.Qo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return nj("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(nj("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lg extends lp{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.yt=r}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();let t=function(e,t){let n;if("targetChange"in t){var i,r;t.targetChange;let s="NO_CHANGE"===(i=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:n$(),a=t.targetChange.targetIds||[],o=(r=t.targetChange.resumeToken,e.wt?(void 0===r||"string"==typeof r||n$(),iF.fromBase64String(r||"")):(void 0===r||r instanceof Uint8Array||n$(),iF.fromUint8Array(r||new Uint8Array))),l=t.targetChange.cause,u=l&&function(e){let t=void 0===e.code?nG.UNKNOWN:sg(e.code);return new nz(t,e.message||"")}(l);n=new sN(s,a,o,u||null)}else if("documentChange"in t){t.documentChange;let h=t.documentChange;h.document,h.document.name,h.document.updateTime;let c=sG(e,h.document.name),d=sq(h.document.updateTime),f=h.document.createTime?sq(h.document.createTime):n5.min(),p=new rS({mapValue:{fields:h.document.fields}}),g=rk.newFoundDocument(c,d,f,p),m=h.targetIds||[],y=h.removedTargetIds||[];n=new sD(m,y,g.key,g)}else if("documentDelete"in t){t.documentDelete;let v=t.documentDelete;v.document;let w=sG(e,v.document),b=v.readTime?sq(v.readTime):n5.min(),I=rk.newNoDocument(w,b),T=v.removedTargetIds||[];n=new sD([],T,I.key,I)}else if("documentRemove"in t){t.documentRemove;let E=t.documentRemove;E.document;let _=sG(e,E.document),S=E.removedTargetIds||[];n=new sD([],S,_,null)}else{if(!("filter"in t))return n$();{t.filter;let k=t.filter;k.targetId;let C=k.count||0,D=new sp(C),A=k.targetId;n=new sA(A,D)}}return n}(this.yt,e),n=function(e){if(!("targetChange"in e))return n5.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?n5.min():t.readTime?sq(t.readTime):n5.min()}(e);return this.listener.Wo(t,n)}zo(e){let t={};t.database=sW(this.yt),t.addTarget=function(e,t){let n;let i=t.target;return(n=rx(i)?{documents:s0(e,i)}:{query:s1(e,i)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=sj(e,t.resumeToken):t.snapshotVersion.compareTo(n5.min())>0&&(n.readTime=sU(e,t.snapshotVersion.toTimestamp())),n}(this.yt,e);let n=function(e,t){let n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return n$()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.yt,e);n&&(t.labels=n),this.Bo(t)}Ho(e){let t={};t.database=sW(this.yt),t.removeTarget=e,this.Bo(t)}}class lm extends lp{constructor(e,t,n,i,r,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,s),this.yt=r,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){var t,n;if(e.streamToken||n$(),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();let i=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(void 0!==n||n$(),t.map(e=>{let t;return(t=e.updateTime?sq(e.updateTime):sq(n)).isEqual(n5.min())&&(t=sq(n)),new se(t,e.transformResults||[])})):[]),r=sq(e.commitTime);return this.listener.Zo(r,i)}return e.writeResults&&0!==e.writeResults.length&&n$(),this.Jo=!0,this.listener.tu()}eu(){let e={};e.database=sW(this.yt),this.Bo(e)}Xo(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>sJ(this.yt,e))};this.Bo(t)}}class ly extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.yt=i,this.nu=!1}su(){if(this.nu)throw new nz(nG.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,n){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,r])=>this.connection.ao(e,t,n,i,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===nG.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new nz(nG.UNKNOWN,e.toString())})}_o(e,t,n,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection._o(e,t,n,r,s,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===nG.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new nz(nG.UNKNOWN,e.toString())})}terminate(){this.nu=!0}}class lv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(nq(t),this.ou=!1):nj("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class lw{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=r,this.mu.Ur(e=>{n.enqueueAndForget(async()=>{lD(this)&&(nj("RemoteStore","Restarting streams for network reachability change."),await async function(e){e._u.add(4),await lI(e),e.gu.set("Unknown"),e._u.delete(4),await lb(e)}(this))})}),this.gu=new lv(n,i)}}async function lb(e){if(lD(e))for(let t of e.wu)await t(!0)}async function lI(e){for(let t of e.wu)await t(!1)}function lT(e,t){e.du.has(t.targetId)||(e.du.set(t.targetId,t),lC(e)?lk(e):lK(e).ko()&&l_(e,t))}function lE(e,t){let n=lK(e);e.du.delete(t),n.ko()&&lS(e,t),0===e.du.size&&(n.ko()?n.Fo():lD(e)&&e.gu.set("Unknown"))}function l_(e,t){e.yu.Ot(t.targetId),lK(e).zo(t)}function lS(e,t){e.yu.Ot(t),lK(e).Ho(t)}function lk(e){e.yu=new sO({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ne:t=>e.du.get(t)||null}),lK(e).start(),e.gu.uu()}function lC(e){return lD(e)&&!lK(e).No()&&e.du.size>0}function lD(e){return 0===e._u.size}async function lA(e){e.du.forEach((t,n)=>{l_(e,t)})}async function lN(e,t){e.yu=void 0,lC(e)?(e.gu.hu(t),lk(e)):e.gu.set("Unknown")}async function lx(e,t,n){if(e.gu.set("Online"),t instanceof sN&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let i of t.targetIds)e.du.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.du.delete(i),e.yu.removeTarget(i))}(e,t)}catch(i){nj("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),i),await lO(e,i)}else if(t instanceof sD?e.yu.Kt(t):t instanceof sA?e.yu.Jt(t):e.yu.jt(t),!n.isEqual(n5.min()))try{let r=await oZ(e.localStore);n.compareTo(r)>=0&&await function(e,t){let n=e.yu.Zt(t);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){let r=e.du.get(i);r&&e.du.set(i,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{let n=e.du.get(t);if(!n)return;e.du.set(t,n.withResumeToken(iF.EMPTY_BYTE_STRING,n.snapshotVersion)),lS(e,t);let i=new aE(n.target,t,1,n.sequenceNumber);l_(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(s){nj("RemoteStore","Failed to raise snapshot:",s),await lO(e,s)}}async function lO(e,t,n){if(!iI(t))throw t;e._u.add(1),await lI(e),e.gu.set("Offline"),n||(n=()=>oZ(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{nj("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await lb(e)})}function lR(e,t){return t().catch(n=>lO(e,n,t))}async function lM(e){let t=l$(e),n=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;lD(e)&&e.fu.length<10;)try{let i=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,n);if(null===i){0===e.fu.length&&t.Fo();break}n=i.batchId,function(e,t){e.fu.push(t);let n=l$(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}(e,i)}catch(r){await lO(e,r)}lP(e)&&lL(e)}function lP(e){return lD(e)&&!l$(e).No()&&e.fu.length>0}function lL(e){l$(e).start()}async function lF(e){l$(e).eu()}async function lV(e){let t=l$(e);for(let n of e.fu)t.Xo(n.mutations)}async function lU(e,t,n){let i=e.fu.shift(),r=aI.from(i,t,n);await lR(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await lM(e)}async function lj(e,t){t&&l$(e).Yo&&await async function(e,t){var n;if(function(e){switch(e){default:return n$();case nG.CANCELLED:case nG.UNKNOWN:case nG.DEADLINE_EXCEEDED:case nG.RESOURCE_EXHAUSTED:case nG.INTERNAL:case nG.UNAVAILABLE:case nG.UNAUTHENTICATED:return!1;case nG.INVALID_ARGUMENT:case nG.NOT_FOUND:case nG.ALREADY_EXISTS:case nG.PERMISSION_DENIED:case nG.FAILED_PRECONDITION:case nG.ABORTED:case nG.OUT_OF_RANGE:case nG.UNIMPLEMENTED:case nG.DATA_LOSS:return!0}}(n=t.code)&&n!==nG.ABORTED){let i=e.fu.shift();l$(e).Mo(),await lR(e,()=>e.remoteSyncer.rejectFailedWrite(i.batchId,t)),await lM(e)}}(e,t),lP(e)&&lL(e)}async function lq(e,t){e.asyncQueue.verifyOperationInProgress(),nj("RemoteStore","RemoteStore received new credentials");let n=lD(e);e._u.add(3),await lI(e),n&&e.gu.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e._u.delete(3),await lb(e)}async function lB(e,t){t?(e._u.delete(2),await lb(e)):t||(e._u.add(2),await lI(e),e.gu.set("Unknown"))}function lK(e){var t,n,i;return e.pu||(e.pu=(t=e.datastore,n=e.asyncQueue,i={Yr:lA.bind(null,e),Zr:lN.bind(null,e),Wo:lx.bind(null,e)},t.su(),new lg(n,t.connection,t.authCredentials,t.appCheckCredentials,t.yt,i)),e.wu.push(async t=>{t?(e.pu.Mo(),lC(e)?lk(e):e.gu.set("Unknown")):(await e.pu.stop(),e.yu=void 0)})),e.pu}function l$(e){var t,n,i;return e.Iu||(e.Iu=(t=e.datastore,n=e.asyncQueue,i={Yr:lF.bind(null,e),Zr:lj.bind(null,e),tu:lV.bind(null,e),Zo:lU.bind(null,e)},t.su(),new lm(n,t.connection,t.authCredentials,t.appCheckCredentials,t.yt,i)),e.wu.push(async t=>{t?(e.Iu.Mo(),await lM(e)):(await e.Iu.stop(),e.fu.length>0&&(nj("RemoteStore",`Stopping write stream with ${e.fu.length} pending writes`),e.fu=[]))})),e.Iu}class lG{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new nH,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,i,r){let s=Date.now()+n,a=new lG(e,t,s,i,r);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new nz(nG.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lz(e,t){if(nq("AsyncQueue",`${t}: ${e}`),iI(e))return new nz(nG.UNAVAILABLE,`${t}: ${e}`);throw e}class lH{constructor(e){this.comparator=e?(t,n)=>e(t,n)||it.comparator(t.key,n.key):(e,t)=>it.comparator(e.key,t.key),this.keyedMap=sw(),this.sortedSet=new rv(this.comparator)}static emptySet(e){return new lH(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof lH)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,r=n.getNext().key;if(!i.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new lH;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class lW{constructor(){this.Tu=new rv(it.comparator)}track(e){let t=e.doc.key,n=this.Tu.get(t);n?0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):n$():this.Tu=this.Tu.insert(t,e)}Eu(){let e=[];return this.Tu.inorderTraversal((t,n)=>{e.push(n)}),e}}class lQ{constructor(e,t,n,i,r,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,r){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new lQ(e,t,lH.emptySet(t),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&rG(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class lY{constructor(){this.Au=void 0,this.listeners=[]}}class lX{constructor(){this.queries=new sm(e=>rz(e),rG),this.onlineState="Unknown",this.Ru=new Set}}async function lJ(e,t){let n=t.query,i=!1,r=e.queries.get(n);if(r||(i=!0,r=new lY),i)try{r.Au=await e.onListen(n)}catch(a){let s=lz(a,`Initialization of query '${rH(t.query)}' failed`);return void t.onError(s)}e.queries.set(n,r),r.listeners.push(t),t.bu(e.onlineState),r.Au&&t.Pu(r.Au)&&l2(e)}async function lZ(e,t){let n=t.query,i=!1,r=e.queries.get(n);if(r){let s=r.listeners.indexOf(t);s>=0&&(r.listeners.splice(s,1),i=0===r.listeners.length)}if(i)return e.queries.delete(n),e.onUnlisten(n)}function l0(e,t){let n=!1;for(let i of t){let r=i.query,s=e.queries.get(r);if(s){for(let a of s.listeners)a.Pu(i)&&(n=!0);s.Au=i}}n&&l2(e)}function l1(e,t,n){let i=e.queries.get(t);if(i)for(let r of i.listeners)r.onError(n);e.queries.delete(t)}function l2(e){e.Ru.forEach(e=>{e.next()})}class l3{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new lQ(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),i=!0):this.Cu(e,this.onlineState)&&(this.xu(e),i=!0),this.Su=e,i}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(e.docChanges.length>0)return!0;let t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=lQ.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class l4{constructor(e){this.key=e}}class l6{constructor(e){this.key=e}}class l5{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=s_(),this.mutatedKeys=s_(),this.Gu=rY(e),this.Qu=new lH(this.Gu)}get ju(){return this.qu}Wu(e,t){let n=t?t.zu:new lW,i=t?t.Qu:this.Qu,r=t?t.mutatedKeys:this.mutatedKeys,s=i,a=!1,o="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{let u=i.get(e),h=rW(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(n.track({type:3,doc:h}),f=!0):this.Hu(u,h)||(n.track({type:2,doc:h}),f=!0,(o&&this.Gu(h,o)>0||l&&0>this.Gu(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let u="F"===this.query.limitType?s.last():s.first();s=s.delete(u.key),r=r.delete(u.key),n.track({type:1,doc:u})}return{Qu:s,zu:n,$i:a,mutatedKeys:r}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){let i=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;let r=e.zu.Eu();r.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return n$()}};return n(e)-n(t)})(e.type,t.type)||this.Gu(e.doc,t.doc)),this.Ju(n);let s=t?this.Yu():[],a=0===this.Ku.size&&this.current?1:0,o=a!==this.Uu;return(this.Uu=a,0!==r.length||o)?{snapshot:new lQ(this.query,e.Qu,i,r,e.mutatedKeys,0===a,o,!1,!!n&&n.resumeToken.approximateByteSize()>0),Xu:s}:{Xu:s}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new lW,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(e=>this.qu=this.qu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.qu=this.qu.delete(e)),this.current=e.current)}Yu(){if(!this.current)return[];let e=this.Ku;this.Ku=s_(),this.Qu.forEach(e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))});let t=[];return e.forEach(e=>{this.Ku.has(e)||t.push(new l6(e))}),this.Ku.forEach(n=>{e.has(n)||t.push(new l4(n))}),t}tc(e){this.qu=e.Hi,this.Ku=s_();let t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return lQ.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class l8{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class l9{constructor(e){this.key=e,this.nc=!1}}class l7{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.sc={},this.ic=new sm(e=>rz(e),rG),this.rc=new Map,this.oc=new Set,this.uc=new rv(it.comparator),this.cc=new Map,this.ac=new oM,this.hc={},this.lc=new Map,this.fc=oc.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function ue(e,t){let n,i;let r=ub(e),s=r.ic.get(t);if(s)n=s.targetId,r.sharedClientState.addLocalQueryTarget(n),i=s.view.ec();else{let a=await o1(r.localStore,rB(t));r.isPrimaryClient&&lT(r.remoteStore,a);let o=r.sharedClientState.addLocalQueryTarget(a.targetId);i=await ut(r,t,n=a.targetId,"current"===o,a.resumeToken)}return i}async function ut(e,t,n,i,r){e._c=(t,n,i)=>(async function(e,t,n,i){let r=t.view.Wu(n);r.$i&&(r=await o3(e.localStore,t.query,!1).then(({documents:e})=>t.view.Wu(e,r)));let s=i&&i.targetChanges.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,s);return ud(e,t.targetId,a.Xu),a.snapshot})(e,t,n,i);let s=await o3(e.localStore,t,!0),a=new l5(t,s.Hi),o=a.Wu(s.documents),l=sC.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),u=a.applyChanges(o,e.isPrimaryClient,l);ud(e,n,u.Xu);let h=new l8(t,n,a);return e.ic.set(t,h),e.rc.has(n)?e.rc.get(n).push(t):e.rc.set(n,[t]),u.snapshot}async function un(e,t){let n=e.ic.get(t),i=e.rc.get(n.targetId);if(i.length>1)return e.rc.set(n.targetId,i.filter(e=>!rG(e,t))),void e.ic.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await o2(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),lE(e.remoteStore,n.targetId),uh(e,n.targetId)}).catch(ig)):(uh(e,n.targetId),await o2(e.localStore,n.targetId,!0))}async function ui(e,t){try{let n=await function(e,t){let n=e,i=t.snapshotVersion,r=n.qi;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.Gi.newChangeBuffer({trackRemovals:!0});r=n.qi;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=r.get(o);if(!u)return;a.push(n.Cs.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Cs.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(o)?h=h.withResumeToken(iF.EMPTY_BYTE_STRING,n5.min()).withLastLimboFreeSnapshotVersion(n5.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,i)),r=r.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(n.Cs.updateTargetData(e,h))});let o=sy,l=s_();if(t.documentUpdates.forEach(i=>{t.resolvedLimboDocuments.has(i)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))}),a.push(o0(e,s,t.documentUpdates).next(e=>{o=e.Wi,l=e.zi})),!i.isEqual(n5.min())){let u=n.Cs.getLastRemoteSnapshotVersion(e).next(t=>n.Cs.setTargetsMetadata(e,e.currentSequenceNumber,i));a.push(u)}return im.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.qi=r,e))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let i=e.cc.get(n);i&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||n$(),t.addedDocuments.size>0?i.nc=!0:t.modifiedDocuments.size>0?i.nc||n$():t.removedDocuments.size>0&&(i.nc||n$(),i.nc=!1))}),await up(e,n,t)}catch(i){await ig(i)}}function ur(e,t,n){let i=e;if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){let r=[];i.ic.forEach((e,n)=>{let i=n.view.bu(t);i.snapshot&&r.push(i.snapshot)}),function(e,t){let n=e;n.onlineState=t;let i=!1;n.queries.forEach((e,n)=>{for(let r of n.listeners)r.bu(t)&&(i=!0)}),i&&l2(n)}(i.eventManager,t),r.length&&i.sc.Wo(r),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function us(e,t,n){let i=e;i.sharedClientState.updateQueryState(t,"rejected",n);let r=i.cc.get(t),s=r&&r.key;if(s){let a=new rv(it.comparator);a=a.insert(s,rk.newNoDocument(s,n5.min()));let o=s_().add(s),l=new sk(n5.min(),new Map,new rI(n3),a,o);await ui(i,l),i.uc=i.uc.remove(s),i.cc.delete(t),uf(i)}else await o2(i.localStore,t,!1).then(()=>uh(i,t,n)).catch(ig)}async function ua(e,t){var n;let i=t.batch.batchId;try{let r=await (n=e.localStore).persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let i=t.batch.keys(),r=n.Gi.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,i){let r=n.batch,s=r.keys(),a=im.resolve();return s.forEach(e=>{a=a.next(()=>i.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);null!==s||n$(),0>t.version.compareTo(s)&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,r))})(n,e,t,r).next(()=>r.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=s_();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,i))});uu(e,i,null),ul(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),await up(e,r)}catch(s){await ig(s)}}async function uo(e,t,n){var i;try{let r=await (i=e.localStore).persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return i.mutationQueue.lookupMutationBatch(e,t).next(t=>(null!==t||n$(),n=t.keys(),i.mutationQueue.removeMutationBatch(e,t))).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>i.localDocuments.getDocuments(e,n))});uu(e,t,n),ul(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await up(e,r)}catch(s){await ig(s)}}function ul(e,t){(e.lc.get(t)||[]).forEach(e=>{e.resolve()}),e.lc.delete(t)}function uu(e,t,n){let i=e,r=i.hc[i.currentUser.toKey()];if(r){let s=r.get(t);s&&(n?s.reject(n):s.resolve(),r=r.remove(t)),i.hc[i.currentUser.toKey()]=r}}function uh(e,t,n=null){for(let i of(e.sharedClientState.removeLocalQueryTarget(t),e.rc.get(t)))e.ic.delete(i),n&&e.sc.wc(i,n);e.rc.delete(t),e.isPrimaryClient&&e.ac.ls(t).forEach(t=>{e.ac.containsKey(t)||uc(e,t)})}function uc(e,t){e.oc.delete(t.path.canonicalString());let n=e.uc.get(t);null!==n&&(lE(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),uf(e))}function ud(e,t,n){for(let i of n)i instanceof l4?(e.ac.addReference(i.key,t),function(e,t){let n=t.key,i=n.path.canonicalString();e.uc.get(n)||e.oc.has(i)||(nj("SyncEngine","New document in limbo: "+n),e.oc.add(i),uf(e))}(e,i)):i instanceof l6?(nj("SyncEngine","Document no longer in limbo: "+i.key),e.ac.removeReference(i.key,t),e.ac.containsKey(i.key)||uc(e,i.key)):n$()}function uf(e){for(;e.oc.size>0&&e.uc.size<e.maxConcurrentLimboResolutions;){let t=e.oc.values().next().value;e.oc.delete(t);let n=new it(n9.fromString(t)),i=e.fc.next();e.cc.set(i,new l9(n)),e.uc=e.uc.insert(n,i),lT(e.remoteStore,new aE(rB(rL(n.path)),i,2,iD.at))}}async function up(e,t,n){let i=[],r=[],s=[];e.ic.isEmpty()||(e.ic.forEach((a,o)=>{s.push(e._c(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient&&e.sharedClientState.updateQueryState(o.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);let s=oQ.Ci(o.targetId,t);r.push(s)}}))}),await Promise.all(s),e.sc.Wo(i),await async function(e,t){let n=e;try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>im.forEach(t,t=>im.forEach(t.Si,i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i)).next(()=>im.forEach(t.Di,i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))}catch(i){if(!iI(i))throw i;nj("LocalStore","Failed to update sequence numbers: "+i)}for(let r of t){let s=r.targetId;if(!r.fromCache){let a=n.qi.get(s),o=a.snapshotVersion,l=a.withLastLimboFreeSnapshotVersion(o);n.qi=n.qi.insert(s,l)}}}(e.localStore,r))}async function ug(e,t){let n=e;if(!n.currentUser.isEqual(t)){nj("SyncEngine","User change. New user:",t.toKey());let i=await oJ(n.localStore,t);n.currentUser=t,n.lc.forEach(e=>{e.forEach(e=>{e.reject(new nz(nG.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),n.lc.clear(),n.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),await up(n,i.ji)}}function um(e,t){let n=e.cc.get(t);if(n&&n.nc)return s_().add(n.key);{let i=s_(),r=e.rc.get(t);if(!r)return i;for(let s of r){let a=e.ic.get(s);i=i.unionWith(a.view.ju)}return i}}async function uy(e,t){let n=await o3(e.localStore,t.query,!0),i=t.view.tc(n);return e.isPrimaryClient&&ud(e,t.targetId,i.Xu),i}async function uv(e,t,n){let i=[],r=[];for(let s of t){let a;let o=e.rc.get(s);if(o&&0!==o.length)for(let l of(a=await o1(e.localStore,rB(o[0])),o)){let u=e.ic.get(l),h=await uy(e,u);h.snapshot&&r.push(h.snapshot)}else{let c=await o4(e.localStore,s);await ut(e,uw(c),s,!1,(a=await o1(e.localStore,c)).resumeToken)}i.push(a)}return e.sc.Wo(r),i}function uw(e){var t,n,i,r,s,a,o;return t=e.path,n=e.collectionGroup,i=e.orderBy,r=e.filters,s=e.limit,a=e.startAt,o=e.endAt,new rP(t,n,i,r,s,"F",a,o)}function ub(e){let t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=ui.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=um.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=us.bind(null,t),t.sc.Wo=l0.bind(null,t.eventManager),t.sc.wc=l1.bind(null,t.eventManager),t}function uI(e){let t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=ua.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=uo.bind(null,t),t}class uT{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=ld(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){var t,n,i,r;return t=this.persistence,n=new oY,i=e.initialUser,r=this.yt,new oX(t,n,i,r)}yc(e){return new oj(oB.Bs,this.yt)}gc(e){return new ls}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class uE{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ur(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ug.bind(null,this.syncEngine),await lB(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new lX}createDatastore(e){var t,n,i;let r=ld(e.databaseInfo.databaseId),s=(t=e.databaseInfo,new lh(t));return n=e.authCredentials,i=e.appCheckCredentials,new ly(n,i,s,r)}createRemoteStore(e){var t,n,i,r,s;return t=this.localStore,n=this.datastore,i=e.asyncQueue,r=e=>ur(this.syncEngine,e,0),s=lo.C()?new lo:new la,new lw(t,n,i,r,s)}createSyncEngine(e,t){return function(e,t,n,i,r,s,a){let o=new l7(e,t,n,i,r,s);return a&&(o.dc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){nj("RemoteStore","RemoteStore shutting down."),e._u.add(5),await lI(e),e.mu.shutdown(),e.gu.set("Unknown")}(this.remoteStore)}}function u_(e){if(!it.isDocumentKey(e))throw new nz(nG.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function uS(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":n$()}function uk(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new nz(nG.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=uS(e);throw new nz(nG.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}let uC=new Map;class uD{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new nz(nG.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new nz(nG.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,i){if(!0===t&&!0===i)throw new nz(nG.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class uA{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uD({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new nz(nG.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new nz(nG.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uD(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new nQ;switch(e.type){case"gapi":let t=e.client;return new nZ(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new nz(nG.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=uC.get(e);t&&(nj("ComponentProvider","Removing Datastore"),uC.delete(e),t.terminate())}(this),Promise.resolve()}}class uN{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new uO(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new uN(this.firestore,e,this._key)}}class ux{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new ux(this.firestore,e,this._query)}}class uO extends ux{constructor(e,t,n){super(e,t,rL(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new uN(this.firestore,null,new it(e))}withConverter(e){return new uO(this.firestore,e,this._path)}}function uR(e,t,...n){if(e=(0,p.Ku)(e),1==arguments.length&&(t=n2.R()),function(e,t,n){if(!n)throw new nz(nG.INVALID_ARGUMENT,`Function doc() cannot be called with an empty ${t}.`)}(0,"path",t),e instanceof uA){let i=n9.fromString(t,...n);return u_(i),new uN(e,null,new it(i))}{if(!(e instanceof uN||e instanceof uO))throw new nz(nG.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(n9.fromString(t,...n));return u_(r),new uN(e.firestore,e instanceof uO?e.converter:null,new it(r))}}class uM{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):nq("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class uP{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=nL.UNAUTHENTICATED,this.clientId=n2.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{nj("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(nj("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new nz(nG.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new nH;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=lz(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function uL(e,t){e.asyncQueue.verifyOperationInProgress(),nj("FirestoreClient","Initializing OfflineComponentProvider");let n=await e.getConfiguration();await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await oJ(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function uF(e,t){e.asyncQueue.verifyOperationInProgress();let n=await uV(e);nj("FirestoreClient","Initializing OnlineComponentProvider");let i=await e.getConfiguration();await t.initialize(n,i),e.setCredentialChangeListener(e=>lq(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>lq(t.remoteStore,n)),e.onlineComponents=t}async function uV(e){return e.offlineComponents||(nj("FirestoreClient","Using default OfflineComponentProvider"),await uL(e,new uT)),e.offlineComponents}async function uU(e){return e.onlineComponents||(nj("FirestoreClient","Using default OnlineComponentProvider"),await uF(e,new uE)),e.onlineComponents}async function uj(e){let t=await uU(e),n=t.eventManager;return n.onListen=ue.bind(null,t.syncEngine),n.onUnlisten=un.bind(null,t.syncEngine),n}class uq{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new lf(this,"async_queue_retry"),this.Wc=()=>{let e=lc();e&&nj("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};let e=lc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;let t=lc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});let t=new nH;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!iI(e))throw e;nj("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro(()=>this.Jc())}}Hc(e){let t=this.Bc.then(()=>(this.Gc=!0,e().catch(e=>{let t;this.Kc=e,this.Gc=!1;let n=(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t);throw nq("INTERNAL UNHANDLED ERROR: ",n),e}).then(e=>(this.Gc=!1,e))));return this.Bc=t,t}enqueueAfterDelay(e,t,n){this.zc(),this.jc.indexOf(e)>-1&&(t=0);let i=lG.createAndSchedule(this,e,t,n,e=>this.Yc(e));return this.Uc.push(i),i}zc(){this.Kc&&n$()}verifyOperationInProgress(){}async Xc(){let e;do await (e=this.Bc);while(e!==this.Bc)}Zc(e){for(let t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{for(let t of(this.Uc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Uc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){let t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function uB(e){return function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])}class uK extends uA{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new uq,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||uG(this),this._firestoreClient.terminate()}}function u$(e,t){let n="object"==typeof e?e:(0,c.Sx)(),i=(0,c.j6)(n,"firestore").getImmediate({identifier:"string"==typeof e?e:t||"(default)"});if(!i._initialized){let r=(0,p.yU)("firestore");r&&function(e,t,n,i={}){var r;let s=(e=uk(e,uA))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&nB("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),i.mockUserToken){let a,o;if("string"==typeof i.mockUserToken)a=i.mockUserToken,o=nL.MOCK_USER;else{a=(0,p.Fy)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);let l=i.mockUserToken.sub||i.mockUserToken.user_id;if(!l)throw new nz(nG.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");o=new nL(l)}e._authCredentials=new nY(new nW(a,o))}}(i,...r)}return i}function uG(e){var t,n,i,r;let s=e._freezeSettings(),a=(n=e._databaseId,i=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",r=e._persistenceKey,new iA(n,i,r,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new uP(e._authCredentials,e._appCheckCredentials,e._queue,a)}class uz{constructor(e){this._byteString=e}static fromBase64String(e){try{return new uz(iF.fromBase64String(e))}catch(t){throw new nz(nG.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new uz(iF.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class uH{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new nz(nG.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ie(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class uW{constructor(e){this._methodName=e}}class uQ{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new nz(nG.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new nz(nG.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return n3(this._lat,e._lat)||n3(this._long,e._long)}}let uY=/^__.*__$/;class uX{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new sl(e,this.data,this.fieldMask,t,this.fieldTransforms):new so(e,this.data,t,this.fieldTransforms)}}class uJ{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new sl(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function uZ(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw n$()}}class u0{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.yt=n,this.ignoreUndefinedProperties=i,void 0===r&&this.na(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new u0(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ia({path:n,oa:!1});return i.ua(e),i}ca(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ia({path:n,oa:!1});return i.na(),i}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return hi(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(uZ(this.sa)&&uY.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class u1{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=n||ld(e)}da(e,t,n,i=!1){return new u0({sa:e,methodName:t,fa:n,path:ie.emptyPath(),oa:!1,la:i},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function u2(e){let t=e._freezeSettings(),n=ld(e._databaseId);return new u1(e._databaseId,!!t.ignoreUndefinedProperties,n)}class u3 extends uW{_toFieldTransform(e){if(2!==e.sa)throw 1===e.sa?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof u3}}class u4 extends null{_toFieldTransform(e){return new r7(e.path,new r1)}isEqual(e){return e instanceof u4}}function u6(e,t,n,i=!1){return u5(n,e.da(i?4:3,t))}function u5(e,t){if(u9(e=(0,p.Ku)(e)))return u7("Unsupported field value:",t,e),u8(e,t);if(e instanceof uW)return function(e,t){if(!uZ(t.sa))throw t.ha(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.ha(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.oa&&4!==t.sa)throw t.ha("Nested arrays are not supported");return function(e,t){let n=[],i=0;for(let r of e){let s=u5(r,t.aa(i));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,p.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e){var n,i;return n=t.yt,iL(i=e)?rJ(i):rX(n,i)}if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=n6.fromDate(e);return{timestampValue:sU(t.yt,r)}}if(e instanceof n6){let s=new n6(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:sU(t.yt,s)}}if(e instanceof uQ)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof uz)return{bytesValue:sj(t.yt,e._byteString)};if(e instanceof uN){let a=t.databaseId,o=e.firestore._databaseId;if(!o.isEqual(a))throw t.ha(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:sB(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ha(`Unsupported field value: ${uS(e)}`)}(e,t)}function u8(e,t){let n={};return iR(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):iO(e,(e,i)=>{let r=u5(i,t.ra(e));null!=r&&(n[e]=r)}),{mapValue:{fields:n}}}function u9(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof n6||e instanceof uQ||e instanceof uz||e instanceof uN||e instanceof uW)}function u7(e,t,n){if(!u9(n)||!("object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n)))){let i=uS(n);throw"an object"===i?t.ha(e+" a custom object"):t.ha(e+" "+i)}}function he(e,t,n){if((t=(0,p.Ku)(t))instanceof uH)return t._internalPath;if("string"==typeof t)return hn(e,t);throw hi("Field path arguments must be of type string or ",e,!1,void 0,n)}let ht=RegExp("[~\\*/\\[\\]]");function hn(e,t,n){if(t.search(ht)>=0)throw hi(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new uH(...t.split("."))._internalPath}catch(i){throw hi(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function hi(e,t,n,i,r){let s=i&&!i.isEmpty(),a=void 0!==r,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${i}`),a&&(l+=` in document ${r}`),l+=")"),new nz(nG.INVALID_ARGUMENT,o+e+l)}function hr(e,t){return e.some(e=>e.isEqual(t))}class hs{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new uN(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new ha(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(ho("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ha extends hs{data(){return super.data()}}function ho(e,t){return"string"==typeof t?hn(e,t):t instanceof uH?t._internalPath:t._delegate._internalPath}class hl{}class hu extends hl{}class hh extends hu{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new hh(e,t,n)}_apply(e){let t=this._parse(e);return hw(e._query,t),new ux(e.firestore,e.converter,rK(e._query,t))}_parse(e){let t=u2(e.firestore),n=function(e,t,n,i,r,s,a){let o;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new nz(nG.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){hv(a,s);let l=[];for(let u of a)l.push(hy(i,e,u));o={arrayValue:{values:l}}}else o=hy(i,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||hv(a,s),o=u6(n,t,a,"in"===s||"not-in"===s);return rn.create(r,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class hc extends hl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new hc(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ri.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e,i=t.getFlattenedFilters();for(let r of i)hw(n,r),n=rK(n,r)}(e._query,t),new ux(e.firestore,e.converter,rK(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class hd extends hu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new hd(e,t)}_apply(e){let t=function(e,t,n){if(null!==e.startAt)throw new nz(nG.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new nz(nG.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");let i=new ry(t,n);return function(e,t){if(null===rV(e)){let n=rU(e);null!==n&&hb(e,n,t.field)}}(e,i),i}(e._query,this._field,this._direction);return new ux(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new rP(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class hf extends hu{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new hf(e,t,n)}_apply(e){return new ux(e.firestore,e.converter,r$(e._query,this._limit,this._limitType))}}class hp extends hu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hp(e,t,n)}_apply(e){var t;let n=hm(e,this.type,this._docOrFields,this._inclusive);return new ux(e.firestore,e.converter,(t=e._query,new rP(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}class hg extends hu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hg(e,t,n)}_apply(e){var t;let n=hm(e,this.type,this._docOrFields,this._inclusive);return new ux(e.firestore,e.converter,(t=e._query,new rP(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function hm(e,t,n,i){if(n[0]=(0,p.Ku)(n[0]),n[0]instanceof hs)return function(e,t,n,i,r){if(!i)throw new nz(nG.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let a of rq(e))if(a.field.isKeyField())s.push(iJ(t,i.key));else{let o=i.data.field(a.field);if(iB(o))throw new nz(nG.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===o){let l=a.field.canonicalString();throw new nz(nG.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}s.push(o)}return new i9(s,r)}(e._query,e.firestore._databaseId,t,n[0]._document,i);{let r=u2(e.firestore);return function(e,t,n,i,r,s){let a=e.explicitOrderBy;if(r.length>a.length)throw new nz(nG.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let l=0;l<r.length;l++){let u=r[l];if(a[l].field.isKeyField()){if("string"!=typeof u)throw new nz(nG.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof u}`);if(!rj(e)&&-1!==u.indexOf("/"))throw new nz(nG.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${i}() must be a plain document ID, but '${u}' contains a slash.`);let h=e.path.child(n9.fromString(u));if(!it.isDocumentKey(h))throw new nz(nG.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${i}() must result in a valid document path, but '${h}' is not because it contains an odd number of segments.`);let c=new it(h);o.push(iJ(t,c))}else{let d=u6(n,i,u);o.push(d)}}return new i9(o,s)}(e._query,e.firestore._databaseId,r,t,n,i)}}function hy(e,t,n){if("string"==typeof(n=(0,p.Ku)(n))){if(""===n)throw new nz(nG.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rj(t)&&-1!==n.indexOf("/"))throw new nz(nG.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let i=t.path.child(n9.fromString(n));if(!it.isDocumentKey(i))throw new nz(nG.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return iJ(e,new it(i))}if(n instanceof uN)return iJ(e,n._key);throw new nz(nG.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uS(n)}.`)}function hv(e,t){if(!Array.isArray(e)||0===e.length)throw new nz(nG.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new nz(nG.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function hw(e,t){if(t.isInequality()){let n=rU(e),i=t.field;if(null!==n&&!n.isEqual(i))throw new nz(nG.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${i.toString()}'`);let r=rV(e);null!==r&&hb(e,i,r)}let s=function(e,t){for(let n of e)for(let i of n.getFlattenedFilters())if(t.indexOf(i.op)>=0)return i.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==s)throw s===t.op?new nz(nG.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new nz(nG.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}function hb(e,t,n){if(!n.isEqual(t))throw new nz(nG.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class hI{convertValue(e,t="none"){switch(iz(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ij(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(iq(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw n$()}}convertObject(e,t){let n={};return iO(e.fields,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertGeoPoint(e){return new uQ(ij(e.latitude),ij(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=function e(t){let n=t.mapValue.fields.__previous_value__;return iB(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(iK(e));default:return null}}convertTimestamp(e){let t=iU(e);return new n6(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=n9.fromString(e);s6(n)||n$();let i=new iN(n.get(1),n.get(3)),r=new it(n.popFirst(5));return i.isEqual(t)||nq(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class hT{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hE extends hs{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new h_(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(ho("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class h_ extends hE{data(e={}){return super.data(e)}}class hS{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new hT(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new h_(this._firestore,this._userDataWriter,n.key,n,new hT(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new nz(nG.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let n=0;return e._snapshot.docChanges.map(t=>{let i=new h_(e._firestore,e._userDataWriter,t.doc.key,t.doc,new hT(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);return t.doc,{type:"added",doc:i,oldIndex:-1,newIndex:n++}})}{let i=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new h_(e._firestore,e._userDataWriter,t.doc.key,t.doc,new hT(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),r=-1,s=-1;return 0!==t.type&&(r=i.indexOf(t.doc.key),i=i.delete(t.doc.key)),1!==t.type&&(s=(i=i.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return n$()}}(t.type),doc:n,oldIndex:r,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}class hk extends hI{constructor(e){super(),this.firestore=e}convertBytes(e){return new uz(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new uN(this.firestore,null,t)}}function hC(e,...t){var n,i,r,s;let a,o,l;e=(0,p.Ku)(e);let u={includeMetadataChanges:!1},h=0;"object"!=typeof t[0]||uB(t[h])||(u=t[h],h++);let c={includeMetadataChanges:u.includeMetadataChanges};if(uB(t[h])){let d=t[h];t[h]=null===(n=d.next)||void 0===n?void 0:n.bind(d),t[h+1]=null===(i=d.error)||void 0===i?void 0:i.bind(d),t[h+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(e instanceof uN)o=uk(e.firestore,uK),l=rL(e._key.path),a={next(n){t[h]&&t[h](function(e,t,n){let i=n.docs.get(t._key),r=new hk(e);return new hE(e,r,t._key,i,new hT(n.hasPendingWrites,n.fromCache),t.converter)}(o,e,n))},error:t[h+1],complete:t[h+2]};else{let f=uk(e,ux);o=uk(f.firestore,uK),l=f._query;let g=new hk(o);a={next(e){t[h]&&t[h](new hS(o,g,f,e))},error:t[h+1],complete:t[h+2]},function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new nz(nG.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query)}return function(e,t,n,i){let r=new uM(i),s=new l3(t,r,n);return e.asyncQueue.enqueueAndForget(async()=>lJ(await uj(e),s)),()=>{r.bc(),e.asyncQueue.enqueueAndForget(async()=>lZ(await uj(e),s))}}(((s=o)._firestoreClient||uG(s),s._firestoreClient.verifyNotTerminated(),s._firestoreClient),l,c,a)}!function(e,t=!0){nF=c.MF,(0,c.om)(new d.uA("firestore",(e,{instanceIdentifier:n,options:i})=>{let r=e.getProvider("app").getImmediate(),s=new uK(new nX(e.getProvider("auth-internal")),new n1(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new nz(nG.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new iN(e.options.projectId,t)}(r,n),r);return i=Object.assign({useFetchStreams:t},i),s._setSettings(i),s},"PUBLIC").setMultipleInstances(!0)),(0,c.KO)(nP,"3.8.3",void 0),(0,c.KO)(nP,"3.8.3","esm2017")}()},96602(e,t,n){n.d(t,{gf:()=>Q}),n(69559);var i,r,s,a,o=n(5125),l=n(96148),u=n(36743),h=n(842);let c="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",d="google.c.a.c_id";function f(e){let t=new Uint8Array(e),n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(s=i||(i={}))[s.DATA_MESSAGE=1]="DATA_MESSAGE",s[s.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(a=r||(r={})).PUSH_RECEIVED="push-received",a.NOTIFICATION_CLICKED="notification-clicked";let p="fcm_token_details_db",g="fcm_token_object_Store";async function m(e){if("databases"in indexedDB){let t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(p))return null}let i=null,r=await (0,l.P2)(p,5,{async upgrade(t,n,r,s){var a;if(n<2||!t.objectStoreNames.contains(g))return;let o=s.objectStore(g),l=await o.index("fcmSenderId").get(e);if(await o.clear(),l){if(2===n){if(!l.auth||!l.p256dh||!l.endpoint)return;i={token:l.fcmToken,createTime:null!==(a=l.createTime)&&void 0!==a?a:Date.now(),subscriptionOptions:{auth:l.auth,p256dh:l.p256dh,endpoint:l.endpoint,swScope:l.swScope,vapidKey:"string"==typeof l.vapidKey?l.vapidKey:f(l.vapidKey)}}}else 3===n?i={token:l.fcmToken,createTime:l.createTime,subscriptionOptions:{auth:f(l.auth),p256dh:f(l.p256dh),endpoint:l.endpoint,swScope:l.swScope,vapidKey:f(l.vapidKey)}}:4===n&&(i={token:l.fcmToken,createTime:l.createTime,subscriptionOptions:{auth:f(l.auth),p256dh:f(l.p256dh),endpoint:l.endpoint,swScope:l.swScope,vapidKey:f(l.vapidKey)}})}}});return r.close(),await (0,l.MR)(p),await (0,l.MR)("fcm_vapid_details_db"),await (0,l.MR)("undefined"),!function(e){if(!e||!e.subscriptionOptions)return!1;let{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}(i)?null:i}let y="firebase-messaging-store",v=null;function w(){return v||(v=(0,l.P2)("firebase-messaging-database",1,{upgrade(e,t){0===t&&e.createObjectStore(y)}})),v}async function b(e){let t=function({appConfig:e}){return e.appId}(e),n=await w(),i=await n.transaction(y).objectStore(y).get(t);if(i)return i;{let r=await m(e.appConfig.senderId);if(r)return await I(e,r),r}}async function I(e,t){let n=function({appConfig:e}){return e.appId}(e),i=await w(),r=i.transaction(y,"readwrite");return await r.objectStore(y).put(t,n),await r.done,t}async function T(e){let t=function({appConfig:e}){return e.appId}(e),n=await w(),i=n.transaction(y,"readwrite");await i.objectStore(y).delete(t),await i.done}let E=new u.FA("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function _(e,t){let n;let i=await D(e),r=A(t),s={method:"POST",headers:i,body:JSON.stringify(r)};try{let a=await fetch(C(e.appConfig),s);n=await a.json()}catch(o){throw E.create("token-subscribe-failed",{errorInfo:null==o?void 0:o.toString()})}if(n.error){let l=n.error.message;throw E.create("token-subscribe-failed",{errorInfo:l})}if(!n.token)throw E.create("token-subscribe-no-token");return n.token}async function S(e,t){let n;let i=await D(e),r=A(t.subscriptionOptions),s={method:"PATCH",headers:i,body:JSON.stringify(r)};try{let a=await fetch(`${C(e.appConfig)}/${t.token}`,s);n=await a.json()}catch(o){throw E.create("token-update-failed",{errorInfo:null==o?void 0:o.toString()})}if(n.error){let l=n.error.message;throw E.create("token-update-failed",{errorInfo:l})}if(!n.token)throw E.create("token-update-no-token");return n.token}async function k(e,t){let n=await D(e);try{let i=await fetch(`${C(e.appConfig)}/${t}`,{method:"DELETE",headers:n}),r=await i.json();if(r.error){let s=r.error.message;throw E.create("token-unsubscribe-failed",{errorInfo:s})}}catch(a){throw E.create("token-unsubscribe-failed",{errorInfo:null==a?void 0:a.toString()})}}function C({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}async function D({appConfig:e,installations:t}){let n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function A({p256dh:e,auth:t,endpoint:n,vapidKey:i}){let r={web:{endpoint:n,auth:t,p256dh:e}};return i!==c&&(r.web.applicationPubKey=i),r}async function N(e){let t=await M(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:f(t.getKey("auth")),p256dh:f(t.getKey("p256dh"))},i=await b(e.firebaseDependencies);if(!i)return R(e.firebaseDependencies,n);if(function(e,t){let n=t.vapidKey===e.vapidKey,i=t.endpoint===e.endpoint,r=t.auth===e.auth,s=t.p256dh===e.p256dh;return n&&i&&r&&s}(i.subscriptionOptions,n))return Date.now()>=i.createTime+6048e5?O(e,{token:i.token,createTime:Date.now(),subscriptionOptions:n}):i.token;try{await k(e.firebaseDependencies,i.token)}catch(r){console.warn(r)}return R(e.firebaseDependencies,n)}async function x(e){let t=await b(e.firebaseDependencies);t&&(await k(e.firebaseDependencies,t.token),await T(e.firebaseDependencies));let n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function O(e,t){try{let n=await S(e.firebaseDependencies,t),i=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await I(e.firebaseDependencies,i),n}catch(r){throw await x(e),r}}async function R(e,t){let n=await _(e,t),i={token:n,createTime:Date.now(),subscriptionOptions:t};return await I(e,i),i.token}async function M(e,t){let n=await e.pushManager.getSubscription();return n||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){let t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(n),r=new Uint8Array(i.length);for(let s=0;s<i.length;++s)r[s]=i.charCodeAt(s);return r}(t)})}function P(e){var t;let n={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};let n=t.notification.title;n&&(e.notification.title=n);let i=t.notification.body;i&&(e.notification.body=i);let r=t.notification.image;r&&(e.notification.image=r);let s=t.notification.icon;s&&(e.notification.icon=s)}(n,e),t=n,e.data&&(t.data=e.data),function(e,t){var n,i,r,s,a;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};let o=null!==(r=null===(i=t.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==r?r:null===(s=t.notification)||void 0===s?void 0:s.click_action;o&&(e.fcmOptions.link=o);let l=null===(a=t.fcmOptions)||void 0===a?void 0:a.analytics_label;l&&(e.fcmOptions.analyticsLabel=l)}(n,e),n}function L(e,t){let n=[];for(let i=0;i<e.length;i++)n.push(e.charAt(i)),i<t.length&&n.push(t.charAt(i));return n.join("")}function F(e){return E.create("missing-app-config-values",{valueName:e})}L("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),L("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class V{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;let i=function(e){if(!e||!e.options)throw F("App Configuration Object");if(!e.name)throw F("App Name");let{options:t}=e;for(let n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw F(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:i,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function U(e){try{e.swRegistration=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),e.swRegistration.update().catch(()=>{})}catch(t){throw E.create("failed-service-worker-registration",{browserErrorMessage:null==t?void 0:t.message})}}async function j(e,t){if(t||e.swRegistration||await U(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw E.create("invalid-sw-registration");e.swRegistration=t}}async function q(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=c)}async function B(e,t){if(!navigator)throw E.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw E.create("permission-blocked");return await q(e,null==t?void 0:t.vapidKey),await j(e,null==t?void 0:t.serviceWorkerRegistration),N(e)}async function K(e,t,n){let i=function(e){switch(e){case r.NOTIFICATION_CLICKED:return"notification_open";case r.PUSH_RECEIVED:return"notification_foreground";default:throw Error()}}(t),s=await e.firebaseDependencies.analyticsProvider.get();s.logEvent(i,{message_id:n[d],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}async function $(e,t){let n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===r.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(P(n)):e.onMessageHandler.next(P(n)));let i=n.data;"object"==typeof i&&i&&d in i&&"1"===i["google.c.a.e"]&&await K(e,n.messageType,i)}let G="@firebase/messaging",z="0.12.3",H=e=>{let t=new V(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>$(t,e)),t},W=e=>{let t=e.getProvider("messaging").getImmediate();return{getToken:e=>B(t,e)}};async function Q(e,t){return B(e=(0,u.Ku)(e),t)}(0,h.om)(new o.uA("messaging",H,"PUBLIC")),(0,h.om)(new o.uA("messaging-internal",W,"PRIVATE")),(0,h.KO)(G,z),(0,h.KO)(G,z,"esm2017")},78292(e,t,n){n.d(t,{dG:()=>z}),n(69559);var i,r,s,a,o=n(5125),l=n(96148),u=n(36743),h=n(842);let c="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",d="FCM_MSG";function f(e){let t=new Uint8Array(e),n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(s=i||(i={}))[s.DATA_MESSAGE=1]="DATA_MESSAGE",s[s.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(a=r||(r={})).PUSH_RECEIVED="push-received",a.NOTIFICATION_CLICKED="notification-clicked";let p="fcm_token_details_db",g="fcm_token_object_Store";async function m(e){if("databases"in indexedDB){let t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(p))return null}let i=null,r=await (0,l.P2)(p,5,{async upgrade(t,n,r,s){var a;if(n<2||!t.objectStoreNames.contains(g))return;let o=s.objectStore(g),l=await o.index("fcmSenderId").get(e);if(await o.clear(),l){if(2===n){if(!l.auth||!l.p256dh||!l.endpoint)return;i={token:l.fcmToken,createTime:null!==(a=l.createTime)&&void 0!==a?a:Date.now(),subscriptionOptions:{auth:l.auth,p256dh:l.p256dh,endpoint:l.endpoint,swScope:l.swScope,vapidKey:"string"==typeof l.vapidKey?l.vapidKey:f(l.vapidKey)}}}else 3===n?i={token:l.fcmToken,createTime:l.createTime,subscriptionOptions:{auth:f(l.auth),p256dh:f(l.p256dh),endpoint:l.endpoint,swScope:l.swScope,vapidKey:f(l.vapidKey)}}:4===n&&(i={token:l.fcmToken,createTime:l.createTime,subscriptionOptions:{auth:f(l.auth),p256dh:f(l.p256dh),endpoint:l.endpoint,swScope:l.swScope,vapidKey:f(l.vapidKey)}})}}});return r.close(),await (0,l.MR)(p),await (0,l.MR)("fcm_vapid_details_db"),await (0,l.MR)("undefined"),!function(e){if(!e||!e.subscriptionOptions)return!1;let{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}(i)?null:i}let y="firebase-messaging-store",v=null;function w(){return v||(v=(0,l.P2)("firebase-messaging-database",1,{upgrade(e,t){0===t&&e.createObjectStore(y)}})),v}async function b(e){let t=function({appConfig:e}){return e.appId}(e),n=await w(),i=await n.transaction(y).objectStore(y).get(t);if(i)return i;{let r=await m(e.appConfig.senderId);if(r)return await I(e,r),r}}async function I(e,t){let n=function({appConfig:e}){return e.appId}(e),i=await w(),r=i.transaction(y,"readwrite");return await r.objectStore(y).put(t,n),await r.done,t}async function T(e){let t=function({appConfig:e}){return e.appId}(e),n=await w(),i=n.transaction(y,"readwrite");await i.objectStore(y).delete(t),await i.done}let E=new u.FA("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function _(e,t){let n;let i=await D(e),r=A(t),s={method:"POST",headers:i,body:JSON.stringify(r)};try{let a=await fetch(C(e.appConfig),s);n=await a.json()}catch(o){throw E.create("token-subscribe-failed",{errorInfo:null==o?void 0:o.toString()})}if(n.error){let l=n.error.message;throw E.create("token-subscribe-failed",{errorInfo:l})}if(!n.token)throw E.create("token-subscribe-no-token");return n.token}async function S(e,t){let n;let i=await D(e),r=A(t.subscriptionOptions),s={method:"PATCH",headers:i,body:JSON.stringify(r)};try{let a=await fetch(`${C(e.appConfig)}/${t.token}`,s);n=await a.json()}catch(o){throw E.create("token-update-failed",{errorInfo:null==o?void 0:o.toString()})}if(n.error){let l=n.error.message;throw E.create("token-update-failed",{errorInfo:l})}if(!n.token)throw E.create("token-update-no-token");return n.token}async function k(e,t){let n=await D(e);try{let i=await fetch(`${C(e.appConfig)}/${t}`,{method:"DELETE",headers:n}),r=await i.json();if(r.error){let s=r.error.message;throw E.create("token-unsubscribe-failed",{errorInfo:s})}}catch(a){throw E.create("token-unsubscribe-failed",{errorInfo:null==a?void 0:a.toString()})}}function C({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}async function D({appConfig:e,installations:t}){let n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function A({p256dh:e,auth:t,endpoint:n,vapidKey:i}){let r={web:{endpoint:n,auth:t,p256dh:e}};return i!==c&&(r.web.applicationPubKey=i),r}async function N(e){let t=await M(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:f(t.getKey("auth")),p256dh:f(t.getKey("p256dh"))},i=await b(e.firebaseDependencies);if(!i)return R(e.firebaseDependencies,n);if(function(e,t){let n=t.vapidKey===e.vapidKey,i=t.endpoint===e.endpoint,r=t.auth===e.auth,s=t.p256dh===e.p256dh;return n&&i&&r&&s}(i.subscriptionOptions,n))return Date.now()>=i.createTime+6048e5?O(e,{token:i.token,createTime:Date.now(),subscriptionOptions:n}):i.token;try{await k(e.firebaseDependencies,i.token)}catch(r){console.warn(r)}return R(e.firebaseDependencies,n)}async function x(e){let t=await b(e.firebaseDependencies);t&&(await k(e.firebaseDependencies,t.token),await T(e.firebaseDependencies));let n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function O(e,t){try{let n=await S(e.firebaseDependencies,t),i=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await I(e.firebaseDependencies,i),n}catch(r){throw await x(e),r}}async function R(e,t){let n=await _(e,t),i={token:n,createTime:Date.now(),subscriptionOptions:t};return await I(e,i),i.token}async function M(e,t){let n=await e.pushManager.getSubscription();return n||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){let t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(n),r=new Uint8Array(i.length);for(let s=0;s<i.length;++s)r[s]=i.charCodeAt(s);return r}(t)})}async function P(e,t){let n=function(e,t){var n,r;let s={};return e.from&&(s.project_number=e.from),e.fcmMessageId&&(s.message_id=e.fcmMessageId),s.instance_id=t,e.notification?s.message_type=i.DISPLAY_NOTIFICATION.toString():s.message_type=i.DATA_MESSAGE.toString(),s.sdk_platform="3",s.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(s.collapse_key=e.collapse_key),s.event="1",(null===(n=e.fcmOptions)||void 0===n?void 0:n.analytics_label)&&(s.analytics_label=null===(r=e.fcmOptions)||void 0===r?void 0:r.analytics_label),s}(t,await e.firebaseDependencies.installations.getId());!function(e,t){let n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}(e,n)}function L(e,t){let n=[];for(let i=0;i<e.length;i++)n.push(e.charAt(i)),i<t.length&&n.push(t.charAt(i));return n.join("")}async function F(e,t){var n,i;let{newSubscription:r}=e;if(!r){await x(t);return}let s=await b(t.firebaseDependencies);await x(t),t.vapidKey=null!==(i=null===(n=null==s?void 0:s.subscriptionOptions)||void 0===n?void 0:n.vapidKey)&&void 0!==i?i:c,await N(t)}async function V(e,t){let n=function({data:e}){if(!e)return null;try{return e.json()}catch(t){return null}}(e);if(!n)return;t.deliveryMetricsExportedToBigQueryEnabled&&await P(t,n);let i=await q();if(i.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){for(let n of(t.isFirebaseMessaging=!0,t.messageType=r.PUSH_RECEIVED,e))n.postMessage(t)}(i,n);if(n.notification&&await function(e){var t;let{actions:n}=e,{maxActions:i}=Notification;return n&&i&&n.length>i&&console.warn(`This browser only supports ${i} actions. The remaining actions will not be displayed.`),self.registration.showNotification(null!==(t=e.title)&&void 0!==t?t:"",e)}(function(e){let t=Object.assign({},e.notification);return t.data={[d]:e},t}(n)),t&&t.onBackgroundMessageHandler){let s=function(e){var t;let n={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};let n=t.notification.title;n&&(e.notification.title=n);let i=t.notification.body;i&&(e.notification.body=i);let r=t.notification.image;r&&(e.notification.image=r);let s=t.notification.icon;s&&(e.notification.icon=s)}(n,e),t=n,e.data&&(t.data=e.data),function(e,t){var n,i,r,s,a;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};let o=null!==(r=null===(i=t.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==r?r:null===(s=t.notification)||void 0===s?void 0:s.click_action;o&&(e.fcmOptions.link=o);let l=null===(a=t.fcmOptions)||void 0===a?void 0:a.analytics_label;l&&(e.fcmOptions.analyticsLabel=l)}(n,e),n}(n);"function"==typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(s):t.onBackgroundMessageHandler.next(s)}}async function U(e){var t,n;let i=null===(n=null===(t=e.notification)||void 0===t?void 0:t.data)||void 0===n?void 0:n[d];if(!i||e.action)return;e.stopImmediatePropagation(),e.notification.close();let s=function(e){var t,n,i,r;let s=null!==(n=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==n?n:null===(i=e.notification)||void 0===i?void 0:i.click_action;return s||("object"==typeof(r=e.data)&&r&&"google.c.a.c_id"in r?self.location.origin:null)}(i);if(!s)return;let a=new URL(s,self.location.href),o=new URL(self.location.origin);if(a.host!==o.host)return;let l=await j(a);if(l?l=await l.focus():(l=await self.clients.openWindow(s),await new Promise(e=>{setTimeout(e,3e3)})),l)return i.messageType=r.NOTIFICATION_CLICKED,i.isFirebaseMessaging=!0,l.postMessage(i)}async function j(e){let t=await q();for(let n of t){let i=new URL(n.url,self.location.href);if(e.host===i.host)return n}return null}function q(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function B(e){return E.create("missing-app-config-values",{valueName:e})}L("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),L("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class K{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;let i=function(e){if(!e||!e.options)throw B("App Configuration Object");if(!e.name)throw B("App Name");let{options:t}=e;for(let n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw B(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:i,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}let $=e=>{let t=new K(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(V(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(F(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(U(e))}),t};async function G(){return(0,u.zW)()&&await (0,u.eX)()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function z(e=(0,h.Sx)()){return G().then(e=>{if(!e)throw E.create("unsupported-browser")},e=>{throw E.create("indexed-db-unsupported")}),(0,h.j6)((0,u.Ku)(e),"messaging-sw").getImmediate()}(0,h.om)(new o.uA("messaging-sw",$,"PUBLIC"))},96148(e,t,n){var i;let r,s;n.d(t,{MR:()=>m,P2:()=>g});let a=(e,t)=>t.some(t=>e instanceof t),o=new WeakMap,l=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap,d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return l.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(f(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&o.set(t,e)}).catch(()=>{}),c.set(t,e),t}(e);if(h.has(e))return h.get(e);let n="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(p(this),e),f(o.get(this))}:function(...e){return f(t.apply(p(this),e))}:function(e,...n){let i=t.call(p(this),e,...n);return u.set(i,e.sort?e.sort():[e]),f(i)}:(t instanceof IDBTransaction&&function(e){if(l.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});l.set(e,t)}(t),a(t,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,d):t;return n!==e&&(h.set(e,n),c.set(n,e)),n}let p=e=>c.get(e);function g(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let a=indexedDB.open(e,t),o=f(a);return i&&a.addEventListener("upgradeneeded",e=>{i(f(a.result),e.oldVersion,e.newVersion,f(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",()=>r())}).catch(()=>{}),o}function m(e,{blocked:t}={}){let n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),f(n).then(()=>void 0)}let y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],w=new Map;function b(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(w.get(t))return w.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=v.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||y.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),a=s.store;return i&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),r&&s.done]))[0]};return w.set(t,s),s}d={...i=d,get:(e,t,n)=>b(e,t)||i.get(e,t,n),has:(e,t)=>!!b(e,t)||i.has(e,t)}}}]);