"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["NotificationWebPush"],{43498(t,e,i){let r;i.d(e,{LL:()=>g,Ui:()=>m,ET:()=>A});var n=i(96602),a=i(96540),o=i(91557),s=i(70223),l=i(11497),c=i(656),p=i(78292);let u=new class{bootstrap(t,e){this.manager=t,this.settingApp=this.manager.getSetting("firebase"),this.settingApp&&this.init(this.settingApp,e)}checkActive(){return this.isActive}init(t,e){if(this.mounted)return this.firebaseApp;this.mounted=!0;let i={apiKey:o.z0J,authDomain:o.wRL,projectId:o.wWR,storageBucket:o.npo,messagingSenderId:o.AfL,appId:o.Kou};this.config=t;try{let r=(0,s.Wp)(i),n=(0,c.xI)(r),{user_firebase_email:a,user_firebase_password:l,requiredSignin:p}=this.settingApp||{};return p&&(0,c.x9)(n,a,l).then(t=>{}).catch(t=>{console.log("Live Video - Firebase signInWithEmailAndPassword error",t),"auth/user-not-found"===t.code&&(0,c.eJ)(n,a,l)}),e(!0),this.firebaseApp=r,this.isActive=!0,r}catch(u){this.isActive=!1}}getFirebaseApp(){return this.firebaseApp}getFirestore(){if(!this.firebaseApp)return null;if(!this.firestore){let t=(0,l.aU)(this.firebaseApp);t&&(this.firestore=t)}return this.firestore}getMessaging(){if(!this.firebaseApp)return null;if(!this.cloudMessage){let t=(0,p.dG)(this.firebaseApp);t&&(this.cloudMessage=t)}return this.cloudMessage}},d=!1,f=!1;function h(){let t=(0,o.PCX)(),[e,i]=a.useState(!1);return e||d||(d=!0,u.bootstrap(t,()=>{f=!0,i(!0)})),[e||f,u]}function g(){let[t,e]=a.useState(),[i,o]=a.useState(!1),[s,l]=h(),c=a.useRef(0);if(!s)return["",()=>{},!0];if(!r&&!i&&s)try{r=l.getMessaging()}catch(p){o(!0)}let u=t=>{(0,n.gf)(r).then(i=>{t(i),e(i)}).catch(()=>{c.current>5||(c.current=c.current+1,u(t))})};return[t,u,i]}function m(){let[t,e]=h();if(!t)return!1;let i=e.getFirestore();return i}let b=(t,e)=>{let[i,r]=(0,a.useState)();return(0,a.useEffect)(()=>{let i;if(t&&(null==e?void 0:e.collection)&&(null==e?void 0:e.docID)){try{let n=(0,l.H9)(t,e.collection,e.docID);i=(0,l.aQ)(n,async t=>{r(t.data())})}catch(a){}return()=>{null==i||i()}}},[]),i},A=b},63095(t,e,i){i.r(e),i.d(e,{default:()=>m});var r,n,a=i(91557),o=i(3556),s=i(8051),l=i(87773),c=i(60780),p=i(96540),u=i(43498);let d=(0,o.Ay)(s.A,{name:"Wrapper",slot:"root"})(({theme:t})=>({position:"fixed",top:16,width:"auto",right:16,zIndex:1301})),f=(0,o.Ay)(s.A,{name:"Inner",slot:"root"})(({theme:t})=>({minWidth:"100px",maxWidth:"25vw",padding:t.spacing(2),backgroundColor:t.palette.background.paper,color:t.palette.text.primary,borderRadius:t.shape.borderRadius,boxShadow:t.shadows[20],[t.breakpoints.down("md")]:{maxWidth:"calc(100vw - 32px)"}})),h=(0,o.Ay)(s.A,{name:"Content",slot:"root"})(({theme:t})=>({paddingBottom:t.spacing(1),marginBottom:t.spacing(1),borderBottomStyle:"solid",borderBottomWidth:1,borderBottomColor:t.palette.divider})),g=(0,o.Ay)(s.A,{name:"ButtonWrapper",slot:"root"})(({theme:t})=>({display:"flex",justifyContent:"flex-end",button:{marginLeft:t.spacing(1)}}));function m(){let{i18n:t,cookieBackend:e,dispatch:i,useLoggedIn:r,useIsMobile:o}=(0,a.PCX)(),[,s,m]=(0,u.LL)(),[b,A]=p.useState(!0),k=e.get("fcm-notification")===n.Skip,x=e.get("fcm-notification")===n.Accept,y=!!e.get("fcm-token"),w=r(),S=o(!0),v=()=>{s&&s(t=>{i({type:"@registerFCM",payload:{token:t}})})},C=p.useCallback((t=n.Skip)=>{e.set("fcm-notification",t,{expires:30})},[]),W=p.useCallback(()=>{A(!1),C()},[]),E=()=>{"Notification"in window?"granted"===Notification.permission?v():"denied"!==Notification.permission?Notification.requestPermission().then(t=>{if("granted"===t){v();return}C(n.Skip)}):C(n.Skip):alert("This browser does not support desktop notification")},I=()=>{A(!1),C(n.Accept),E()};return(p.useEffect(()=>{a.SDN||!x||y||(C(n.Skip),E())},[]),a.SDN||x||k||!b||!w||m||S)?null:p.createElement(d,null,p.createElement(f,null,p.createElement(h,null,p.createElement(l.A,{variant:"body1",component:"span"},t.formatMessage({id:"web_push_consent_desc"}))),p.createElement(g,null,p.createElement(c.A,{"data-testid":"cancelWebPush",role:"button",tabIndex:2,variant:"text",disableRipple:!0,size:"small",color:"primary",onClick:W},t.formatMessage({id:"skip"})),p.createElement(c.A,{"data-testid":"allowWebPush",role:"button",tabIndex:1,autoFocus:!0,variant:"contained",disableRipple:!0,size:"small",color:"primary",onClick:I},t.formatMessage({id:"accept"})))))}(r=n||(n={})).Default="0",r.Skip="1",r.Accept="2"}}]);