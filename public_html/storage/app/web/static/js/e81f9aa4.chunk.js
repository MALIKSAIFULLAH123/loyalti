"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-feed-blocks-StatusComposer-Block"],{48462(e,t,a){a.r(t),a.d(t,{default:()=>T});var r=a(91557),o=a(84680),n=a(40515),i=a(67725),l=a(3556),s=a(30719),p=a(2491),d=a(8051),c=a(62193),m=a.n(c),u=a(96540),f=a(3306),v=a(72180),g=a(63461);function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}let h=(0,l.Ay)(g.A,{name:"StatusControl",slot:"Control",shouldForwardProp:e=>"canUploadTypes"!==e})(({theme:e})=>({width:32,height:32,fontSize:e.mixins.pxToRem(20),[e.breakpoints.up("sm")]:{width:44,height:44}}));function b({icon:e,testid:t,...a}){return u.createElement(h,y({"data-testid":t,color:"primary"},a),u.createElement(n.s4,{icon:e}))}var x=a(90243);let C="block",k=(0,l.Ay)("div",{name:"AvatarWrapper"})(({theme:e})=>({marginRight:e.spacing(1.5)})),w=(0,l.Ay)("div",{name:"ComposerWrapper"})(({theme:e})=>({display:"flex",width:"100%",alignItems:"center",minWidth:0,[e.breakpoints.down("sm")]:{display:"block",width:"100%"}})),E=(0,l.Ay)("div",{name:"LayoutSlot",slot:"ComposerInput",overridesResolver:(e,t)=>[t.composerInput]})(({theme:e})=>({border:e.mixins.border("secondary"),flex:1,backgroundColor:e.palette.action.hover,height:e.spacing(6),borderRadius:24,padding:e.spacing(0,3),cursor:"pointer",color:e.palette.text.secondary,fontSize:e.mixins.pxToRem(15),fontWeight:e.typography.fontWeightRegular,letterSpacing:0,WebkitBoxOrient:"vertical",WebkitLineClamp:"1",display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",lineHeight:e.mixins.pxToRem(48),"*":{margin:"0 !important"},[e.breakpoints.down("sm")]:{height:e.spacing(4),lineHeight:e.mixins.pxToRem(32),padding:e.spacing(0,2)}})),_=(0,l.Ay)("div",{name:"ComposerToolbar"})(({theme:e})=>({display:"flex",marginLeft:e.spacing(1.5),[e.breakpoints.down("sm")]:{marginLeft:e.spacing(0),marginTop:e.spacing(1.5),"& > *":{marginRight:`${e.spacing(1.5)} !important`}}})),A=(0,l.Ay)("div",{name:"ComposerToolbarExpand"})(({theme:e})=>{var t;return{display:"flex",borderTop:"solid 1px",borderTopColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary,marginTop:e.spacing(2),marginLeft:e.spacing(8),paddingTop:e.spacing(1)}}),S=(0,r.$MH)((0,r.FB$)(function({item:e,title:t,variant:a,blockProps:l,showWhen:c}){var g,y;let h;let[S,,T]=(0,v.A)(),{i18n:R,useSession:W,dispatch:H,jsxBackend:B,usePageParams:I,getAcl:L,getSetting:P}=(0,r.PCX)(),D=(0,s.A)(),O=(0,p.A)(D.breakpoints.down("sm")),z=L(),U=L("activity.feed.create"),F=P(),{user:M,loggedIn:$}=W(),j=I(),V=R.formatMessage({id:"what_s_your_mind"},{user:null==M?void 0:M.full_name}),q=(0,r.dx2)("formValues.dialogStatusComposer")||V,{identity:X,item_type:G}=j,J=X?X.split(".")[3]:"",K="user"===G&&J&&(null==M?void 0:M.id)!==parseInt(J);u.useEffect(()=>{$&&H({type:"setting/sharingItemPrivacy/FETCH",payload:{id:null==M?void 0:M.id}})},[$]),T.current.requestComposerUpdate=u.useCallback(()=>{setImmediate(()=>{let{attachmentType:e,attachments:t}=T.current.state;H({type:"statusComposer/onPress/status",payload:{data:{attachmentType:e,attachments:{[e]:t[e]}},parentIdentity:X,parentType:G}})})},[T,H,X,G]),((null==e?void 0:e.privacy_feed)||(null==e?void 0:e.privacy_detail))&&(h={privacy_feed:null==e?void 0:e.privacy_feed,privacy_detail:null==e?void 0:e.privacy_detail});let N=()=>{H({type:"statusComposer/onPress/status",payload:{parentIdentity:X,parentType:G,data:h}})},Q=()=>{T.current.removeAttachments()},Y=u.useMemo(()=>({strategy:C,acl:z,setting:F,isUserProfileOther:K,item:e,parentType:G}),[z,F,K,e,G]),Z=(0,i.Ue)(f.A.attachers,Y);if(m()(M)||!U||(null==e?void 0:null===(g=e.profile_settings)||void 0===g?void 0:g.profile_view_profile)===!1||(null==e?void 0:null===(y=e.profile_settings)||void 0===y?void 0:y.feed_share_on_wall)===!1)return null;let ee=!!(0,i.Ue)([{showWhen:c}],{item:e}).length;if(!ee)return null;if("expanded"===a)return u.createElement(o.eB,{testid:"blockStatusComposer"},u.createElement(o.Tw,{title:t}),u.createElement(o.tD,null,u.createElement(d.A,{display:"flex",flexDirection:"row"},u.createElement(k,null,u.createElement(n.H8,{user:M,size:O?32:48,"data-testid":"userAvatar",noStory:!0,showStatus:!1})),u.createElement(E,{"data-testid":"whatsHappening",color:"info",onClick:N},u.createElement(x.Ay,{html:q}))),u.createElement(A,{onClick:Q},Z.map(e=>B.render({component:e.as,props:{key:e.as,strategy:C,composerRef:T,composerState:S,control:b,parentIdentity:X}})))));let et=O?Z:Z.slice(0,3);return u.createElement(o.eB,{testid:"blockStatusComposer"},u.createElement(o.Tw,{title:t}),u.createElement(o.tD,null,u.createElement(d.A,{display:"flex",flexDirection:"row"},u.createElement(k,null,u.createElement(n.H8,{user:M,size:O?32:48,"data-testid":"userAvatar",noStory:!0,showStatus:!1})),u.createElement(w,null,u.createElement(E,{"data-testid":"whatsHappening",onClick:N},u.createElement(x.Ay,{html:q})),u.createElement(_,{"data-testid":"composerToolbar",onClick:Q},et.map(e=>B.render({component:e.as,props:{key:e.as,strategy:C,composerRef:T,composerState:S,control:b,parentIdentity:X}})))))))},()=>{})),T=(0,r.WvA)({extendBlock:S,name:"StatusComposer",testid:"StatusComposer",defaults:{variant:"default",title:"Status Composer",blockLayout:"Status Composer"},custom:{variant:{name:"variant",component:"Select",label:"Variant",fullWidth:!0,margin:"normal",variant:"outlined",options:[{label:"Default",value:"default"},{label:"Expanded",value:"expanded"}]}}})}}]);