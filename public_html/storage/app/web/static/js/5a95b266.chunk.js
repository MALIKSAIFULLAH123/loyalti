"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-layout-LayoutBlock-BlockWithEditingPage"],{14464(e,t,r){let n;r.r(t),r.d(t,{default:()=>C});var i=r(91557),a=r(40515),o=r(3556),s=r(8051),c=r(97763),l=r(63461),d=r(96540),g=r(58410),u=r(25044),h=r(32072),p=r(85015),m=r.n(p);let f=(0,o.Ay)(s.A,{name:"BlockEditingDragLayer",slot:"Block"})(({theme:e,currentOffset:t,mouseOffset:r,width:n})=>({backgroundColor:e.palette.background.paper,display:"flex",alignItems:"center",padding:"4px 8px",margin:"8px 0",borderRadius:e.shape.borderRadius,minWidth:"300px",minHeight:"40px",cursor:"move",border:"2px dashed transparent",boxSizing:"border-box",opacity:.8,marginLeft:r&&t?`${r.x-t.x-(n?n/2:0)}px`:0})),D=({item:e})=>d.createElement(f,null,e.title),b=(0,o.Ay)("div",{name:"EditBlock",slot:"root"})({}),v=(0,o.Ay)("div",{name:"EditBlock",slot:"controller",shouldForwardProp:e=>"dragging"!==e&&"canDrag"!==e})(({theme:e,canDrag:t,dragging:r,disabled:n})=>({minHeight:"40px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:e.spacing(.5,1),backgroundColor:e.palette.background.paper,margin:e.spacing(1,0),borderRadius:e.shape.borderRadius/2,boxShadow:e.shadows[1],cursor:"pointer",border:"2px dashed transparent",boxSizing:"border-box",'&[draggable="true"]':{cursor:t?"move":"default"},...n?{background:"rgba(0,0,0,0.1)",cursor:"default"}:{"&:hover":{opacity:.8}},...r&&{opacity:0,height:0,margin:0,padding:0,"&:hover":{opacity:0}}})),S=(0,o.Ay)("div",{name:"EditBlock",slot:"actions"})(({theme:e})=>({"& button":{marginLeft:e.spacing(.5)}})),w=(0,o.Ay)("div",{name:"EditBlock",slot:"content"})(({theme:e})=>({paddingLeft:e.spacing(2)}));function C(e){let{blockId:t,title:r,layoutEditMode:o,blockDisabled:s,blockName:p,blockOrigin:f,slotName:C,elements:P}=e,{layoutBackend:I,jsxBackend:O,dispatch:y,i18n:k}=(0,i.PCX)(),{title:A,container:M}=d.useMemo(()=>I.getBlockView(p)||{title:p,container:!1},[p,I]),E=r&&m()(r)?k.formatMessage({id:r}):"",x=E||A||p,R="layout"===f&&o===h.W.editLayout||"page"===f&&o===h.W.editPageContent||"site"===f&&o===h.W.editSiteContent,B="page"!==f&&o===h.W.editPageContent;d.useEffect(()=>{T((n||((n=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),n),{captureDraggingState:!1})},[]);let[_,H,T]=(0,g.i)({type:u.X,item:{type:u.X,blockId:t,blockName:p,slotName:C,draggingComponent:D,title:x},canDrag:R,collect:e=>({isDragging:!!e.isDragging()})}),U=t=>y({type:t,payload:e});return d.createElement(b,null,d.createElement(v,{canDrag:R,ref:H,dragging:_.isDragging,disabled:s&&o===h.W.editPageContent},x,d.createElement(S,null,M?d.createElement(c.A,{title:k.formatMessage({id:"add_layout_block"})},d.createElement(l.A,{onClick:()=>U("@layout/createBlock"),size:"smaller"},d.createElement(a.s4,{icon:"ico-plus"}))):null,R?d.createElement(c.A,{title:k.formatMessage({id:"edit_layout_block"})},d.createElement(l.A,{onClick:()=>U("@layout/editBlock"),size:"smaller"},d.createElement(a.s4,{icon:"ico-pencil"}))):null,R?d.createElement(c.A,{title:k.formatMessage({id:"delete_layout_block"})},d.createElement(l.A,{onClick:()=>U("@layout/deleteBlock"),size:"smaller"},d.createElement(a.s4,{icon:"ico-trash"}))):null,B?d.createElement(c.A,{title:k.formatMessage({id:s?"layout_enable_layout_block":"layout_disable_layout_block"})},d.createElement(l.A,{onClick:()=>U("@layout/toggleBlock"),size:"smaller"},d.createElement(a.s4,{icon:"ico-eye-off"}))):null)),M?d.createElement(w,null,O.render(P)):null)}},58410(e,t,r){r.d(t,{i:()=>b});var n=r(79396),i=r(8576),a=r(27739),o=r(96540),s=r(31670),c=r(58853),l=r(71643);class d{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){let e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){let e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return(t&&this.disconnectDragSource(),this.handlerId)?e?(t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),t):(this.lastConnectedDragSource=e,t):t}reconnectDragPreview(e=!1){let t=this.dragPreview,r=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(r&&this.disconnectDragPreview(),this.handlerId){if(!t){this.lastConnectedDragPreview=t;return}r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!(0,s.b)(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!(0,s.b)(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=(0,l.i)({dragSource:(e,t)=>{this.clearDragSource(),this.dragSourceOptions=t||null,(0,c.i)(e)?this.dragSourceRef=e:this.dragSourceNode=e,this.reconnectDragSource()},dragPreview:(e,t)=>{this.clearDragPreview(),this.dragPreviewOptions=t||null,(0,c.i)(e)?this.dragPreviewRef=e:this.dragPreviewNode=e,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}var g=r(56143),u=r(27727);let h=!1,p=!1;class m{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){(0,n.V)(!h,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return h=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{h=!1}}isDragging(){if(!this.sourceId)return!1;(0,n.V)(!p,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return p=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{p=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}var f=r(85711);class D{beginDrag(){let e=this.spec,t=this.monitor,r=null;return null!=(r="object"==typeof e.item?e.item:"function"==typeof e.item?e.item(t):{})?r:null}canDrag(){let e=this.spec,t=this.monitor;return"boolean"==typeof e.canDrag?e.canDrag:"function"!=typeof e.canDrag||e.canDrag(t)}isDragging(e,t){let r=this.spec,n=this.monitor,{isDragging:i}=r;return i?i(n):t===e.getSourceId()}endDrag(){let e=this.spec,t=this.monitor,r=this.connector,{end:n}=e;n&&n(t.getItem(),t),r.reconnect()}constructor(e,t,r){this.spec=e,this.monitor=t,this.connector=r}}function b(e,t){let r=(0,a.I)(e,t);(0,n.V)(!r.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");let s=function(){let e=(0,g.u)();return(0,o.useMemo)(()=>new m(e),[e])}(),c=function(e,t){let r=(0,g.u)(),n=(0,o.useMemo)(()=>new d(r.getBackend()),[r]);return(0,u.E)(()=>(n.dragSourceOptions=e||null,n.reconnect(),()=>n.disconnectDragSource()),[n,e]),(0,u.E)(()=>(n.dragPreviewOptions=t||null,n.reconnect(),()=>n.disconnectDragPreview()),[n,t]),n}(r.options,r.previewOptions);return!function(e,t,r){let i=(0,g.u)(),a=function(e,t,r){let n=(0,o.useMemo)(()=>new D(e,t,r),[t,r]);return(0,o.useEffect)(()=>{n.spec=e},[e]),n}(e,t,r),s=(0,o.useMemo)(()=>{let t=e.type;return(0,n.V)(null!=t,"spec.type must be defined"),t},[e]);(0,u.E)(function(){if(null!=s){let[e,n]=(0,f.V)(s,a,i);return t.receiveHandlerId(e),r.receiveHandlerId(e),n}},[i,t,r,a,s])}(r,s,c),[(0,i.j)(r.collect,s,c),(0,o.useMemo)(()=>c.hooks.dragSource(),[c]),(0,o.useMemo)(()=>c.hooks.dragPreview(),[c])]}}}]);