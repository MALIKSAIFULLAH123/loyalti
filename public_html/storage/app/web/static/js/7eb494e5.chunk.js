"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-livestreaming-blocks-LiveComment-CommentContainer"],{43498(e,t,n){let i;n.d(t,{LL:()=>v,Ui:()=>g,ET:()=>y});var a=n(96602),l=n(96540),o=n(91557),r=n(70223),s=n(11497),c=n(656),m=n(78292);let u=new class{bootstrap(e,t){this.manager=e,this.settingApp=this.manager.getSetting("firebase"),this.settingApp&&this.init(this.settingApp,t)}checkActive(){return this.isActive}init(e,t){if(this.mounted)return this.firebaseApp;this.mounted=!0;let n={apiKey:o.z0J,authDomain:o.wRL,projectId:o.wWR,storageBucket:o.npo,messagingSenderId:o.AfL,appId:o.Kou};this.config=e;try{let i=(0,r.Wp)(n),a=(0,c.xI)(i),{user_firebase_email:l,user_firebase_password:s,requiredSignin:m}=this.settingApp||{};return m&&(0,c.x9)(a,l,s).then(e=>{}).catch(e=>{console.log("Live Video - Firebase signInWithEmailAndPassword error",e),"auth/user-not-found"===e.code&&(0,c.eJ)(a,l,s)}),t(!0),this.firebaseApp=i,this.isActive=!0,i}catch(u){this.isActive=!1}}getFirebaseApp(){return this.firebaseApp}getFirestore(){if(!this.firebaseApp)return null;if(!this.firestore){let e=(0,s.aU)(this.firebaseApp);e&&(this.firestore=e)}return this.firestore}getMessaging(){if(!this.firebaseApp)return null;if(!this.cloudMessage){let e=(0,m.dG)(this.firebaseApp);e&&(this.cloudMessage=e)}return this.cloudMessage}},d=!1,p=!1;function h(){let e=(0,o.PCX)(),[t,n]=l.useState(!1);return t||d||(d=!0,u.bootstrap(e,()=>{p=!0,n(!0)})),[t||p,u]}function v(){let[e,t]=l.useState(),[n,o]=l.useState(!1),[r,s]=h(),c=l.useRef(0);if(!r)return["",()=>{},!0];if(!i&&!n&&r)try{i=s.getMessaging()}catch(m){o(!0)}let u=e=>{(0,a.gf)(i).then(n=>{e(n),t(n)}).catch(()=>{c.current>5||(c.current=c.current+1,u(e))})};return[e,u,n]}function g(){let[e,t]=h();if(!e)return!1;let n=t.getFirestore();return n}let f=(e,t)=>{let[n,i]=(0,l.useState)();return(0,l.useEffect)(()=>{let n;if(e&&(null==t?void 0:t.collection)&&(null==t?void 0:t.docID)){try{let a=(0,s.H9)(e,t.collection,t.docID);n=(0,s.aQ)(a,async e=>{i(e.data())})}catch(l){}return()=>{null==n||n()}}},[]),n},y=f},92287(e,t,n){n.d(t,{A:()=>f});var i=n(90243),a=n(40515),l=n(3556),o=n(87773),r=n(96540),s=n(91557),c=n(67725);function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}let u="CommentExtraData",d=(0,l.Ay)("div",{name:u,slot:"extraDataPhoto"})(({theme:e})=>({maxWidth:e.spacing(26),cursor:"pointer"})),p=(0,l.Ay)("div",{name:u,slot:"extraDataSticker"})(({theme:e})=>({width:e.spacing(10),height:e.spacing(10)})),h=(0,l.Ay)("div",{name:u,slot:"bubbleExtraData"})(({theme:e})=>({marginTop:e.spacing(1)}));function v(e){let{extra_data:t}=e,{extra_type:n,image:i,params:l}=Object.assign({},t),{dispatch:o,jsxBackend:u}=(0,s.PCX)(),v=u.get("feedArticle.comment.embedItem");if(!t)return null;let g=(0,c.AE)(i,"500"),f=e=>{o({type:"photo/presentSimplePhoto",payload:{src:e,alt:"photo",identity:null==t?void 0:t._identity}})},y=null;switch(n){case"photo":case"storage_file":y=r.createElement(d,{onClick:()=>f(g)},r.createElement(a._V,{src:g,alt:"photo",shape:"radius"}));break;case"sticker":y=r.createElement(p,null,r.createElement(a._V,{src:g,alt:"sticker",aspectRatio:"fixed",imageFit:"contain"}));break;case"link":y=(null==l?void 0:l.is_image)?r.createElement(d,{onClick:()=>f(null==l?void 0:l.image)},r.createElement(a._V,{src:null==l?void 0:l.image,alt:"photo",shape:"radius"})):(null==l?void 0:l.is_hidden)?null:r.createElement(v,m({},l,{widthImage:"90px"}))}return y?r.createElement(h,null,y):null}let g=(0,l.Ay)("div",{name:"CommentContent",slot:"bubbleText"})(({theme:e})=>({display:"block",fontSize:e.mixins.pxToRem(15),transition:"background 300ms ease","& a":{color:e.palette.primary.main,fontWeight:e.typography.fontWeightRegular,"&:hover":{textDecoration:"underline"}}}));function f({text:e,extra_data:t,isHidden:n}){let{i18n:l}=(0,s.PCX)();return r.createElement("div",null,n?r.createElement(g,null,r.createElement(o.A,{component:"h1",variant:"body1",color:"text.hint"},l.formatMessage({id:"comment_hidden"}))):r.createElement(r.Fragment,null,r.createElement(g,null,r.createElement(a.Zn,{truncateProps:{variant:"body1",lines:3}},r.createElement(i.Ay,{html:e}))),r.createElement(v,{extra_data:t})))}},72974(e,t,n){n.r(t),n.d(t,{default:()=>A});var i=n(91557),a=n(96540),l=n(3556),o=n(40515),r=n(8051),s=n(92287);let c="PreFetchComment",m=(0,l.Ay)("div",{name:c,slot:"itemOuter"})(({theme:e})=>({display:"flex",opacity:.6,pointerEvents:"none","&:hover $ItemActionMenu":{visibility:"visible",marginLeft:e.spacing(.5)}})),u=(0,l.Ay)("div",{name:c,slot:"avatarWrapper"})(({theme:e})=>({marginRight:e.spacing(1)})),d=(0,l.Ay)("div",{name:c,slot:"itemInner"})(({theme:e})=>({display:"flex",flexDirection:"column",minWidth:0,wordBreak:"break-word"})),p=(0,l.Ay)("div",{name:c,slot:"itemName"})(({theme:e})=>({display:"flex",fontSize:e.mixins.pxToRem(13),marginBottom:e.spacing(.5)})),h=(0,l.Ay)(o.xE,{name:c,slot:"userName"})(({theme:e})=>({fontSize:e.mixins.pxToRem(13),maxWidth:"100%",fontWeight:"bold"})),v=(0,l.Ay)("div",{name:c,slot:"actions"})(({theme:e})=>({display:"inline-flex",alignItems:"center",height:e.spacing(4)}));function g({text:e}){let{useSession:t,ReactionActButton:n,ReplyActButton:l}=(0,i.PCX)(),{user:c}=t();return a.createElement("div",{"data-testid":"comment"},a.createElement(r.A,{pt:1},a.createElement(m,null,a.createElement(u,null,a.createElement(o.H8,{user:c,size:32})),a.createElement(d,null,a.createElement(r.A,{p:0,borderRadius:2},a.createElement(p,null,a.createElement(h,{to:`/user/${c.id}`,user:c})),a.createElement(s.A,{text:e})),a.createElement(v,{className:"dotSeparators"},n&&a.createElement(n,{minimize:!0}),l&&a.createElement(l,{minimize:!0}))))))}let f=(0,l.Ay)("div",{name:"CommentListRoot"})(({theme:e})=>{var t;return{position:"relative","& $CommentRoot:first-of-type":{marginTop:e.spacing(1)},"& $CommentRoot:last-child":{borderBottom:"solid 1px",borderBottomColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary,paddingBottom:e.spacing(2),[e.breakpoints.down("sm")]:{borderBottom:"none"}}}}),y=(0,l.Ay)("div",{name:"CommentListRoot"})(({theme:e})=>{var t;return{position:"relative","&:before":{content:'""',position:"absolute",top:e.spacing(6),bottom:e.spacing(2),left:e.spacing(2),borderLeft:"solid 1px",borderLeftColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary}}});function b({identity:e,data:t,scrollToBottom:n,setParentReply:l}){let{useGetItem:o,jsxBackend:r}=(0,i.PCX)(),s=r.get("CommentItemViewLiveStreaming"),c=o(e),{preFetchingComment:m}=c||{},u=m&&Object.values(m).some(e=>(null==e?void 0:e.isLoading)===!0);return(a.useEffect(()=>{n&&n()},[u,n]),s)?a.createElement(f,null,(null==t?void 0:t.length)?t.map(e=>a.createElement(y,{key:null==e?void 0:e.id},a.createElement(s,{itemLive:e,identity:`comment.entities.comment.${null==e?void 0:e.id}`,setParentReply:l}))):null,m?Object.values(m).filter(e=>(null==e?void 0:e.isLoading)===!0).map(e=>a.createElement(y,{key:e},a.createElement(g,{text:e.text}))):null):null}var E=n(43498);let A=(0,i.G5k)(function({streamKey:e,identity:t,scrollToBottom:n,setParentReply:l}){var o;let{dispatch:r,useGetItem:s,getSetting:c}=(0,i.PCX)(),m=s(t),u=c("comment"),d=(0,E.Ui)(),p=(0,E.ET)(d,{collection:"live_video_comment",docID:e}),h=null==p?void 0:p.total_comment;if(a.useEffect(()=>{var e,n;(null==m?void 0:null===(e=m.statistic)||void 0===e?void 0:e.total_comment)!==h&&r({type:"livestreaming/updateStatistic",payload:{identity:t,statistic:{total_comment:h||(null==m?void 0:null===(n=m.statistic)||void 0===n?void 0:n.total_comment)}}})},[h,null==m?void 0:null===(o=m.statistic)||void 0===o?void 0:o.total_comment]),a.useEffect(()=>{r({type:"livestreaming/updateComment",payload:{data:null==p?void 0:p.comment}})},[null==p?void 0:p.comment]),!e||!p)return null;let v=null==p?void 0:p.comment.slice(Math.max((null==p?void 0:p.comment.length)-20,0));return u?a.createElement(b,{data:v,identity:t,scrollToBottom:n,setParentReply:l}):null})}}]);