"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chatplus-components-ChatRoomPanel-Block"],{4941(e,t,l){l.d(t,{A:()=>i});var n=l(89481),a=l(96540);let o={backdrop:{position:"absolute",left:0,top:0,bottom:0,right:0},content:{position:"absolute",left:"50%",top:"50%",marginLeft:-20,marginTop:-20}};function i({size:e=40}){return a.createElement("div",{style:o.backdrop,"data-testid":"loadingIndicator"},a.createElement("div",{style:o.content},a.createElement(n.A,{variant:"indeterminate",size:e})))}},15439(e,t,l){l.r(t),l.d(t,{default:()=>tG});var n=l(91557),a=l(88485),o=l(16677),i=l(97837),r=l(84680),s=l(40515),d=l(3556),u=l(8051),c=l(30719),m=l(84058),p=l.n(m),g=l(56449),v=l.n(g),h=l(62193),f=l.n(h),y=l(96540),b=l(71468),E=l(93624),x=l(76799),A=l(61341),C=l(67725),M=l(13718),k=l(60780),w=l(95223),_=l(97763),S=l(58156),R=l.n(S),I=l(2404),P=l.n(I),F=l(13586),z=l(43546),B=l(2491),T=l(87773),D=l(38221),W=l.n(D);let O=(0,d.Ay)("div")(({theme:e})=>({width:"100%",transition:"all .2s ease"})),H=(0,d.Ay)(w.Ay,{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({maxWidth:"600px",height:e.spacing(5),margin:e.spacing(2),padding:e.spacing(1.5,2),borderRadius:e.spacing(2.5),border:e.mixins.border("secondary"),backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.grey["100"],"& .MuiInputBase-input":{marginRight:e.spacing(1),...!t&&{minWidth:"200px"}},[e.breakpoints.down("lg")]:{width:"100%",maxWidth:"100%",margin:0,padding:e.spacing(0,1),"& input":{paddingTop:e.spacing(.5)}},...t&&{width:"100%",maxWidth:"100%",margin:0,padding:e.spacing(0,1),"& input":{paddingTop:e.spacing(.5)}}})),L=(0,d.Ay)(s.s4,{shouldForwardProp:e=>"isMobile"!==e&&"disabled"!==e})(({theme:e,isMobile:t,disabled:l})=>({color:e.palette.text.primary,transition:"all .2s ease",cursor:"pointer",padding:e.spacing(0,1),...t&&{padding:0},...l&&{cursor:"not-allowed",color:e.palette.text.disabled}})),j=(0,d.Ay)("div")(({theme:e})=>({display:"inline-flex"})),U=(0,d.Ay)("div",{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:"0",color:e.palette.grey["600"],marginRight:e.spacing(1.5),...t&&{marginRight:e.spacing(.75)}})),X=(0,d.Ay)("span")(({theme:e})=>({marginRight:e.spacing(0,.25),color:e.palette.text.primary}));function $({id:e,checked:t,icon:l,value:a,label:o,roomId:i,onClick:r}){let{dispatch:s}=(0,n.PCX)(),d=()=>{s({type:a,payload:{identity:i}}),"function"==typeof r&&r(t?void 0:e)};return y.createElement(U,{onClick:d},y.createElement(z.A,{checked:t,size:"small"}),y.createElement(X,null,o))}let N=function({toggleSearch:e,room:t,messageFilter:l,searching:o}){let{i18n:i,dispatch:r,useIsMobile:s,useTheme:d}=(0,n.PCX)(),u=s(!0),c=d(),m=(0,B.A)(c.breakpoints.down("lg")),p=(0,a.nb)(null==t?void 0:t.id),{msgSearch:g}=p||{},v=g?(null==g?void 0:g.slot)+1:0,[h,b]=y.useState((null==g?void 0:g.total)||0),E=y.useRef(),x=y.useRef(),C=(0,y.useRef)(null),M=y.useMemo(()=>(null==p?void 0:p.pinned)?i.formatMessage({id:"search_pinned_messages"}):(null==p?void 0:p.starred)?i.formatMessage({id:"search_starred_messages"}):i.formatMessage({id:"search_messages_dots"}),[null==p?void 0:p.pinned,null==p?void 0:p.starred]),k=(0,y.useMemo)(()=>[{icon:"ico-thumb-tack",label:i.formatMessage({id:"pinned"}),checked:null==p?void 0:p.pinned,value:"chatplus/room/pinnedMessages",id:"pin"},{icon:"ico-star-o",label:i.formatMessage({id:"starred"}),checked:null==p?void 0:p.starred,value:"chatplus/room/starredMessages",id:"star"}],[i,p]),[w,_]=y.useState(!0),S=(0,y.useMemo)(()=>!!f()(g)||(null==g?void 0:g.slot)===0,[g]),R=(0,y.useMemo)(()=>!!f()(g)||h===v,[g,h,v]),I=()=>{(u||m)&&setTimeout(()=>{_(!1)},200)},P=()=>{(u||m)&&_(!0)};y.useEffect(()=>{_(!0)},[null==p?void 0:p.pinned,null==p?void 0:p.starred]),y.useEffect(()=>{f()(g)&&b(0)},[g]),y.useEffect(()=>{E.current="",C.current=null},[o]);let F=e=>{C.current=e,J()},z=e=>{b((null==e?void 0:e.total)||0)},D=()=>{},U=e=>{E.current=e.target.value,J()},X=y.useCallback(()=>{if(u){r({type:C.current?"chatplus/room/pinnedMessages":"chatplus/room/searchMessages",payload:{roomId:null==t?void 0:t.id,text:E.current,filter:C.current,isBuddy:!0},meta:{onSuccess:z,onFailure:D}});return}r({type:"chatplus/room/searchMessages",payload:{roomId:null==t?void 0:t.id,text:E.current,filter:C.current},meta:{onSuccess:z,onFailure:D}})},[r,t,u]),N=y.useCallback(()=>{S||r({type:"chatplus/room/searchChangePosition",payload:{rid:null==t?void 0:t.id,mid:null==g?void 0:g.id,type:A.rs}})},[null==g?void 0:g.id,S]),q=y.useCallback(()=>{R||r({type:"chatplus/room/searchChangePosition",payload:{rid:null==t?void 0:t.id,mid:null==g?void 0:g.id,type:A.mR}})},[null==g?void 0:g.id,R]),J=y.useMemo(()=>W()(X,A.IG),[X]);return u?y.createElement(O,null,y.createElement(H,{isMobile:u,endAdornment:y.createElement(y.Fragment,null,y.createElement(y.Fragment,null,y.createElement(T.A,{justifyContent:"flex-end",display:"inline-flex"},v,"/",h),y.createElement(L,{icon:"ico-angle-up",onClick:N,disabled:S}),y.createElement(L,{icon:"ico-angle-down",onClick:q,disabled:R})),y.createElement(L,{icon:"ico-close",onClick:e})),placeholder:M,autoComplete:"off",inputProps:{"aria-label":"search","data-testid":"searchBox",autoComplete:"off",autoCapitalize:"off",onFocus:I,onBlur:P},ref:x,inputRef:E,onChange:U})):y.createElement(O,null,y.createElement(H,{startAdornment:y.createElement(y.Fragment,null,w?y.createElement(j,null,k.map(e=>y.createElement($,{id:e.id,key:e.id.toString(),checked:e.checked,icon:e.icon,value:e.value,label:e.label,roomId:null==t?void 0:t.id,onClick:F}))):null,y.createElement(L,{icon:"ico-search-o"})),endAdornment:y.createElement(y.Fragment,null,y.createElement(T.A,{justifyContent:"flex-end",display:"inline-flex"},v,"/",h),y.createElement(L,{icon:"ico-angle-up",onClick:N,disabled:S}),y.createElement(L,{icon:"ico-angle-down",onClick:q,disabled:R}),y.createElement(L,{icon:"ico-close",onClick:e})),placeholder:M,autoComplete:"off",inputProps:{"aria-label":"search","data-testid":"searchBox",autoComplete:"off",autoCapitalize:"off",onFocus:I,onBlur:P},ref:x,inputRef:E,onChange:U}))},q=(0,d.Ay)("div")(({theme:e})=>({width:"100%"})),J=(0,d.Ay)("div")(({theme:e})=>({display:"inline-flex",padding:e.spacing(0,1)})),V=(0,d.Ay)(u.A,{name:"SearchBox",slot:"Root"})(({theme:e})=>({width:"100%",height:e.spacing(5),borderRadius:e.spacing(2.5),display:"flex",alignItems:"center",backgroundColor:e.palette.action.hover,"& input::placeholder":{color:e.palette.text.hint}})),G=(0,d.Ay)(u.A)(({theme:e})=>({display:"flex",alignItems:"center"}));function K({roomId:e}){let{dispatch:t}=(0,n.PCX)(),l=()=>{t({type:"chatplus/room/toggleSearching",payload:{identity:e}})};return y.createElement(s.s4,{icon:"ico-close",onClick:l})}let Q=({hide:e,roomId:t,searching:l,chatRoom:a,isBuddy:o=!1})=>{let{dispatch:i,i18n:r}=(0,n.PCX)(),d=(0,y.useRef)(null),u=(0,y.useRef)(null),[c,m]=y.useState(null),p=r.formatMessage({id:"search_messages_dots"});(null==a?void 0:a.pinned)&&(p=r.formatMessage({id:"search_pinned_messages"})),(null==a?void 0:a.starred)&&(p=r.formatMessage({id:"search_starred_messages"})),(0,y.useEffect)(()=>{d.current="",m(""),u.current=null,b()},[l]);let g=e=>{d.current=e.target.value,m(e.target.value),b()},v=e=>{},h=()=>{},f=y.useCallback(()=>{i({type:u.current?"chatplus/room/pinnedMessages":"chatplus/room/searchMessages",payload:{roomId:t,text:d.current,filter:u.current,isBuddy:o},meta:{onSuccess:v,onFailure:h}})},[i,t]),b=(0,y.useMemo)(()=>W()(f,A.IG),[f]);return((0,y.useEffect)(()=>{!t||(d.current="",m(""),(null==a?void 0:a.pinned)&&(u.current="pin",b()),(null==a?void 0:a.starred)&&(u.current="star",b()),(null==a?void 0:a.pinned)||(null==a?void 0:a.starred)||(u.current=null,b()))},[null==a?void 0:a.pinned,null==a?void 0:a.starred,t]),e||!t)?null:y.createElement(q,null,y.createElement(V,null,y.createElement(w.Ay,{sx:{width:"100%"},variant:"search",onChange:g,placeholder:p,startAdornment:y.createElement(s.s4,{icon:"ico-search-o"}),"aria-controls":"search_complete",value:c,fullWidth:!0,endAdornment:y.createElement(G,null,y.createElement(J,null,y.createElement(K,{roomId:t})))})))},Y=(0,y.memo)(Q);var Z=l(5818);let ee="HeaderRoom",et=(0,d.Ay)("div",{name:ee,slot:"root",shouldForwardProp:e=>"isMobile"!==e&&"openSearch"!==e})(({theme:e,isMobile:t,openSearch:l})=>({backgroundColor:e.palette.background.paper,alignItems:"center",boxSizing:"border-box",display:"flex",height:e.spacing(9),padding:e.spacing(1,1,1,2),justifyContent:"space-between",borderBottom:e.mixins.border("divider"),...t&&!l&&{padding:e.spacing(1,.5,1,1)}})),el=(0,d.Ay)("div",{name:ee,slot:"Toolbar",shouldForwardProp:e=>"openSearch"!==e})(({theme:e,openSearch:t})=>({[e.breakpoints.down("lg")]:{...t&&{width:"100%"}},"& button":{[e.breakpoints.up("sm")]:{minWidth:"auto"}}})),en=(0,d.Ay)("div",{name:ee,slot:"title",shouldForwardProp:e=>"openSearch"!==e})(({theme:e,openSearch:t})=>({padding:e.spacing(1.75,0),display:"flex",alignItems:"center",[e.breakpoints.down("lg")]:{...t&&{display:"none"}}})),ea=(0,d.Ay)("span")(({theme:e})=>({...e.typography.h4})),eo=(0,d.Ay)(M.A)(({theme:e})=>({height:e.spacing(4.25)})),ei=(0,d.Ay)(k.A)(({theme:e})=>({height:e.spacing(4.25),marginLeft:e.spacing(1)})),er=(0,d.Ay)(k.A,{shouldForwardProp:e=>"isInfo"!==e})(({theme:e,isInfo:t})=>({color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.primary,...t&&{color:e.palette.primary.main},fontSize:e.spacing(2.25),minWidth:"auto",height:"auto",padding:e.spacing(1),margin:0})),es=(0,d.Ay)(k.A,{shouldForwardProp:e=>"isInfo"!==e})(({theme:e,isInfo:t})=>({color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.primary,fontSize:e.spacing(2.25),minWidth:e.spacing(5),...t&&{color:e.palette.primary.main},padding:0,margin:0})),ed=(0,d.Ay)(s.s4)(({theme:e})=>({fontSize:e.spacing(2.25),cursor:"pointer",padding:e.spacing(1)})),eu=(0,d.Ay)(w.Ay)(({theme:e})=>({width:"200px",height:e.spacing(4.375),margin:e.spacing(2),borderRadius:e.spacing(3),padding:e.spacing(2),backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.grey["100"]})),ec=(0,d.Ay)("div")(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"flex-end"})),em=(0,d.Ay)("div")(({theme:e})=>({flex:1,display:"flex",alignItems:"center",justifyContent:"space-between"})),ep=(0,d.Ay)("div")(({theme:e})=>({display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitLineClamp:1,WebkitBoxOrient:"vertical",paddingLeft:e.spacing(1.5),width:"fit-content"})),eg=(0,d.Ay)(n.N_E,{shouldForwardProp:e=>"isDirect"!==e})(({theme:e,isDirect:t})=>({cursor:"pointer",...!t&&{"&:hover":{textDecoration:"none",cursor:"default"}}})),ev=({name:e,room:t,perms:l,to:a})=>{let o=a,{dispatch:r,i18n:s}=(0,n.PCX)(),[d,u]=y.useState(!1),[c,m]=y.useState(e),[g,v]=y.useState(!1);y.useEffect(()=>{u(!1),m(e)},[null==t?void 0:t.id]),y.useEffect(()=>{d&&m(e)},[d]);let h=()=>{u(!1),m(null)},f=e=>{m(e.target.value)},b=()=>{if(!c||P()(c,e)){u(!1);return}v(!0),r({type:"chatplus/room/editSettings",payload:{identity:null==t?void 0:t.id,value:{roomName:c}},meta:{onSuccess:E,onFailure:x}})},E=()=>{v(!1),u(!1)},x=()=>{v(!1),u(!1)},C=e=>{13===e.keyCode&&b()};return((null==t?void 0:t.isBotRoom)&&(o=null),d)?y.createElement(y.Fragment,null,y.createElement(eu,{placeholder:e,value:c,onChange:f,inputProps:{maxLength:A.uK},onKeyDown:C}),y.createElement(eo,{loading:g,variant:"contained",onClick:b},s.formatMessage({id:"save"})),y.createElement(ei,{variant:"outlined",onClick:h},s.formatMessage({id:"cancel"}))):y.createElement(y.Fragment,null,y.createElement(ep,{"data-testid":p()("chatplus container name")},y.createElement(eg,{target:"_blank",to:o||null,isDirect:o},y.createElement(ea,null,c||e))),l["edit-room"]&&(null==t?void 0:t.t)!==i.CJ.Direct&&y.createElement(_.A,{title:s.formatMessage({id:"change_group_name"}),placement:"top"},y.createElement(ed,{"data-testid":p()("chatplus change name"),icon:"ico-pencilline-o",onClick:()=>u(!0)})))},eh=function({buddy:e,perms:t,userChat:l,room:o,chatRoom:r,toggleInfo:d,messageFilter:u,searching:c,subscription:m,settings:g,isSelfChat:h,allowMsgNoOne:b,isReadOnly:x,isMetaFoxBlocked:A,isBlocked:M,openInfo:k}){var w,S,I,P,z,B;let{dispatch:T,useActionControl:D,useIsMobile:W,navigate:O,i18n:H}=(0,n.PCX)(),L=W(!0),j=y.useRef(),U=y.useRef(),X=(0,a.hB)(),[$,q]=y.useState(c),[J,V]=y.useState(null),[G]=D(null==o?void 0:o.id,{}),K=(e,t,l)=>{G(e,t,l),"chatplus/room/toggleSearching"===e&&(T({type:"chatplus/room/searchMessages",payload:{roomId:null==o?void 0:o.id,text:""}}),q(e=>!e)),"chatplus/room/sideInfo"===e&&d()},Q=X&&o&&o.muted&&v()(o.muted)&&!!o.muted.find(e=>e===X.username),ee=(null==o?void 0:o.t)===i.CJ.Direct&&(null==e?void 0:e.username)&&`/${e.username}`,eo=y.useMemo(()=>{let t=H.formatMessage({id:"name"});if(null==o?void 0:o.isNameChanged)return(null==e?void 0:e.name)||t;let l=null==e?void 0:e.name.split(",");return(null==e?void 0:e.name)&&l.length>2?`${l[0]}, ${l[1]} +${l.length-2}`:null==e?void 0:e.name},[null==e?void 0:e.name,null==o?void 0:o.isNameChanged]),ei=(0,a.EH)(),ed=(0,a.FX)(),eu=y.useMemo(()=>(0,C.Ue)(ei,{room:o,subscription:m,groups:null==r?void 0:r.groups,pinned:null==r?void 0:r.pinned,favorite:null==m?void 0:m.f,starred:null==r?void 0:r.starred,searching:null==r?void 0:r.searching,settings:g,perms:t,isMobile:L,isSelfChat:h,isBlocked:M,isMetaFoxBlocked:A,allowMsgNoOne:b,isReadOnly:x,isMuted:Q}),[r,m,o,g,t,L,ei,h,M,A,b,x,Q]),eg=y.useMemo(()=>(0,C.Ue)(ed,{room:o,subscription:m,groups:null==r?void 0:r.groups,pinned:null==r?void 0:r.pinned,favorite:null==m?void 0:m.f,starred:null==r?void 0:r.starred,searching:null==r?void 0:r.searching,settings:g,perms:t,isMobile:L,isSelfChat:h,isBlocked:M,isMetaFoxBlocked:A,allowMsgNoOne:b,isReadOnly:x}),[r,m,o,g,t,L,ed,h,M,A,b,x]),eh=R()(t,"search-msg"),ef=Boolean(-1!==eg.findIndex(e=>"startVoiceCall"===e.testid)),ey=Boolean(-1!==eg.findIndex(e=>"startVideoChat"===e.testid)),eb=!f()(eu)&&eu.length>1&&eu.filter(e=>(null==e?void 0:e.behavior)!=="more"),eE=(null==l?void 0:l.status)||0;y.useEffect(()=>{q(c)},[c]),y.useEffect(()=>(q(!1),()=>{V(null)}),[null==o?void 0:o.id]);let ex=y.useCallback(()=>{T({type:"chatplus/room/toggleSearching",payload:{identity:null==o?void 0:o.id}}),T({type:"chatplus/room/clearMsgSearch",payload:{rid:null==o?void 0:o.id}}),q(e=>!e),V(null)},[T,o]),eA=y.useCallback(()=>{T({type:"chatplus/room/startVoiceCall",payload:{identity:null==o?void 0:o.id}})},[T,o]),eC=y.useCallback(()=>{T({type:"chatplus/room/startVideoChat",payload:{identity:null==o?void 0:o.id}})},[T,o]),eM=y.useCallback(()=>{if("pin"===J){V(null);return}V("pin")},[J]),ek=y.useCallback(()=>{if("star"===J){V(null);return}V("star")},[J]),ew=()=>{O({pathname:"/messages"})},e_=y.useCallback(()=>{J&&V(null)},[J]),eS=y.useCallback(()=>{d(),V(null)},[]),eR=y.useMemo(()=>"pin"===J?U:"star"===J?j:void 0,[J]);return L?y.createElement(et,{isMobile:L,openSearch:$},$?null:y.createElement(es,{onClick:ew},y.createElement(s.s4,{icon:"ico-arrow-left"})),$?(null==r?void 0:r.pinned)||(null==r?void 0:r.starred)?y.createElement(Y,{hide:!c,roomId:null==o?void 0:o.id,searching:c,chatRoom:r,isBuddy:!0}):y.createElement(N,{toggleSearch:ex,room:o,messageFilter:u,searching:c}):y.createElement(em,null,y.createElement(en,null,y.createElement(F.default,{name:eo,username:null==e?void 0:e.username,size:48,src:null==e?void 0:e.avatar,room:o,status:eE,avatarETag:null==e?void 0:e.avatarETag}),y.createElement(ep,null,y.createElement(ea,null,eo))),y.createElement(el,null,y.createElement(ec,null,y.createElement(E.qC,{items:eu,handleAction:K,displayLimit:2}))))):y.createElement(et,{"data-testid":p()("block chatroom header")},y.createElement(en,{openSearch:$},y.createElement(F.default,{target:"_blank",to:ee,noLink:null==o?void 0:o.isBotRoom,name:eo,username:null==e?void 0:e.username,size:48,src:null==e?void 0:e.avatar,room:o,status:eE,avatarETag:null==e?void 0:e.avatarETag}),y.createElement(ev,{name:eo,room:o,perms:t,to:ee})),y.createElement(el,{"data-testid":p()("block header toolbar"),openSearch:$},$?y.createElement(N,{toggleSearch:ex,room:o,messageFilter:u,searching:c}):y.createElement(ec,null,eh&&y.createElement(_.A,{title:null!==(w=H.formatMessage({id:"search"}))&&void 0!==w?w:"",placement:"top"},y.createElement(er,{"data-testid":p()("header action search"),onClick:ex},y.createElement(s.s4,{icon:"ico-search-o"}))),y.createElement(_.A,{title:null!==(S=H.formatMessage({id:"pinned_messages"}))&&void 0!==S?S:"",placement:"top"},y.createElement(er,{"data-testid":p()("header action pin"),ref:U,onClick:eM,isInfo:"pin"===J},y.createElement(s.s4,{icon:"ico-thumb-tack"}))),y.createElement(_.A,{title:null!==(I=H.formatMessage({id:"starred_messages"}))&&void 0!==I?I:"",placement:"top"},y.createElement(er,{"data-testid":p()("header action starred"),ref:j,onClick:ek,isInfo:"star"===J},y.createElement(s.s4,{icon:"ico-star-o"}))),y.createElement(Z.default,{open:"pin"===J||"star"===J,anchorRef:eR,type:J,closePopover:e_}),y.createElement(_.A,{title:null!==(P=H.formatMessage({id:"conversation_info"}))&&void 0!==P?P:"",placement:"top"},y.createElement(er,{"data-testid":p()("header action info"),onClick:eS,isInfo:k},y.createElement(s.s4,{icon:"ico-info-circle-alt-o"}))),!h&&ef&&y.createElement(_.A,{title:null!==(z=H.formatMessage({id:"start_an_audio_call"}))&&void 0!==z?z:"",placement:"top"},y.createElement(er,{"data-testid":p()("header action call"),onClick:eA},y.createElement(s.s4,{icon:"ico-phone-o"}))),!h&&ey&&y.createElement(_.A,{title:null!==(B=H.formatMessage({id:"start_a_video_call"}))&&void 0!==B?B:"",placement:"top"},y.createElement(er,{"data-testid":p()("header action video call"),onClick:eC},y.createElement(s.s4,{icon:"ico-videocam-o"}))),eb?y.createElement(er,{sx:{p:0,height:"34px",width:"34px"}},y.createElement(E.qC,{items:eu,handleAction:G,variant:"pageMessage"})):null)))};var ef=l(54358),ey=l(18727),eb=l(77298),eE=l(97648),ex=l.n(eE);function eA(){return(eA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(this,arguments)}let eC="ChatRoomPanel",eM=(0,d.Ay)("div")(({theme:e})=>({borderLeft:e.mixins.border("divider"),backgroundColor:e.palette.background.paper,display:"flex",flexDirection:"column",width:"100%",height:"100%"})),ek=(0,d.Ay)("div",{name:eC,slot:"mainContent"})(({theme:e})=>({borderBottom:e.mixins.border("divider"),display:"flex",flexDirection:"row",alignItems:"center"})),ew=(0,d.Ay)("div")(({theme:e})=>({display:"flex",flexDirection:"row",backgroundColor:e.palette.background.paper,flex:1})),e_=(0,d.Ay)("div")(({theme:e})=>({flex:1,display:"flex",flexDirection:"column",width:"100%",minWidth:0})),eS=(0,d.Ay)("div",{name:eC,slot:"Title"})(({theme:e})=>({fontSize:e.mixins.pxToRem(15),fontWeight:e.typography.fontWeightMedium,padding:e.spacing(3.5,2),alignSelf:"flex-start",color:e.palette.text.secondary,minWidth:"130px"})),eR=(0,d.Ay)("div",{name:eC,slot:"SearchWrapper"})(({theme:e})=>({flex:1,minWidth:0,margin:e.spacing(1),position:"relative",zIndex:e.zIndex.speedDial,display:"flex",alignItems:"center",listStyle:"none","& fieldset":{border:"none"}})),eI=(0,d.Ay)("div",{shouldForwardProp:e=>"suggestList"!==e})(({theme:e,suggestList:t})=>({...!0===t&&{position:"absolute",border:e.mixins.border("secondary"),backgroundColor:e.palette.background.paper,borderRadius:e.shape.borderRadius,marginTop:e.spacing(.5),width:"100%"}})),eP=(0,d.Ay)("li")(({theme:e})=>({margin:e.spacing(.5)})),eF=(0,d.Ay)("div")(({theme:e})=>({padding:e.spacing(1.75,2),display:"flex",alignItems:"center",cursor:"pointer",borderBottom:e.mixins.border("secondary"),"&:last-child":{borderBottom:"none"}})),ez=(0,d.Ay)("span")(({theme:e})=>({...e.typography.h5,marginLeft:e.spacing(1)})),eB=(0,d.Ay)(k.A,{name:eC,slot:"ButtonSubmit"})(({theme:e})=>({paddingRight:e.spacing(.5)})),eT=(0,d.Ay)(ef.A,{name:eC,slot:"InputStyled",shouldForwardProp:e=>"isFocus"!==e})(({theme:e,isFocus:t})=>({minHeight:e.spacing(5),borderRadius:e.spacing(2.5),paddingRight:e.spacing(1),backgroundColor:e.palette.action.hover,transition:"all 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",border:e.mixins.border("secondary"),"& .MuiInputBase-root":{padding:e.spacing(0,1),"& input":{minHeight:e.spacing(5),padding:"0 !important"}},"& .ico.ico-search-o":{opacity:.43},...t&&{borderRadius:e.spacing(2.5),border:e.mixins.border("primary"),borderColor:e.palette.primary.main,backgroundColor:e.palette.background.paper,"& .ico.ico-search-o":{opacity:1,color:e.palette.primary.main}}})),eD=(0,d.Ay)(s.s4,{name:eC,slot:"icon-search"})(({theme:e})=>({padding:e.spacing(0,1)})),eW=function(){let{i18n:e,dispatch:t}=(0,n.PCX)(),[l,d]=y.useState([]),{results:c,searchText:m}=(0,a.Rh)(),p=(0,a.hB)(),g=(0,b.d4)(o.M7),[v,h]=y.useState(""),[E,x]=y.useState(!1),[A,C]=y.useState(!1),[M,k]=y.useState(!1),w=y.useCallback(()=>{let e=l.length;e&&(k(!0),t({type:"chatplus/newChatRoom/submit",payload:{users:l,pageMessage:!0},meta:{onSuccess(){k(!1)},onFailure(){k(!1)}}}))},[t,l]),_=e=>{h(void 0),d(t=>[...t,e]),T()},S=e=>{d(t=>t.filter(t=>t.value!==e.value))},R=y.useCallback(e=>{var l,n;let a=null===(l=e.currentTarget)||void 0===l?void 0:l.value;if(x(!0),h(a),!a){let o=Object.values(g)?null===(n=Object.values(g))||void 0===n?void 0:n.slice(0,4):[];t({type:"chatplus/newChatRoom/search/updateUsers",payload:o});return}P(a)},[g]),I=e=>{t({type:"chatplus/newChatRoom/search",payload:{query:e}})},P=W()(I,300),z=c.users.filter(e=>e.username!==p.username).map(e=>({value:e.username,label:e.name,_id:e._id,avatarETag:null==e?void 0:e.avatarETag})),B=ex()(z,l,"value"),T=()=>{x(!1)},D=()=>{C(!0)},O=()=>{C(!1)};return y.createElement(eM,null,y.createElement(ek,null,y.createElement(eS,null,e.formatMessage({id:"new_message"})),y.createElement(s.qB,{onClickAway:T},y.createElement(eR,null,y.createElement(u.A,{sx:{position:"relative",flex:1}},y.createElement(ey.A,{sx:{flex:1},multiple:!0,open:!1,disableClearable:!0,clearText:e.formatMessage({id:"clear"}),options:B,value:l,freeSolo:!0,renderTags:(e,t)=>f()(e)?null:l.map((e,t)=>y.createElement(eP,{key:t},y.createElement(eb.A,{variant:"outlined",label:e.label,onDelete:()=>S(e),size:"medium"}))),inputValue:v||m,renderInput:t=>y.createElement(eT,eA({},t,{isFocus:A,onFocus:D,onBlur:O,onChange:R,placeholder:e.formatMessage({id:"type_name_start_new_conversation"}),InputProps:{...t.InputProps,startAdornment:y.createElement(y.Fragment,null,y.createElement(eD,{icon:"ico-search-o"}),t.InputProps.startAdornment)}}))}),E?y.createElement(eI,{suggestList:Boolean(B&&B.length)},y.createElement("div",null,y.createElement(r.P,{autoHide:!0,autoHeight:!0},B.map((e,t)=>y.createElement(y.Fragment,{key:t},y.createElement(eF,{onClick:()=>_(e)},y.createElement(F.default,{name:e.label,username:e.value,size:32,roomType:i.CJ.Direct,avatarETag:null==e?void 0:e.avatarETag}),y.createElement(ez,null,e.label))))))):null),y.createElement(eB,{disabled:!l.length||M,size:"medium",color:"primary",variant:"text",onClick:w},e.formatMessage({id:"submit"}))))),y.createElement(ew,null,y.createElement(e_,null)))};var eO=l(18579),eH=l(80160);let eL=(e,t)=>{let[l,a]=(0,y.useState)(!1),o=(0,n.yX1)(),i=e?e.current:o&&o.current;if((0,y.useEffect)(()=>(i&&i.addEventListener("scroll",r),()=>{i&&i.removeEventListener("scroll",r)}),[i]),(0,y.useEffect)(()=>{l&&t()},[l]),!o||!o.current)return[l,a];function r(){i.clientHeight+i.scrollTop+20<i.scrollHeight||l||a(!0)}return[l,a]};var ej=l(4941),eU=l(89481),eX=l(65121);let e$=(0,d.Ay)("div")(({theme:e})=>({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",height:e.spacing(5.75),marginBottom:e.spacing(1.25)})),eN=(0,d.Ay)("div")(({theme:e})=>({display:"flex",alignItems:"center",overflow:"hidden"})),eq=(0,d.Ay)("div")(({theme:e})=>({display:"flex",flexDirection:"column",overflow:"hidden",marginRight:e.spacing(.5)})),eJ=(0,d.Ay)(k.A)(({theme:e})=>({color:e.palette.primary.main,border:e.mixins.border("primary"),minWidth:e.spacing(5)})),eV=(0,d.Ay)(s.s4)(({theme:e})=>({color:e.palette.grey["600"],fontSize:e.spacing(5.75),marginRight:e.spacing(1)})),eG=function(e){let{chatplus:t,i18n:l}=(0,n.PCX)(),a=(0,eX.z3)(e.size||0);return y.createElement(e$,null,y.createElement(eN,null,y.createElement(eV,{icon:"ico-file-zip-o"}),y.createElement(eq,null,y.createElement(s.mE,{lines:1,variant:"h5"},e.name),y.createElement(T.A,null,a))),y.createElement(_.A,{title:l.formatMessage({id:"download"}),PopperProps:{disablePortal:!0},placement:"top"},y.createElement(eJ,{onClick:()=>(0,eX.NK)(t.sanitizeRemoteFileUrl(null==e?void 0:e.url),!1,!0)},y.createElement(s.s4,{icon:"ico-download"}))))};function eK(){return(eK=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(this,arguments)}let eQ="FileList",eY=(0,d.Ay)("div",{name:eQ,slot:"NoContent"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(2),textAlign:"center",flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",height:"100%",fontSize:e.mixins.pxToRem(16)})),eZ=(0,d.Ay)("div",{name:eQ,slot:"description"})(({theme:e})=>({fontSize:e.mixins.pxToRem(14)})),e0=(0,d.Ay)("div",{name:eQ,slot:"root"})(({theme:e})=>({padding:e.spacing(2)})),e1=(0,d.Ay)(u.A,{name:eQ,slot:"loadmore"})(({theme:e})=>({textAlign:"center"})),e5=function(e){var t,l,o,i,r,s;let{room:d,scrollRefList:u,type:c}=e,{dispatch:m}=(0,n.PCX)(),p=(0,a._n)(null==d?void 0:d.id),g=null!==(i=null==p?void 0:null===(t=p.other)||void 0===t?void 0:t.files)&&void 0!==i?i:[],v=null!==(r=null==p?void 0:null===(l=p.other)||void 0===l?void 0:l.total)&&void 0!==r?r:0,h=null!==(s=null==p?void 0:null===(o=p.other)||void 0===o?void 0:o.count)&&void 0!==s?s:0,f=y.useRef(!0),[b,E]=y.useState(!1),[x,A]=eL(u,function(){C(()=>{A(!1)})});y.useEffect(()=>{if(g.length)E(!0);else{var t;let l={rid:null==d?void 0:d.id,queryParam:null==e?void 0:e.query,sort:void 0,count:null!==(t=null==e?void 0:e.countLoad)&&void 0!==t?t:18,offset:0,type:null==e?void 0:e.type,callback(){E(!0)}};m({type:"chatplus/room/getRoomFiles",payload:l})}},[c]);let C=t=>{if(A(!0),v>h){var l;let n={rid:null==d?void 0:d.id,queryParam:null==e?void 0:e.query,sort:void 0,count:null!==(l=null==e?void 0:e.countLoad)&&void 0!==l?l:18,offset:h,type:null==e?void 0:e.type,callback:t};m({type:"chatplus/room/getRoomFiles",payload:n})}else A(!1),f.current=!1};return b?Array.isArray(g)&&!g.length&&b?y.createElement(eY,{"data-testid":"noResultFound"},null==e?void 0:e.emptyPhrase,(null==e?void 0:e.emptyPhraseSub)?y.createElement(eZ,null,null==e?void 0:e.emptyPhraseSub):null):y.createElement(e0,null,g.map((e,t)=>y.createElement(eG,eK({key:t},e))),x&&f.current?y.createElement(e1,null,y.createElement(eU.A,{variant:"indeterminate",size:28,"data-testid":"loadingIndicator"})):null):y.createElement(ej.A,{size:32})},e2=(0,d.Ay)("div")(({theme:e})=>({padding:e.spacing(.5)})),e4=(0,d.Ay)("span")(({theme:e})=>({cursor:"pointer",display:"block",width:"100px",aspectRatio:"1",backgroundSize:"cover",backgroundPosition:"center center",backgroundRepeat:"no-repeat",backgroundOrigin:"border-box",border:"1px solid rgba(0, 0, 0, 0.1)",position:"relative"})),e8=(0,d.Ay)(s.s4,{name:"MediaItem",slot:"CustomPlayButton"})({position:"absolute",top:0,bottom:0,left:0,right:0,margin:"auto",fontSize:"40px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2,background:"rgba(0, 0, 0, 0.3)",color:"#fff",pointerEvents:"none"}),e3=function(e){let{chatplus:t}=(0,n.PCX)(),{uploadedAt:l,keyIndex:a,listImages:o}=e;return y.createElement(e2,null,y.createElement(_.A,{PopperProps:{disablePortal:!0},title:(0,eX.rb)(null==l?void 0:l.$date),placement:"top"},y.createElement("div",null,(null==e?void 0:e.video_thumb_url)?y.createElement(e4,{style:{backgroundImage:`url(${t.sanitizeRemoteFileUrl(null==e?void 0:e.video_thumb_url)}&width=300)`},onClick(l){t.presentImageView(l,{id:parseInt(a),video_thumb_url:t.sanitizeRemoteFileUrl(null==e?void 0:e.video_thumb_url),src:t.sanitizeRemoteFileUrl(null==e?void 0:e.url),video_type:!!((null==e?void 0:e.type)&&e.type.match("video/*"))&&e.type},o)}},y.createElement(e8,{icon:"ico-play-circle-o"})):y.createElement(e4,{style:{backgroundImage:`url(${t.sanitizeRemoteFileUrl(null==e?void 0:e.url)}&width=300)`},onClick(l){t.presentImageView(l,{id:parseInt(a),src:t.sanitizeRemoteFileUrl(null==e?void 0:e.url)},o)}}))))};function e7(){return(e7=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(this,arguments)}let e6="FileList",e9=(0,d.Ay)("div",{name:e6,slot:"no-content"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(2),textAlign:"center",flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",height:"100%",fontSize:e.mixins.pxToRem(16)})),te=(0,d.Ay)("div",{name:e6,slot:"description"})(({theme:e})=>({fontSize:e.mixins.pxToRem(14)})),tt=(0,d.Ay)("div",{name:e6,slot:"root"})(({theme:e})=>({padding:e.spacing(2)})),tl=(0,d.Ay)("div",{name:e6,slot:"content"})(({theme:e})=>({display:"flex",flexFlow:"wrap"})),tn=(0,d.Ay)(u.A,{name:e6,slot:"loadmore"})(({theme:e})=>({textAlign:"center"})),ta=function(e){var t,l,o,i,r,s;let{dispatch:d,chatplus:u}=(0,n.PCX)(),{room:c,type:m,scrollRefList:p}=e,g=(0,a._n)(c.id),v=null!==(i=null==g?void 0:null===(t=g.media)||void 0===t?void 0:t.files)&&void 0!==i?i:[],h=null!==(r=null==g?void 0:null===(l=g.media)||void 0===l?void 0:l.total)&&void 0!==r?r:0,f=null!==(s=null==g?void 0:null===(o=g.media)||void 0===o?void 0:o.count)&&void 0!==s?s:0,[b,E]=y.useState(!1),x=y.useRef(!0),[A,C]=eL(p,function(){setTimeout(()=>{M(()=>{C(!1)})},500)});y.useEffect(()=>{if(v.length)E(!0);else{var t;let l={rid:null==c?void 0:c.id,queryParam:null==e?void 0:e.query,sort:void 0,count:null!==(t=null==e?void 0:e.countLoad)&&void 0!==t?t:18,offset:0,type:null==e?void 0:e.type,callback(){E(!0)}};d({type:"chatplus/room/getRoomFiles",payload:l})}},[m]);let M=t=>{if(C(!0),h>f){var l;let n={rid:null==c?void 0:c.id,queryParam:null==e?void 0:e.query,sort:void 0,count:null!==(l=null==e?void 0:e.countLoad)&&void 0!==l?l:18,offset:f,type:null==e?void 0:e.type,callback:t};d({type:"chatplus/room/getRoomFiles",payload:n})}else C(!1),x.current=!1},k=y.useMemo(()=>Array.isArray(v)&&!v.length?[]:v.map((e,t)=>({id:t,src:u.sanitizeRemoteFileUrl(e.url),video_type:!!((null==e?void 0:e.type)&&e.type.match("video/*"))&&!!e.type,video_thumb_url:(null==e?void 0:e.video_thumb_url)?u.sanitizeRemoteFileUrl(null==e?void 0:e.video_thumb_url):null})),[v]);return b?Array.isArray(v)&&!v.length?y.createElement(e9,{"data-testid":"noResultFound"},null==e?void 0:e.emptyPhrase,(null==e?void 0:e.emptyPhraseSub)?y.createElement(te,null,null==e?void 0:e.emptyPhraseSub):null):y.createElement(tt,null,y.createElement(tl,null,v.map((e,t)=>y.createElement(e3,e7({key:t,listImages:k,keyIndex:t},e)))),A&&x.current?y.createElement(tn,null,y.createElement(eU.A,{"data-testid":"loadingIndicator",variant:"indeterminate",size:28})):null):y.createElement(ej.A,{size:32})};var to=l(67131);let ti="MemberItem",tr=(0,d.Ay)("div",{name:ti,slot:"UIChatBuddyItem"})(({theme:e})=>{var t;return{padding:e.spacing(0,2),display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid",borderColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary,"&:hover":{background:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.grey["50"]}}}),ts=(0,d.Ay)("div",{name:ti,slot:"UIChatBuddyItemWrapper"})(({theme:e})=>({padding:e.spacing(2,0),display:"flex",alignItems:"center",cursor:"pointer",flex:1})),td=(0,d.Ay)("div")(({theme:e})=>({marginLeft:e.spacing(1.5),display:"flex",alignItems:"flex-start",flexDirection:"column",flex:1})),tu=(0,d.Ay)("div")(({theme:e})=>({color:e.palette.grey["600"],fontSize:e.spacing(2),padding:e.spacing(0,1)})),tc=(0,d.Ay)(s.mE)(({theme:e})=>({display:"flex",flexDirection:"column",..."dark"===e.palette.mode&&{color:e.palette.grey["400"]}})),tm=(0,d.Ay)("div")(({theme:e})=>({...e.typography.body1,..."dark"===e.palette.mode&&{color:e.palette.grey["500"]},display:"flex",flexWrap:"wrap","& > *:not(:last-child):after":{content:"'\xb7'",margin:e.spacing(0,.5)}}));function tp({u:e,user:t,room:l,perms:a={},setReloadData:o}){var r,d;let{i18n:c,useActionControl:m,chatplus:p}=(0,n.PCX)(),g={moderator:0,leader:0,owner:0};e&&e.roles&&Array.isArray(e.roles)&&Object.keys(g).forEach(t=>{e.roles.includes(t)&&(g[t]=1)});let v=(null==e?void 0:e._id)===t._id,h=(null==l?void 0:l.muted)&&(null==l?void 0:l.muted.includes(null==e?void 0:e.username)),f=null==e?void 0:e._id,[b]=m(null==l?void 0:l._id,{}),E=(e,t,l)=>{b(e,t,l),o&&o(!0)},x=[{label:"unmute_room_user",icon:"ico-unlock-o",value:"closeMenu, chatplus/room/unmuteUserInRoom",params:{userId:f},showWhen:["and",["truthy","perms.mute-user"],["falsy","isOwner"],["truthy","isMuted"]]},{label:"mute",icon:"ico-lock",value:"closeMenu, chatplus/room/muteUserInRoom",params:{userId:f},showWhen:["and",["truthy","perms.mute-user"],["falsy","isOwner"],["falsy","isMuted"]]},{label:"set_room_owner",icon:"ico-businessman-plus",value:"closeMenu, chatplus/room/addRoomOwner",params:{userId:f},showWhen:["and",["truthy","perms.set-owner"],["falsy","roles.owner"],["falsy","isOwner"]]},{label:"remove_room_owner",icon:"ico-businessman-del",value:"closeMenu, chatplus/room/removeRoomOwner",params:{userId:f},showWhen:["and",["truthy","perms.set-owner"],["truthy","roles.owner"]]},{label:"set_room_moderator",icon:"ico-businessman-plus",value:"closeMenu, chatplus/room/addRoomModerator",params:{userId:f},showWhen:["and",["truthy","perms.set-moderator"],["falsy","roles.moderator"],["falsy","isOwner"]]},{label:"remove_room_moderator",icon:"ico-businessman-del",value:"closeMenu, chatplus/room/removeRoomModerator",params:{userId:f},showWhen:["and",["truthy","perms.set-moderator"],["truthy","roles.moderator"]]},{label:"set_room_leader",icon:"ico-businessman-plus",value:"closeMenu, chatplus/room/addRoomLeader",params:{userId:f},showWhen:["and",["truthy","perms.set-leader"],["falsy","roles.leader"],["falsy","isOwner"]]},{label:"remove_room_leader",icon:"ico-businessman-del",value:"closeMenu, chatplus/room/removeRoomLeader",params:{userId:f},showWhen:["and",["truthy","perms.set-leader"],["truthy","roles.leader"]]},{label:"remove_room_user",icon:"ico-trash-o",value:"closeMenu, chatplus/room/removeUserFromRoom",params:{userId:f},showWhen:["and",["truthy","perms.remove-user"],["falsy","isOwner"]]}],A=y.useMemo(()=>(0,C.Ue)(x,{isOwner:v,roles:g,perms:a,isMuted:h}),[v,g,a,h]);return e&&l?y.createElement(tr,null,y.createElement(ts,{onClick:()=>p.openDirectMessageByUserId(null==e?void 0:e._id)},y.createElement(F.default,{username:e.username,name:e.name,size:32,status:e.status,room:l,roomType:i.CJ.Direct,avatarETag:null==e?void 0:e.avatarETag,hoverCard:`/user/${null==e?void 0:e.metafoxUserId}`,component:n.Wti}),y.createElement(td,null,y.createElement(tc,{lines:2,variant:"h5"},y.createElement(n.N_E,{children:e.name,hoverCard:`/user/${null==e?void 0:e.metafoxUserId}`,underline:"none",sx:{color:e=>e.palette.text.primary}})),y.createElement(tm,null,e.roles?e.roles.map(e=>y.createElement(u.A,{key:e},c.formatMessage({id:e}))):null,(null==e?void 0:e.inviter)?y.createElement(u.A,null,c.formatMessage({id:"added_by_name"},{name:(null==t?void 0:t._id)===(null===(r=e.inviter)||void 0===r?void 0:r._id)?"you":null===(d=e.inviter)||void 0===d?void 0:d.name})):null))),A.length?y.createElement(tu,null,y.createElement(s.pN,{identity:null==l?void 0:l._id,icon:"ico-dottedmore-vertical-o",items:A,menuName:"detailActionMenu",handleAction:E,size:"smaller",tooltipTitle:c.formatMessage({id:"more_options"})})):null,y.createElement(to.A,null)):null}let tg=(0,d.Ay)("div")(({theme:e})=>({})),tv=function({room:e,setMemberCount:t}){let{dispatch:l}=(0,n.PCX)(),o=y.useRef(),i=null==e?void 0:e.id,s=(0,a.hB)(),d=(0,a.y8)(i),[u,c]=y.useState([]),[m,p]=y.useState(!1);y.useEffect(()=>{v()},[i,null==e?void 0:e.usersCount]),y.useEffect(()=>{m&&v()},[m,l]);let g=e=>{t((null==e?void 0:e.count)||0),Array.isArray(e.users)&&c(e.users)},v=()=>{l({type:"chatplus/room/presentMembers",payload:{rid:null==e?void 0:e.id},meta:{onSuccess(e){g(e),p(!1)}}})};return f()(u)&&y.createElement(ej.A,null),y.createElement(tg,null,y.createElement(r.P,{ref:o},u.map((t,l)=>y.createElement(tp,{key:t._id,u:t,room:e,user:s,perms:d,setReloadData:p}))))};function th(e){let t=y.useRef(),{children:l,value:n,index:a,...o}=e;return y.createElement("div",{role:"tabpanel",hidden:n!==a,id:`simple-tabpanel-${a}`,"aria-labelledby":`simple-tab-${a}`,style:{height:"100%"}},n===a?y.createElement(r.P,{autoHide:!0,autoHeight:!0,autoHeightMax:"100%",ref:t},y.cloneElement(l,{...o})):null)}function tf(){return(tf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e}).apply(this,arguments)}let ty="sideInfo",tb=(0,d.Ay)("div",{name:ty})(({theme:e})=>({height:"100%",backgroundColor:e.palette.background.paper,position:"relative",borderLeft:e.mixins.border("divider"),display:"flex",flexDirection:"column"})),tE=(0,d.Ay)(k.A)(({theme:e})=>({position:"absolute",top:16,right:16,fontSize:e.spacing(2.25),color:e.palette.grey["600"]})),tx=(0,d.Ay)("div",{name:ty})(({theme:e})=>({boxSizing:"border-box",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",paddingTop:e.spacing(5)})),tA=(0,d.Ay)("div")(({theme:e})=>({padding:e.spacing(1.75,0),display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"})),tC=(0,d.Ay)(s.mE)(({theme:e})=>({marginTop:e.spacing(2),textAlign:"center",padding:e.spacing(0,1)})),tM=(0,d.Ay)("span",{shouldForwardProp:e=>"bio"!==e})(({theme:e,bio:t})=>({...e.typography.body1,marginTop:e.spacing(1),...t&&{color:e.palette.text.hint}})),tk=(0,d.Ay)("div",{name:ty})(({theme:e})=>({display:"flex",flexDirection:"column",height:"100%",backgroundColor:e.palette.background.paper,flex:1,overflow:"auto",marginTop:e.spacing(3),"& .MuiTabs-root":{overflow:"unset !important","& .MuiTabs-scroller":{overflowX:"auto !important"}}})),tw=(0,d.Ay)(k.A)(({theme:e})=>({fontSize:e.spacing(2),width:"90%"})),t_=(0,d.Ay)(eO.A)(({theme:e})=>({...e.typography.h5}));function tS(e){let{toggleInfo:t,buddy:l,room:o}=e,{i18n:r,dispatch:d,dialogBackend:c,navigate:m,useIsMobile:p}=(0,n.PCX)(),g=p(!0),v=(0,a.y8)(null==o?void 0:o.id),h=(0,a.sz)(),f=(0,a.hB)(),b=(0,a.kp)(),E=(null==o?void 0:o.t)==="d",[x,A]=y.useState(0),[M,k]=y.useState(null),w=y.useRef(),[S,R]=y.useState(0),I=(()=>{try{if(o&&o.t===i.CJ.Direct&&1===o.usersCount)return f;if(o&&o.t===i.CJ.Direct&&2===o.usersCount){var e;let t=null==o?void 0:null===(e=o.uids)||void 0===e?void 0:e.find(e=>e!==(null==f?void 0:f._id));if(!t)return null;let l=Object.values(b).find(e=>e._id===t);return l||null}}catch(n){return null}})(),P=y.useMemo(()=>{let e=r.formatMessage({id:"name"});if(null==o?void 0:o.isNameChanged)return(null==l?void 0:l.name)||e;let t=(null==l?void 0:l.name.split(","))||"";return(null==l?void 0:l.name)&&(null==t?void 0:t.length)>1?`${t[0]} +${(null==t?void 0:t.length)-1}`:null==l?void 0:l.name},[null==l?void 0:l.name,null==o?void 0:o.isNameChanged]);y.useEffect(()=>{k(null)},[o]);let z=(e,t)=>{A(t)},B=y.useCallback(()=>{if(E&&I){window.open(`/${I.username}`,"_blank","noreferrer");return}v["edit-room"]&&w&&w.current&&w.current.click()},[m,l,E,w,v,I]),T=e=>{var t;e.preventDefault(),e.stopPropagation();let l=w.current;if(!l||!(null===(t=l.files)||void 0===t?void 0:t.length))return;let n=l.files[0],a=new FileReader,i="",s=(null==h?void 0:h.RoomAvatarUpload_MaxFileSize)||8e3;a.addEventListener("load",e=>{i=e.target.result;let t=null==n?void 0:n.size,l=n.name;if(t&&t<s&&0!==s){if(!i)return;k(i),d({type:"chatplus/room/editSettings",payload:{identity:null==o?void 0:o.id,value:{roomAvatar:i}}})}else c.alert({message:r.formatMessage({id:"warning_upload_limit_one_file"},{fileName:(0,C.Tu)(l,30),fileSize:(0,C.lT)(n.size),maxSize:(0,C.lT)(s)})})}),a.readAsDataURL(n)},D=[{label:r.formatMessage({id:"members"}).toUpperCase(),content:{component:y.createElement(tv,{room:o,setMemberCount:R})},showWhen:["neq","room.t","d"]},{label:r.formatMessage({id:"files"}).toUpperCase(),query:{typeGroup:{$nin:["image","video"]}},type:"other",countLoad:18,content:{component:y.createElement(e5,{room:o})},emptyPhrase:r.formatMessage({id:"no_files"}),emptyPhraseSub:E?r.formatMessage({id:"no_files_subtext"},{name:null==l?void 0:l.name}):r.formatMessage({id:"no_files_group_subtext"})},{label:r.formatMessage({id:"media"}).toUpperCase(),query:{typeGroup:{$in:["image","video"]}},type:"media",countLoad:18,content:{component:y.createElement(ta,{room:o})},emptyPhrase:r.formatMessage({id:"no_media"}),emptyPhraseSub:E?r.formatMessage({id:"no_medias_subtext"},{name:null==l?void 0:l.name}):r.formatMessage({id:"no_medias_group_subtext"})}],W=y.useMemo(()=>(0,C.Ue)(D,{room:o}),[o]);return y.createElement(tb,null,y.createElement(_.A,{title:r.formatMessage({id:"close"}),placement:"top"},y.createElement(tE,{onClick:t},g?y.createElement(s.s4,{icon:"ico-close"}):y.createElement(s.s4,{icon:"ico-goright"}))),y.createElement(tx,null,y.createElement(tA,null,y.createElement(F.default,{name:null==l?void 0:l.name,username:null==l?void 0:l.username,src:M||(null==l?void 0:l.avatar),size:80,room:o,uploadLocal:!!M,avatarETag:null==l?void 0:l.avatarETag}),y.createElement(tC,{showFull:!0,variant:(null==P?void 0:P.length)<100?"h3":"h4"},P),y.createElement(tM,{bio:null==I?void 0:I.bio},E?null==I?void 0:I.bio:r.formatMessage({id:"total_user_member"},{value:S}))),y.createElement("input",{accept:"image/*",style:{display:"none"},type:"file",ref:w,onChange:T}),E&&!(null==o?void 0:o.isBotRoom)&&y.createElement(tw,{variant:"outlined",onClick:B},r.formatMessage({id:"view_main_profile"})),!E&&v["edit-room"]&&y.createElement(tw,{variant:"outlined",onClick:B},r.formatMessage({id:"change_group_image"}))),(null==o?void 0:o.isBotRoom)?null:y.createElement(tk,null,y.createElement(eH.A,{value:x,onChange:z},W.map((e,t)=>y.createElement(t_,tf({key:t,label:e.label},{id:`simple-tab-${t}`,"aria-controls":`simple-tabpanel-${t}`})))),y.createElement(u.A,{sx:{flex:1,minHeight:0}},W.map((e,t)=>{var l;return y.createElement(th,tf({key:t,value:x,index:t},e),null==e?void 0:null===(l=e.content)||void 0===l?void 0:l.component)}))))}var tR=l(86898),tI=l(35319),tP=l(36338),tF=l(9880),tz=l(54075),tB=l(98820);let tT="ChatRoomPanel",tD=(0,d.Ay)("div")(({theme:e})=>({borderLeft:e.mixins.border("divider"),backgroundColor:e.palette.background.paper,display:"flex",flexDirection:"row",width:"100%",height:"100%"})),tW=(0,d.Ay)("div",{name:tT,slot:"mainContent",shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({flex:1,display:"flex",width:"100%",height:"100%",...t&&{flexDirection:"column"}})),tO=(0,d.Ay)("div")(({theme:e})=>({display:"flex",flexDirection:"row",flex:1,width:"100%",minHeight:0})),tH=(0,d.Ay)("div",{name:tT,slot:"Main",shouldForwardProp:e=>"isMobile"!==e&&"openInfo"!==e})(({theme:e,isMobile:t,openInfo:l})=>({position:"relative",flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",...t&&l&&{flex:0,display:"none"}})),tL=(0,d.Ay)(s.dl,{name:tT,slot:"DropFileBox",shouldForwardProp:e=>"isMobile"!==e&&"openInfo"!==e})(({theme:e,isMobile:t,openInfo:l})=>({position:"relative",flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%",...t&&l&&{flex:0,display:"none"}})),tj=(0,d.Ay)(u.A,{name:tT,slot:"DropFileBackground"})(({theme:e})=>({backgroundColor:e.palette.background.secondary,width:"100%",height:"100%",position:"absolute",top:0,left:0,right:0,zIndex:"9999",opacity:.9,display:"flex",alignItems:"center",justifyContent:"center"})),tU=(0,d.Ay)("div",{name:tT,slot:"sideInfoStyled",shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({flexBasis:"360px",...t&&{flex:1},overflow:"hidden"})),tX=(0,d.Ay)("div")(({theme:e})=>({textAlign:"center",padding:e.spacing(2),fontStyle:"italic",color:"dark"===e.palette.mode?e.palette.text.primary:e.palette.grey["700"],fontSize:e.spacing(1.75)})),t$=(0,d.Ay)("div",{name:tT,slot:"ReplyEditWrapper"})(({theme:e})=>({padding:e.spacing(.625,1.25),height:"50px",width:"100%",borderTop:e.mixins.border("secondary"),display:"flex",justifyContent:"space-between",backgroundColor:"dark"===e.palette.mode?e.palette.grey["600"]:e.palette.grey["100"]})),tN=(0,d.Ay)(s.mE,{name:tT,slot:"SelectedMsg"})(({theme:e})=>({color:e.palette.text.primary,a:{pointerEvents:"none",color:e.palette.text.primary}})),tq=(0,d.Ay)(s.s4,{name:tT,slot:"LineIconClose"})(({theme:e})=>({cursor:"pointer",alignSelf:"center"})),tJ=(0,d.Ay)("div",{name:tT,slot:"SelectedMsgAttachment"})(({theme:e})=>({fontSize:e.spacing(1.5),margin:e.spacing(.5,0),"& .ico":{marginRight:e.spacing(.5)}})),tV=(0,d.Ay)("div",{name:tT,slot:"ContentWrapper"})(({theme:e})=>({overflow:"hidden"})),tG=(0,n.WvA)({name:"ChatRoomPanel",extendBlock:function(e){let{i18n:t,jsxBackend:l,usePageParams:d,dispatch:m,useIsMobile:g,getSetting:h}=(0,n.PCX)(),C=g(!0),M=g(),k=d(),{rid:w,noConversation:_}=k,S=y.useRef(),R=(0,a.nb)(w),I=(0,a.iW)(w),P=(0,a.GV)(w),F=(0,a.Im)(w),z=(0,b.d4)(e=>(0,o.a7)(e,w)),B=(0,a.hB)(),T=(0,a.sz)(),D=(0,a.y8)(w),W=(0,a.Fz)(null==I?void 0:I.userId),O=(0,a.Iv)(w),[H,L]=y.useState(!1),[j,U]=(0,y.useState)("no_react"),[X,$]=(0,y.useState)(),[N,q]=y.useState(!1),[J,V]=y.useState(!1),G=(0,c.A)(),K=y.useRef(),Q=y.useRef(),Y=y.useRef(),Z=y.useRef(),ee=l.get("ChatComposer"),et=y.useRef(),el=y.useMemo(()=>{var e,t,l,n;return f()(null==R?void 0:R.msgSearch)||(null==R?void 0:null===(e=R.msgSearch)||void 0===e?void 0:e.mode)===A.Dn?null:(null==R?void 0:null===(t=R.msgSearch)||void 0===t?void 0:t.mQuoteId)?null==R?void 0:R.searchMessages[null==R?void 0:null===(n=R.msgSearch)||void 0===n?void 0:n.mQuoteId]:null==R?void 0:R.searchMessages[null==R?void 0:null===(l=R.msgSearch)||void 0===l?void 0:l.id]},[null==R?void 0:R.msgSearch,null==R?void 0:R.searchMessages]),en=y.useMemo(()=>(null==R?void 0:R.searching)||!f()(el),[el,null==R?void 0:R.searching]),[ea,eo]=(0,y.useState)(!1),ei=y.useCallback(()=>{M&&eo(!1)},[M]),er=e=>{if(M&&eo(!0),e.target.scrollHeight-e.target.scrollTop-2*e.target.clientHeight>0?V(!0):V(!1),f()(el)){if(e.target.scrollTop<100&&!N){let{oldest:t,endLoadmoreMessage:l}=R||{};if(!t||l)return;et.current=e.target.scrollHeight-e.target.clientHeight,q(!0),m({type:"chatplus/room/loadHistory",payload:{rid:w,oldest:t},meta:{onSuccess(){q(!1)}}})}return}(null==Z?void 0:Z.current)&&Z.current.handleScroll(e)};y.useEffect(()=>{if(!(null==el?void 0:el.oldest)||!et.current)return;let e=S.current.scrollHeight-S.current.clientHeight;S.current.scrollTop=0+(e-et.current),et.current=0},[null==el?void 0:el.oldest]),y.useEffect(()=>{if(!(null==R?void 0:R.oldest)||!et.current)return;let e=S.current.scrollHeight-S.current.clientHeight;S.current.scrollTop=0+(e-et.current),et.current=0},[null==R?void 0:R.oldest]);let es=y.useCallback(()=>{(null==P?void 0:P.alert)&&m({type:"chatplus/room/markAsRead",payload:{identity:w}})},[P,w,m]),ed=()=>{U("no_react"),$(void 0)};y.useEffect(()=>(w&&(m({type:"chatplus/room/markAsRead",payload:{identity:w}}),m({type:"chatplus/openRooms/activeRoom",payload:w})),()=>{m({type:"chatplus/openRooms/activeRoom",payload:void 0}),L(!1),V(!1)}),[w]);let eu=!f()(I&&P&&R&&z);y.useEffect(()=>(eu&&m({type:"chatplus/room/active",payload:{rid:w}}),()=>{m({type:"chatplus/room/inactive",payload:{rid:w}}),ed()}),[w,eu]);let ec=y.useCallback(()=>L(e=>!e),[]),{isQuote:em}=(0,tI.checkIsQuote)(null==X?void 0:X.attachments),ep=y.useMemo(()=>(null==X?void 0:X.msg)?(0,tP.Nj)(null==X?void 0:X.msg,{mentions:null==X?void 0:X.mentions}):"",[X]);if(!w&&_&&!C)return y.createElement(eW,null);let eg=!!(null==P?void 0:P.archived),ev=!!((null==I?void 0:I.t)===i.CJ.Direct&&((null==P?void 0:P.blocked)||(null==P?void 0:P.blocker))),ef=!!((null==I?void 0:I.t)===i.CJ.Direct&&((null==P?void 0:P.metafoxBlocked)||(null==P?void 0:P.metafoxBlocker))),ey=!!(ev||ef),eb=!((null==P?void 0:P.allowMessageFrom)!=="noone"),eE=(null==R?void 0:R.newest)||0,ex=null==R?void 0:R.roomProgress,eA=I&&(null==I?void 0:I.typing)||[],eC=eb||ey||!h("preaction"),eM=B&&I&&I.muted&&v()(I.muted)&&!!I.muted.find(e=>e===B.username),ek=(null==I?void 0:I.ro)&&(null==I?void 0:I.t)!==i.CJ.Direct&&!(null==D?void 0:D.postReadonly)||!!eg,ew=(e,t)=>{if(!e)return;let l=e.split(/.,| /);l.forEach(e=>{switch(e){case"chatplus/replyMessage":U("reply"),$(t);break;case"chatplus/editMessage":U("edit"),$(t)}})},e_=()=>{if(ed(),!f()(el)){m({type:"chatplus/room/modeSearch",payload:{rid:w,mode:A.Dn},meta:{onSuccess(){(null==Y?void 0:Y.current)&&(V(!1),Y.current.scrollToBottom())}}});return}(null==Y?void 0:Y.current)&&Y.current.scrollToBottom()},eS={backgroundColor:G.palette.background.paper},eR=e=>{if(e.length&&K&&K.current){var t,l,n;let a=(null===(t=Q.current)||void 0===t?void 0:t.getPreviewFiles())||[];null===(l=Q.current)||void 0===l||l.attachFiles([...a,...e]),null===(n=K.current)||void 0===n||n.attachFiles([...a,...e])}};return y.createElement(tD,{"data-testid":p()("block chatroom")},y.createElement(tW,{isMobile:C},C?y.createElement(eh,{buddy:z,perms:D,userChat:W,room:I,toggleInfo:ec,messageFilter:F,chatRoom:R,subscription:P,searching:null==R?void 0:R.searching,settings:T,isSelfChat:O,allowMsgNoOne:eb,isReadOnly:ek,isMetaFoxBlocked:ef,isBlocked:ey,openInfo:H}):null,y.createElement(tO,null,y.createElement(tH,{isMobile:C,openInfo:H},C?null:y.createElement(eh,{buddy:z,perms:D,userChat:W,room:I,toggleInfo:ec,messageFilter:F,chatRoom:R,subscription:P,searching:null==R?void 0:R.searching,settings:T,isSelfChat:O,allowMsgNoOne:eb,isReadOnly:ek,isMetaFoxBlocked:ef,isBlocked:ey,openInfo:H}),y.createElement(tL,{onClick:es,isMobile:C,openInfo:H,onDrop(e){eR(e)},render({canDrop:e,isOver:l}){var n,a;return y.createElement(y.Fragment,null,e&&l&&y.createElement(tj,null,y.createElement(s.mE,{variant:"h5",lines:1},t.formatMessage({id:"drop_files_here"}))),y.createElement(u.A,{sx:{flex:1,minHeight:0,position:"relative"}},y.createElement(r.P,{autoHide:!1,autoHeight:!0,autoHeightMax:"100%",ref:S,style:eS,onScroll:er,onScrollStop:ei},C&&(null==R?void 0:R.searching)&&!f()(F)?y.createElement(tB.A,{user:B,items:F,archived:eg,room:I,isMobile:C,settings:T,perms:D,disableReact:eC,type:(null==R?void 0:R.pinned)?"pin":"star",subscription:P,ref:Y}):en?y.createElement(tz.A,{setReactMode:U,setSelectedMsg:$,searchMessages:el,loadingMsgs:N,setLoadingMsgs:q,oldScrollOffset:et,ref:Z,chatRoom:R,rid:w,handleAction:ew,isPageFull:!0}):y.createElement(y.Fragment,null,(null==R?void 0:R.searching)||!(null==R?void 0:R.endLoadmoreMessage)?null:y.createElement(tX,null,t.formatMessage({id:"start_of_conversation"})),y.createElement(x.Ay,{rid:w,typing:eA,groupIds:null==R?void 0:R.groupIds,groups:null==R?void 0:R.groups,roomProgress:ex,newest:eE,archived:eg,room:I,subscription:P,isMobile:!1,settings:T,user:B,containerRef:S,disableReact:eC,handleAction:ew,isAllPage:!0,ref:Y}))),!J||ea||(null==R?void 0:R.searching)?null:y.createElement(tF.A,{showText:!M,reactMode:j,refMessage:Y,setShowLatestMsg:V,searchMessages:el,rid:w})),"no_react"!==j&&y.createElement(t$,null,y.createElement(tV,null,y.createElement("div",null,"reply"===j?t.formatMessage({id:"chatplus_reply_to_user"},{user_name:null==X?void 0:null===(n=X.u)||void 0===n?void 0:n.name,is_owner:(null==B?void 0:B._id)===(null==X?void 0:null===(a=X.u)||void 0===a?void 0:a._id)?1:0}):t.formatMessage({id:"editing"})),f()(null==X?void 0:X.attachments)?y.createElement(tN,{lines:1,dangerouslySetInnerHTML:{__html:ep}}):em&&!f()(ep)?y.createElement(tN,{lines:1,dangerouslySetInnerHTML:{__html:ep}}):y.createElement(tJ,null,y.createElement(s.s4,{icon:"ico-paperclip-alt"}),y.createElement("span",null,t.formatMessage({id:"file_attachment"})," "))),y.createElement(tq,{icon:"ico-close",onClick:()=>U("no_react")})),y.createElement(tR.A,{ref:K,filesUploadRef:Q,isAllPage:!0}),y.createElement(E.WH,{archived:eg,isReadOnly:ek,isMuted:eM,searching:null==R?void 0:R.searching,isBlocked:ey,reactMode:j,allowMsgNoOne:eb},y.createElement(ee,{rid:w,room:I,user:B,msgId:null==X?void 0:X.id,reactMode:j,text:"edit"===j?ep:(null==R?void 0:R.textEditor)||"",onSuccess:e_,subscription:P,previewRef:K,ref:Q,isAllPage:!0})))}})),H?y.createElement(tU,{isMobile:C},y.createElement(tS,{toggleInfo:ec,buddy:z,room:I})):null)))}})},5818(e,t,l){l.r(t),l.d(t,{default:()=>D});var n=l(88485),a=l(91557),o=l(84680),i=l(40515),r=l(3556),s=l(8051),d=l(83445),u=l(18799),c=l(87773),m=l(96540),p=l(62193),g=l.n(p),v=l(97837),h=l(65121),f=l(67725),y=l(40120),b=l(59408),E=l(61341),x=l(67912);let A="MsgItemFilterPopper",C=(0,r.Ay)("div",{name:A,slot:"uiChatMsgItemBody",shouldForwardProp:e=>"file"!==e})(({theme:e,file:t})=>({display:t?"block":"flex"})),M=(0,r.Ay)("div",{name:A,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:l})=>({display:"flex",flexDirection:"row",padding:e.spacing(1.25),borderBottom:e.mixins.border("secondary"),width:"100%",...l&&{"&.uiChatMsgSetAvatar":{display:"none"},"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse"}})),k=(0,r.Ay)("div",{name:A,slot:"uiChatMsgSetAvatar"})(({theme:e})=>({marginRight:e.spacing(1)})),w=(0,r.Ay)("span")(({theme:e})=>({...e.typography.h5})),_=(0,r.Ay)("span")(({theme:e})=>({padding:e.spacing(.5,0)})),S=(0,r.Ay)(s.A)(({theme:e})=>({display:"flex",flexDirection:"column",width:"calc(100% - 40px)"}));function R({msgId:e,user:t,tooltipPosition:l,isMobile:o,showToolbar:i=!0,isRoomLimited:r,room:d,type:u,closePopover:c}){var p,g;let A=`chatplus.chatRooms.${d.id}.messageFilter.${e}`,R=(0,n.wg)(A),{jsxBackend:I,dispatch:P}=(0,a.PCX)(),[F,z]=(0,a.Vd3)(A,{}),B=()=>{c&&c()},T=(t,l,n)=>{t===E.ci&&e?P({type:E.ci,payload:{roomId:null==d?void 0:d.id,mid:e,identity:A,type:u},meta:{onSuccess:B}}):F(t,l,n)},D=(0,n.y8)(null==d?void 0:d.id),W=(0,n.sz)(),O=(0,n.GV)(null==d?void 0:d.id),H=!((null==O?void 0:O.allowMessageFrom)!=="noone"),{_id:L,t:j,system:U,attachments:X,reactions:$,msgType:N,ts:q,u:J,starred:V}=R||{},G=(0,n.Fz)(null==J?void 0:J._id),K=t._id===(null==J?void 0:J._id),Q=(0,h.rs)(X),Y=(null==X?void 0:X.length)?null===(p=X.filter(e=>e.image_url))||void 0===p?void 0:p.length:null,Z=!!((null==d?void 0:d.t)===v.CJ.Direct&&((null==O?void 0:O.metafoxBlocked)||(null==O?void 0:O.metafoxBlocker))),ee=!!((null==d?void 0:d.t)===v.CJ.Direct&&((null==O?void 0:O.blocked)||(null==O?void 0:O.blocker))),et=!!(ee||Z),el=null==V?void 0:V.find(e=>e._id===t._id),en=(null==W?void 0:W.Message_AllowStarring)&&!H&&!et,ea=W.Message_AllowPinning&&D["pin-message"]&&!r&&!H&&!et,eo=W.Message_AllowDeleting&&(D["force-delete-message"]||D["delete-message"]||K&&D["delete-own-message"])&&!r&&!H&&!et,ei=(0,n.B)(),er=m.useMemo(()=>(0,f.Ue)(ei,{allowPinning:ea,item:R,allowStarring:en,isStarred:el,canDelete:eo,type:u}),[ei,ea,R,en,el,eo,u]);return R?m.createElement(M,null,m.createElement(k,null,m.createElement(x.A,{name:(null==G?void 0:G.name)||(null==J?void 0:J.name),username:(null==G?void 0:G.username)||(null==J?void 0:J.username),avatarETag:(null==J?void 0:J.avatarETag)||(null==G?void 0:G.avatarETag),size:32})),m.createElement(S,null,m.createElement(s.A,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"}},m.createElement(s.A,{sx:{display:"flex",flexDirection:"column"}},m.createElement(w,null,(null==J?void 0:J.name)||(null==J?void 0:J.username)),m.createElement(_,null,(0,h.rb)(null==q?void 0:q.$date))),m.createElement(b.A,{identity:A,items:er,handleAction:T,disabled:!1,disableReact:!0,state:z,showHover:!1,menuStyles:{maxWidth:"auto"},sxFieldWrapper:{justifyContent:"flex-start"}})),m.createElement("div",{"data-id":L,"data-t":j},m.createElement(C,{file:Boolean(1===Q||!Y&&(null==R?void 0:R.file)||(null==R?void 0:null===(g=R.urls)||void 0===g?void 0:g.length))},I.render({component:"chatplus.messageContent.standard",props:{message:R,showActiveSearch:!1,isOwner:!1,user:t,createdDate:null,isRoomLimited:r,msgType:N,tooltipPosition:o?"top":l}}),m.createElement(b.A,{identity:A,handleAction:F,disabled:U||!i,disableReact:!0,state:z})),m.createElement(y.A,{identity:A,disabled:!$||U,reactions:$})))):null}let I="MessageFilterPopper",P=(0,r.Ay)("div",{name:I,slot:"root"})(({theme:e})=>({width:"100%","& :last-child":{borderBottom:"none"}})),F=(0,r.Ay)("div",{name:I,slot:"noItemFound"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(1,2),color:e.palette.grey["600"],margin:e.spacing(1,0),textAlign:"center"})),z=({archived:e,settings:t,user:l,disableReact:n,room:o,items:i,phraseNoContent:r="no_results_found",type:s,closePopover:d})=>{let{i18n:u}=(0,a.PCX)();return g()(i)?m.createElement(F,null,u.formatMessage({id:r})," "):m.createElement(P,null,i&&Object.values(i).map(a=>m.createElement(R,{key:a._id,msgId:a._id,archived:e,settings:t,perms:{},isMobile:!1,user:l,disableReact:n,room:o,type:s,closePopover:d})))},B=(0,r.Ay)("div")(({theme:e})=>({display:"flex",alignItems:"flex-end"})),T=(0,r.Ay)(s.A,{shouldForwardProp:e=>"noContent"!==e})(({theme:e,noContent:t})=>{var l;return{padding:e.spacing(1.5,2),display:"flex",alignItems:"center",justifyContent:"space-between",...!t&&{borderBottom:"1px solid",borderColor:null===(l=e.palette.border)||void 0===l?void 0:l.secondary}}});function D({anchorRef:e,open:t,placement:l,type:r,closePopover:s}){let{i18n:p,usePageParams:g,dispatch:v}=(0,a.PCX)(),h=g(),{rid:f}=h,y=(0,n.Im)(f),b=(0,n.hB)(),E=(0,n.GV)(f),x=(0,n.iW)(f),A=(0,n.sz)(),C=!!(null==E?void 0:E.archived);return m.useEffect(()=>{"pin"===r&&v({type:"chatplus/room/pinnedMessages",payload:{roomId:null==x?void 0:x.id,filter:"pin"}}),"star"===r&&v({type:"chatplus/room/pinnedMessages",payload:{roomId:null==x?void 0:x.id,filter:"star"}})},[r]),m.useEffect(()=>{v({type:"chatplus/room/deleteMessagesFilter",payload:{identity:null==x?void 0:x.id}})},[]),m.createElement(i.qB,{excludeRef:e,onClickAway:s},m.createElement(d.A,{id:"chatplus","data-testid":"chatplus",anchorEl:null==e?void 0:e.current,open:t,placement:l||"bottom-end"},m.createElement(u.A,{sx:{width:320,overflow:"hidden",userSelect:"none"}},m.createElement(T,null,m.createElement(B,null,m.createElement(c.A,{variant:"h4"},p.formatMessage({id:"pin"===r?"pinned_messages":"starred_messages"})))),m.createElement(o.P,{autoHide:!0,autoHeight:!0,autoHeightMax:390,autoHeightMin:40},m.createElement(z,{user:b,items:y,archived:C,room:x,isMobile:!1,settings:A,disableReact:!0,phraseNoContent:"pin"===r?"no_pinned_messages":"no_starred_messages",type:r,closePopover:s})))))}}}]);