(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chat-components-ChatRoomPanel-Block"],{24713(e,t,a){var n=a(2523),i=a(15389),l=a(61489),r=Math.max;e.exports=function(e,t,a){var o=null==e?0:e.length;if(!o)return -1;var s=null==a?0:l(a);return s<0&&(s=r(o+s,0)),n(e,i(t,3),s)}},92322(e,t,a){"use strict";a.d(t,{A:()=>w});var n=a(8022),i=a(84680),l=a(40515),r=a(3556),o=a(96540),s=a(8051);let d="PreviewUploadFile",c=(0,r.Ay)("img",{name:d,slot:"previewImage"})(({theme:e})=>({borderRadius:e.spacing(1),maxWidth:"52px",width:"52px",height:"52px",marginRight:e.spacing(2),objectFit:"cover"})),m=(0,r.Ay)("div",{name:d,slot:"PreviewFile",shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({borderRadius:e.spacing(1),maxWidth:"150px",width:"150px",height:"52px",marginRight:e.spacing(2),fontSize:e.spacing(1.5),display:"flex",alignItems:"center",background:"light"===e.palette.mode?e.palette.background.default:e.palette.grey["500"],...t&&{maxWidth:"180px",width:"180px",overflowX:"hidden"}})),u=(0,r.Ay)("div",{name:d,slot:"IconFile"})(({theme:e})=>({borderRadius:"100%",maxWidth:"28px",width:"28px",height:"28px",margin:e.spacing(0,1),padding:e.spacing(0,1),color:e.palette.default.contrastText,background:"light"===e.palette.mode?e.palette.grey["500"]:e.palette.grey["700"],display:"inline-flex",justifyContent:"center",alignItems:"center"})),p=(0,r.Ay)("div",{name:d,slot:"closeButton"})(({theme:e})=>({position:"absolute",top:"-8px",right:"8px",cursor:"pointer",width:e.spacing(2.5),height:e.spacing(2.5),backgroundColor:e.palette.grey["500"],borderRadius:"50%",fontSize:e.mixins.pxToRem(8),justifyContent:"center",alignItems:"center",display:"inline-flex",opacity:.8,color:(e.palette.mode,e.palette.text.primary),"&:hover":{backgroundColor:e.palette.background.default,color:e.palette.text.primary,border:e.mixins.border("secondary")}})),g=(0,r.Ay)(l.mE)(({theme:e})=>({paddingRight:e.spacing(1),wordBreak:"break-word",p:{fontSize:e.mixins.pxToRem(13)}})),h=function({onRemove:e,file:t,isAllPage:a}){let n=t.type,i=["image/gif","image/jpeg","image/png"].includes(n),r=i?URL.createObjectURL(t):"";return o.createElement(s.A,{display:"inline-flex",position:"relative"},i?o.createElement(c,{src:r,alt:"Preview"}):o.createElement(m,{isAllPage:a},o.createElement(u,null,o.createElement(l.s4,{icon:"ico-paperclip-alt"})),o.createElement(g,{lines:2},t.name)),o.createElement(s.A,{position:"absolute",top:1,right:1},o.createElement(p,{"data-testid":"buttonRemove",onClick:e,"aria-label":"Close"},o.createElement(l.s4,{icon:"ico-close"}))))};var f=a(19740),v=a(62193),y=a.n(v);let x=(0,r.Ay)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({background:e.palette.background.paper,padding:e.spacing(2,1,0,1),display:"flex",overflow:"hidden",borderTop:e.mixins.border("secondary"),userSelect:"none",height:"85px",minHeight:"85px",...t&&{height:"90px",minHeight:"90px"}})),b=(0,r.Ay)("div")(({theme:e})=>({display:"flex",paddingTop:e.spacing(1),marginBottom:e.spacing(.5),paddingBottom:e.spacing(.5)})),A=(0,r.Ay)("div",{slot:"ButtonAdd"})(({theme:e})=>({marginRight:e.spacing(1),cursor:"pointer",span:{background:"light"===e.palette.mode?e.palette.background.default:e.palette.grey["500"],"&:hover":{background:e.palette.action.hover},borderRadius:e.spacing(1),maxWidth:"52px",width:"52px",height:"52px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:e.spacing(2.5)}})),w=o.forwardRef(function({filesUploadRef:e,isAllPage:t,rid:a},r){let s=(0,f.nb)(a),d=o.useRef(),c=o.useRef(),[m,u,p]=(0,n.A)({inputRef:c}),g=t=>{let a=[...m];if(t>-1&&(a.splice(t,1),u([...a]),e)){var n;null===(n=e.current)||void 0===n||n.removeFile(t)}};o.useImperativeHandle(r,()=>({attachFiles(e){(null==e?void 0:e.length)&&p(e)},clear(){u([])}}));let v=()=>{c.current.click()},w=()=>{v()},E=()=>{var e;if(!(null===(e=c.current)||void 0===e?void 0:e.files.length))return;let t=p(c.current.files);if(!t)return};return(o.useEffect(()=>{if(e){var t;null===(t=e.current)||void 0===t||t.attachFiles(m)}},[m.length]),y()(null==s?void 0:s.roomProgress)&&m&&(null==m?void 0:m.length))?o.createElement(x,{isAllPage:t},o.createElement(i.P,{autoHide:!1,autoHeight:!1,ref:d,style:{height:"auto"}},o.createElement(b,null,o.createElement(A,{onClick:w},o.createElement("span",null,o.createElement(l.s4,{icon:"ico-text-file-plus"}))),Object.values(m).map((e,a)=>o.createElement(h,{key:a,file:e,onRemove:()=>g(a),isAllPage:t})))),o.createElement("input",{"data-testid":"inputAttachPhoto",onChange:E,multiple:!0,ref:c,style:{display:"none"},type:"file",accept:"image/*"})):null})},90005(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>eg});var n=a(91557),i=a(74046),l=a(84680),r=a(40515),o=a(3556),s=a(30719),d=a(8051),c=a(89481),m=a(96540),u=a(19740),p=a(67725),g=a(60780),h=a(97763),f=a(95223),v=a(38221),y=a.n(v);let x=(0,o.Ay)("div")(()=>({width:"100%"})),b=(0,o.Ay)(f.Ay,{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({maxWidth:"600px",height:e.spacing(5),margin:e.spacing(2),padding:e.spacing(1.5,2),borderRadius:e.spacing(2.5),border:e.mixins.border("secondary"),backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.grey["100"],...t&&{margin:0,width:"100%",maxWidth:"100%",padding:e.spacing(0,1),"& input":{paddingTop:e.spacing(.25)}},minWidth:250,[e.breakpoints.down("sm")]:{minWidth:"100%"}})),A=(0,o.Ay)(r.s4,{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({color:e.palette.text.primary,transition:"all .2s ease",cursor:"pointer",...t&&{padding:e.spacing(1)}})),w=((0,o.Ay)("div",{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:"0",color:e.palette.grey["600"],marginRight:e.spacing(1.5),...t&&{marginRight:e.spacing(.75)}})),(0,o.Ay)("span")(({theme:e})=>({marginRight:e.spacing(0,.25),color:e.palette.text.primary})),(0,o.Ay)(b,{name:"SearchInputText"})(({theme:e})=>({"& input::placeholder":{color:e.palette.text.hint}}))),E=function({toggleSearch:e,room:t,searching:a}){let{i18n:i,dispatch:l,useIsMobile:r}=(0,n.PCX)(),o=r(!0),s=m.useRef();m.useEffect(()=>{s.current="",u()},[a]);let d=e=>{s.current=e.target.value,u()},c=m.useCallback(()=>{l({type:"chat/room/searchMessages",payload:{roomId:null==t?void 0:t.id,text:s.current},meta:{}})},[l,t]),u=m.useMemo(()=>y()(c,200),[c]);return o?m.createElement(x,null,m.createElement(w,{isMobile:o,startAdornment:m.createElement(A,{icon:"ico-search-o",isMobile:o}),endAdornment:m.createElement(A,{icon:"ico-close",onClick:e,isMobile:o}),placeholder:i.formatMessage({id:"search_messages_dots"}),autoComplete:"off",inputProps:{"aria-label":"search","data-testid":"searchBox",autoComplete:"off",autoCapitalize:"off"},inputRef:s,onChange:d})):m.createElement(x,null,m.createElement(w,{startAdornment:m.createElement(A,{icon:"ico-search-o"}),endAdornment:m.createElement(A,{icon:"ico-close",onClick:e}),placeholder:i.formatMessage({id:"search_messages_dots"}),autoComplete:"off",inputProps:{"aria-label":"search","data-testid":"searchBox",autoComplete:"off",autoCapitalize:"off"},inputRef:s,onChange:d}))};var C=a(84058),k=a.n(C);let _=(0,o.Ay)("div",{shouldForwardProp:e=>"isMobile"!==e&&"openSearch"!==e})(({theme:e,isMobile:t,openSearch:a})=>({backgroundColor:e.palette.background.paper,alignItems:"center",boxSizing:"border-box",display:"flex",height:e.spacing(9),padding:e.spacing(1,1,1,2),justifyContent:"space-between",borderBottom:e.mixins.border("secondary"),...t&&!a&&{padding:e.spacing(1,.5,1,1)}})),M=(0,o.Ay)("div")(({theme:e})=>({})),R=(0,o.Ay)(n.N_E)(({theme:e})=>({padding:e.spacing(1.75,0),display:"flex",alignItems:"center",cursor:"pointer","&:hover":{textDecoration:"none"}})),I=(0,o.Ay)(r.mE)(({theme:e})=>({margin:e.spacing(0,1.5,0,1.5)})),P=(0,o.Ay)(g.A,{shouldForwardProp:e=>"isInfo"!==e})(({theme:e,isInfo:t})=>({color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.primary,fontSize:e.spacing(2.25),minWidth:e.spacing(6.25),...t&&{color:e.palette.primary.main},padding:0,margin:0})),S=(0,o.Ay)("div")(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center"})),O=(0,o.Ay)("div")(({theme:e})=>({flex:1,display:"flex",alignItems:"center",justifyContent:"space-between"})),T=(0,o.Ay)(g.A,{shouldForwardProp:e=>"isInfo"!==e})(({theme:e,isInfo:t})=>({color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.primary,fontSize:e.spacing(2.25),minWidth:e.spacing(4),...t&&{color:e.palette.primary.main}})),F=function({room:e,searching:t}){var a;let{dispatch:l,useActionControl:o,useIsMobile:s,navigate:d,useGetItem:c,i18n:g}=(0,n.PCX)(),f=s(!0),[v,y]=m.useState(!1),x=(null==e?void 0:e.other_members[0])||void 0,b=c(x),[A]=o(null==e?void 0:e.id,{}),w=(t,a,n)=>{A(t,a,n),"chat/room/toggleSearching"===t&&(l({type:"chat/room/searchMessages",payload:{roomId:null==e?void 0:e.id,text:""}}),y(e=>!e))},C=(0,u.EH)(),F=m.useMemo(()=>(0,p.Ue)(C,{isMobile:f,item:e}),[C,f,e]);m.useEffect(()=>{y(!1)},[e]);let W=m.useCallback(()=>{l({type:"chat/room/toggleSearching",payload:{identity:null==e?void 0:e.id}}),l({type:"chat/room/searchMessages",payload:{roomId:null==e?void 0:e.id,text:""}}),y(e=>!e),l({type:"chat/room/clearMsgSearch",payload:{rid:null==e?void 0:e.id}})},[l,e]),H=()=>{d({pathname:"/messages"})};return f?m.createElement(_,{isMobile:f,openSearch:v},v?null:m.createElement(P,{onClick:H},m.createElement(r.s4,{icon:"ico-arrow-left"})),v?m.createElement(E,{toggleSearch:W,room:e,searching:t}):m.createElement(O,null,m.createElement(R,{to:null==b?void 0:b.link},m.createElement(r.H8,{user:b,size:48,noLink:!0}),m.createElement(I,{lines:2,variant:"h4"},null==e?void 0:e.name)),m.createElement(M,null,m.createElement(S,null,m.createElement(i.qC,{items:F,handleAction:w,displayLimit:2}))))):m.createElement(_,{"data-testid":k()("_chat Header room")},m.createElement(R,{"data-testid":k()("_chat Header title"),to:null==b?void 0:b.link},e?m.createElement(r.H8,{user:b,size:48,noLink:!0}):null,m.createElement(I,{lines:2,variant:"h4"},null==e?void 0:e.name)),m.createElement(M,{"data-testid":k()("_chat Header room toolbar")},v?m.createElement(E,{toggleSearch:W,room:e,searching:t}):m.createElement(S,{"data-testid":k()("_chat room wrapper action")},m.createElement(h.A,{title:null!==(a=g.formatMessage({id:"search"}))&&void 0!==a?a:"",placement:"top"},m.createElement(T,{"data-testid":k()("_chat room action search"),onClick:W},m.createElement(r.s4,{icon:"ico-search-o"}))),m.createElement(i.qC,{items:F,handleAction:A,variant:"pageMessage"}))))};var W=a(56449),H=a.n(W);let D="ChatRoomPanel",B=(0,o.Ay)("div")(({theme:e})=>({display:"flex",flexDirection:"column",borderLeft:e.mixins.border("secondary"),backgroundColor:e.palette.background.paper,width:"100%",height:"100%"})),z=(0,o.Ay)("div",{name:D,slot:"mainContent"})(({theme:e})=>({display:"flex",flexDirection:"row",alignItems:"center",borderBottom:e.mixins.border("secondary")})),j=(0,o.Ay)("div")(({theme:e})=>({display:"flex",flexDirection:"row",backgroundColor:e.palette.background.paper,flex:1})),L=(0,o.Ay)("div")(({theme:e})=>({flex:1,display:"flex",flexDirection:"column",width:"100%",minWidth:0})),X=(0,o.Ay)("div",{name:D,slot:"Title"})(({theme:e})=>({fontSize:e.spacing(1.875),padding:e.spacing(3.5,2),fontWeight:e.typography.fontWeightMedium,alignSelf:"flex-start",color:e.palette.text.secondary,minWidth:"130px"})),$=(0,o.Ay)("div",{name:D,slot:"SearchWrapper"})(({theme:e})=>({flex:1,minWidth:0,margin:e.spacing(1),position:"relative",zIndex:e.zIndex.speedDial})),N=(0,o.Ay)("div",{name:D,slot:"WrapperSuggest",shouldForwardProp:e=>"suggestList"!==e})(({theme:e,suggestList:t})=>({...!0===t&&{position:"absolute",width:"100%",border:e.mixins.border("secondary"),borderTop:"none",backgroundColor:e.palette.background.paper,borderEndEndRadius:e.spacing(1),borderEndStartRadius:e.spacing(1)}})),Q=(0,o.Ay)("div")(({theme:e})=>({padding:e.spacing(1.75,2),display:"flex",alignItems:"center",cursor:"pointer",borderBottom:e.mixins.border("secondary"),"&:last-child":{borderBottom:"none"}})),q=(0,o.Ay)("span")(({theme:e})=>({...e.typography.h5,marginLeft:e.spacing(1)})),U=function(){let{i18n:e,dispatch:t,apiClient:a}=(0,n.PCX)(),o=m.useRef(""),[s,d]=m.useState(""),[c,u]=m.useState(!1),[p,g]=m.useState([]),h=m.useMemo(()=>{let e=()=>{a.get("/friend",{params:{limit:10,q:o.current||void 0}}).then(e=>e.data.data).then(e=>H()(e)&&g(e)).catch(e=>{})};return y()(e,200)},[a,o.current]);m.useEffect(()=>{h()},[]);let f=m.useCallback(e=>{t({type:"chat/newChatRoom",payload:{user:e,isPage:!0}})},[]),v=m.useCallback(e=>{},[]),x=m.useCallback(e=>{var t;let a=null===(t=e.currentTarget)||void 0===t?void 0:t.value;o.current=a,d(a),h(),u(!0)},[]),b=()=>{u(!1)};return m.createElement(B,null,m.createElement(z,null,m.createElement(X,null,e.formatMessage({id:"new_message"})),m.createElement(r.qB,{onClickAway:b},m.createElement($,null,m.createElement(i.qJ,{sx:{p:0},valueSearch:s,onChangeSearch:x,onKeyUp:v,placeholder:e.formatMessage({id:"type_name_start_new_conversation"}),size:30,isShowButtonSubmit:!1}),c?m.createElement(N,{suggestList:Boolean(p&&p.length)},m.createElement("div",null,m.createElement(l.P,{autoHide:!0,autoHeight:!0},p.map((e,t)=>m.createElement(m.Fragment,{key:t},m.createElement(Q,{onClick:()=>f(e)},m.createElement(r.H8,{user:e,size:32,noLink:!0}),m.createElement(q,null,e.full_name))))))):null))),m.createElement(j,null,m.createElement(L,null)))};var G=a(62193),K=a.n(G),V=a(94317),Z=a(11247),J=a(96610),Y=a(92322),ee=a(83659),et=a(69709);let ea="ChatRoomPanel",en=(0,o.Ay)("div",{name:ea,slot:"root",shouldForwardProp:e=>"loading"!==e})(({theme:e,loading:t})=>({borderLeft:e.mixins.border("secondary"),backgroundColor:e.palette.background.paper,display:"flex",flexDirection:"row",width:"100%",height:"100%","& .MuiAvatar-root":{fontSize:e.mixins.pxToRem(14)}})),ei=(0,o.Ay)("div",{name:ea,slot:"mainContent"})(({theme:e})=>({flex:1,display:"flex",width:"100%",height:"100%"})),el=(0,o.Ay)("div")(({theme:e})=>({display:"flex",flexDirection:"row",width:"100%",flex:1,minHeight:0})),er=(0,o.Ay)("div",{name:ea,slot:"Main"})(({theme:e})=>({flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"})),eo=(0,o.Ay)("div")(({theme:e})=>({textAlign:"center",padding:e.spacing(2),fontStyle:"italic",color:"dark"===e.palette.mode?e.palette.text.primary:e.palette.grey["700"],fontSize:e.spacing(1.75)})),es=(0,o.Ay)("div",{name:ea,slot:"ReplyEditWrapper"})(({theme:e})=>({padding:e.spacing(.625,1.25),height:"50px",width:"100%",borderTop:e.mixins.border("secondary"),display:"flex",justifyContent:"space-between",backgroundColor:"dark"===e.palette.mode?e.palette.grey["600"]:e.palette.grey["100"]})),ed=(0,o.Ay)(r.mE,{name:ea,slot:"SelectedMsg"})(({theme:e})=>({color:e.palette.text.primary})),ec=(0,o.Ay)(r.s4,{name:ea,slot:"LineIconClose"})(({theme:e})=>({margin:e.spacing(1),cursor:"pointer",alignSelf:"center"})),em=(0,o.Ay)("div",{name:ea,slot:"SelectedMsgAttachment"})(({theme:e})=>({fontSize:e.spacing(1.5),margin:e.spacing(.5,0),"& .ico":{marginRight:e.spacing(.5)}})),eu=(0,o.Ay)("div",{name:ea,slot:"ContentWrapper"})(({theme:e})=>({overflow:"hidden"})),ep=(0,o.Ay)("div",{name:ea,slot:"LoadingStyled"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",marginTop:e.spacing(3)})),eg=(0,n.WvA)({name:"ChatRoomPanel",extendBlock:function(e){var t;let{i18n:a,jsxBackend:o,usePageParams:p,useActionControl:g,dispatch:h,useIsMobile:f,getSetting:v,getAcl:y}=(0,n.PCX)(),x=y("chat.chat_message"),b=p(),{rid:A}=b,w=f(),E=m.useRef(),C=m.useRef(),_=m.useRef(),M=m.useRef(),R=m.useRef(),I=(0,u.nb)(A),P=(0,u.iW)(A),[S]=g(A,{}),[O,T]=(0,m.useState)("no_react"),[W,H]=(0,m.useState)(),[D,B]=(0,m.useState)(void 0),[z,j]=(0,m.useState)(!1),L=(0,n.dx2)(null==W?void 0:W.user),{user:X}=(0,n.wVH)(),[$,N]=m.useState(!1),Q=(0,s.A)(),q=null==I?void 0:I.searching,G=o.get("ChatSimpleComposer"),ea=m.useRef(),eg=e=>{if(K()(eh)&&e.target.scrollTop<100&&!$){let{endLoadmoreMessage:t,lastMsgId:a}=I||{};if(!a||t)return;ea.current=e.target.scrollHeight-e.target.clientHeight,N(!0),h({type:"chat/room/loadHistory",payload:{rid:A,lastMsgId:a},meta:{onSuccess(){N(!1)}}});return}(null==R?void 0:R.current)&&R.current.handleScroll(e)};m.useEffect(()=>{if(!(null==I?void 0:I.lastMsgId)||!ea.current)return;let e=E.current.scrollHeight-E.current.clientHeight;E.current.scrollTop=0+(e-ea.current),ea.current=0},[null==I?void 0:I.lastMsgId]);let eh=m.useMemo(()=>{var e,t,a,n,i,l;return K()(null==I?void 0:I.msgSearch)||(null==I?void 0:null===(e=I.msgSearch)||void 0===e?void 0:e.mode)===et.Dn?null:(null==I?void 0:null===(t=I.msgSearch)||void 0===t?void 0:t.mQuoteId)?null==I?void 0:null===(l=I.searchMessages)||void 0===l?void 0:l[null==I?void 0:null===(i=I.msgSearch)||void 0===i?void 0:i.mQuoteId]:null==I?void 0:null===(n=I.searchMessages)||void 0===n?void 0:n[null==I?void 0:null===(a=I.msgSearch)||void 0===a?void 0:a.id]},[null==I?void 0:I.msgSearch,null==I?void 0:I.searchMessages]),ef=m.useMemo(()=>(null==I?void 0:I.searching)||!K()(eh),[eh,null==I?void 0:I.searching]),ev=()=>{T("no_react"),H(void 0)},ey=m.useCallback(()=>{A&&h({type:"chat/room/markAsRead",payload:{identity:A}})},[A,h]);m.useEffect(()=>(A&&(j(!0),h({type:"chat/room/markAsRead",payload:{identity:A}}),h({type:"chat/room/active",payload:A,meta:{onSuccess(e){B(e),j(!1)},onFailure(){j(!1)}}})),()=>{h({type:"chat/room/inactive",payload:{rid:A}}),ev(),B(void 0)}),[A]);let ex=!v("preaction"),eb=null==I?void 0:I.messageFilter,eA={backgroundColor:Q.palette.background.paper},ew=m.useMemo(()=>(null==W?void 0:W.message)?(0,J.Nj)(null==W?void 0:W.message):"",[W]);if(!A&&!w&&!D)return m.createElement(U,null);let eE=(e,t)=>{if(!e)return;let a=e.split(/.,| /);a.forEach(e=>{switch(e){case"chat/replyMessage":T("reply"),H(t);break;case"chat/editMessage":T("edit"),H(t)}})},eC=()=>{if(ev(),ef){h({type:"chat/room/modeSearch",payload:{rid:A,mode:et.Dn},meta:{onSuccess(){setTimeout(()=>{(null==M?void 0:M.current)&&M.current.scrollToBottom()},300)}}});return}(null==M?void 0:M.current)&&M.current.scrollToBottom()};return m.createElement(en,{loading:z||!D&&A},m.createElement(ei,null,m.createElement(el,null,m.createElement(er,null,m.createElement(F,{room:D,searching:q}),m.createElement(d.A,{sx:{flex:1,minHeight:0}},m.createElement(l.P,{autoHeight:!0,autoHeightMax:"100%",ref:E,style:eA,onScroll:eg},(z||(null==I?void 0:null===(t=I.msgSearch)||void 0===t?void 0:t.loading))&&m.createElement(ep,{"data-testid":"loadingIndicator"},m.createElement(c.A,{size:24})),(null==I?void 0:I.searching)?m.createElement(d.A,{sx:{mt:2}},m.createElement(Z.A,{items:eb,room:D,disableReact:!0,handleAction:S})):ef?m.createElement(ee.A,{setReactMode:T,setSelectedMsg:H,searchMessages:eh,loadingMsgs:$,setLoadingMsgs:N,oldScrollOffset:ea,ref:R,chatRoom:I,rid:A,handleAction:eE,isPageFull:!0}):m.createElement(m.Fragment,null,(null==I?void 0:I.searching)||!(null==I?void 0:I.endLoadmoreMessage)?null:m.createElement(eo,{"data-testid":k()("_chat room start of conversation")},a.formatMessage({id:"start_of_conversation"})),m.createElement(V.A,{rid:A,groups:null==I?void 0:I.groups,groupIds:null==I?void 0:I.groupIds,newest:null==I?void 0:I.newest,preFetchingMsg:null==I?void 0:I.preFetchingMsg,room:D,containerRef:E,disableReact:ex,handleAction:eE,ref:M,loading:z,roomProgress:null==I?void 0:I.roomProgress,isAllPage:!0,showToolbar:!(null==P?void 0:P.is_block)})))),"no_react"!==O&&m.createElement(es,null,m.createElement(eu,null,m.createElement("div",null,"reply"===O?m.createElement(r.mE,{lines:1,variant:"body2"},a.formatMessage({id:"chat_reply_to_user_at_timestamp"},{user_name:null==L?void 0:L.full_name,is_owner:(null==X?void 0:X.id)===(null==L?void 0:L.id)?1:0})):a.formatMessage({id:"editing"})),K()(null==W?void 0:W.attachments)?m.createElement(ed,{lines:1,dangerouslySetInnerHTML:{__html:ew}}):m.createElement(em,null,m.createElement(r.s4,{icon:"ico-paperclip-alt"}),m.createElement("span",null,a.formatMessage({id:"file_attachment"})))),m.createElement(ec,{icon:"ico-close",onClick:()=>T("no_react")})),m.createElement(Y.A,{ref:C,filesUploadRef:_,isAllPage:!0,rid:A}),m.createElement(i.WH,{searching:q,isBlocked:null==P?void 0:P.is_block,allowCompose:null==x?void 0:x.create},m.createElement(G,{rid:A,msgId:null==W?void 0:W.id,reactMode:O,text:"edit"===O?ew:(null==I?void 0:I.textEditor)||"",onSuccess:eC,previewRef:C,ref:_,isAllPage:!0,onMarkAsRead:ey}))))))}})},83659(e,t,a){"use strict";a.d(t,{A:()=>h});var n=a(91557),i=a(3556),l=a(8051),r=a(62193),o=a.n(r),s=a(96540),d=a(94317),c=a(69709),m=a(19740);let u="ChatRoomPanel",p=(0,i.Ay)("div",{name:u})(({theme:e})=>({textAlign:"center",padding:e.spacing(2),color:"dark"===e.palette.mode?e.palette.text.primary:e.palette.grey["700"],fontSize:e.spacing(1.75)})),g=(0,i.Ay)("div",{name:u,slot:"noItemFound"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(1,2),color:e.palette.grey["600"],marginTop:e.spacing(2)})),h=s.forwardRef(function(e,t){let{searchMessages:a,setLoadingMsgs:i,loadingMsgs:r,oldScrollOffset:u,chatRoom:h,handleAction:f,rid:v}=e,{i18n:y,dispatch:x}=(0,n.PCX)(),b=s.useRef(),A=(0,m.iW)(v),{msgSearch:w}=h||{},E=s.useRef(),C=(0,s.useCallback)(({type:e="up"})=>{i(!0),x({type:"chat/room/search/loadHistory",payload:{roomId:v,mid:"up"===e?null==a?void 0:a.lastMsgId:null==a?void 0:a.msgNewest,operate:e,limit:c.xm},meta:{onSuccess(){i(!1)}}})},[v,null==a?void 0:a.lastMsgId,null==a?void 0:a.msgNewest]),k=e=>{if(o()(a)||(null==w?void 0:w.loading))return;let{endLoadmoreMessage:t,endTopLoadmoreMessage:n=!1,oldest:i,newest:l}=a||{};if(e.target.scrollTop<100&&!r){if(!i||n)return;u.current=e.target.scrollHeight-e.target.clientHeight,C({type:"up"});return}if(e.target.scrollHeight-e.target.scrollTop-50<=e.target.clientHeight&&!r){if(!l||t)return;u.current=e.target.scrollHeight-e.target.clientHeight,C({type:"down"})}};if(s.useImperativeHandle(t,()=>({handleScroll(e){k(e)}})),null==h?void 0:h.searching)return o()(a)?s.createElement(g,null,y.formatMessage({id:"no_results_found"})):s.createElement(l.A,{sx:{mt:2}},r?s.createElement(p,null,y.formatMessage({id:"loading_dots"})):null,s.createElement(d.A,{rid:v,groupIds:null==a?void 0:a.groupIds,groups:null==a?void 0:a.groups,newest:0,room:A,containerRef:b,disableReact:!0,showToolbar:!1,handleAction:f,ref:E,chatRoom:h}),r?s.createElement(p,null,y.formatMessage({id:"loading_dots"})):null);if(o()(a))return null;let _=(null==w?void 0:w.mode)!=="quote",M=(null==w?void 0:w.mode)==="quote";return s.createElement(s.Fragment,null,r?s.createElement(p,null,y.formatMessage({id:"loading_dots"})):null,s.createElement(d.A,{rid:v,groupIds:null==a?void 0:a.groupIds,groups:null==a?void 0:a.groups,newest:0,room:A,containerRef:b,disableReact:_,showToolbar:M,handleAction:f,ref:E,chatRoom:h}),r?s.createElement(p,null,y.formatMessage({id:"loading_dots"})):null)})},74046(e,t,a){"use strict";a.d(t,{qJ:()=>g,Zk:()=>S,wq:()=>f,WH:()=>w,aO:()=>_,xw:()=>U,qC:()=>Z,$6:()=>N});var n,i,l=a(40515),r=a(3556),o=a(8051),s=a(60780),d=a(96540);let c=(0,r.Ay)("div",{name:"ChatDockFilter"})(({theme:e})=>({position:"relative"})),m=(0,r.Ay)(o.A,{name:"ChatDockFilter"})(({theme:e})=>({padding:e.spacing(1,1,1,2),display:"flex",flexDirection:"row",alignItems:"center"})),u=(0,r.Ay)(l.Gd,{name:"SearchWrapper"})(({theme:e})=>({"& input::placeholder, .ico":{color:e.palette.text.hint}})),p=(0,r.Ay)(s.A,{name:"ChatDockFilter"})(({theme:e})=>({marginLeft:e.spacing(.5)}));function g({placeholder:e,size:t,hide:a,label:n,disabled:i,valueSearch:l,onChangeSearch:r,onKeyUp:o,onSubmit:s,variant:g="direct",isShowButtonSubmit:h=!0,sx:f}){return a?null:d.createElement(c,null,d.createElement(m,{sx:f},d.createElement(u,{placeholder:e,onKeyUp:o,value:l,onChange:r}),h&&s?d.createElement(p,{disabled:i,size:"medium",color:"primary",variant:"text",onClick:s},n):null))}let h=(0,r.Ay)("div",{name:"ChatDockContent",slot:"root",shouldForwardProp:e=>"searching"!==e&&"collapsed"!==e})(({theme:e,searching:t,collapsed:a})=>({flex:1,maxHeight:"100%",position:"relative",paddingBottom:e.spacing(.75),...t&&{borderTop:"none"},...a&&{display:"none"},"&::-webkit-scrollbar":{height:"5px",width:"5px",background:"gray",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}})),f=d.forwardRef(function({children:e,searching:t,collapsed:a},n){return d.createElement(h,{ref:n,searching:t,collapsed:a},e)});var v=a(91557);let y="ChatDockFooter",x=(0,r.Ay)("div",{name:y,slot:"root",shouldForwardProp:e=>"isAllPageMessages"!==e})(({theme:e,isAllPageMessages:t})=>({position:"relative",display:"flex",minHeight:e.spacing(5),zIndex:2,backgroundColor:e.palette.background.paper,borderTop:e.mixins.border("secondary"),...t&&{minHeight:e.spacing(6)}})),b=(0,r.Ay)("div",{name:y,slot:"uiChatRoomFooter",shouldForwardProp:e=>"disable"!==e&&"isAllPageMessages"!==e})(({theme:e,disable:t,isAllPageMessages:a})=>({position:"relative",borderTop:e.mixins.border("secondary"),display:"flex",alignItems:"flex-end",minHeight:e.spacing(5),zIndex:2,flexFlow:"wrap",justifyContent:"center",...t&&{userSelect:"none",backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.background.paper},...a&&{minHeight:e.spacing(6)}})),A=(0,r.Ay)("div",{name:y,slot:"uiChatComposerContainer"})(({theme:e})=>({textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",padding:"4px 8px",color:e.palette.grey["500"]}));function w({children:e,searching:t,isBlocked:a,allowCompose:n}){let{i18n:i,usePageParams:l}=(0,v.PCX)(),r=l(),o=(null==r?void 0:r.isAllPageMessages)||!1;return t?null:a||!n?d.createElement(b,{disable:!0,isAllPageMessages:o},d.createElement(A,null,i.formatMessage({id:"you_can_not_send_message_in_this_conversation"}))):d.createElement(x,{isAllPageMessages:o},e)}var E=a(84058),C=a.n(E);let k=(0,r.Ay)("div",{shouldForwardProp:e=>"searching"!==e&&"addNewMembers"!==e})(({theme:e,searching:t,addNewMembers:a})=>({display:"flex",alignItems:"center",minHeight:e.spacing(7),padding:e.spacing(1.5,1.25,1.5,2),borderBottom:e.mixins.border("secondary"),...(t||a)&&{borderBottom:"none"}}));function _({children:e,onClick:t,searching:a,addNewMembers:n}){let i=d.useCallback(e=>{e.preventDefault(),t&&t()},[t]);return d.createElement(k,{"data-testid":C()("_chat Dock Header"),onClick:i,searching:a,addNewMembers:n},e)}let M="ChatDockPanel",R=(0,r.Ay)("div",{name:M,slot:"Root"})(({theme:e})=>({display:"flex",alignItems:"flex-end",marginLeft:e.spacing(2),width:"328px",zIndex:999})),I=(0,r.Ay)("div",{name:M,slot:"PanelStyled"})(({theme:e})=>({display:"flex",flexDirection:"column",zIndex:10,backgroundColor:e.mixins.backgroundColor("paper"),borderTopLeftRadius:e.shape.borderRadius/2,borderTopRightRadius:e.shape.borderRadius/2,boxShadow:"0 0 4px 0 rgba(0,0,0,0.2)",wordBreak:"break-word",wordWrap:"break-word",borderStartStartRadius:e.shape.borderRadius,borderStartEndRadius:e.shape.borderRadius,height:"455px",maxHeight:"calc(100vh - 60px)"})),P=(0,r.Ay)("div",{name:M,slot:"StageStyled"})(({theme:e})=>({width:"100%"})),S=d.forwardRef(function({children:e},t){return d.createElement(R,{ref:t},d.createElement(P,null,d.createElement(I,null,e)))});var O=a(95223),T=a(38221),F=a.n(T);let W="ChatSearchFilter",H=(0,r.Ay)("label",{name:W,slot:"OptionLabel",shouldForwardProp:e=>"optionChecked"!==e})(({theme:e,optionChecked:t})=>({width:"32px",height:"32px",display:"inline-flex",alignItems:"center",justifyContent:"center",margin:"0",color:"#a2a2a2",...t&&{color:e.palette.primary.main}})),D=(0,r.Ay)("input",{name:W,slot:"OptionInput"})(({theme:e})=>({display:"none"})),B=(0,r.Ay)(l.s4,{name:W,slot:"OptionIcon"})(({theme:e})=>({display:"inline-flex",alignItems:"center",marginTop:"1px",height:"14px",marginRight:"4px"})),z=(0,r.Ay)("div")(({theme:e})=>({display:"inline-flex"})),j=(0,r.Ay)(O.Ay)(({theme:e})=>({display:"flex",width:"100%","&.Mui-focused":{borderColor:e.palette.primary.main}})),L=(0,r.Ay)(o.A,{name:W,slot:"SearchWrapper"})(({theme:e})=>({margin:e.spacing(0,2,1,2),height:e.spacing(5),borderRadius:e.spacing(2.5),display:"flex",alignItems:"center",backgroundColor:e.palette.action.hover,"& input::placeholder, .ico":{color:e.palette.text.hint}}));function X({id:e,checked:t,icon:a,value:n,roomId:i,onClick:l}){let{dispatch:r}=(0,v.PCX)(),o=()=>{r({type:n,payload:{identity:i}}),"function"==typeof l&&l(t?void 0:e)};return d.createElement(H,{optionChecked:t},d.createElement(D,{type:"checkbox"}),d.createElement(B,{icon:a,onClick:o}))}let $=({placeholder:e,hide:t,options:a=[],roomId:n,searching:i=!1})=>{let{dispatch:r}=(0,v.PCX)(),s=(0,d.useRef)(null),c=(0,d.useRef)(null);(0,d.useEffect)(()=>{s.current="",c.current=null,g()},[i]);let m=e=>{s.current=e.target.value,g()},u=e=>{c.current=e,g()},p=(0,d.useCallback)(()=>{r({type:"chat/room/searchMessages",payload:{roomId:n,text:s.current}})},[r,n]),g=(0,d.useMemo)(()=>F()(p,200),[p]);return((0,d.useEffect)(()=>{var e;a.length&&(c.current=null===(e=a.find(e=>e.checked))||void 0===e?void 0:e.id)},[a]),(0,d.useEffect)(()=>{!t&&n&&r({type:"chat/room/clearMsgSearch",payload:{rid:n}})},[t,n]),t)?null:d.createElement(o.A,null,d.createElement(L,null,d.createElement(j,{variant:"search",onChange:m,placeholder:e,startAdornment:d.createElement(l.s4,{icon:"ico-search-o"}),"aria-controls":"search_complete",endAdornment:d.createElement(o.A,null,a&&a.length?d.createElement(z,null,a.map(e=>d.createElement(X,{id:e.id,key:e.id.toString(),checked:null==e?void 0:e.checked,icon:e.icon,value:e.value,roomId:n,onClick:u}))):null)})))},N=(0,d.memo)($);(n=i||(i={})).Direct="d",n.Private="p",n.Public="c",n.OnlyUser="u",a(52705);let Q=(0,r.Ay)("div")(({theme:e})=>({flex:1,fontWeight:"bold",display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"})),q=(0,r.Ay)("span",{shouldForwardProp:e=>"variant"!==e})(({theme:e,variant:t,type:a})=>({...e.typography.subtitle1,fontSize:"15px",lineHeight:e.spacing(2.375),...a===i.Direct&&{":hover":{cursor:"pointer",textDecoration:"underline"}},..."new_message"===t&&{fontSize:e.typography.pxToRem(18),":hover":{cursor:"auto",textDecoration:"none"}}}));function U({room:e,children:t,status:a,user:n,variant:l,isSelfChat:r=!1,loading:o=!1}){let{navigate:s}=(0,v.PCX)(),c=()=>{let t=n&&(n.username||n.user_name);(null==e?void 0:e.t)===i.Direct&&t&&s(`/${t}`)};return(null==e?void 0:e.t)===i.Direct?d.createElement(Q,{"data-testid":C()("_chat Dock Header title")},d.createElement(q,{onClick:c,type:null==e?void 0:e.t},t)):d.createElement(Q,{"data-testid":C()("_chat Dock Header title")},d.createElement(q,{type:null==e?void 0:e.t,variant:l},t))}var G=a(24713),K=a.n(G);let V=(0,r.Ay)("div",{name:"ToolbarChat",slot:"root",shouldForwardProp:e=>"variant"!==e})(({theme:e,variant:t})=>({display:"flex",padding:"0",margin:"0",listStyle:"none","& .MuiActionMenu-menu":"roomPanel"===t&&{overflow:"auto",maxHeight:"200px","&::-webkit-scrollbar":{height:"5px",width:"5px",background:"transparent",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{margin:e.spacing(.5,0),borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}}}));function Z({items:e,displayLimit:t=2,variant:a=null,handleAction:n}){var i,r,o;if(!Array.isArray(e))return null;if("roomPanel"===a){let s=t-1,c=e.filter((e,t)=>t<s||e.behavior),m=K()(c,{behavior:"more"});if(m>-1){if(null===(i=c[m].items)||void 0===i?void 0:i.length)c[m].as="dropdown";else{let u=e.filter((e,t)=>t>s-1&&!e.behavior);c[m]={...c[m],items:u,as:"dropdown"}}}return d.createElement(V,{"data-testid":C()("_chat toolbar"),variant:a},d.createElement(l.c,{items:c,prefixName:"chatToolbar.item.",fallbackName:"button",handleAction:n}))}if("pageMessage"===a){let p=e.filter((e,t)=>e.behavior),g=K()(p,{behavior:"more"});if(g>-1){if(null===(r=p[g].items)||void 0===r?void 0:r.length)p[g].as="dropdown";else{let h=e.filter((e,t)=>!e.behavior);p[g]={...p[g],items:h,as:"dropdown"}}}return d.createElement(V,{"data-testid":C()("_chat toolbar"),variant:a},d.createElement(l.c,{items:p,prefixName:"chatToolbar.item.",fallbackName:"button",handleAction:n,variant:a}))}let f=e.filter((e,a)=>a<t-1||e.behavior),v=K()(f,{behavior:"more"});if(v>-1){if(null===(o=f[v].items)||void 0===o?void 0:o.length)f[v].as="dropdown";else{let y=e.filter((e,a)=>a>t-2&&!e.behavior);f[v]={...f[v],items:y,as:"dropdown"}}}return d.createElement(V,{"data-testid":C()("_chat toolbar")},d.createElement(l.c,{items:f,prefixName:"chatToolbar.item.",fallbackName:"button",handleAction:n}))}},11247(e,t,a){"use strict";a.d(t,{A:()=>w});var n=a(91557),i=a(3556),l=a(62193),r=a.n(l),o=a(96540),s=a(58040),d=a(12561),c=a(20053),m=a(14088);let u="MsgItemFilter",p=(0,i.Ay)("div",{name:u,slot:"uiChatMsgItem"})(({theme:e})=>({maxWidth:"100%",overflow:"hidden"})),g=(0,i.Ay)("div",{name:u,slot:"uiChatMsgItemBody"})(({theme:e})=>({display:"flex"})),h=(0,i.Ay)("div",{name:u,slot:"ChatMsgItemBodyOuter"})(({theme:e})=>({maxWidth:"100%"}));function f({msgId:e,tooltipPosition:t="top",showToolbar:a=!0,room:i,disableReact:l,handleAction:r,firstIndex:s=!1}){let{jsxBackend:u,useSession:f,useGetItem:v,useActionControl:y}=(0,n.PCX)(),x=`chat.chatRooms.${null==i?void 0:i.id}.messageFilter.${e}`,b=v(x),{user:A}=f(),[w]=y(x,{});if(!b)return;let{id:E,attachments:C,reactions:k,type:_,created_at:M,user:R}=b||{},I=(null==A?void 0:A.id)===(null==R?void 0:R.id),P=(0,d.rb)(M),S=(0,d.rs)(C),O=(e,t,a)=>{w(e,t,a),r(e,b,a)};return o.createElement(p,{className:"uiChatMsgItem","data-id":E,"data-t":_},o.createElement(g,null,o.createElement(h,{className:(0,c.default)("uiChatMsgItemBodyOuter",{hasToolbar:a,"multi-image":S>1})},u.render({component:`chat.messageContent.${_}`,props:{message:b,isOwner:I,user:R,createdDate:P,msgType:_,tooltipPosition:s?"bottom":t,isSearch:!0,showActiveSearch:!1}}))),o.createElement(m.A,{identity:x,disabled:l,reactions:k,handleAction:O}))}let v="MessageFilter",y=(0,i.Ay)("div",{name:v,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isGroup"!==e})(({theme:e,isOwner:t,isAlert:a})=>({display:"flex",flexDirection:"row",padding:e.spacing(.5,2),...a&&{"&.uiChatMsgSetAvatar":{display:"none"},"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse"}})),x=(0,i.Ay)("div",{name:v,slot:"uiChatMsgSetAvatar"})(({theme:e})=>({marginRight:e.spacing(1)})),b=(0,i.Ay)("div",{name:v,slot:"noItemFound"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(1,2),color:e.palette.grey["600"]})),A=({disableReact:e,room:t,items:a,handleAction:i})=>{let{i18n:l}=(0,n.PCX)();return r()(a)?o.createElement(b,null,l.formatMessage({id:"no_results_found"})," "):o.createElement("div",null,a&&Object.values(a).map((a,n)=>o.createElement(y,{key:a.id.toString()},o.createElement(x,null,o.createElement(s.A,{user:a.user,size:32,showTooltip:!0})),o.createElement(f,{msgId:a.id,disableReact:e,room:t,handleAction:i,firstIndex:0===n}))))},w=A},58040(e,t,a){"use strict";a.d(t,{A:()=>c});var n=a(91557),i=a(40515),l=a(3556),r=a(97763),o=a(96540);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let d=(0,l.Ay)(({className:e,...t})=>o.createElement(r.A,s({},t,{classes:{popper:e}})))(({theme:e})=>({"& .MuiTooltip-tooltip":{"&.MuiTooltip-tooltipPlacementLeft":{marginRight:`${e.spacing(1)} !important`}}})),c=(0,o.memo)(function({identity:e,size:t=30,user:a,showTooltip:l=!1}){let{useGetItem:r}=(0,n.PCX)(),s=r(e);if(!a&&!s)return null;let c=l&&((null==a?void 0:a.full_name)||(null==s?void 0:s.full_name));return o.createElement(d,{title:c,placement:"left",arrow:!1,PopperProps:{popperOptions:{strategy:"fixed"}}},o.createElement("div",null,o.createElement(i.H8,{user:a||s,size:t,noLink:!0})))})},94317(e,t,a){"use strict";a.d(t,{A:()=>ef});var n=a(12561),i=a(91557),l=a(3556),r=a(8051),o=a(96540);let s=o.createContext(o.createRef());var d=a(58040),c=a(19740),m=a(14088),u=a(40515),p=a(60780),g=a(97763);let h="MsgActionMenu",f=(0,l.Ay)("div",{name:h,slot:"root"})(({theme:e})=>({"& .MuiActionMenu-menu":{overflow:"auto",maxHeight:"220px"}})),v=(0,l.Ay)(p.A,{name:h,slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.5),cursor:"pointer",minWidth:e.spacing(3),lineHeight:e.spacing(2.5)}));function y({identity:e,handleAction:t,scrollRef:a,items:n,placement:l="auto-start"}){let{ItemActionMenu:r,i18n:s}=(0,i.PCX)();return o.createElement(f,null,o.createElement(r,{items:n,placement:l,identity:e,handleAction:t,scrollRef:a,scrollClose:!0,popperOptions:{strategy:"fixed"},variantPopper:"hidden-outview",control:o.createElement(g.A,{title:s.formatMessage({id:"more"}),placement:"top"},o.createElement(v,{disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0,className:"uiChatItemBtn"},o.createElement(u.s4,{icon:"ico-dottedmore-vertical-o"})))}))}var x=a(18799),b=a(83445),A=a(44031),w=a(62193),E=a.n(w);let C="ChatReactListPopover",k=(0,l.Ay)(r.A,{name:C,slot:"ItemRoot",shouldForwardProp:e=>"active"!==e})(({theme:e,active:t})=>({padding:"4px",display:"flex",alignItem:"center",alignSelf:"center",...t&&{background:e.palette.grey["300"],padding:e.spacing(.5),borderRadius:e.spacing(1),width:34,height:34,display:"flex",alignItem:"center",justifyContent:"center",margin:e.spacing(.2)}})),_=(0,l.Ay)("img",{name:C,slot:"ItemImage"})(({theme:e})=>({width:27,height:27})),M=({item:e,onClick:t,active:a})=>o.createElement(k,{active:a,role:"button",onClick:t,"aria-label":e.title,"data-testid":"itemReaction"},o.createElement(g.A,{title:e.title},o.createElement(_,{src:e.src,draggable:!1,alt:e.title}))),R=function({onEmojiClick:e,unsetReaction:t,identity:a}){let{useSession:n,useReactions:l=A.a}=(0,i.PCX)(),r=l(),s=(0,c.wg)(a),{user:d}=n(),m=e=>{var t,a;if(E()(null==s?void 0:null===(t=s.reactions)||void 0===t?void 0:t[e]))return!1;let n=null==s?void 0:null===(a=s.reactions)||void 0===a?void 0:a[e].some(e=>e.user_name===d.user_name);return n},u=a=>{let n=m(a);n?t(a):e(a,null)};return o.createElement(k,{active:!1},r.map(e=>o.createElement(M,{key:e.id.toString(),onClick(){u(`:reaction_${e.id.toString()}:`)},item:e,active:m(`:reaction_${e.id}:`)})))},I=(0,l.Ay)(x.A)(({theme:e})=>({margin:0,padding:e.spacing(0,.5),maxHeight:"48px",display:"flex",alignItems:"center",whiteSpace:"nowrap"}));function P({onEmojiClick:e,multiple:t=!0,disabled:a,scrollRef:n,scrollClose:l,placement:r="top",label:s="react",control:d,identity:c,unsetReaction:m}){let{i18n:p}=(0,i.PCX)(),g=p.formatMessage({id:s}),[h,f]=o.useState(null),v=o.useRef(),[y,x]=o.useState(!1),A=o.useCallback(()=>{x(!1)},[]),w=o.useCallback(e=>{x(e=>!e),f(h?null:e.currentTarget)},[]),E=o.useCallback((a,n)=>{e&&e(a,n),t||x(!1)},[t,e]),C=o.useCallback(e=>{m&&m(e),x(!1)},[m]);return o.useEffect(()=>{if(y&&n&&n.current&&l){let e=()=>x(!1);return n.current.addEventListener("scroll",e),()=>{null==n||n.current.removeEventListener("scroll",e)}}},[y]),o.createElement(o.Fragment,null,o.createElement(u.qB,{excludeRef:v,onClickAway:A},o.createElement(d,{onClick:w,disabled:a,title:g,"data-testid":"buttonAttachEmoji",icon:"ico-smile-o"})),o.createElement(b.A,{ref:v,open:y,anchorEl:h,placement:r,role:"presentation",style:{zIndex:5e3}},o.createElement(I,{"data-testid":"dialogEmojiPicker"},o.createElement(R,{onEmojiClick:E,unsetReaction:C,identity:c}))))}function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let O=(0,l.Ay)(p.A,{name:"MsgEmojiPicker",slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.75),cursor:"pointer",minWidth:e.spacing(2.5),lineHeight:e.spacing(2.5)})),T=o.forwardRef(({title:e,...t},a)=>o.createElement(g.A,{title:e,placement:"top",PopperProps:{disablePortal:!0}},o.createElement(O,S({className:"uiChatItemBtn uiChatIconBtn",disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0},t,{ref:a}),o.createElement(u.s4,{icon:"ico-smile-o"}))));function F({handleAction:e,scrollRef:t,identity:a}){let n=o.useCallback((t,a=null)=>e("chat/messageReaction",{shortcut:t,unicode:a}),[e]),i=o.useCallback(t=>{e("chat/unsetReaction",{identity:a,shortcut:t})},[e]);return o.createElement(P,{size:"small",multiple:!1,onEmojiClick:n,unsetReaction:i,control:T,scrollRef:t,scrollClose:!0,identity:a})}function W(){return(W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let H=(0,l.Ay)("div",{name:"MsgToolbar",slot:"uiChatToolbar",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",justifyContent:"center",alignItems:"center",...!t&&{flexDirection:"row-reverse"}}));function D({items:e,disabled:t,disableReact:a,handleAction:n,identity:l,isOwner:r,...s}){let{useScrollRef:d}=(0,i.PCX)(),c=d();return t?null:o.createElement(H,{isOwner:r,className:"uiChatToolbar"},o.createElement(y,W({identity:l,items:e,scrollRef:c,handleAction:n},s)),a?null:o.createElement(F,{scrollRef:c,handleAction:n,identity:l}))}let B=(0,l.Ay)("div",{name:"UIMsgItemBody",slot:"RootStyled",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isShowReact"!==e})(({theme:e,isOwner:t,isAlert:a,isShowReact:n})=>({display:"flex","@media (hover: hover)":{"&:hover .uiChatItemBtn":{visibility:"visible"}},"@media (hover: none)":{".uiChatItemBtn":{visibility:"visible"}},[e.breakpoints.down("sm")]:{".uiChatItemBtn":{visibility:"visible"}},...t&&{flexDirection:"row-reverse"},...a&&{textAlign:"center",...n&&{justifyContent:"center"}}}));function z({children:e,isOwner:t,isAlert:a,isShowReact:n}){return o.createElement(B,{isOwner:t,isAlert:a,isShowReact:n},e)}let j=(0,l.Ay)("div",{name:"UIMsgItemBodyOuter",slot:"RootStyled",shouldForwardProp:e=>"isPageAllMessages"!==e&&"msgType"!==e&&"isMsgEdit"!==e&&"totalImage"!==e&&"totalImageQuote"!==e&&"msgContentType"!==e})(({theme:e,isPageAllMessages:t,msgType:a,isMsgEdit:n,totalImage:i,totalImageQuote:l,msgContentType:r})=>({minWidth:0,maxWidth:`calc(100% - ${n?"80px":"50px"})`,...i>1&&{width:"75%"},...1===i&&{width:"65%"},...("message_pinned"===a||"message_unpinned"===a)&&{width:"100%"},..."messageDeleted"===r&&{maxWidth:"calc(100% - 26px)"},...t&&{maxWidth:"65%",...("message_pinned"===a||"message_unpinned"===a)&&{maxWidth:1===l?"300px":"400px",width:"100%"},...1===i&&{maxWidth:"300px",width:"100%"},...i>1&&{width:"55%"},[e.breakpoints.down("sm")]:{maxWidth:`calc(100% - ${n?"80px":"50px"})`,...i>1&&{width:"75%"},...1===i&&{width:"60%"},...("message_pinned"===a||"message_unpinned"===a)&&{width:"75%"}}},..."messageDeleted"===a&&{width:"auto"}}));function L({children:e,isMsgEdit:t=!1,totalImage:a,isPageAllMessages:n,msgType:i,msgContentType:l,totalImageQuote:r}){if(e)return o.createElement(j,{isMsgEdit:t,msgContentType:l,totalImage:a,isPageAllMessages:n,msgType:i,totalImageQuote:r},e)}var X=a(55737);let $=(0,l.Ay)("div",{name:"MsgItem",slot:"uiChatMsgItem",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({...t&&{flexDirection:"row-reverse"},minHeight:"40px",marginBottom:e.spacing(.5)}));function N({msgId:e,authUser:t,showToolbar:a=!0,disableReact:l,handleAction:r,room:s,indexLast:d}){let{jsxBackend:u,usePageParams:p,useGetItem:g}=(0,i.PCX)(),h=(0,i.yX1)(),f=o.useRef(),v=`chat.entities.message.${e}`,y=g(v),x=(0,c.nb)(null==s?void 0:s.id),{msgSearch:b,msgNewest:A}=x||{},w=p(),E=(null==w?void 0:w.rid)||!1,[C]=(0,i.Vd3)(v,{}),{id:k,type:_,attachments:M,reactions:R,created_at:I,user:P}=y||{},S=(0,c.Dr)(),O=(0,n.Rt)(R,S),T=g(P),F=(null==t?void 0:t.id)===(null==T?void 0:T.id),W=(0,n.rb)(I),H=(0,n.M2)(_),{multiImageFile:B}=(0,X.Xc)(M);o.useEffect(()=>{if((null==b||!b.loading)&&f.current&&((null==b?void 0:b.mQuoteId)===(null==y?void 0:y.id)||(null==b?void 0:b.id)===(null==y?void 0:y.id))){var e,t,a,n;let{top:i}=null===(e=f.current)||void 0===e?void 0:e.getBoundingClientRect(),{top:l}=null===(t=h.current)||void 0===t?void 0:t.getBoundingClientRect();i-l>0&&i-l<(null===(a=h.current)||void 0===a?void 0:a.clientHeight)||h.current.scrollTo({top:null===(n=f.current)||void 0===n?void 0:n.offsetTop})}},[null==b?void 0:b.loading,null==b?void 0:b.id,null==b?void 0:b.mQuoteId,null==y?void 0:y._id]);let j=o.useMemo(()=>F?d&&A==k?"left-end":"left-start":d&&A==k?"right-end":"right-start",[F,d,A,k]);if(!y)return null;let N=(e,t,a)=>{C(e,t,a),r(e,y,a)},Q="messageDeleted"!==_;return o.createElement($,{isOwner:F,"data-id":k,"data-t":_,"data-testid":k,ref:f},o.createElement(z,{isOwner:F,isAlert:H,isShowReact:Q},o.createElement(L,{totalImage:null==B?void 0:B.length,isPageAllMessages:E,msgType:_},u.render({component:`chat.messageContent.${_}`,props:{message:y,isOwner:F,user:P,createdDate:W,msgType:_,tooltipPosition:"top"}})),Q&&!H&&o.createElement(D,{identity:v,handleAction:N,disabled:!a,disableReact:l,isOwner:F,placement:j})),Q&&o.createElement(m.A,{identity:v,disabled:!O,reactions:O,isOwner:F,handleAction:N}))}let Q="MsgSet",q=(0,l.Ay)("div",{name:Q,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:a})=>({display:"flex",flexDirection:"row",padding:e.spacing(.5,2),...a&&{"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse",padding:e.spacing(0,2)}})),U=(0,l.Ay)("div",{name:Q,slot:"uiChatMsgSetAvatar",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:a})=>({marginRight:e.spacing(1),display:"flex",alignItems:"flex-end",marginBottom:e.spacing(.75),...t&&{display:"none",flexDirection:"row-reverse"},...a&&{display:"none"},"& > span":{cursor:"default"}})),G=(0,l.Ay)("div",{name:Q,slot:"uiChatMsgSetBody",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({flex:1,minWidth:0,...t&&{flexDirection:"row-reverse"}}));function K({msgSet:e,disableReact:t,handleAction:a,showToolbar:n,room:l}){let{useSession:r,useGetItem:s}=(0,i.PCX)(),{user:c}=r(),m=s(null==e?void 0:e.user);if(!e)return;let{items:u}=e,p=(null==c?void 0:c.id)===m.id;return u&&u.length?o.createElement(q,{isOwner:p,className:`uiChatMsgSet ${p?"isOwner":""}`},o.createElement(U,{isOwner:p,className:"uiChatMsgSetAvatar"},o.createElement(d.A,{user:m,size:32,showTooltip:!0})),o.createElement(G,{className:"uiChatMsgSetBody"},u.map((e,i)=>o.createElement(N,{authUser:c,key:e.toString(),msgId:e,disableReact:t,handleAction:a,showToolbar:n,room:l,indexLast:i===u.length-1})))):null}function V({msgGroup:e,disableReact:t,handleAction:a,showToolbar:n,room:i}){if(!e)return null;let{items:l}=e;return l?o.createElement("div",null,l.map((e,l)=>o.createElement(K,{msgSet:e,key:`k.0${l}`,disableReact:t,showToolbar:n,handleAction:a,room:i}))):null}var Z=a(81502);let J=(0,l.Ay)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({"&:not(:first-of-type)":{marginTop:e.spacing(.75)},position:"relative",padding:e.spacing(1),maxWidth:"245px",backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},borderRadius:e.spacing(1.25),overflow:"hidden",...t&&{maxWidth:"400px",padding:e.spacing(1.25,1)}})),Y=(0,l.Ay)("div")(({theme:e})=>({display:"flex",alignItems:"center","& .ico":{marginRight:e.spacing(.75)}})),ee=(0,l.Ay)(u.mE)(({theme:e})=>({flex:1,minWidth:0,fontSize:e.mixins.pxToRem(12)})),et=(0,l.Ay)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({position:"absolute",bottom:0,left:0,right:0,padding:e.spacing(0,1),...t&&{span:{height:e.spacing(.75)}}})),ea=function({count:e=1,files:t,progress:a=0,isAllPage:n=!1}){let{i18n:l}=(0,i.PCX)();if(t||t.length)return o.createElement(J,{isAllPage:n},o.createElement(Y,null,o.createElement(u.s4,{icon:"ico-paperclip-alt"}),o.createElement(ee,{lines:1},1===e?o.createElement(o.Fragment,null,l.formatMessage({id:"uploading_name"},{name:t[0].name})):l.formatMessage({id:"uploading_n_attachments"},{count:e}))),o.createElement(et,{isAllPage:n},o.createElement(Z.A,{variant:"determinate",value:a})))};function en(){return(en=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let ei=(0,l.Ay)("div")(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"flex-end",marginBottom:e.spacing(.5),padding:e.spacing(.5,2)})),el=(0,l.Ay)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({display:"flex",flexDirection:"column",alignItems:"flex-end",width:"100%",...t&&{maxWidth:'calc(~"100% - 50px")'}})),er=function({data:e,eventInit:t,isAllPage:a=!1}){let n=Object.keys(e),i=n.map(t=>({id:t,...e[t]}));return(o.useEffect(()=>{t&&t()},[i]),i.length)?o.createElement(ei,null,o.createElement(el,{isAllPage:a},i.map(e=>o.createElement(ea,en({},e,{key:e.id,isAllPage:a}))))):null};var eo=a(96610),es=a(68536);let ed="MsgSet",ec=(0,l.Ay)("div",{name:ed,slot:"uiChatMsgSet"})(({theme:e})=>({display:"flex",flexDirection:"row-reverse",padding:e.spacing(0,2),opacity:.6,pointerEvents:"none"})),em=(0,l.Ay)("div",{name:ed,slot:"uiChatMsgSetBody",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({flex:1,minWidth:0,...t&&{flexDirection:"row-reverse"}})),eu=(0,l.Ay)("div",{name:ed,slot:"uiChatMsgItemMsg",shouldForwardProp:e=>"isOwner"!==e&&"isQuote"!==e})(({theme:e,isOwner:t,isQuote:a})=>({zIndex:2,minHeight:e.spacing(5),marginBottom:e.spacing(.5),borderRadius:e.spacing(1),fontSize:e.mixins.pxToRem(15),padding:e.spacing(1.25),backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},overflowWrap:"break-word","& a":{color:t?"#fff":e.palette.text.primary,textDecoration:"underline",cursor:"pointer",overflowWrap:"break-word"},...t&&{backgroundColor:e.palette.primary.main,color:"#fff !important"}})),ep=(0,l.Ay)("div",{name:ed,slot:"uiChatMsgItemBodyInnerWrapper"})(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"flex-end"}));function eg({item:e}){var t,a;let{useGetItems:n}=(0,i.PCX)();if(!e.text&&!e.dataQuote)return null;let l=null==e?void 0:null===(t=e.dataQuote)||void 0===t?void 0:t.attachments;return l&&"string"==typeof(null==l?void 0:l[0])&&(l=n(null==e?void 0:null===(a=e.dataQuote)||void 0===a?void 0:a.attachments)),o.createElement(ec,null,o.createElement(em,null,o.createElement(ep,null,E()(e.dataQuote)?null:o.createElement(es.A,{dataQuote:{...e.dataQuote,attachments:l},isOwner:!0}),e.text?o.createElement(eu,{isQuote:!1,isOwner:!0,className:"uiChatMsgItemMsg",dangerouslySetInnerHTML:{__html:(0,eo.Ay)(e.text)}}):null)))}let eh=(0,l.Ay)(r.A,{name:"Messages",slot:"DateTimeGroup"})(({theme:e})=>({textAlign:"center",color:e.palette.grey["600"],padding:e.spacing(1,0)})),ef=o.forwardRef(function({rid:e,groups:t,groupIds:a,preFetchingMsg:l,newest:r,disableReact:d,room:c,containerRef:m,handleAction:u,isAllPage:p,roomProgress:g,loading:h,showToolbar:f,chatRoom:v},y){let x=(0,i.yX1)(),[b,A]=o.useState(!1),w=o.useRef(!1),{msgSearch:C}=v||{},k=()=>{if(C&&(null==C?void 0:C.mQuoteId)||!(null==C?void 0:C.id)){let e=x.current.scrollHeight+10;x.current.scrollTo({top:e})}};return(o.useEffect(()=>{if(E()(C)&&!w.current&&b)return w.current=!0,setTimeout(()=>{k()},100),()=>{w.current=!1}},[e,b,h]),o.useEffect(()=>(A(!!(null==a?void 0:a.length)),()=>A(!1)),[null==a?void 0:a.length]),o.useLayoutEffect(()=>{if((null==C?void 0:C.mode)!=="quote"&&(null==x?void 0:x.current)&&r){let e=x.current;e.scrollHeight-e.scrollTop-110<=e.clientHeight&&k()}},[r,null==C?void 0:C.mode]),o.useImperativeHandle(y,()=>({scrollToBottom(){k()}})),c&&t)?o.createElement(s.Provider,{value:m},a.map((e,a)=>{var i,l;return o.createElement("div",{key:`k.0${a}`},t[e]&&(0,n.rb)(null===(i=t[e])||void 0===i?void 0:i.ts)?o.createElement(eh,null,(0,n.rb)(null===(l=t[e])||void 0===l?void 0:l.ts)):null,o.createElement(V,{msgGroup:t[e],disableReact:d,showToolbar:f,handleAction:u,room:c}))}),E()(g)?null:o.createElement(er,{data:g,eventInit:k,isAllPage:p}),l?l.filter(e=>(null==e?void 0:e.isLoading)===!0).map(e=>o.createElement(eg,{key:e,item:e})):null):null})},15535(e,t,a){"use strict";a.d(t,{A:()=>s});var n=a(3556),i=a(37131),l=a(96540);function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let o=(0,n.Ay)("div",{name:"MsgAttachment",slot:"UIMsgAttachment",shouldForwardProp:e=>"isOwner"!==e&&"isAudio"!==e&&"isTypeFile"!==e&&"isOther"!==e})(({theme:e})=>({maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",paddingBottom:e.spacing(.5),marginTop:e.spacing(.25),overflow:"hidden"}));function s({item:e,isOwner:t,allowOpenPreview:a=!0}){let{is_image:n,image:s,file_name:d,download_url:c,file_size_text:m}=e;return l.createElement(o,{isOwner:t},l.createElement(i.A,r({isOwner:t,image:s,is_image:n,download_url:c,file_name:d,file_size_text:m},e,{allowOpenPreview:a})))}},37131(e,t,a){"use strict";a.d(t,{A:()=>k});var n=a(12561),i=a(3556),l=a(96540);let r="UIMsgAttachmentImgWrapper",o=(0,i.Ay)("div",{name:r,slot:"RootStyled"})(({theme:e})=>({position:"relative",width:"100%"})),s=(0,i.Ay)("figure",{name:r,slot:"MediaWrapper"})(({theme:e})=>({margin:0,display:"block"})),d=(0,i.Ay)("div",{name:r,slot:"ImgRatioWrapper",shouldForwardProp:e=>"isOwner"!==e&&"isPageAllMessages"!==e})(({theme:e,isOwner:t,isPageAllMessages:a})=>({width:"100%",minWidth:t?"200px":"180px",maxWidth:"100%",cursor:"pointer",...a&&{width:"300px",[e.breakpoints.down("sm")]:{width:t?"200px":"180px"}}}));function c({children:e,ratioImage:t,isPageAllMessages:a,isOwner:n}){return l.createElement(o,null,l.createElement(s,null,l.createElement(d,{isOwner:!!n,isPageAllMessages:a,style:{paddingBottom:`${t?100*t:100}%`}},e)))}let m="UIMsgAttachMultiImgWrapper",u=(0,i.Ay)("div",{name:m,slot:"RootStyled"})(({theme:e})=>({position:"relative",width:"100%"})),p=(0,i.Ay)("figure",{name:m,slot:"MediaWrapper"})(({theme:e})=>({margin:0,display:"block"})),g=(0,i.Ay)("div",{name:m,slot:"ImgRatioWrapper",shouldForwardProp:e=>"isPageAllMessages"!==e})(({theme:e,isPageAllMessages:t})=>({maxWidth:"100%",cursor:"pointer",marginBottom:"1px",width:"100%",height:"100%",...t&&{width:"100%",height:"100%"}}));function h({children:e,isPageAllMessages:t,ratioImage:a=1}){return l.createElement(u,null,l.createElement(p,null,l.createElement(g,{isPageAllMessages:t,style:{paddingBottom:`${a?100*a:100}%`}},e)))}var f=a(91557),v=a(67725);let y=(0,i.Ay)("img",{name:"MsgAttachmentImage"})(({theme:e})=>({position:"absolute",left:0,top:0,width:"100%",borderRadius:e.spacing(1),border:e.mixins.border("secondary")})),x=(e,t)=>{let a=new Image;a.src=t,a.onload=()=>{e({height:a.height,width:a.width})},a.onerror=t=>{e(t)}};function b({isOwner:e,image:t,download_url:a,file_name:n,id:i,allowOpenPreview:r=!0}){let{dispatch:o,usePageParams:s,assetUrl:d}=(0,f.PCX)(),m=s(),u=(null==m?void 0:m.rid)||!1,[p,g]=l.useState(null),h=(0,v.AE)(t,"500",d("photo.no_image")),b=(0,v.AE)(t,"origin",d("photo.no_image"));l.useEffect(()=>{h&&x(g,h)},[h]);let A=!!p&&p.height/p.width,w=()=>{r&&o({type:"chat/room/presentImageView",payload:{image:{id:"img0",src:b,download_url:a,is_image:!0,file_name:n,imageId:i}}})};return l.createElement(c,{isPageAllMessages:u,ratioImage:A,isOwner:e},l.createElement(y,{src:h,onClick:w,alt:n}))}let A=(0,i.Ay)("img",{name:"MsgAttachmentImage"})(({theme:e})=>({position:"absolute",left:0,top:0,width:"100%",objectFit:"cover",borderRadius:e.spacing(1),border:e.mixins.border("secondary"),height:"100%"}));function w({image:e,download_url:t,images:a,isOwner:n,file_name:i,keyIndex:r,id:o}){let{dispatch:s,usePageParams:d,assetUrl:c}=(0,f.PCX)(),m=d(),u=(null==m?void 0:m.rid)||!1,p=l.useMemo(()=>a&&a.length?a.map((e,t)=>{let a=(0,v.AE)(e.image,"origin",c("photo.no_image"));return{id:t,src:a,download_url:e.download_url,file_name:e.file_name,imageId:e.id}}):[],[a]),g=(0,v.AE)(e,"500",c("photo.no_image")),y=(0,v.AE)(e,"origin",c("photo.no_image")),x=()=>{s({type:"chat/room/presentImageView",payload:{image:{id:parseInt(r),src:y,download_url:t,file_name:i,imageId:o},images:p}})};return l.createElement(h,{isPageAllMessages:u},l.createElement(A,{src:g,onClick:x,alt:"dwq"}))}let E=(0,i.Ay)("div",{name:"MsgAttachmentMedia",slot:"TitleLink",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({borderRadius:e.spacing(1),fontSize:e.spacing(1.75),padding:e.spacing(1),overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",display:"inline-block",maxWidth:"100%",wordBreak:"break-word",wordWrap:"break-word",backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},...t&&{backgroundColor:e.palette.primary.main,color:"#fff"}})),C=(0,i.Ay)("div")(({theme:e})=>({display:"flex",alignItems:"center",cursor:"pointer","& .ico":{marginRight:e.spacing(1)}}));function k({isOwner:e,layout:t,totalImages:a,is_image:i,image:r,file_name:o,download_url:s,file_size_text:d,keyIndex:c,id:m,allowOpenPreview:u=!0}){return r&&"multi-image"===t?l.createElement(w,{images:a,file_name:o,image:r,download_url:s,isOwner:e,keyIndex:c,id:m,allowOpenPreview:u}):i&&r?l.createElement(b,{isOwner:e,image:r,file_name:o,download_url:s,id:m,allowOpenPreview:u}):i?null:l.createElement(E,{isOwner:e},l.createElement(C,{onClick:()=>(0,n.NK)(s)},l.createElement("i",{className:"ico ico-arrow-down-circle mr-1"}),o))}},55737(e,t,a){"use strict";a.d(t,{Ay:()=>v,Xc:()=>f,tr:()=>h});var n=a(91557),i=a(96540),l=a(15535),r=a(3556),o=a(37131);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let d="MsgAttachmentMultiMedia",c=(0,r.Ay)("div",{name:d,slot:"uiMsgImageAttachmentWrapper",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",alignItems:"center",flexWrap:"wrap",justifyContent:t?"flex-end":"flex-start",marginTop:e.spacing(.25),width:"100%",gap:e.spacing(.5)})),m=(0,r.Ay)("div",{name:d,slot:"uiMsgImageAttachmentItem"})(({theme:e})=>({flexBasis:`calc(100% / 3 - ${e.spacing(.5)})`}));function u({mediaItems:e,isOwner:t}){return i.createElement(c,{isOwner:t},e.map((a,n)=>i.createElement(m,{key:`k${n}`},i.createElement(o.A,s({},a,{keyIndex:n,layout:"multi-image",totalImages:e,isOwner:t})))))}var p=a(62193),g=a.n(p);let h=e=>{if(g()(e))return{multiImageFile:[],otherFile:[],attachments:[]};let t=[],a=[];return e.map(e=>{e.is_image?t.push(e):a.push(e)}),{multiImageFile:t,otherFile:a,attachments:e}},f=e=>{let{useGetItems:t}=(0,n.PCX)(),a=t(e)||[];if(g()(a))return{multiImageFile:[],otherFile:[],attachments:[]};let i=[],l=[];return a.map(e=>{e.is_image?i.push(e):l.push(e)}),{multiImageFile:i,otherFile:l,attachments:a}};function v({message:e,isOwner:t}){var a;let{multiImageFile:n,otherFile:r,attachments:o}=f(null==e?void 0:e.attachments);return(null===(a=e.attachments)||void 0===a?void 0:a.length)&&(n.length||r.length)?n.length>1?i.createElement(i.Fragment,null,i.createElement(u,{mediaItems:n,isOwner:t}),r.length?r.map((e,a)=>i.createElement(l.A,{item:e,key:`k${a}`,isOwner:t})):null):o.map((e,a)=>i.createElement(l.A,{item:e,key:`k${a}`,isOwner:t})):null}},68536(e,t,a){"use strict";a.d(t,{A:()=>S});var n=a(96610),i=a(91557),l=a(3556),r=a(87773),o=a(89481),s=a(8051),d=a(96540),c=a(40515),m=a(55737),u=a(15535),p=a(62193),g=a.n(p),h=a(12561),f=a(19740),v=a(69709),y=a(771);let x="MsgQuote",b=(0,l.Ay)("div",{name:x,slot:"RootMsg",shouldForwardProp:e=>"isOwner"!==e&&"isSearch"!==e})(({theme:e,isOwner:t,isSearch:a})=>({marginBottom:e.spacing(-2),marginLeft:e.spacing(1),marginRight:0,marginTop:e.spacing(.25),paddingBottom:e.spacing(3),maxWidth:"calc(100% - 8px)",display:"flex",flexDirection:"row",overflow:"hidden",border:e.mixins.border("secondary"),borderRadius:e.spacing(1),minHeight:"70px",position:"relative",...!a&&{cursor:"pointer"},"& a:not(.MuiAvatar-root)":{color:e.palette.text.primary,textDecoration:"underline",cursor:"pointer"},...t&&{color:e.palette.text.secondary,marginRight:e.spacing(1),marginLeft:0}})),A=(0,l.Ay)("div",{name:x,slot:"Author"})(({theme:e})=>({display:"flex",justifyContent:"flex-start",alignItems:"center","& .MuiAvatar-root":{fontSize:e.mixins.pxToRem(7)},strong:{padding:e.spacing(0,.5)}})),w=(0,l.Ay)("div",{name:x,slot:"MsgAttachmentFlex",shouldForwardProp:e=>"isAttachment"!==e})(({theme:e,isAttachment:t})=>({textAlign:"start",...t&&{maxWidth:"300px"}})),E=(0,l.Ay)(c.mE,{name:x,slot:"Text"})(({theme:e})=>({color:e.palette.text.secondary,margin:e.spacing(.5,0)})),C=(0,l.Ay)("div",{name:x,slot:"TextDelete"})(({theme:e})=>({margin:e.spacing(.5),marginLeft:0,fontStyle:"italic"})),k=(0,l.Ay)("div",{name:x,slot:"AttachmentInfo"})(({theme:e})=>({overflow:"hidden",margin:e.spacing(1,1,0,0)})),_=(0,l.Ay)("div")(({theme:e})=>({width:e.spacing(.5),height:"100%",backgroundColor:e.palette.grey["100"]})),M=(0,l.Ay)("div")(({theme:e})=>({width:e.spacing(3),minWidth:e.spacing(3),marginTop:e.spacing(1.5),display:"flex",justifyContent:"center",alignItems:"center"})),R=(0,l.Ay)(r.A)(({theme:e})=>({color:"light"===e.palette.mode?e.palette.grey.A200:e.palette.text.primary})),I=(0,l.Ay)(c.mE,{name:x,slot:"uiMsgAttachmentLink"})(({theme:e})=>({"& .ico":{fontSize:e.mixins.pxToRem(12),marginRight:e.spacing(.5)}})),P=(0,l.Ay)("div",{name:x,slot:"LoadingStyled"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",width:"100%",height:"100%",backgroundColor:(0,y.X4)(e.palette.background.paper,.7)}));function S({dataQuote:e,isOwner:t,isSearch:a=!1}){let{i18n:l,dispatch:r}=(0,i.PCX)(),p=(0,f.Zq)(null==e?void 0:e.room_id)||[],[y,x]=d.useState(!1),S=(0,f.nb)(null==e?void 0:e.room_id),{msgSearch:O}=S||{},{multiImageFile:T,attachments:F}=(0,m.tr)(null==e?void 0:e.attachments);if(!e)return null;let{user:W,message:H}=e,D=(0,h.R$)({msg:e,messagesDelete:p}),B=()=>{x(!1)},z=()=>{a||"messageDeleted"===D||y||(x(!0),r({type:v.H5,payload:{roomId:null==e?void 0:e.room_id,mid:null==e?void 0:e.id,limit:20,operate:"all",mode:"quote"},meta:{onSuccess:B}}))};return d.createElement(b,{isOwner:t,onClick:z,isSearch:a},!g()(O)&&y?d.createElement(P,{"data-testid":"loadingIndicator"},d.createElement(o.A,{size:20})):null,d.createElement(M,null,d.createElement(_,null)),d.createElement(k,null,W?d.createElement(A,null,d.createElement(R,{component:"h2",variant:"h5"},W.full_name||W.user_name)):null,d.createElement(w,{isAttachment:F.length},"messageDeleted"===D?d.createElement(C,null,l.formatMessage({id:"message_was_deleted"})):null,g()(H)||"messageDeleted"===D?null:d.createElement(E,{lines:1,dangerouslySetInnerHTML:{__html:(0,n.Ay)(H)}}),"messageDeleted"!==D&&F&&(null==F?void 0:F.length)?d.createElement(s.A,{sx:{mt:1}},T.length>1?d.createElement(E,{lines:1},l.formatMessage({id:"total_photo"},{value:T.length})):d.createElement(d.Fragment,null,F.map((e,a)=>d.createElement(d.Fragment,{key:`k${a}`},e.is_image&&e.image?d.createElement(u.A,{item:e,isOwner:t,allowOpenPreview:!1}):d.createElement(I,{lines:1},d.createElement(c.s4,{icon:"ico-paperclip-alt"}),e.file_name))))):null)))}},14088(e,t,a){"use strict";a.d(t,{A:()=>h});var n=a(91557),i=a(3556),l=a(96540),r=a(19740),o=a(85015),s=a.n(o);let d=(0,i.Ay)("span")(({theme:e})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:e.spacing(0,.25)})),c=(0,i.Ay)("img")(({theme:e})=>({width:15,height:15}));function m({id:e,users:t=[]}){let a=(0,r.Dr)();if(!e||!t.length)return null;let n=s()(e)&&e.split(":")[1].split("_")[1];if(!n||!a)return null;let i=a.find(e=>e.id===parseInt(n));return l.createElement(d,null,l.createElement(c,{src:null==i?void 0:i.src,draggable:!1,alt:null==i?void 0:i.title}))}let u=(0,i.Ay)("div",{shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",margin:0,padding:0,marginBottom:e.spacing(-.25),...t&&{flexDirection:"row-reverse"}})),p=(0,i.Ay)("span")(({theme:e})=>({marginLeft:e.spacing(.5),position:"relative",top:"-1px",fontSize:e.typography.pxToRem(14),height:e.spacing(2.5),fontWeight:e.typography.fontWeightRegular})),g=(0,i.Ay)("div")(({theme:e})=>({cursor:"pointer",color:e.palette.grey["800"],backgroundColor:e.palette.grey["50"],position:"relative",borderRadius:e.spacing(1),lineHeight:e.spacing(2.5),whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",padding:e.spacing(.5,.75),boxShadow:"0px 0px 15px 0px #00000026",transform:"translateY(-10px)",height:e.spacing(3),zIndex:2}));function h({identity:e,disabled:t,reactions:a,isOwner:i,handleAction:r}){let{dispatch:o,getSetting:s}=(0,n.PCX)(),d=!s("preaction"),c=()=>{o({type:"chat/presentReactionsList",payload:{identity:e}})};if(d||t||!a||!Object.keys(a).length)return null;let h=0,f=Object.keys(a).reduce((e,t)=>{var n;return h+=null===(n=a[t])||void 0===n?void 0:n.length,{...e,[t]:a[t]}},{});return l.createElement(u,{isOwner:i},l.createElement(g,{onClick:c},Object.keys(f).slice(0,3).map((e,t)=>l.createElement(m,{id:e,users:f[e],key:`k${t}`})),l.createElement(p,null,h)))}},19740(e,t,a){"use strict";a.d(t,{nb:()=>o,Zq:()=>s,iw:()=>r,In:()=>p,f3:()=>m,EH:()=>c,wg:()=>d,eL:()=>u,Dr:()=>l.A,iW:()=>g,oT:()=>h});var n=a(71468),i=a(99477),l=a(44031);function r(){return(0,n.d4)(e=>(0,i.Tr)(e))}let o=e=>(0,n.d4)(t=>(0,i.rS)(t,e)),s=e=>(0,n.d4)(t=>(0,i.vF)(t,e));function d(e){return(0,n.d4)(t=>(0,i.Ax)(t,e))}let c=()=>(0,n.d4)(i.x2),m=()=>(0,n.d4)(i.yr),u=()=>(0,n.d4)(i.Eq),p=()=>(0,n.d4)(i.pR),g=e=>(0,n.d4)(t=>(0,i.gQ)(t,e)),h=()=>(0,n.d4)(i.t8)},8022(e,t,a){"use strict";a.d(t,{A:()=>s});var n=a(91557),i=a(96540),l=a(62193),r=a.n(l),o=a(67725);function s(e){let{initialValues:t,messageAcceptFail:a,inputRef:l}=e||{},{dialogBackend:s,i18n:d,getSetting:c}=(0,n.PCX)(),[m,u]=i.useState(t||[]),p=i.useRef(!1),g=c("core.attachment.maximum_file_size_each_attachment_can_be_uploaded"),h=c("core.attachment.maximum_number_of_attachments_that_can_be_uploaded"),f=()=>{(null==l?void 0:l.current)&&(l.current.value=null)},v=(e,t=!1)=>{if(r()(e))return;let n=[],i=[],l=(t?0:m.length)+(null==e?void 0:e.length);if(h<l){s.alert({title:"Oops!",message:d.formatMessage({id:"could_not_select_more_than_limit_files"},{limit:h})});return}for(let c=0;c<e.length;++c){let v=e[c],y=v.size,x={file_name:v.name,file_size:v.size,file_type:v.type,file:v};if(!(0,o.HH)(null==v?void 0:v.type,"image/*")){s.alert({message:a||d.formatMessage({id:"file_accept_type_fail"})}).then(()=>p.current=!1).catch(()=>p.current=!1),p.current=!0,f();break}y>g&&0!==g?(x.max_size=g,i.push(x)):n.push(x.file)}if(!p.current){if(n.length&&u([...m||[],...n]),i.length>0){var b;s.alert({message:1===i.length?d.formatMessage({id:"warning_upload_limit_one_file"},{fileName:(0,o.Tu)(i[0].file_name,30),fileSize:(0,o.lT)(i[0].file_size),maxSize:(0,o.lT)(null===(b=i[0])||void 0===b?void 0:b.max_size)}):d.formatMessage({id:"warning_upload_limit_multi_image"},{numberFile:i.length,photoMaxSize:(0,o.lT)(g)})}),f();return}return f(),!0}};return[m,u,v]}},44031(e,t,a){"use strict";a.d(t,{A:()=>r,a:()=>d});var n=a(91557),i=a(71468),l=a(1081);function r(){let{getSetting:e}=(0,n.PCX)(),t=e("preaction.reaction_list",[]).filter(e=>e.is_active),a=e("preaction.inactive_reaction_list",[]),i=[...t,...a];return(null==i?void 0:i.length)?i:[]}let o=e=>(e.preaction.data.reactions||[]).filter(e=>e.is_active),s=(0,l.Mz)(o,e=>e);function d(){return(0,i.d4)(s)}},96610(e,t,a){"use strict";a.d(t,{Ay:()=>u,Nj:()=>m,XC:()=>p});var n=a(69709),i=a(12561),l=a(14425),r=a.n(l);function o(e){return e.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2")}function s(e,t={}){let{mentions:a=[]}=t,n=e.replace(/\[(\s)*\]\(([^\)]+)\)/gm,"");return a&&a.length>0&&(n=n.replace(/@([^\s\\#@:]+)/giu,(e,t)=>{let n=a.find(e=>e.username===t);return n&&n.name?`@${n.name}`:e})),n}function d(e,t={}){let{mentions:a=[]}=t,n=e.replace(/@\[([^\]]+)\]\(([^#@:]+)\)/giu,"<a onclick=\"triggerClick('$2')\">@$1</a>");return a&&a.length>0&&(n=n.replace(/@([^\s\\#@:]+)/giu,(e,t)=>{let n=a.find(e=>e.username===t);return n&&n.name?`<a onclick="triggerClick('/${t}')">@${n.name}</a>`:e})),n}window.triggerClick=i.NK;let c=e=>e.replace(/:\w+:/gi,e=>e),m=(e,t={})=>e?s(e,t):null;function u(e,t={}){var a;return e?o(c(d((a=s(e),r()(a)).replace(n._t,e=>{let t=e.startsWith("http")?e:`https://${e}`;return`<a href="${t}" target="_blank">${t}</a>`}),t))):null}function p(e,t=null,a=!0){var n;let i=null==e?void 0:e.type;if(["messageDelete","delete"].includes(i)){let l=[{id:"you_deleted_a_message"}];return a||(l=t?[{id:"user_message_is_removed",user:t.full_name||t.user_name}]:[{id:"message_was_deleted"}]),l}return(null==e?void 0:e.message)?o(c(d((n=s(null==e?void 0:e.message),r()(n)),{mentions:[]}))):null}}}]);