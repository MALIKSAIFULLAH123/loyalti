"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-story-blocks-ReviewStoryBackground-Block"],{37145(e,t,r){r.d(t,{A:()=>B});var o=r(91557),i=r(84680),l=r(3556),n=r(8051),a=r(96540),d=r(14425),s=r.n(d),u=r(58156),c=r.n(u),h=r(62193),v=r.n(h),f=r(44562),g=r(40515),m=r(90243),p=r(85332),y=r(88316),w=r(26287),b=r(5605);let k=(0,w.Ay)({resolved:{},chunkName:()=>"reactDraggable",isReady(e){let t=this.resolve(e);return!0===this.resolved[t]&&!!r.m[t]},importAsync:()=>r.e("reactDraggable").then(r.t.bind(r,55794,23)),requireAsync(e){let t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){let t=this.resolve(e);return r(t)},resolve:()=>55794}),x="StoryReview",E=(0,l.Ay)("div",{name:x,slot:"root"})(({theme:e})=>({position:"relative",margin:"auto",height:"100%",display:"flex",justifyContent:"center",borderRadius:e.shape.borderRadius})),A=(0,l.Ay)("div",{name:x,slot:"StoryImageContainer",shouldForwardProp:e=>"width"!==e&&"height"!==e})(({theme:e,height:t,width:r})=>({height:t||"100%",width:r||"390px",position:"relative",overflow:"hidden",border:e.mixins.border("secondary"),borderColor:"#fff",borderRadius:e.shape.borderRadius})),R=(0,l.Ay)("div",{name:x,slot:"StoryImage"})(({theme:e})=>({height:"100%",width:"100%"})),S=(0,l.Ay)("div",{name:x,slot:"TextContent",shouldForwardProp:e=>"fontFamily"!==e&&"fontSize"!==e})(({theme:e,fontFamily:t,fontSize:r})=>({overflow:"hidden",position:"absolute",left:0,top:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",zIndex:1,fontWeight:e.typography.fontWeightRegular,fontSize:r?`${r}px !important`:"28px !important",wordBreak:"break-word",wordWrap:"break-word",color:"#fff",lineHeight:"normal","& a":{color:"#fff"},...t&&{fontFamily:t}})),F=(0,l.Ay)("img",{name:x,slot:"ImageUrl"})(({theme:e})=>({pointerEvents:"none",height:"100%",width:"100%"})),C=(0,l.Ay)("div",{name:x,slot:"BackgroundBlur"})(({theme:e})=>({filter:"blur(30px)",WebkitFilter:"blur(30px)",overflow:"hidden",padding:e.spacing(1.5),height:"100%",width:"100%",backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center",transform:"scale(2)"})),_=(0,l.Ay)(n.A,{name:x})(({theme:e})=>({position:"absolute",top:0,cursor:"move"}));function B(e){var t,r,l;let{i18n:d,eventCenter:u}=(0,o.PCX)(),[h,w]=a.useState({}),x=a.useRef(),B=a.useRef(),[P,I]=a.useState(!1),z=a.useRef(),[$,W]=a.useState({width:0,height:0}),[M,L]=a.useState(),[j,q]=a.useState({x:0,y:0}),{background:D,text:H,font_style:T,size:N}=h||{},U=(0,p.Ay)(),{setInit:V}=U||{},[X,Z]=(0,p.Uf)(x),O=a.useRef(),Q=a.useRef(),Y=null===(t=B.current)||void 0===t?void 0:t.getBoundingClientRect(),G=(null==Y?void 0:Y.height)/f.S1,J=()=>{var e;let t=null===(e=Q.current)||void 0===e?void 0:e.getBoundingClientRect(),r=(null==Y?void 0:Y.width)/2-(null==t?void 0:t.width)/2,o=(null==Y?void 0:Y.height)/2-(null==t?void 0:t.height)/2,i=100*r/X,l=100*o/Z;return{top:`${parseFloat(null==l?void 0:l.toFixed(2))}%`||0,left:`${parseFloat(null==i?void 0:i.toFixed(2))}%`||0}},K=e=>{if(v()(e))return{x:0,y:0};let t=(null==e?void 0:e.x)*100/X,r=(null==e?void 0:e.y)*100/Z;return{top:`${parseFloat(null==r?void 0:r.toFixed(2))}%`||0,left:`${parseFloat(null==t?void 0:t.toFixed(2))}%`||0}};if(a.useEffect(()=>{let e=u.on(f.ck,e=>{var t;let r=c()(e,"values"),o=c()(e,"form");if(I((null==o?void 0:o.isSubmitting)||!1),v()(r))return;let i=c()(e,"schema.elements.content.elements.basic.elements.background_id.options"),l=null===(t=i.find(e=>e.id===r.background_id))||void 0===t?void 0:t.value;w({...r,background:l})});return()=>u.off(f.ck,e)},[]),a.useEffect(()=>{let e=u.on(f.ck,e=>{let t=c()(e,"form");O.current=t});if(O.current){var t,r;let o=null===(t=Q.current)||void 0===t?void 0:t.getBoundingClientRect(),i=(null==o?void 0:o.width)?`${o.width/(X-2)*100}%`:"100%",l=[{text:H,fontFamily:T,fontSize:N,color:f.OT,textAlign:"center",width:i,transform:{rotation:0,scale:1,position:J()}}];null===(r=O.current)||void 0===r||r.setFieldValue("extra",{isBrowser:!0,transform:{position:K(j),rotation:0,scale:$.width/(null==M?void 0:M.width)},storyHeight:Z,texts:l,size:{width:null==M?void 0:M.width,height:null==M?void 0:M.height}})}return()=>u.off(f.ck,e)},[Z,H,T,N,$,M,j,X,Q.current]),a.useEffect(()=>{V(!0)},[]),v()(h))return null;let ee=()=>{var e,t;if(!z.current)return;let r=(null===(e=z.current)||void 0===e?void 0:e.naturalWidth)||0,o=(null===(t=z.current)||void 0===t?void 0:t.naturalHeight)||0,i=r/X,l={width:parseInt(r/i),height:parseInt(o/i)},n={x:0,y:(Z-l.height)/2};q(n),L({width:r,height:o}),W(l)},et=(null==$?void 0:$.width)?$.width:"100%",er=(null==$?void 0:$.height)?$.height:"100%";return a.createElement(i.eB,{testid:`preview ${null==h?void 0:h.resource_name}`},a.createElement(y.bQ,null),P?a.createElement(y.Cj,null):null,a.createElement(i.Tw,null,a.createElement(i.E9,null,d.formatMessage({id:"preview"}))),a.createElement(i.tD,null,a.createElement(E,{ref:x},a.createElement(A,{height:Z,width:X},a.createElement(R,{ref:B,id:f.Yo},a.createElement(C,{style:{backgroundImage:`url(${D})`}}),a.createElement(k,{key:D,position:j,disabled:!0},a.createElement(_,null,a.createElement(F,{key:D,ref:z,onLoad:ee,src:D,style:{width:et,height:er}}))),a.createElement(S,{fontFamily:T,fontSize:(N||f.FV)*G},a.createElement(n.A,{ref:Q},a.createElement(g.np,{mt:0,sx:{whiteSpace:"normal"}},a.createElement(m.Ay,{html:s()(H)||d.formatMessage({id:"start_typing"})})))))),!(null===(r=O.current)||void 0===r?void 0:null===(l=r.errors)||void 0===l?void 0:l.expand_link)&&(null==h?void 0:h.expand_link)&&a.createElement(b.A,{link:null==h?void 0:h.expand_link}))))}},10411(e,t,r){r.r(t),r.d(t,{default:()=>l});var o=r(91557),i=r(37145);let l=(0,o.WvA)({name:"StoryReview",extendBlock:i.A,defaults:{blockLayout:"Review Story"}})},5605(e,t,r){r.d(t,{A:()=>s});var o=r(91557),i=r(3556),l=r(96540),n=r(91262);let a=(0,i.Ay)(o.vxq,{name:"seeMoreLinkStory",slot:"SeeMoreLink",shouldForwardProp:e=>"isPreview"!==e})(({theme:e,isPreview:t})=>({...t&&{position:"absolute",left:"50%",bottom:16,transform:"translate(-50%, 0)"},color:"#fff",borderColor:"#fff",borderRadius:e.spacing(3),zIndex:3})),d=({link:e,sx:t,variant:r="outlined",fire:i,isPreview:d=!0})=>{let{i18n:s}=(0,o.PCX)();if(!e)return;let u=()=>{i&&i({type:"setForcePause",payload:n.ZR.No})},c=()=>{i&&i({type:"setForcePause",payload:n.ZR.Pause})};return l.createElement(a,{isPreview:d,to:e,variant:r,sx:t,onClick:c,onCancel:u},s.formatMessage({id:"visit_link"}))},s=d}}]);