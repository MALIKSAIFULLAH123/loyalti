"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chatplus-components-MsgAttachments-Wave-WaveFormAudio"],{97164(e,t,r){r.r(t),r.d(t,{default:()=>T});var n=r(91557),a=r(40515),i=r(3556),o=r(8051),l=r(81502),c=r(96540);let s=e=>e instanceof MouseEvent?e.clientX:e.touches[0].clientX;function d(e,t){let r=!1;return n=>{r||(e(n),r=!0,setTimeout(()=>r=!1,t))}}let u=e=>{let t=Math.floor(e/60),r=`0${Math.round(e-60*t)}`.slice(-2);return`${t}:${r}`},p=(e,t)=>u(t-t*e/100);var m=r(62193),h=r.n(m);let f=(0,i.Ay)(o.A,{name:"SvgShape",slot:"SvgShape",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",height:"50px",cursor:"pointer","& svg":{width:"100%","&  > rect":{fill:t?"#ffffff4d":"#0006",..."dark"===e.palette.mode&&{fill:"#fff6"}}}})),g=function(e){let{percent:t,isOwner:r,audioRef:a,duration:i,setProgress:o,isDraggingProgress:l,setIsDraggingProgress:u}=e||{},p=a.current||{},m=c.useRef(),{useTheme:g}=(0,n.PCX)(),v=g(),x=0,[y,E]=c.useState(0);c.useEffect(()=>{y&&o(y)},[y,o]);let w=e=>{var n,a;let i=(null===(n=document.getElementById("svg-shape"))||void 0===n?void 0:null===(a=n.children)||void 0===a?void 0:a.length)*2-1;return i&&0!==t&&100!==t&&Math.ceil(i*t/100/2)>=e?{fill:"dark"===v.palette.mode?"#fff":r?"#fff":"#000"}:{}},A=e=>{var t;let r=(null===(t=p.src)||void 0===t?void 0:t.indexOf("blob:"))!==0&&void 0===i;if(r&&(!p.src||!isFinite(p.currentTime)||!m.current))return{currentTime:0,currentTimePos:0};let n=m.current.getBoundingClientRect(),a=n.width,o=s(e)-n.left;o<0?o=0:o>a&&(o=a);let l=i*o/a;return{currentTime:l,currentTimePos:parseFloat((o/a*100).toFixed(2))}},b=d(e=>{let t=e.target;if(l.current)return;let{currentTime:r}=t;if(r===i){E(0);return}E(parseFloat((r/i*100||0).toFixed(2)))},0);c.useEffect(()=>{h()(p)||p.addEventListener("timeupdate",b,!1)},[p]);let P=e=>{e.stopPropagation();let{currentTime:t,currentTimePos:r}=A(e.nativeEvent);isFinite(t)&&(x=t,u(!0),E(r),e.nativeEvent instanceof MouseEvent?(window.addEventListener("mousemove",k),window.addEventListener("mouseup",L)):(window.addEventListener("touchmove",k),window.addEventListener("touchend",L)))},k=e=>{e instanceof MouseEvent&&e.preventDefault(),e.stopPropagation();let t=window.getSelection();if(t&&"Range"===t.type&&t.empty(),l.current){let{currentTime:r,currentTimePos:n}=A(e);x=r,E(n)}},L=t=>{t.stopPropagation();let r=x,{onChangeCurrentTimeError:n,onSeek:a}=e;if(a);else{let o={isDraggingProgress:!1};if(!h()(p)&&(p.readyState===p.HAVE_NOTHING||p.readyState===p.HAVE_METADATA||!isFinite(r)))try{p.load()}catch(l){return o.currentTimePos=0,n&&n(l)}if(p.readyState===p.HAVE_NOTHING||p.readyState===p.HAVE_METADATA||!isFinite(i))try{p.load()}catch(c){return}p.currentTime=r,u(o.isDraggingProgress),E(o.currentTimePos)}t instanceof MouseEvent?(window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",L)):(window.removeEventListener("touchmove",k),window.removeEventListener("touchend",L))};return c.createElement(f,{isOwner:r,onMouseDown:P,onTouchStart:P},c.createElement("svg",{ref:m,id:"svg-shape","aria-hidden":"true"},c.createElement("rect",{height:"14",rx:"3",width:"3",x:"0",y:"calc(50% - 7px)",style:w(1)}),c.createElement("rect",{height:"29",rx:"3",width:"3",x:"6",y:"calc(50% - 14.5px)",style:w(2)}),c.createElement("rect",{height:"43",rx:"3",width:"3",x:"12",y:"calc(50% - 21.5px)",style:w(3)}),c.createElement("rect",{height:"13",rx:"3",width:"3",x:"18",y:"calc(50% - 6.5px)",style:w(4)}),c.createElement("rect",{height:"35",rx:"3",width:"3",x:"24",y:"calc(50% - 17.5px)",style:w(5)}),c.createElement("rect",{height:"39",rx:"3",width:"3",x:"30",y:"calc(50% - 19.5px)",style:w(6)}),c.createElement("rect",{height:"6",rx:"3",width:"3",x:"36",y:"calc(50% - 3px)",style:w(7)}),c.createElement("rect",{height:"12",rx:"3",width:"3",x:"42",y:"calc(50% - 6px)",style:w(8)}),c.createElement("rect",{height:"19",rx:"3",width:"3",x:"48",y:"calc(50% - 9.5px)",style:w(9)}),c.createElement("rect",{height:"4",rx:"3",width:"3",x:"54",y:"calc(50% - 2px)",style:w(10)}),c.createElement("rect",{height:"44",rx:"3",width:"3",x:"60",y:"calc(50% - 22px)",style:w(11)}),c.createElement("rect",{height:"30",rx:"3",width:"3",x:"66",y:"calc(50% - 15px)",style:w(12)}),c.createElement("rect",{height:"22",rx:"3",width:"3",x:"72",y:"calc(50% - 10px)",style:w(13)}),c.createElement("rect",{height:"32",rx:"3",width:"3",x:"78",y:"calc(50% - 16px)",style:w(14)})))};function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}let x="WaveShape",y=(0,i.Ay)(o.A,{name:x,slot:"Root"})(({theme:e})=>({position:"relative",zIndex:2,overflow:"hidden",maxWidth:"85px"})),E=(0,i.Ay)(o.A,{name:x,slot:"Track",shouldForwardProp:e=>"left"!==e})(({theme:e,left:t,isDraggingProgress:r})=>({position:"absolute",display:"block",width:"4px",height:"44px",borderTopLeftRadius:"2px",borderTopRightRadius:"2px",borderBottomLeftRadius:"2px",borderBottomRightRadius:"2px",background:"#fff",transition:"all 200ms linear",top:"50%",transform:"translate(0, -50%)",left:t?`${t}%`:0,...r&&{transition:"none"}})),w=function({isOwner:e,progress:t,...r}){var n;return c.createElement(y,null,c.createElement(g,v({isOwner:e,percent:t},r)),0===t||100===t?null:c.createElement(E,{isDraggingProgress:null==r?void 0:null===(n=r.isDraggingProgress)||void 0===n?void 0:n.current,left:t}))},A="messageWaveForm",b=(0,i.Ay)(o.A,{name:A,slot:"root"})(({theme:e})=>({position:"relative",display:"flex",alignItems:"center",padding:e.spacing(0,1),paddingTop:e.spacing(1),"& .ico":{fontSize:18,cursor:"pointer"}})),P=(0,i.Ay)(o.A,{name:A,slot:"ButtonControlWrapper"})(({theme:e})=>({marginRight:e.spacing(1),position:"relative"})),k=(0,i.Ay)(o.A,{name:A,slot:"InfoWapper"})(({theme:e})=>({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minWidth:32,marginLeft:"auto"})),L=(0,i.Ay)(a.s4,{name:A,slot:"LineIcon",shouldForwardProp:e=>"disabled"!==e&&"isOwner"!==e})(({theme:e,disabled:t,isOwner:r})=>({color:r?"#fff !important":"#000",..."dark"===e.palette.mode&&{color:"#fff !important"},...t&&{color:`${e.palette.grey[500]}!important`}})),S=(0,i.Ay)(o.A,{name:A,slot:"playBackRate",shouldForwardProp:e=>"disabled"!==e})(({theme:e,disabled:t})=>({padding:e.spacing(.5,1),backgroundColor:"dark"===e.palette.mode?e.palette.grey["400"]:e.palette.grey["300"],borderRadius:e.shape.borderRadius,marginTop:e.spacing(1),color:"dark"===e.palette.mode?e.palette.text.primary:e.palette.text.secondary,WebkitUserSelect:"none",userSelect:"none"})),R=(0,i.Ay)(o.A,{name:A,slot:"SupportIosPlayer"})(({theme:e})=>({position:"absolute",left:0,right:0,bottom:0,top:0,zIndex:2})),T=function({url:e,isOwner:t,audioDuration:r,isPageAllMessages:a}){var i;let{useMediaPlaying:s}=(0,n.PCX)(),u=a?`msg-audio-all-${e}`:`msg-audio-${e}`,m=c.useRef(),[h,f]=s(u),[g,v]=c.useState(!1),[x,y]=c.useState(1),[E,A]=c.useState(0),T=c.useRef(!1),F=e=>T.current=e,C=r||(null===(i=m.current)||void 0===i?void 0:i.duration),[O,I]=c.useState(!1),D=/iPad|iPhone|iPod/.test(navigator.userAgent),[M,W]=c.useState(!1),_=(e=!1)=>{v(!0),e&&z()},$=()=>{if(!g){_(!0);return}f(!h),z()},B=()=>{_()},H=()=>{if(!g)return;let e=m.current.playbackRate;if(e>=2){m.current.playbackRate=.5,y(.5);return}m.current.playbackRate=e+.5,y(e+.5)},z=()=>{if(!m.current)return;m.current.error&&m.current.load();let e=m.current.play();e&&e.then(null).catch(e=>{m.current.play()})},N=c.useCallback(e=>{h||f(!0)},[f,h]),V=c.useCallback(e=>{h&&f(!1)},[f,h]),X=()=>{f(!1,!0),A(0)},j=d(e=>{let t=e.target;if(!t)return;let{currentTime:r}=t;if(T.current)return;let n=parseFloat((r/C*100||0).toFixed(2));A(n),T.current||0!==n&&100!==n||A(0)},0);c.useEffect(()=>{m.current&&(m.current.preservesPitch=!0,m.current.addEventListener("timeupdate",j))},[j]),c.useEffect(()=>{var e;if(!m.current||!g)return;let t=null===(e=m.current)||void 0===e?void 0:e.paused;h&&W(!0),(h||!t)&&(h?z():m.current.pause())},[h]),c.useEffect(()=>{try{fetch(e,{mode:"no-cors",headers:{"Access-Control-Allow-Origin":"*"}}).then(e=>e.blob()).then(t=>{m.current=new Audio(e),m.current.addEventListener("loadeddata",G),m.current.addEventListener("loadedmetadata",G)})}catch(t){if(m.current)return;m.current=new Audio(e),m.current.addEventListener("loadeddata",G),m.current.addEventListener("loadedmetadata",G)}return()=>{var e,t,r;null===(e=m.current)||void 0===e||e.pause(),f(!1,!0),null===(t=m.current)||void 0===t||t.removeEventListener("loadeddata",G),null===(r=m.current)||void 0===r||r.removeEventListener("loadedmetadata",G)}},[]);let G=()=>{O||setImmediate(()=>{I(!0),B(),m.current.addEventListener("play",N),m.current.addEventListener("pause",V),m.current.addEventListener("ended",X)})},U=()=>{$(),W(!0)};return c.createElement(b,null,O?null:c.createElement(o.A,{sx:{width:"100%",position:"absolute",left:0,right:0,bottom:0,top:0,zIndex:3}},c.createElement(l.A,null)),c.createElement(P,{onClick:$},h?c.createElement(L,{icon:"ico-pause",isOwner:t}):c.createElement(L,{icon:"ico-play",isOwner:t})),c.createElement(o.A,{position:"relative",flex:1,minWidth:0},c.createElement(w,{isOwner:t,progress:E,audioRef:m,duration:C,setProgress:A,isDraggingProgress:T,setIsDraggingProgress:F}),D&&!M?c.createElement(R,{onClick:U}):null),c.createElement(k,null,c.createElement("div",null,p(E,C)),h?c.createElement(S,{disabled:!g,onClick:H},x,"x"):null))}}}]);