(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chat-components-FlyChatRoomPanel-index"],{24713(e,t,n){var a=n(2523),i=n(15389),l=n(61489),r=Math.max;e.exports=function(e,t,n){var o=null==e?0:e.length;if(!o)return -1;var s=null==n?0:l(n);return s<0&&(s=r(o+s,0)),a(e,i(t,3),s)}},92322(e,t,n){"use strict";n.d(t,{A:()=>A});var a=n(8022),i=n(84680),l=n(40515),r=n(3556),o=n(96540),s=n(8051);let d="PreviewUploadFile",c=(0,r.Ay)("img",{name:d,slot:"previewImage"})(({theme:e})=>({borderRadius:e.spacing(1),maxWidth:"52px",width:"52px",height:"52px",marginRight:e.spacing(2),objectFit:"cover"})),m=(0,r.Ay)("div",{name:d,slot:"PreviewFile",shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({borderRadius:e.spacing(1),maxWidth:"150px",width:"150px",height:"52px",marginRight:e.spacing(2),fontSize:e.spacing(1.5),display:"flex",alignItems:"center",background:"light"===e.palette.mode?e.palette.background.default:e.palette.grey["500"],...t&&{maxWidth:"180px",width:"180px",overflowX:"hidden"}})),u=(0,r.Ay)("div",{name:d,slot:"IconFile"})(({theme:e})=>({borderRadius:"100%",maxWidth:"28px",width:"28px",height:"28px",margin:e.spacing(0,1),padding:e.spacing(0,1),color:e.palette.default.contrastText,background:"light"===e.palette.mode?e.palette.grey["500"]:e.palette.grey["700"],display:"inline-flex",justifyContent:"center",alignItems:"center"})),p=(0,r.Ay)("div",{name:d,slot:"closeButton"})(({theme:e})=>({position:"absolute",top:"-8px",right:"8px",cursor:"pointer",width:e.spacing(2.5),height:e.spacing(2.5),backgroundColor:e.palette.grey["500"],borderRadius:"50%",fontSize:e.mixins.pxToRem(8),justifyContent:"center",alignItems:"center",display:"inline-flex",opacity:.8,color:(e.palette.mode,e.palette.text.primary),"&:hover":{backgroundColor:e.palette.background.default,color:e.palette.text.primary,border:e.mixins.border("secondary")}})),g=(0,r.Ay)(l.mE)(({theme:e})=>({paddingRight:e.spacing(1),wordBreak:"break-word",p:{fontSize:e.mixins.pxToRem(13)}})),h=function({onRemove:e,file:t,isAllPage:n}){let a=t.type,i=["image/gif","image/jpeg","image/png"].includes(a),r=i?URL.createObjectURL(t):"";return o.createElement(s.A,{display:"inline-flex",position:"relative"},i?o.createElement(c,{src:r,alt:"Preview"}):o.createElement(m,{isAllPage:n},o.createElement(u,null,o.createElement(l.s4,{icon:"ico-paperclip-alt"})),o.createElement(g,{lines:2},t.name)),o.createElement(s.A,{position:"absolute",top:1,right:1},o.createElement(p,{"data-testid":"buttonRemove",onClick:e,"aria-label":"Close"},o.createElement(l.s4,{icon:"ico-close"}))))};var f=n(19740),v=n(62193),y=n.n(v);let x=(0,r.Ay)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({background:e.palette.background.paper,padding:e.spacing(2,1,0,1),display:"flex",overflow:"hidden",borderTop:e.mixins.border("secondary"),userSelect:"none",height:"85px",minHeight:"85px",...t&&{height:"90px",minHeight:"90px"}})),b=(0,r.Ay)("div")(({theme:e})=>({display:"flex",paddingTop:e.spacing(1),marginBottom:e.spacing(.5),paddingBottom:e.spacing(.5)})),w=(0,r.Ay)("div",{slot:"ButtonAdd"})(({theme:e})=>({marginRight:e.spacing(1),cursor:"pointer",span:{background:"light"===e.palette.mode?e.palette.background.default:e.palette.grey["500"],"&:hover":{background:e.palette.action.hover},borderRadius:e.spacing(1),maxWidth:"52px",width:"52px",height:"52px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:e.spacing(2.5)}})),A=o.forwardRef(function({filesUploadRef:e,isAllPage:t,rid:n},r){let s=(0,f.nb)(n),d=o.useRef(),c=o.useRef(),[m,u,p]=(0,a.A)({inputRef:c}),g=t=>{let n=[...m];if(t>-1&&(n.splice(t,1),u([...n]),e)){var a;null===(a=e.current)||void 0===a||a.removeFile(t)}};o.useImperativeHandle(r,()=>({attachFiles(e){(null==e?void 0:e.length)&&p(e)},clear(){u([])}}));let v=()=>{c.current.click()},A=()=>{v()},E=()=>{var e;if(!(null===(e=c.current)||void 0===e?void 0:e.files.length))return;let t=p(c.current.files);if(!t)return};return(o.useEffect(()=>{if(e){var t;null===(t=e.current)||void 0===t||t.attachFiles(m)}},[m.length]),y()(null==s?void 0:s.roomProgress)&&m&&(null==m?void 0:m.length))?o.createElement(x,{isAllPage:t},o.createElement(i.P,{autoHide:!1,autoHeight:!1,ref:d,style:{height:"auto"}},o.createElement(b,null,o.createElement(w,{onClick:A},o.createElement("span",null,o.createElement(l.s4,{icon:"ico-text-file-plus"}))),Object.values(m).map((e,n)=>o.createElement(h,{key:n,file:e,onRemove:()=>g(n),isAllPage:t})))),o.createElement("input",{"data-testid":"inputAttachPhoto",onChange:E,multiple:!0,ref:c,style:{display:"none"},type:"file",accept:"image/*"})):null})},83659(e,t,n){"use strict";n.d(t,{A:()=>h});var a=n(91557),i=n(3556),l=n(8051),r=n(62193),o=n.n(r),s=n(96540),d=n(94317),c=n(69709),m=n(19740);let u="ChatRoomPanel",p=(0,i.Ay)("div",{name:u})(({theme:e})=>({textAlign:"center",padding:e.spacing(2),color:"dark"===e.palette.mode?e.palette.text.primary:e.palette.grey["700"],fontSize:e.spacing(1.75)})),g=(0,i.Ay)("div",{name:u,slot:"noItemFound"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(1,2),color:e.palette.grey["600"],marginTop:e.spacing(2)})),h=s.forwardRef(function(e,t){let{searchMessages:n,setLoadingMsgs:i,loadingMsgs:r,oldScrollOffset:u,chatRoom:h,handleAction:f,rid:v}=e,{i18n:y,dispatch:x}=(0,a.PCX)(),b=s.useRef(),w=(0,m.iW)(v),{msgSearch:A}=h||{},E=s.useRef(),k=(0,s.useCallback)(({type:e="up"})=>{i(!0),x({type:"chat/room/search/loadHistory",payload:{roomId:v,mid:"up"===e?null==n?void 0:n.lastMsgId:null==n?void 0:n.msgNewest,operate:e,limit:c.xm},meta:{onSuccess(){i(!1)}}})},[v,null==n?void 0:n.lastMsgId,null==n?void 0:n.msgNewest]),C=e=>{if(o()(n)||(null==A?void 0:A.loading))return;let{endLoadmoreMessage:t,endTopLoadmoreMessage:a=!1,oldest:i,newest:l}=n||{};if(e.target.scrollTop<100&&!r){if(!i||a)return;u.current=e.target.scrollHeight-e.target.clientHeight,k({type:"up"});return}if(e.target.scrollHeight-e.target.scrollTop-50<=e.target.clientHeight&&!r){if(!l||t)return;u.current=e.target.scrollHeight-e.target.clientHeight,k({type:"down"})}};if(s.useImperativeHandle(t,()=>({handleScroll(e){C(e)}})),null==h?void 0:h.searching)return o()(n)?s.createElement(g,null,y.formatMessage({id:"no_results_found"})):s.createElement(l.A,{sx:{mt:2}},r?s.createElement(p,null,y.formatMessage({id:"loading_dots"})):null,s.createElement(d.A,{rid:v,groupIds:null==n?void 0:n.groupIds,groups:null==n?void 0:n.groups,newest:0,room:w,containerRef:b,disableReact:!0,showToolbar:!1,handleAction:f,ref:E,chatRoom:h}),r?s.createElement(p,null,y.formatMessage({id:"loading_dots"})):null);if(o()(n))return null;let _=(null==A?void 0:A.mode)!=="quote",M=(null==A?void 0:A.mode)==="quote";return s.createElement(s.Fragment,null,r?s.createElement(p,null,y.formatMessage({id:"loading_dots"})):null,s.createElement(d.A,{rid:v,groupIds:null==n?void 0:n.groupIds,groups:null==n?void 0:n.groups,newest:0,room:w,containerRef:b,disableReact:_,showToolbar:M,handleAction:f,ref:E,chatRoom:h}),r?s.createElement(p,null,y.formatMessage({id:"loading_dots"})):null)})},74046(e,t,n){"use strict";n.d(t,{qJ:()=>g,Zk:()=>S,wq:()=>f,WH:()=>A,aO:()=>_,xw:()=>q,qC:()=>K,$6:()=>N});var a,i,l=n(40515),r=n(3556),o=n(8051),s=n(60780),d=n(96540);let c=(0,r.Ay)("div",{name:"ChatDockFilter"})(({theme:e})=>({position:"relative"})),m=(0,r.Ay)(o.A,{name:"ChatDockFilter"})(({theme:e})=>({padding:e.spacing(1,1,1,2),display:"flex",flexDirection:"row",alignItems:"center"})),u=(0,r.Ay)(l.Gd,{name:"SearchWrapper"})(({theme:e})=>({"& input::placeholder, .ico":{color:e.palette.text.hint}})),p=(0,r.Ay)(s.A,{name:"ChatDockFilter"})(({theme:e})=>({marginLeft:e.spacing(.5)}));function g({placeholder:e,size:t,hide:n,label:a,disabled:i,valueSearch:l,onChangeSearch:r,onKeyUp:o,onSubmit:s,variant:g="direct",isShowButtonSubmit:h=!0,sx:f}){return n?null:d.createElement(c,null,d.createElement(m,{sx:f},d.createElement(u,{placeholder:e,onKeyUp:o,value:l,onChange:r}),h&&s?d.createElement(p,{disabled:i,size:"medium",color:"primary",variant:"text",onClick:s},a):null))}let h=(0,r.Ay)("div",{name:"ChatDockContent",slot:"root",shouldForwardProp:e=>"searching"!==e&&"collapsed"!==e})(({theme:e,searching:t,collapsed:n})=>({flex:1,maxHeight:"100%",position:"relative",paddingBottom:e.spacing(.75),...t&&{borderTop:"none"},...n&&{display:"none"},"&::-webkit-scrollbar":{height:"5px",width:"5px",background:"gray",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}})),f=d.forwardRef(function({children:e,searching:t,collapsed:n},a){return d.createElement(h,{ref:a,searching:t,collapsed:n},e)});var v=n(91557);let y="ChatDockFooter",x=(0,r.Ay)("div",{name:y,slot:"root",shouldForwardProp:e=>"isAllPageMessages"!==e})(({theme:e,isAllPageMessages:t})=>({position:"relative",display:"flex",minHeight:e.spacing(5),zIndex:2,backgroundColor:e.palette.background.paper,borderTop:e.mixins.border("secondary"),...t&&{minHeight:e.spacing(6)}})),b=(0,r.Ay)("div",{name:y,slot:"uiChatRoomFooter",shouldForwardProp:e=>"disable"!==e&&"isAllPageMessages"!==e})(({theme:e,disable:t,isAllPageMessages:n})=>({position:"relative",borderTop:e.mixins.border("secondary"),display:"flex",alignItems:"flex-end",minHeight:e.spacing(5),zIndex:2,flexFlow:"wrap",justifyContent:"center",...t&&{userSelect:"none",backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.background.paper},...n&&{minHeight:e.spacing(6)}})),w=(0,r.Ay)("div",{name:y,slot:"uiChatComposerContainer"})(({theme:e})=>({textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",padding:"4px 8px",color:e.palette.grey["500"]}));function A({children:e,searching:t,isBlocked:n,allowCompose:a}){let{i18n:i,usePageParams:l}=(0,v.PCX)(),r=l(),o=(null==r?void 0:r.isAllPageMessages)||!1;return t?null:n||!a?d.createElement(b,{disable:!0,isAllPageMessages:o},d.createElement(w,null,i.formatMessage({id:"you_can_not_send_message_in_this_conversation"}))):d.createElement(x,{isAllPageMessages:o},e)}var E=n(84058),k=n.n(E);let C=(0,r.Ay)("div",{shouldForwardProp:e=>"searching"!==e&&"addNewMembers"!==e})(({theme:e,searching:t,addNewMembers:n})=>({display:"flex",alignItems:"center",minHeight:e.spacing(7),padding:e.spacing(1.5,1.25,1.5,2),borderBottom:e.mixins.border("secondary"),...(t||n)&&{borderBottom:"none"}}));function _({children:e,onClick:t,searching:n,addNewMembers:a}){let i=d.useCallback(e=>{e.preventDefault(),t&&t()},[t]);return d.createElement(C,{"data-testid":k()("_chat Dock Header"),onClick:i,searching:n,addNewMembers:a},e)}let M="ChatDockPanel",I=(0,r.Ay)("div",{name:M,slot:"Root"})(({theme:e})=>({display:"flex",alignItems:"flex-end",marginLeft:e.spacing(2),width:"328px",zIndex:999})),R=(0,r.Ay)("div",{name:M,slot:"PanelStyled"})(({theme:e})=>({display:"flex",flexDirection:"column",zIndex:10,backgroundColor:e.mixins.backgroundColor("paper"),borderTopLeftRadius:e.shape.borderRadius/2,borderTopRightRadius:e.shape.borderRadius/2,boxShadow:"0 0 4px 0 rgba(0,0,0,0.2)",wordBreak:"break-word",wordWrap:"break-word",borderStartStartRadius:e.shape.borderRadius,borderStartEndRadius:e.shape.borderRadius,height:"455px",maxHeight:"calc(100vh - 60px)"})),P=(0,r.Ay)("div",{name:M,slot:"StageStyled"})(({theme:e})=>({width:"100%"})),S=d.forwardRef(function({children:e},t){return d.createElement(I,{ref:t},d.createElement(P,null,d.createElement(R,null,e)))});var O=n(95223),T=n(38221),F=n.n(T);let H="ChatSearchFilter",W=(0,r.Ay)("label",{name:H,slot:"OptionLabel",shouldForwardProp:e=>"optionChecked"!==e})(({theme:e,optionChecked:t})=>({width:"32px",height:"32px",display:"inline-flex",alignItems:"center",justifyContent:"center",margin:"0",color:"#a2a2a2",...t&&{color:e.palette.primary.main}})),D=(0,r.Ay)("input",{name:H,slot:"OptionInput"})(({theme:e})=>({display:"none"})),j=(0,r.Ay)(l.s4,{name:H,slot:"OptionIcon"})(({theme:e})=>({display:"inline-flex",alignItems:"center",marginTop:"1px",height:"14px",marginRight:"4px"})),B=(0,r.Ay)("div")(({theme:e})=>({display:"inline-flex"})),z=(0,r.Ay)(O.Ay)(({theme:e})=>({display:"flex",width:"100%","&.Mui-focused":{borderColor:e.palette.primary.main}})),$=(0,r.Ay)(o.A,{name:H,slot:"SearchWrapper"})(({theme:e})=>({margin:e.spacing(0,2,1,2),height:e.spacing(5),borderRadius:e.spacing(2.5),display:"flex",alignItems:"center",backgroundColor:e.palette.action.hover,"& input::placeholder, .ico":{color:e.palette.text.hint}}));function X({id:e,checked:t,icon:n,value:a,roomId:i,onClick:l}){let{dispatch:r}=(0,v.PCX)(),o=()=>{r({type:a,payload:{identity:i}}),"function"==typeof l&&l(t?void 0:e)};return d.createElement(W,{optionChecked:t},d.createElement(D,{type:"checkbox"}),d.createElement(j,{icon:n,onClick:o}))}let L=({placeholder:e,hide:t,options:n=[],roomId:a,searching:i=!1})=>{let{dispatch:r}=(0,v.PCX)(),s=(0,d.useRef)(null),c=(0,d.useRef)(null);(0,d.useEffect)(()=>{s.current="",c.current=null,g()},[i]);let m=e=>{s.current=e.target.value,g()},u=e=>{c.current=e,g()},p=(0,d.useCallback)(()=>{r({type:"chat/room/searchMessages",payload:{roomId:a,text:s.current}})},[r,a]),g=(0,d.useMemo)(()=>F()(p,200),[p]);return((0,d.useEffect)(()=>{var e;n.length&&(c.current=null===(e=n.find(e=>e.checked))||void 0===e?void 0:e.id)},[n]),(0,d.useEffect)(()=>{!t&&a&&r({type:"chat/room/clearMsgSearch",payload:{rid:a}})},[t,a]),t)?null:d.createElement(o.A,null,d.createElement($,null,d.createElement(z,{variant:"search",onChange:m,placeholder:e,startAdornment:d.createElement(l.s4,{icon:"ico-search-o"}),"aria-controls":"search_complete",endAdornment:d.createElement(o.A,null,n&&n.length?d.createElement(B,null,n.map(e=>d.createElement(X,{id:e.id,key:e.id.toString(),checked:null==e?void 0:e.checked,icon:e.icon,value:e.value,roomId:a,onClick:u}))):null)})))},N=(0,d.memo)(L);(a=i||(i={})).Direct="d",a.Private="p",a.Public="c",a.OnlyUser="u",n(52705);let Q=(0,r.Ay)("div")(({theme:e})=>({flex:1,fontWeight:"bold",display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"})),U=(0,r.Ay)("span",{shouldForwardProp:e=>"variant"!==e})(({theme:e,variant:t,type:n})=>({...e.typography.subtitle1,fontSize:"15px",lineHeight:e.spacing(2.375),...n===i.Direct&&{":hover":{cursor:"pointer",textDecoration:"underline"}},..."new_message"===t&&{fontSize:e.typography.pxToRem(18),":hover":{cursor:"auto",textDecoration:"none"}}}));function q({room:e,children:t,status:n,user:a,variant:l,isSelfChat:r=!1,loading:o=!1}){let{navigate:s}=(0,v.PCX)(),c=()=>{let t=a&&(a.username||a.user_name);(null==e?void 0:e.t)===i.Direct&&t&&s(`/${t}`)};return(null==e?void 0:e.t)===i.Direct?d.createElement(Q,{"data-testid":k()("_chat Dock Header title")},d.createElement(U,{onClick:c,type:null==e?void 0:e.t},t)):d.createElement(Q,{"data-testid":k()("_chat Dock Header title")},d.createElement(U,{type:null==e?void 0:e.t,variant:l},t))}var G=n(24713),V=n.n(G);let Z=(0,r.Ay)("div",{name:"ToolbarChat",slot:"root",shouldForwardProp:e=>"variant"!==e})(({theme:e,variant:t})=>({display:"flex",padding:"0",margin:"0",listStyle:"none","& .MuiActionMenu-menu":"roomPanel"===t&&{overflow:"auto",maxHeight:"200px","&::-webkit-scrollbar":{height:"5px",width:"5px",background:"transparent",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{margin:e.spacing(.5,0),borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}}}));function K({items:e,displayLimit:t=2,variant:n=null,handleAction:a}){var i,r,o;if(!Array.isArray(e))return null;if("roomPanel"===n){let s=t-1,c=e.filter((e,t)=>t<s||e.behavior),m=V()(c,{behavior:"more"});if(m>-1){if(null===(i=c[m].items)||void 0===i?void 0:i.length)c[m].as="dropdown";else{let u=e.filter((e,t)=>t>s-1&&!e.behavior);c[m]={...c[m],items:u,as:"dropdown"}}}return d.createElement(Z,{"data-testid":k()("_chat toolbar"),variant:n},d.createElement(l.c,{items:c,prefixName:"chatToolbar.item.",fallbackName:"button",handleAction:a}))}if("pageMessage"===n){let p=e.filter((e,t)=>e.behavior),g=V()(p,{behavior:"more"});if(g>-1){if(null===(r=p[g].items)||void 0===r?void 0:r.length)p[g].as="dropdown";else{let h=e.filter((e,t)=>!e.behavior);p[g]={...p[g],items:h,as:"dropdown"}}}return d.createElement(Z,{"data-testid":k()("_chat toolbar"),variant:n},d.createElement(l.c,{items:p,prefixName:"chatToolbar.item.",fallbackName:"button",handleAction:a,variant:n}))}let f=e.filter((e,n)=>n<t-1||e.behavior),v=V()(f,{behavior:"more"});if(v>-1){if(null===(o=f[v].items)||void 0===o?void 0:o.length)f[v].as="dropdown";else{let y=e.filter((e,n)=>n>t-2&&!e.behavior);f[v]={...f[v],items:y,as:"dropdown"}}}return d.createElement(Z,{"data-testid":k()("_chat toolbar")},d.createElement(l.c,{items:f,prefixName:"chatToolbar.item.",fallbackName:"button",handleAction:a}))}},90641(e,t,n){"use strict";n.r(t),n.d(t,{default:()=>O});var a=n(96540),i=n(74046),l=n(19740),r=n(96610),o=n(91557),s=n(84680),d=n(40515),c=n(67725),m=n(3556),u=n(8051),p=n(89481),g=n(84058),h=n.n(g),f=n(62193),v=n.n(f),y=n(94317),x=n(11247),b=n(92322),w=n(83659),A=n(69709);let E="FlyChatRoomPanel",k=(0,m.Ay)("div",{name:E,slot:"UIChatMsgStart"})(({theme:e})=>({textAlign:"center",padding:e.spacing(2,2,1),fontStyle:"italic",color:e.palette.text.primary,fontSize:e.spacing(1.75)})),C=(0,m.Ay)("div",{name:E,slot:"ReplyEditWrapper"})(({theme:e})=>({padding:e.spacing(.625,1.25),height:"50px",width:"100%",borderTop:e.mixins.border("secondary"),display:"flex",justifyContent:"space-between",backgroundColor:"dark"===e.palette.mode?e.palette.grey["600"]:e.palette.grey["100"]})),_=(0,m.Ay)(d.mE,{name:E,slot:"SelectedMsg"})(({theme:e})=>({color:e.palette.text.primary})),M=(0,m.Ay)(d.s4,{name:E,slot:"LineIconClose"})(({theme:e})=>({margin:e.spacing(1),cursor:"pointer",alignSelf:"center"})),I=(0,m.Ay)("div",{name:E,slot:"SelectedMsgAttachment"})(({theme:e})=>({fontSize:e.spacing(1.5),margin:e.spacing(.5,0),"& .ico":{marginRight:e.spacing(.5)}})),R=(0,m.Ay)("div",{name:E,slot:"ContentWrapper"})(({theme:e})=>({overflow:"hidden"})),P=(0,m.Ay)("div",{name:E,slot:"LoadingStyled"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",marginTop:e.spacing(3)})),S=(0,m.Ay)(i.$6,{name:"SearchWrapper"})(({theme:e})=>({"& input::placeholder, .ico":{color:e.palette.text.hint}})),O=a.memo(function({rid:e,collapsed:t,textDefault:n}){var m;let{i18n:g,useActionControl:f,dispatch:E,jsxBackend:O,useGetItem:T,getSetting:F,getAcl:H}=(0,o.PCX)(),W=H("chat.chat_message"),D=a.useRef(),j=a.useRef(),B=a.useRef(),z=a.useRef(),$=a.useRef(),X=(0,l.nb)(e),L=(0,l.iW)(e),[N]=f(e,{}),[Q,U]=(0,a.useState)("no_react"),[q,G]=(0,a.useState)(),[V,Z]=(0,a.useState)(void 0),[K,J]=(0,a.useState)(!1),Y=(null==V?void 0:V.other_members[0])||void 0,ee=T(Y),{user:et}=(0,o.wVH)(),en=T(null==q?void 0:q.user),ea=O.get("ChatSimpleComposer"),[ei,el]=a.useState(!1),er=a.useRef();a.useEffect(()=>{if(!(null==X?void 0:X.lastMsgId)||!er.current)return;let e=B.current.scrollHeight-B.current.clientHeight;B.current.scrollTop=0+(e-er.current),er.current=0},[null==X?void 0:X.lastMsgId]);let eo=a.useCallback(()=>{e&&E({type:"chat/room/markAsRead",payload:{identity:e}})},[e,E]);a.useEffect(()=>{e&&E({type:"chat/room/markAsRead",payload:{identity:e}})},[e]),a.useEffect(()=>{if(e)return J(!0),E({type:"chat/room/active",payload:e,meta:{onSuccess(e){Z(e),J(!1)},onFailure(){J(!1)}}}),()=>{E({type:"chat/room/inactive",payload:{rid:e}})}},[]);let es=a.useMemo(()=>{var e,t,n,a,i,l;return v()(null==X?void 0:X.msgSearch)||(null==X?void 0:null===(e=X.msgSearch)||void 0===e?void 0:e.mode)===A.Dn?null:(null==X?void 0:null===(t=X.msgSearch)||void 0===t?void 0:t.mQuoteId)?null==X?void 0:null===(l=X.searchMessages)||void 0===l?void 0:l[null==X?void 0:null===(i=X.msgSearch)||void 0===i?void 0:i.mQuoteId]:null==X?void 0:null===(a=X.searchMessages)||void 0===a?void 0:a[null==X?void 0:null===(n=X.msgSearch)||void 0===n?void 0:n.id]},[null==X?void 0:X.msgSearch,null==X?void 0:X.searchMessages]),ed=a.useMemo(()=>(null==X?void 0:X.searching)||!v()(es),[es,null==X?void 0:X.searching]),ec=null==X?void 0:X.messageFilter,em=!F("preaction"),eu=null==X?void 0:X.searching,ep=(0,l.In)(),eg=a.useMemo(()=>(0,c.Ue)(ep,{item:L}),[ep,L]),eh=t=>{if(null==X||!X.searching||v()(ec)){if(v()(es)&&t.target.scrollTop<100&&!ei){let{endLoadmoreMessage:n,lastMsgId:a}=X||{};if(!a||n)return;er.current=t.target.scrollHeight-t.target.clientHeight,el(!0),E({type:"chat/room/loadHistory",payload:{rid:e,lastMsgId:a},meta:{onSuccess(){el(!1)}}});return}(null==$?void 0:$.current)&&$.current.handleScroll(t)}},ef=a.useMemo(()=>(null==q?void 0:q.message)?(0,r.Nj)(null==q?void 0:q.message):"",[q]),ev=(e,t)=>{if(!e)return;let n=e.split(/.,| /);n.forEach(e=>{switch(e){case"chat/replyMessage":U("reply"),G(t);break;case"chat/editMessage":U("edit"),G(t)}})},ey=()=>{U("no_react"),G(void 0)},ex=()=>{if(ey(),ed){E({type:"chat/room/modeSearch",payload:{rid:e,mode:A.Dn},meta:{onSuccess(){setTimeout(()=>{(null==z?void 0:z.current)&&z.current.scrollToBottom()},300)}}});return}(null==z?void 0:z.current)&&z.current.scrollToBottom()};return a.createElement(i.Zk,null,a.createElement(i.aO,{searching:eu},a.createElement(i.xw,{loading:K,room:{...V,t:"d"},user:ee},null==V?void 0:V.name),a.createElement(i.qC,{items:eg,handleAction:N,variant:"roomPanel"})),a.createElement(S,{hide:!eu,roomId:e,placeholder:g.formatMessage({id:"search_messages_dots"}),size:30,searching:eu}),a.createElement(u.A,{"data-testid":h()("_chat Dock Content"),sx:{flex:1,minHeight:0}},a.createElement(s.P,{autoHide:!1,autoHeight:!0,autoHeightMax:"100%",ref:B,onScroll:eh},a.createElement(i.wq,{searching:eu,collapsed:t,ref:B},(K||(null==X?void 0:null===(m=X.msgSearch)||void 0===m?void 0:m.loading))&&a.createElement(P,{"data-testid":"loadingIndicator"},a.createElement(p.A,{size:24})),eu?a.createElement(x.A,{items:ec,room:V,disableReact:!0,handleAction:N}):ed?a.createElement(w.A,{setReactMode:U,setSelectedMsg:G,searchMessages:es,loadingMsgs:ei,setLoadingMsgs:el,oldScrollOffset:er,ref:$,chatRoom:X,rid:e,handleAction:ev}):a.createElement(a.Fragment,null,eu||K||!(null==X?void 0:X.endLoadmoreMessage)?null:a.createElement(k,{"ata-testid":h()("_chat Start of conversation")},g.formatMessage({id:"start_of_conversation"})),a.createElement(y.A,{rid:e,groups:null==X?void 0:X.groups,groupIds:null==X?void 0:X.groupIds,preFetchingMsg:null==X?void 0:X.preFetchingMsg,newest:null==X?void 0:X.newest,room:V,containerRef:B,disableReact:em,handleAction:ev,ref:z,loading:K,roomProgress:null==X?void 0:X.roomProgress,showToolbar:!(null==L?void 0:L.is_block),chatRoom:X}))))),"no_react"!==Q&&a.createElement(C,null,a.createElement(R,null,a.createElement("div",null,"reply"===Q?a.createElement(d.mE,{lines:1,variant:"body2"},g.formatMessage({id:"chat_reply_to_user_at_timestamp"},{user_name:null==en?void 0:en.full_name,is_owner:(null==et?void 0:et.id)===(null==en?void 0:en.id)?1:0})):g.formatMessage({id:"editing"})),v()(null==q?void 0:q.attachments)?a.createElement(_,{lines:1,dangerouslySetInnerHTML:{__html:ef}}):a.createElement(I,null,a.createElement(d.s4,{icon:"ico-paperclip-alt"}),a.createElement("span",null,g.formatMessage({id:"file_attachment"})," "))),a.createElement(M,{icon:"ico-close",onClick:ey})),a.createElement(b.A,{ref:D,filesUploadRef:j,rid:e}),a.createElement(i.WH,{searching:eu,isBlocked:null==L?void 0:L.is_block,allowCompose:null==W?void 0:W.create},a.createElement(ea,{rid:e,msgId:null==q?void 0:q.id,reactMode:Q,text:"edit"===Q?ef:n||"",onSuccess:ex,previewRef:D,ref:j,onMarkAsRead:eo})))},(e,t)=>e.rid===t.rid)},11247(e,t,n){"use strict";n.d(t,{A:()=>A});var a=n(91557),i=n(3556),l=n(62193),r=n.n(l),o=n(96540),s=n(58040),d=n(12561),c=n(20053),m=n(14088);let u="MsgItemFilter",p=(0,i.Ay)("div",{name:u,slot:"uiChatMsgItem"})(({theme:e})=>({maxWidth:"100%",overflow:"hidden"})),g=(0,i.Ay)("div",{name:u,slot:"uiChatMsgItemBody"})(({theme:e})=>({display:"flex"})),h=(0,i.Ay)("div",{name:u,slot:"ChatMsgItemBodyOuter"})(({theme:e})=>({maxWidth:"100%"}));function f({msgId:e,tooltipPosition:t="top",showToolbar:n=!0,room:i,disableReact:l,handleAction:r,firstIndex:s=!1}){let{jsxBackend:u,useSession:f,useGetItem:v,useActionControl:y}=(0,a.PCX)(),x=`chat.chatRooms.${null==i?void 0:i.id}.messageFilter.${e}`,b=v(x),{user:w}=f(),[A]=y(x,{});if(!b)return;let{id:E,attachments:k,reactions:C,type:_,created_at:M,user:I}=b||{},R=(null==w?void 0:w.id)===(null==I?void 0:I.id),P=(0,d.rb)(M),S=(0,d.rs)(k),O=(e,t,n)=>{A(e,t,n),r(e,b,n)};return o.createElement(p,{className:"uiChatMsgItem","data-id":E,"data-t":_},o.createElement(g,null,o.createElement(h,{className:(0,c.default)("uiChatMsgItemBodyOuter",{hasToolbar:n,"multi-image":S>1})},u.render({component:`chat.messageContent.${_}`,props:{message:b,isOwner:R,user:I,createdDate:P,msgType:_,tooltipPosition:s?"bottom":t,isSearch:!0,showActiveSearch:!1}}))),o.createElement(m.A,{identity:x,disabled:l,reactions:C,handleAction:O}))}let v="MessageFilter",y=(0,i.Ay)("div",{name:v,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isGroup"!==e})(({theme:e,isOwner:t,isAlert:n})=>({display:"flex",flexDirection:"row",padding:e.spacing(.5,2),...n&&{"&.uiChatMsgSetAvatar":{display:"none"},"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse"}})),x=(0,i.Ay)("div",{name:v,slot:"uiChatMsgSetAvatar"})(({theme:e})=>({marginRight:e.spacing(1)})),b=(0,i.Ay)("div",{name:v,slot:"noItemFound"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(1,2),color:e.palette.grey["600"]})),w=({disableReact:e,room:t,items:n,handleAction:i})=>{let{i18n:l}=(0,a.PCX)();return r()(n)?o.createElement(b,null,l.formatMessage({id:"no_results_found"})," "):o.createElement("div",null,n&&Object.values(n).map((n,a)=>o.createElement(y,{key:n.id.toString()},o.createElement(x,null,o.createElement(s.A,{user:n.user,size:32,showTooltip:!0})),o.createElement(f,{msgId:n.id,disableReact:e,room:t,handleAction:i,firstIndex:0===a}))))},A=w},58040(e,t,n){"use strict";n.d(t,{A:()=>c});var a=n(91557),i=n(40515),l=n(3556),r=n(97763),o=n(96540);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let d=(0,l.Ay)(({className:e,...t})=>o.createElement(r.A,s({},t,{classes:{popper:e}})))(({theme:e})=>({"& .MuiTooltip-tooltip":{"&.MuiTooltip-tooltipPlacementLeft":{marginRight:`${e.spacing(1)} !important`}}})),c=(0,o.memo)(function({identity:e,size:t=30,user:n,showTooltip:l=!1}){let{useGetItem:r}=(0,a.PCX)(),s=r(e);if(!n&&!s)return null;let c=l&&((null==n?void 0:n.full_name)||(null==s?void 0:s.full_name));return o.createElement(d,{title:c,placement:"left",arrow:!1,PopperProps:{popperOptions:{strategy:"fixed"}}},o.createElement("div",null,o.createElement(i.H8,{user:n||s,size:t,noLink:!0})))})},94317(e,t,n){"use strict";n.d(t,{A:()=>ef});var a=n(12561),i=n(91557),l=n(3556),r=n(8051),o=n(96540);let s=o.createContext(o.createRef());var d=n(58040),c=n(19740),m=n(14088),u=n(40515),p=n(60780),g=n(97763);let h="MsgActionMenu",f=(0,l.Ay)("div",{name:h,slot:"root"})(({theme:e})=>({"& .MuiActionMenu-menu":{overflow:"auto",maxHeight:"220px"}})),v=(0,l.Ay)(p.A,{name:h,slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.5),cursor:"pointer",minWidth:e.spacing(3),lineHeight:e.spacing(2.5)}));function y({identity:e,handleAction:t,scrollRef:n,items:a,placement:l="auto-start"}){let{ItemActionMenu:r,i18n:s}=(0,i.PCX)();return o.createElement(f,null,o.createElement(r,{items:a,placement:l,identity:e,handleAction:t,scrollRef:n,scrollClose:!0,popperOptions:{strategy:"fixed"},variantPopper:"hidden-outview",control:o.createElement(g.A,{title:s.formatMessage({id:"more"}),placement:"top"},o.createElement(v,{disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0,className:"uiChatItemBtn"},o.createElement(u.s4,{icon:"ico-dottedmore-vertical-o"})))}))}var x=n(18799),b=n(83445),w=n(44031),A=n(62193),E=n.n(A);let k="ChatReactListPopover",C=(0,l.Ay)(r.A,{name:k,slot:"ItemRoot",shouldForwardProp:e=>"active"!==e})(({theme:e,active:t})=>({padding:"4px",display:"flex",alignItem:"center",alignSelf:"center",...t&&{background:e.palette.grey["300"],padding:e.spacing(.5),borderRadius:e.spacing(1),width:34,height:34,display:"flex",alignItem:"center",justifyContent:"center",margin:e.spacing(.2)}})),_=(0,l.Ay)("img",{name:k,slot:"ItemImage"})(({theme:e})=>({width:27,height:27})),M=({item:e,onClick:t,active:n})=>o.createElement(C,{active:n,role:"button",onClick:t,"aria-label":e.title,"data-testid":"itemReaction"},o.createElement(g.A,{title:e.title},o.createElement(_,{src:e.src,draggable:!1,alt:e.title}))),I=function({onEmojiClick:e,unsetReaction:t,identity:n}){let{useSession:a,useReactions:l=w.a}=(0,i.PCX)(),r=l(),s=(0,c.wg)(n),{user:d}=a(),m=e=>{var t,n;if(E()(null==s?void 0:null===(t=s.reactions)||void 0===t?void 0:t[e]))return!1;let a=null==s?void 0:null===(n=s.reactions)||void 0===n?void 0:n[e].some(e=>e.user_name===d.user_name);return a},u=n=>{let a=m(n);a?t(n):e(n,null)};return o.createElement(C,{active:!1},r.map(e=>o.createElement(M,{key:e.id.toString(),onClick(){u(`:reaction_${e.id.toString()}:`)},item:e,active:m(`:reaction_${e.id}:`)})))},R=(0,l.Ay)(x.A)(({theme:e})=>({margin:0,padding:e.spacing(0,.5),maxHeight:"48px",display:"flex",alignItems:"center",whiteSpace:"nowrap"}));function P({onEmojiClick:e,multiple:t=!0,disabled:n,scrollRef:a,scrollClose:l,placement:r="top",label:s="react",control:d,identity:c,unsetReaction:m}){let{i18n:p}=(0,i.PCX)(),g=p.formatMessage({id:s}),[h,f]=o.useState(null),v=o.useRef(),[y,x]=o.useState(!1),w=o.useCallback(()=>{x(!1)},[]),A=o.useCallback(e=>{x(e=>!e),f(h?null:e.currentTarget)},[]),E=o.useCallback((n,a)=>{e&&e(n,a),t||x(!1)},[t,e]),k=o.useCallback(e=>{m&&m(e),x(!1)},[m]);return o.useEffect(()=>{if(y&&a&&a.current&&l){let e=()=>x(!1);return a.current.addEventListener("scroll",e),()=>{null==a||a.current.removeEventListener("scroll",e)}}},[y]),o.createElement(o.Fragment,null,o.createElement(u.qB,{excludeRef:v,onClickAway:w},o.createElement(d,{onClick:A,disabled:n,title:g,"data-testid":"buttonAttachEmoji",icon:"ico-smile-o"})),o.createElement(b.A,{ref:v,open:y,anchorEl:h,placement:r,role:"presentation",style:{zIndex:5e3}},o.createElement(R,{"data-testid":"dialogEmojiPicker"},o.createElement(I,{onEmojiClick:E,unsetReaction:k,identity:c}))))}function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let O=(0,l.Ay)(p.A,{name:"MsgEmojiPicker",slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.75),cursor:"pointer",minWidth:e.spacing(2.5),lineHeight:e.spacing(2.5)})),T=o.forwardRef(({title:e,...t},n)=>o.createElement(g.A,{title:e,placement:"top",PopperProps:{disablePortal:!0}},o.createElement(O,S({className:"uiChatItemBtn uiChatIconBtn",disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0},t,{ref:n}),o.createElement(u.s4,{icon:"ico-smile-o"}))));function F({handleAction:e,scrollRef:t,identity:n}){let a=o.useCallback((t,n=null)=>e("chat/messageReaction",{shortcut:t,unicode:n}),[e]),i=o.useCallback(t=>{e("chat/unsetReaction",{identity:n,shortcut:t})},[e]);return o.createElement(P,{size:"small",multiple:!1,onEmojiClick:a,unsetReaction:i,control:T,scrollRef:t,scrollClose:!0,identity:n})}function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let W=(0,l.Ay)("div",{name:"MsgToolbar",slot:"uiChatToolbar",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",justifyContent:"center",alignItems:"center",...!t&&{flexDirection:"row-reverse"}}));function D({items:e,disabled:t,disableReact:n,handleAction:a,identity:l,isOwner:r,...s}){let{useScrollRef:d}=(0,i.PCX)(),c=d();return t?null:o.createElement(W,{isOwner:r,className:"uiChatToolbar"},o.createElement(y,H({identity:l,items:e,scrollRef:c,handleAction:a},s)),n?null:o.createElement(F,{scrollRef:c,handleAction:a,identity:l}))}let j=(0,l.Ay)("div",{name:"UIMsgItemBody",slot:"RootStyled",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isShowReact"!==e})(({theme:e,isOwner:t,isAlert:n,isShowReact:a})=>({display:"flex","@media (hover: hover)":{"&:hover .uiChatItemBtn":{visibility:"visible"}},"@media (hover: none)":{".uiChatItemBtn":{visibility:"visible"}},[e.breakpoints.down("sm")]:{".uiChatItemBtn":{visibility:"visible"}},...t&&{flexDirection:"row-reverse"},...n&&{textAlign:"center",...a&&{justifyContent:"center"}}}));function B({children:e,isOwner:t,isAlert:n,isShowReact:a}){return o.createElement(j,{isOwner:t,isAlert:n,isShowReact:a},e)}let z=(0,l.Ay)("div",{name:"UIMsgItemBodyOuter",slot:"RootStyled",shouldForwardProp:e=>"isPageAllMessages"!==e&&"msgType"!==e&&"isMsgEdit"!==e&&"totalImage"!==e&&"totalImageQuote"!==e&&"msgContentType"!==e})(({theme:e,isPageAllMessages:t,msgType:n,isMsgEdit:a,totalImage:i,totalImageQuote:l,msgContentType:r})=>({minWidth:0,maxWidth:`calc(100% - ${a?"80px":"50px"})`,...i>1&&{width:"75%"},...1===i&&{width:"65%"},...("message_pinned"===n||"message_unpinned"===n)&&{width:"100%"},..."messageDeleted"===r&&{maxWidth:"calc(100% - 26px)"},...t&&{maxWidth:"65%",...("message_pinned"===n||"message_unpinned"===n)&&{maxWidth:1===l?"300px":"400px",width:"100%"},...1===i&&{maxWidth:"300px",width:"100%"},...i>1&&{width:"55%"},[e.breakpoints.down("sm")]:{maxWidth:`calc(100% - ${a?"80px":"50px"})`,...i>1&&{width:"75%"},...1===i&&{width:"60%"},...("message_pinned"===n||"message_unpinned"===n)&&{width:"75%"}}},..."messageDeleted"===n&&{width:"auto"}}));function $({children:e,isMsgEdit:t=!1,totalImage:n,isPageAllMessages:a,msgType:i,msgContentType:l,totalImageQuote:r}){if(e)return o.createElement(z,{isMsgEdit:t,msgContentType:l,totalImage:n,isPageAllMessages:a,msgType:i,totalImageQuote:r},e)}var X=n(55737);let L=(0,l.Ay)("div",{name:"MsgItem",slot:"uiChatMsgItem",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({...t&&{flexDirection:"row-reverse"},minHeight:"40px",marginBottom:e.spacing(.5)}));function N({msgId:e,authUser:t,showToolbar:n=!0,disableReact:l,handleAction:r,room:s,indexLast:d}){let{jsxBackend:u,usePageParams:p,useGetItem:g}=(0,i.PCX)(),h=(0,i.yX1)(),f=o.useRef(),v=`chat.entities.message.${e}`,y=g(v),x=(0,c.nb)(null==s?void 0:s.id),{msgSearch:b,msgNewest:w}=x||{},A=p(),E=(null==A?void 0:A.rid)||!1,[k]=(0,i.Vd3)(v,{}),{id:C,type:_,attachments:M,reactions:I,created_at:R,user:P}=y||{},S=(0,c.Dr)(),O=(0,a.Rt)(I,S),T=g(P),F=(null==t?void 0:t.id)===(null==T?void 0:T.id),H=(0,a.rb)(R),W=(0,a.M2)(_),{multiImageFile:j}=(0,X.Xc)(M);o.useEffect(()=>{if((null==b||!b.loading)&&f.current&&((null==b?void 0:b.mQuoteId)===(null==y?void 0:y.id)||(null==b?void 0:b.id)===(null==y?void 0:y.id))){var e,t,n,a;let{top:i}=null===(e=f.current)||void 0===e?void 0:e.getBoundingClientRect(),{top:l}=null===(t=h.current)||void 0===t?void 0:t.getBoundingClientRect();i-l>0&&i-l<(null===(n=h.current)||void 0===n?void 0:n.clientHeight)||h.current.scrollTo({top:null===(a=f.current)||void 0===a?void 0:a.offsetTop})}},[null==b?void 0:b.loading,null==b?void 0:b.id,null==b?void 0:b.mQuoteId,null==y?void 0:y._id]);let z=o.useMemo(()=>F?d&&w==C?"left-end":"left-start":d&&w==C?"right-end":"right-start",[F,d,w,C]);if(!y)return null;let N=(e,t,n)=>{k(e,t,n),r(e,y,n)},Q="messageDeleted"!==_;return o.createElement(L,{isOwner:F,"data-id":C,"data-t":_,"data-testid":C,ref:f},o.createElement(B,{isOwner:F,isAlert:W,isShowReact:Q},o.createElement($,{totalImage:null==j?void 0:j.length,isPageAllMessages:E,msgType:_},u.render({component:`chat.messageContent.${_}`,props:{message:y,isOwner:F,user:P,createdDate:H,msgType:_,tooltipPosition:"top"}})),Q&&!W&&o.createElement(D,{identity:v,handleAction:N,disabled:!n,disableReact:l,isOwner:F,placement:z})),Q&&o.createElement(m.A,{identity:v,disabled:!O,reactions:O,isOwner:F,handleAction:N}))}let Q="MsgSet",U=(0,l.Ay)("div",{name:Q,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:n})=>({display:"flex",flexDirection:"row",padding:e.spacing(.5,2),...n&&{"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse",padding:e.spacing(0,2)}})),q=(0,l.Ay)("div",{name:Q,slot:"uiChatMsgSetAvatar",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:n})=>({marginRight:e.spacing(1),display:"flex",alignItems:"flex-end",marginBottom:e.spacing(.75),...t&&{display:"none",flexDirection:"row-reverse"},...n&&{display:"none"},"& > span":{cursor:"default"}})),G=(0,l.Ay)("div",{name:Q,slot:"uiChatMsgSetBody",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({flex:1,minWidth:0,...t&&{flexDirection:"row-reverse"}}));function V({msgSet:e,disableReact:t,handleAction:n,showToolbar:a,room:l}){let{useSession:r,useGetItem:s}=(0,i.PCX)(),{user:c}=r(),m=s(null==e?void 0:e.user);if(!e)return;let{items:u}=e,p=(null==c?void 0:c.id)===m.id;return u&&u.length?o.createElement(U,{isOwner:p,className:`uiChatMsgSet ${p?"isOwner":""}`},o.createElement(q,{isOwner:p,className:"uiChatMsgSetAvatar"},o.createElement(d.A,{user:m,size:32,showTooltip:!0})),o.createElement(G,{className:"uiChatMsgSetBody"},u.map((e,i)=>o.createElement(N,{authUser:c,key:e.toString(),msgId:e,disableReact:t,handleAction:n,showToolbar:a,room:l,indexLast:i===u.length-1})))):null}function Z({msgGroup:e,disableReact:t,handleAction:n,showToolbar:a,room:i}){if(!e)return null;let{items:l}=e;return l?o.createElement("div",null,l.map((e,l)=>o.createElement(V,{msgSet:e,key:`k.0${l}`,disableReact:t,showToolbar:a,handleAction:n,room:i}))):null}var K=n(81502);let J=(0,l.Ay)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({"&:not(:first-of-type)":{marginTop:e.spacing(.75)},position:"relative",padding:e.spacing(1),maxWidth:"245px",backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},borderRadius:e.spacing(1.25),overflow:"hidden",...t&&{maxWidth:"400px",padding:e.spacing(1.25,1)}})),Y=(0,l.Ay)("div")(({theme:e})=>({display:"flex",alignItems:"center","& .ico":{marginRight:e.spacing(.75)}})),ee=(0,l.Ay)(u.mE)(({theme:e})=>({flex:1,minWidth:0,fontSize:e.mixins.pxToRem(12)})),et=(0,l.Ay)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({position:"absolute",bottom:0,left:0,right:0,padding:e.spacing(0,1),...t&&{span:{height:e.spacing(.75)}}})),en=function({count:e=1,files:t,progress:n=0,isAllPage:a=!1}){let{i18n:l}=(0,i.PCX)();if(t||t.length)return o.createElement(J,{isAllPage:a},o.createElement(Y,null,o.createElement(u.s4,{icon:"ico-paperclip-alt"}),o.createElement(ee,{lines:1},1===e?o.createElement(o.Fragment,null,l.formatMessage({id:"uploading_name"},{name:t[0].name})):l.formatMessage({id:"uploading_n_attachments"},{count:e}))),o.createElement(et,{isAllPage:a},o.createElement(K.A,{variant:"determinate",value:n})))};function ea(){return(ea=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let ei=(0,l.Ay)("div")(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"flex-end",marginBottom:e.spacing(.5),padding:e.spacing(.5,2)})),el=(0,l.Ay)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({display:"flex",flexDirection:"column",alignItems:"flex-end",width:"100%",...t&&{maxWidth:'calc(~"100% - 50px")'}})),er=function({data:e,eventInit:t,isAllPage:n=!1}){let a=Object.keys(e),i=a.map(t=>({id:t,...e[t]}));return(o.useEffect(()=>{t&&t()},[i]),i.length)?o.createElement(ei,null,o.createElement(el,{isAllPage:n},i.map(e=>o.createElement(en,ea({},e,{key:e.id,isAllPage:n}))))):null};var eo=n(96610),es=n(68536);let ed="MsgSet",ec=(0,l.Ay)("div",{name:ed,slot:"uiChatMsgSet"})(({theme:e})=>({display:"flex",flexDirection:"row-reverse",padding:e.spacing(0,2),opacity:.6,pointerEvents:"none"})),em=(0,l.Ay)("div",{name:ed,slot:"uiChatMsgSetBody",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({flex:1,minWidth:0,...t&&{flexDirection:"row-reverse"}})),eu=(0,l.Ay)("div",{name:ed,slot:"uiChatMsgItemMsg",shouldForwardProp:e=>"isOwner"!==e&&"isQuote"!==e})(({theme:e,isOwner:t,isQuote:n})=>({zIndex:2,minHeight:e.spacing(5),marginBottom:e.spacing(.5),borderRadius:e.spacing(1),fontSize:e.mixins.pxToRem(15),padding:e.spacing(1.25),backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},overflowWrap:"break-word","& a":{color:t?"#fff":e.palette.text.primary,textDecoration:"underline",cursor:"pointer",overflowWrap:"break-word"},...t&&{backgroundColor:e.palette.primary.main,color:"#fff !important"}})),ep=(0,l.Ay)("div",{name:ed,slot:"uiChatMsgItemBodyInnerWrapper"})(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"flex-end"}));function eg({item:e}){var t,n;let{useGetItems:a}=(0,i.PCX)();if(!e.text&&!e.dataQuote)return null;let l=null==e?void 0:null===(t=e.dataQuote)||void 0===t?void 0:t.attachments;return l&&"string"==typeof(null==l?void 0:l[0])&&(l=a(null==e?void 0:null===(n=e.dataQuote)||void 0===n?void 0:n.attachments)),o.createElement(ec,null,o.createElement(em,null,o.createElement(ep,null,E()(e.dataQuote)?null:o.createElement(es.A,{dataQuote:{...e.dataQuote,attachments:l},isOwner:!0}),e.text?o.createElement(eu,{isQuote:!1,isOwner:!0,className:"uiChatMsgItemMsg",dangerouslySetInnerHTML:{__html:(0,eo.Ay)(e.text)}}):null)))}let eh=(0,l.Ay)(r.A,{name:"Messages",slot:"DateTimeGroup"})(({theme:e})=>({textAlign:"center",color:e.palette.grey["600"],padding:e.spacing(1,0)})),ef=o.forwardRef(function({rid:e,groups:t,groupIds:n,preFetchingMsg:l,newest:r,disableReact:d,room:c,containerRef:m,handleAction:u,isAllPage:p,roomProgress:g,loading:h,showToolbar:f,chatRoom:v},y){let x=(0,i.yX1)(),[b,w]=o.useState(!1),A=o.useRef(!1),{msgSearch:k}=v||{},C=()=>{if(k&&(null==k?void 0:k.mQuoteId)||!(null==k?void 0:k.id)){let e=x.current.scrollHeight+10;x.current.scrollTo({top:e})}};return(o.useEffect(()=>{if(E()(k)&&!A.current&&b)return A.current=!0,setTimeout(()=>{C()},100),()=>{A.current=!1}},[e,b,h]),o.useEffect(()=>(w(!!(null==n?void 0:n.length)),()=>w(!1)),[null==n?void 0:n.length]),o.useLayoutEffect(()=>{if((null==k?void 0:k.mode)!=="quote"&&(null==x?void 0:x.current)&&r){let e=x.current;e.scrollHeight-e.scrollTop-110<=e.clientHeight&&C()}},[r,null==k?void 0:k.mode]),o.useImperativeHandle(y,()=>({scrollToBottom(){C()}})),c&&t)?o.createElement(s.Provider,{value:m},n.map((e,n)=>{var i,l;return o.createElement("div",{key:`k.0${n}`},t[e]&&(0,a.rb)(null===(i=t[e])||void 0===i?void 0:i.ts)?o.createElement(eh,null,(0,a.rb)(null===(l=t[e])||void 0===l?void 0:l.ts)):null,o.createElement(Z,{msgGroup:t[e],disableReact:d,showToolbar:f,handleAction:u,room:c}))}),E()(g)?null:o.createElement(er,{data:g,eventInit:C,isAllPage:p}),l?l.filter(e=>(null==e?void 0:e.isLoading)===!0).map(e=>o.createElement(eg,{key:e,item:e})):null):null})},15535(e,t,n){"use strict";n.d(t,{A:()=>s});var a=n(3556),i=n(37131),l=n(96540);function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let o=(0,a.Ay)("div",{name:"MsgAttachment",slot:"UIMsgAttachment",shouldForwardProp:e=>"isOwner"!==e&&"isAudio"!==e&&"isTypeFile"!==e&&"isOther"!==e})(({theme:e})=>({maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",paddingBottom:e.spacing(.5),marginTop:e.spacing(.25),overflow:"hidden"}));function s({item:e,isOwner:t,allowOpenPreview:n=!0}){let{is_image:a,image:s,file_name:d,download_url:c,file_size_text:m}=e;return l.createElement(o,{isOwner:t},l.createElement(i.A,r({isOwner:t,image:s,is_image:a,download_url:c,file_name:d,file_size_text:m},e,{allowOpenPreview:n})))}},37131(e,t,n){"use strict";n.d(t,{A:()=>C});var a=n(12561),i=n(3556),l=n(96540);let r="UIMsgAttachmentImgWrapper",o=(0,i.Ay)("div",{name:r,slot:"RootStyled"})(({theme:e})=>({position:"relative",width:"100%"})),s=(0,i.Ay)("figure",{name:r,slot:"MediaWrapper"})(({theme:e})=>({margin:0,display:"block"})),d=(0,i.Ay)("div",{name:r,slot:"ImgRatioWrapper",shouldForwardProp:e=>"isOwner"!==e&&"isPageAllMessages"!==e})(({theme:e,isOwner:t,isPageAllMessages:n})=>({width:"100%",minWidth:t?"200px":"180px",maxWidth:"100%",cursor:"pointer",...n&&{width:"300px",[e.breakpoints.down("sm")]:{width:t?"200px":"180px"}}}));function c({children:e,ratioImage:t,isPageAllMessages:n,isOwner:a}){return l.createElement(o,null,l.createElement(s,null,l.createElement(d,{isOwner:!!a,isPageAllMessages:n,style:{paddingBottom:`${t?100*t:100}%`}},e)))}let m="UIMsgAttachMultiImgWrapper",u=(0,i.Ay)("div",{name:m,slot:"RootStyled"})(({theme:e})=>({position:"relative",width:"100%"})),p=(0,i.Ay)("figure",{name:m,slot:"MediaWrapper"})(({theme:e})=>({margin:0,display:"block"})),g=(0,i.Ay)("div",{name:m,slot:"ImgRatioWrapper",shouldForwardProp:e=>"isPageAllMessages"!==e})(({theme:e,isPageAllMessages:t})=>({maxWidth:"100%",cursor:"pointer",marginBottom:"1px",width:"100%",height:"100%",...t&&{width:"100%",height:"100%"}}));function h({children:e,isPageAllMessages:t,ratioImage:n=1}){return l.createElement(u,null,l.createElement(p,null,l.createElement(g,{isPageAllMessages:t,style:{paddingBottom:`${n?100*n:100}%`}},e)))}var f=n(91557),v=n(67725);let y=(0,i.Ay)("img",{name:"MsgAttachmentImage"})(({theme:e})=>({position:"absolute",left:0,top:0,width:"100%",borderRadius:e.spacing(1),border:e.mixins.border("secondary")})),x=(e,t)=>{let n=new Image;n.src=t,n.onload=()=>{e({height:n.height,width:n.width})},n.onerror=t=>{e(t)}};function b({isOwner:e,image:t,download_url:n,file_name:a,id:i,allowOpenPreview:r=!0}){let{dispatch:o,usePageParams:s,assetUrl:d}=(0,f.PCX)(),m=s(),u=(null==m?void 0:m.rid)||!1,[p,g]=l.useState(null),h=(0,v.AE)(t,"500",d("photo.no_image")),b=(0,v.AE)(t,"origin",d("photo.no_image"));l.useEffect(()=>{h&&x(g,h)},[h]);let w=!!p&&p.height/p.width,A=()=>{r&&o({type:"chat/room/presentImageView",payload:{image:{id:"img0",src:b,download_url:n,is_image:!0,file_name:a,imageId:i}}})};return l.createElement(c,{isPageAllMessages:u,ratioImage:w,isOwner:e},l.createElement(y,{src:h,onClick:A,alt:a}))}let w=(0,i.Ay)("img",{name:"MsgAttachmentImage"})(({theme:e})=>({position:"absolute",left:0,top:0,width:"100%",objectFit:"cover",borderRadius:e.spacing(1),border:e.mixins.border("secondary"),height:"100%"}));function A({image:e,download_url:t,images:n,isOwner:a,file_name:i,keyIndex:r,id:o}){let{dispatch:s,usePageParams:d,assetUrl:c}=(0,f.PCX)(),m=d(),u=(null==m?void 0:m.rid)||!1,p=l.useMemo(()=>n&&n.length?n.map((e,t)=>{let n=(0,v.AE)(e.image,"origin",c("photo.no_image"));return{id:t,src:n,download_url:e.download_url,file_name:e.file_name,imageId:e.id}}):[],[n]),g=(0,v.AE)(e,"500",c("photo.no_image")),y=(0,v.AE)(e,"origin",c("photo.no_image")),x=()=>{s({type:"chat/room/presentImageView",payload:{image:{id:parseInt(r),src:y,download_url:t,file_name:i,imageId:o},images:p}})};return l.createElement(h,{isPageAllMessages:u},l.createElement(w,{src:g,onClick:x,alt:"dwq"}))}let E=(0,i.Ay)("div",{name:"MsgAttachmentMedia",slot:"TitleLink",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({borderRadius:e.spacing(1),fontSize:e.spacing(1.75),padding:e.spacing(1),overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",display:"inline-block",maxWidth:"100%",wordBreak:"break-word",wordWrap:"break-word",backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},...t&&{backgroundColor:e.palette.primary.main,color:"#fff"}})),k=(0,i.Ay)("div")(({theme:e})=>({display:"flex",alignItems:"center",cursor:"pointer","& .ico":{marginRight:e.spacing(1)}}));function C({isOwner:e,layout:t,totalImages:n,is_image:i,image:r,file_name:o,download_url:s,file_size_text:d,keyIndex:c,id:m,allowOpenPreview:u=!0}){return r&&"multi-image"===t?l.createElement(A,{images:n,file_name:o,image:r,download_url:s,isOwner:e,keyIndex:c,id:m,allowOpenPreview:u}):i&&r?l.createElement(b,{isOwner:e,image:r,file_name:o,download_url:s,id:m,allowOpenPreview:u}):i?null:l.createElement(E,{isOwner:e},l.createElement(k,{onClick:()=>(0,a.NK)(s)},l.createElement("i",{className:"ico ico-arrow-down-circle mr-1"}),o))}},55737(e,t,n){"use strict";n.d(t,{Ay:()=>v,Xc:()=>f,tr:()=>h});var a=n(91557),i=n(96540),l=n(15535),r=n(3556),o=n(37131);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let d="MsgAttachmentMultiMedia",c=(0,r.Ay)("div",{name:d,slot:"uiMsgImageAttachmentWrapper",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",alignItems:"center",flexWrap:"wrap",justifyContent:t?"flex-end":"flex-start",marginTop:e.spacing(.25),width:"100%",gap:e.spacing(.5)})),m=(0,r.Ay)("div",{name:d,slot:"uiMsgImageAttachmentItem"})(({theme:e})=>({flexBasis:`calc(100% / 3 - ${e.spacing(.5)})`}));function u({mediaItems:e,isOwner:t}){return i.createElement(c,{isOwner:t},e.map((n,a)=>i.createElement(m,{key:`k${a}`},i.createElement(o.A,s({},n,{keyIndex:a,layout:"multi-image",totalImages:e,isOwner:t})))))}var p=n(62193),g=n.n(p);let h=e=>{if(g()(e))return{multiImageFile:[],otherFile:[],attachments:[]};let t=[],n=[];return e.map(e=>{e.is_image?t.push(e):n.push(e)}),{multiImageFile:t,otherFile:n,attachments:e}},f=e=>{let{useGetItems:t}=(0,a.PCX)(),n=t(e)||[];if(g()(n))return{multiImageFile:[],otherFile:[],attachments:[]};let i=[],l=[];return n.map(e=>{e.is_image?i.push(e):l.push(e)}),{multiImageFile:i,otherFile:l,attachments:n}};function v({message:e,isOwner:t}){var n;let{multiImageFile:a,otherFile:r,attachments:o}=f(null==e?void 0:e.attachments);return(null===(n=e.attachments)||void 0===n?void 0:n.length)&&(a.length||r.length)?a.length>1?i.createElement(i.Fragment,null,i.createElement(u,{mediaItems:a,isOwner:t}),r.length?r.map((e,n)=>i.createElement(l.A,{item:e,key:`k${n}`,isOwner:t})):null):o.map((e,n)=>i.createElement(l.A,{item:e,key:`k${n}`,isOwner:t})):null}},68536(e,t,n){"use strict";n.d(t,{A:()=>S});var a=n(96610),i=n(91557),l=n(3556),r=n(87773),o=n(89481),s=n(8051),d=n(96540),c=n(40515),m=n(55737),u=n(15535),p=n(62193),g=n.n(p),h=n(12561),f=n(19740),v=n(69709),y=n(771);let x="MsgQuote",b=(0,l.Ay)("div",{name:x,slot:"RootMsg",shouldForwardProp:e=>"isOwner"!==e&&"isSearch"!==e})(({theme:e,isOwner:t,isSearch:n})=>({marginBottom:e.spacing(-2),marginLeft:e.spacing(1),marginRight:0,marginTop:e.spacing(.25),paddingBottom:e.spacing(3),maxWidth:"calc(100% - 8px)",display:"flex",flexDirection:"row",overflow:"hidden",border:e.mixins.border("secondary"),borderRadius:e.spacing(1),minHeight:"70px",position:"relative",...!n&&{cursor:"pointer"},"& a:not(.MuiAvatar-root)":{color:e.palette.text.primary,textDecoration:"underline",cursor:"pointer"},...t&&{color:e.palette.text.secondary,marginRight:e.spacing(1),marginLeft:0}})),w=(0,l.Ay)("div",{name:x,slot:"Author"})(({theme:e})=>({display:"flex",justifyContent:"flex-start",alignItems:"center","& .MuiAvatar-root":{fontSize:e.mixins.pxToRem(7)},strong:{padding:e.spacing(0,.5)}})),A=(0,l.Ay)("div",{name:x,slot:"MsgAttachmentFlex",shouldForwardProp:e=>"isAttachment"!==e})(({theme:e,isAttachment:t})=>({textAlign:"start",...t&&{maxWidth:"300px"}})),E=(0,l.Ay)(c.mE,{name:x,slot:"Text"})(({theme:e})=>({color:e.palette.text.secondary,margin:e.spacing(.5,0)})),k=(0,l.Ay)("div",{name:x,slot:"TextDelete"})(({theme:e})=>({margin:e.spacing(.5),marginLeft:0,fontStyle:"italic"})),C=(0,l.Ay)("div",{name:x,slot:"AttachmentInfo"})(({theme:e})=>({overflow:"hidden",margin:e.spacing(1,1,0,0)})),_=(0,l.Ay)("div")(({theme:e})=>({width:e.spacing(.5),height:"100%",backgroundColor:e.palette.grey["100"]})),M=(0,l.Ay)("div")(({theme:e})=>({width:e.spacing(3),minWidth:e.spacing(3),marginTop:e.spacing(1.5),display:"flex",justifyContent:"center",alignItems:"center"})),I=(0,l.Ay)(r.A)(({theme:e})=>({color:"light"===e.palette.mode?e.palette.grey.A200:e.palette.text.primary})),R=(0,l.Ay)(c.mE,{name:x,slot:"uiMsgAttachmentLink"})(({theme:e})=>({"& .ico":{fontSize:e.mixins.pxToRem(12),marginRight:e.spacing(.5)}})),P=(0,l.Ay)("div",{name:x,slot:"LoadingStyled"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",width:"100%",height:"100%",backgroundColor:(0,y.X4)(e.palette.background.paper,.7)}));function S({dataQuote:e,isOwner:t,isSearch:n=!1}){let{i18n:l,dispatch:r}=(0,i.PCX)(),p=(0,f.Zq)(null==e?void 0:e.room_id)||[],[y,x]=d.useState(!1),S=(0,f.nb)(null==e?void 0:e.room_id),{msgSearch:O}=S||{},{multiImageFile:T,attachments:F}=(0,m.tr)(null==e?void 0:e.attachments);if(!e)return null;let{user:H,message:W}=e,D=(0,h.R$)({msg:e,messagesDelete:p}),j=()=>{x(!1)},B=()=>{n||"messageDeleted"===D||y||(x(!0),r({type:v.H5,payload:{roomId:null==e?void 0:e.room_id,mid:null==e?void 0:e.id,limit:20,operate:"all",mode:"quote"},meta:{onSuccess:j}}))};return d.createElement(b,{isOwner:t,onClick:B,isSearch:n},!g()(O)&&y?d.createElement(P,{"data-testid":"loadingIndicator"},d.createElement(o.A,{size:20})):null,d.createElement(M,null,d.createElement(_,null)),d.createElement(C,null,H?d.createElement(w,null,d.createElement(I,{component:"h2",variant:"h5"},H.full_name||H.user_name)):null,d.createElement(A,{isAttachment:F.length},"messageDeleted"===D?d.createElement(k,null,l.formatMessage({id:"message_was_deleted"})):null,g()(W)||"messageDeleted"===D?null:d.createElement(E,{lines:1,dangerouslySetInnerHTML:{__html:(0,a.Ay)(W)}}),"messageDeleted"!==D&&F&&(null==F?void 0:F.length)?d.createElement(s.A,{sx:{mt:1}},T.length>1?d.createElement(E,{lines:1},l.formatMessage({id:"total_photo"},{value:T.length})):d.createElement(d.Fragment,null,F.map((e,n)=>d.createElement(d.Fragment,{key:`k${n}`},e.is_image&&e.image?d.createElement(u.A,{item:e,isOwner:t,allowOpenPreview:!1}):d.createElement(R,{lines:1},d.createElement(c.s4,{icon:"ico-paperclip-alt"}),e.file_name))))):null)))}},14088(e,t,n){"use strict";n.d(t,{A:()=>h});var a=n(91557),i=n(3556),l=n(96540),r=n(19740),o=n(85015),s=n.n(o);let d=(0,i.Ay)("span")(({theme:e})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:e.spacing(0,.25)})),c=(0,i.Ay)("img")(({theme:e})=>({width:15,height:15}));function m({id:e,users:t=[]}){let n=(0,r.Dr)();if(!e||!t.length)return null;let a=s()(e)&&e.split(":")[1].split("_")[1];if(!a||!n)return null;let i=n.find(e=>e.id===parseInt(a));return l.createElement(d,null,l.createElement(c,{src:null==i?void 0:i.src,draggable:!1,alt:null==i?void 0:i.title}))}let u=(0,i.Ay)("div",{shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",margin:0,padding:0,marginBottom:e.spacing(-.25),...t&&{flexDirection:"row-reverse"}})),p=(0,i.Ay)("span")(({theme:e})=>({marginLeft:e.spacing(.5),position:"relative",top:"-1px",fontSize:e.typography.pxToRem(14),height:e.spacing(2.5),fontWeight:e.typography.fontWeightRegular})),g=(0,i.Ay)("div")(({theme:e})=>({cursor:"pointer",color:e.palette.grey["800"],backgroundColor:e.palette.grey["50"],position:"relative",borderRadius:e.spacing(1),lineHeight:e.spacing(2.5),whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",padding:e.spacing(.5,.75),boxShadow:"0px 0px 15px 0px #00000026",transform:"translateY(-10px)",height:e.spacing(3),zIndex:2}));function h({identity:e,disabled:t,reactions:n,isOwner:i,handleAction:r}){let{dispatch:o,getSetting:s}=(0,a.PCX)(),d=!s("preaction"),c=()=>{o({type:"chat/presentReactionsList",payload:{identity:e}})};if(d||t||!n||!Object.keys(n).length)return null;let h=0,f=Object.keys(n).reduce((e,t)=>{var a;return h+=null===(a=n[t])||void 0===a?void 0:a.length,{...e,[t]:n[t]}},{});return l.createElement(u,{isOwner:i},l.createElement(g,{onClick:c},Object.keys(f).slice(0,3).map((e,t)=>l.createElement(m,{id:e,users:f[e],key:`k${t}`})),l.createElement(p,null,h)))}},19740(e,t,n){"use strict";n.d(t,{nb:()=>o,Zq:()=>s,iw:()=>r,In:()=>p,f3:()=>m,EH:()=>c,wg:()=>d,eL:()=>u,Dr:()=>l.A,iW:()=>g,oT:()=>h});var a=n(71468),i=n(99477),l=n(44031);function r(){return(0,a.d4)(e=>(0,i.Tr)(e))}let o=e=>(0,a.d4)(t=>(0,i.rS)(t,e)),s=e=>(0,a.d4)(t=>(0,i.vF)(t,e));function d(e){return(0,a.d4)(t=>(0,i.Ax)(t,e))}let c=()=>(0,a.d4)(i.x2),m=()=>(0,a.d4)(i.yr),u=()=>(0,a.d4)(i.Eq),p=()=>(0,a.d4)(i.pR),g=e=>(0,a.d4)(t=>(0,i.gQ)(t,e)),h=()=>(0,a.d4)(i.t8)},8022(e,t,n){"use strict";n.d(t,{A:()=>s});var a=n(91557),i=n(96540),l=n(62193),r=n.n(l),o=n(67725);function s(e){let{initialValues:t,messageAcceptFail:n,inputRef:l}=e||{},{dialogBackend:s,i18n:d,getSetting:c}=(0,a.PCX)(),[m,u]=i.useState(t||[]),p=i.useRef(!1),g=c("core.attachment.maximum_file_size_each_attachment_can_be_uploaded"),h=c("core.attachment.maximum_number_of_attachments_that_can_be_uploaded"),f=()=>{(null==l?void 0:l.current)&&(l.current.value=null)},v=(e,t=!1)=>{if(r()(e))return;let a=[],i=[],l=(t?0:m.length)+(null==e?void 0:e.length);if(h<l){s.alert({title:"Oops!",message:d.formatMessage({id:"could_not_select_more_than_limit_files"},{limit:h})});return}for(let c=0;c<e.length;++c){let v=e[c],y=v.size,x={file_name:v.name,file_size:v.size,file_type:v.type,file:v};if(!(0,o.HH)(null==v?void 0:v.type,"image/*")){s.alert({message:n||d.formatMessage({id:"file_accept_type_fail"})}).then(()=>p.current=!1).catch(()=>p.current=!1),p.current=!0,f();break}y>g&&0!==g?(x.max_size=g,i.push(x)):a.push(x.file)}if(!p.current){if(a.length&&u([...m||[],...a]),i.length>0){var b;s.alert({message:1===i.length?d.formatMessage({id:"warning_upload_limit_one_file"},{fileName:(0,o.Tu)(i[0].file_name,30),fileSize:(0,o.lT)(i[0].file_size),maxSize:(0,o.lT)(null===(b=i[0])||void 0===b?void 0:b.max_size)}):d.formatMessage({id:"warning_upload_limit_multi_image"},{numberFile:i.length,photoMaxSize:(0,o.lT)(g)})}),f();return}return f(),!0}};return[m,u,v]}},44031(e,t,n){"use strict";n.d(t,{A:()=>r,a:()=>d});var a=n(91557),i=n(71468),l=n(1081);function r(){let{getSetting:e}=(0,a.PCX)(),t=e("preaction.reaction_list",[]).filter(e=>e.is_active),n=e("preaction.inactive_reaction_list",[]),i=[...t,...n];return(null==i?void 0:i.length)?i:[]}let o=e=>(e.preaction.data.reactions||[]).filter(e=>e.is_active),s=(0,l.Mz)(o,e=>e);function d(){return(0,i.d4)(s)}},96610(e,t,n){"use strict";n.d(t,{Ay:()=>u,Nj:()=>m,XC:()=>p});var a=n(69709),i=n(12561),l=n(14425),r=n.n(l);function o(e){return e.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2")}function s(e,t={}){let{mentions:n=[]}=t,a=e.replace(/\[(\s)*\]\(([^\)]+)\)/gm,"");return n&&n.length>0&&(a=a.replace(/@([^\s\\#@:]+)/giu,(e,t)=>{let a=n.find(e=>e.username===t);return a&&a.name?`@${a.name}`:e})),a}function d(e,t={}){let{mentions:n=[]}=t,a=e.replace(/@\[([^\]]+)\]\(([^#@:]+)\)/giu,"<a onclick=\"triggerClick('$2')\">@$1</a>");return n&&n.length>0&&(a=a.replace(/@([^\s\\#@:]+)/giu,(e,t)=>{let a=n.find(e=>e.username===t);return a&&a.name?`<a onclick="triggerClick('/${t}')">@${a.name}</a>`:e})),a}window.triggerClick=i.NK;let c=e=>e.replace(/:\w+:/gi,e=>e),m=(e,t={})=>e?s(e,t):null;function u(e,t={}){var n;return e?o(c(d((n=s(e),r()(n)).replace(a._t,e=>{let t=e.startsWith("http")?e:`https://${e}`;return`<a href="${t}" target="_blank">${t}</a>`}),t))):null}function p(e,t=null,n=!0){var a;let i=null==e?void 0:e.type;if(["messageDelete","delete"].includes(i)){let l=[{id:"you_deleted_a_message"}];return n||(l=t?[{id:"user_message_is_removed",user:t.full_name||t.user_name}]:[{id:"message_was_deleted"}]),l}return(null==e?void 0:e.message)?o(c(d((a=s(null==e?void 0:e.message),r()(a)),{mentions:[]}))):null}}}]);