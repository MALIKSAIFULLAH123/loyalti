"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-core-blocks-ListingOnMap-Block"],{92718(e,t,a){a.r(t),a.d(t,{default:()=>W});var o=a(91557),n=a(40515),l=a(3556),i=a(18799),r=a(83445),s=a(84475),c=a(54358),d=a(97763),g=a(15292),p=a(8051),u=a(52705),m=a(84058),h=a.n(m),f=a(58156),v=a.n(f),y=a(96540),w=a(78106),x=a(67725),E=a(61769),k=a(84680),b=a(71468),A=a(86663),S=a(50305);let C=(0,l.Ay)("div",{name:"titleStyled"})(({theme:e})=>({color:e.palette.grey[700]})),R=(0,l.Ay)("div")(({theme:e})=>({position:"absolute",right:e.spacing(7.5),top:e.spacing(1.2),backgroundColor:"#ffffff",height:e.spacing(5),borderRadius:e.spacing(1),'[dir="rtl"] &':{right:"inherit",left:e.spacing(7.5)},"& .MuiInputBase-root":{width:"320px",height:"40px !important",borderRadius:e.spacing(1)},"& input":{padding:e.spacing(1.75,1.75),color:"black",marginRight:e.spacing(3)},"& input::placeholder":{color:e.palette.grey[700]},[e.breakpoints.down("sm")]:{position:"absolute!important",top:"-50px",width:"calc(100% - 32px)!important",left:e.spacing(2),"& .MuiInputBase-root":{width:"100%!important"},marginRight:e.spacing(2)}})),$=(0,l.Ay)("span")(({theme:e})=>({paddingLeft:e.spacing(1),color:e.palette.text.secondary})),_=(0,l.Ay)("span")(({theme:e})=>({color:e.palette.text.primary})),B=(0,l.Ay)(n.s4)(({theme:e})=>({color:e.palette.text.secondary,fontSize:e.mixins.pxToRem(13),paddingRight:e.spacing(1)})),z=(0,l.Ay)("div")(({theme:e})=>({flexDirection:"row",alignItems:"center",padding:e.spacing(1,1),whiteSpace:"nowrap",fontSize:e.mixins.pxToRem(15),cursor:"pointer","&:hover":{backgroundColor:e.palette.action.focus},overflow:"hidden",textOverflow:"ellipsis",WebkitBoxOrient:"vertical",WebkitLineClamp:1})),F=(0,l.Ay)(i.A)(({theme:e})=>({padding:e.spacing(1,1),marginTop:"0px"})),I=(0,l.Ay)(r.A)(({theme:e})=>({zIndex:1e3,width:"320px",maxHeight:"300px",overflowY:"auto",[e.breakpoints.down("sm")]:{width:"100%"}})),M=(0,l.Ay)("div")(({theme:e})=>({position:"absolute",top:"50%",right:0,transform:"translate(-14px, -50%)",cursor:"pointer",color:e.palette.grey.A700})),O=(0,l.Ay)("div")(({theme:e})=>({display:"block",position:"relative","& .map":{backgroundColor:e.palette.action.focus,height:"100%",width:"100%",position:"absolute",top:0,left:0},"& .gm-ui-hover-effect":{background:"white !important",width:"20px !important",height:"20px !important",right:"2px !important","& span":{margin:"0 !important"}},"& .gm-style-iw + button":{display:"none"}})),W=(0,o.WvA)({extendBlock:function({fixedView:e}){let t=(0,o.alo)(),a=y.useRef(),[l,i]=y.useState(""),{usePageParams:r,navigate:m,dispatch:f,assetUrl:W,i18n:L,usePreference:P}=(0,o.PCX)(),V=r(),{appName:T}=V,H=(0,b.d4)(e=>v()(e,`${T}.${T}Active`)),N=(0,o.IgF)(T,T,"viewItemsOnMap"),Z=(0,x.FI)(V,null==N?void 0:N.apiRules),{search:q}=(0,w.zy)(),D=(0,y.useMemo)(()=>new URLSearchParams(q),[q]),G=y.useRef(),K=y.useRef(),U=(0,b.d4)(e=>(0,o.qRQ)(e,`${null==N?void 0:N.apiUrl}?${A.stringify(Z)}`)),Q=(0,b.d4)(e=>(0,o.OG_)(e,null==U?void 0:U.ids)),{userLanguage:X}=P(),Y=o.uO7,{isLoaded:j}=(0,E.RH)({googleMapsApiKey:Y,libraries:["places"],language:X||o.mg_}),[J,ee]=y.useState([]),[et,ea]=y.useState({loading:!1,error:!1}),[eo,en]=y.useState(!1),el=e=>{let t=e.address.search(","),a={address:e.address.slice(0,t)===e.name?`${e.address}`:`${e.name}, ${e.address}`,lat:e.lat,lng:e.lng};en(!1),i(a.address),er({lat:e.lat,lng:e.lng})},[ei,er]=(0,y.useState)({lat:(parseFloat(D.get(S._x))+parseFloat(D.get(S.gz)))/2||0,lng:(parseFloat(D.get(S.C0))+parseFloat(D.get(S.o6)))/2||0}),[es,ec]=(0,y.useState)(null),ed=(0,y.useMemo)(()=>null==es?void 0:es.getZoom().toString(),[es]),eg=(0,y.useMemo)(()=>parseInt(D.get(S.c2))||ed||15,[D.get(S.c2),ed]),ep=y.useCallback(e=>{ec(e);try{K.current=new google.maps.Geocoder,K.current.geocode({location:ei}).then(e=>{e.results[0]?i(e.results[0].formatted_address):i("")})}catch(t){}D.get(S._x)||navigator.geolocation.getCurrentPosition(e=>{er({lat:e.coords.latitude,lng:e.coords.longitude})},()=>{}),G.current=new google.maps.places.PlacesService(e)},[]),eu=(0,y.useRef)(null),em=(0,o.Woi)(eu).style,eh=e=>{i(e),en(!0)},ef=y.useCallback(e=>{G.current&&(null==e?void 0:e.query)&&(ea(e=>({...e,loading:!0})),G.current.textSearch(e,(e,t)=>{"OK"===t&&(ee(e.map(e=>({icon:e.icon,name:e.name,address:e.formatted_address,lat:e.geometry.location.lat(),lng:e.geometry.location.lng()}))),ea(e=>({...e,loading:!1})))}))},[l]);y.useEffect(()=>{ef({query:l})},[l]),(0,y.useEffect)(()=>{l&&ev()},[ei]);let ev=()=>{if(j&&es){let e=es.getBounds().getSouthWest().lng(),t=es.getBounds().getNorthEast().lng(),a=es.getBounds().getSouthWest().lat(),o=es.getBounds().getNorthEast().lat();D.set(S.C0,t.toString()),D.set(S.gz,o.toString()),D.set(S._x,a.toString()),D.set(S.o6,e.toString()),D.set(S.c2,es.getZoom().toString()),m({search:D.toString()},{replace:!0})}},ey=()=>{eE(),setTimeout(()=>{ev()},200)},ew=e=>{let t=document.getElementById(e);t.scrollIntoView(!1),e!==H&&f({type:`${T}/hover`,payload:e})},ex=()=>{eE(),q&&setTimeout(()=>{ev()},200)},eE=()=>{f({type:`${T}/hover`,payload:""})};if((0,y.useEffect)(()=>()=>{eu.current=null},[]),(0,y.useEffect)(()=>{(null==U?void 0:U.loading)&&eE()},[null==U?void 0:U.loading]),!j)return;let ek={url:W(`${T}.map_marker_hover`),scaledSize:new google.maps.Size(52,52)},eb={url:W(`${T}.map_marker`),scaledSize:new google.maps.Size(44,44)},eA=()=>{navigator.geolocation.getCurrentPosition(e=>{er({lat:e.coords.latitude,lng:e.coords.longitude})},()=>{})};return y.createElement(k.eB,null,y.createElement(O,{"data-testid":"mapSearchView",ref:eu},y.createElement("div",{style:e?{...em,...t?{top:180}:{}}:{position:"static",height:"0",paddingBottom:"100%"}},j?y.createElement(E.u6,{mapContainerStyle:{},center:ei,zoom:eg,onLoad:ep,mapContainerClassName:"map",onDragEnd:ey,onZoomChanged:ex,options:{gestureHandling:"cooperative"}},Q.map(({id:e,title:t,location:a})=>y.createElement(E.pH,{icon:H===`${T}Active${e}`?ek:eb,key:e,position:{lat:parseFloat(null==a?void 0:a.lat),lng:parseFloat(null==a?void 0:a.lng)},onClick:()=>ew(`${T}Active${e}`)},H===`${T}Active${e}`?y.createElement(E.Fu,{position:{lat:parseFloat(null==a?void 0:a.lat),lng:parseFloat(null==a?void 0:a.lng)},onCloseClick:()=>eE()},y.createElement(C,null,t)):null))):null,y.createElement(s.A,{onClickAway:()=>en(!1)},y.createElement("div",null,y.createElement(R,null,y.createElement(c.A,{sx:{width:"100%"},inputRef:a,onChange:e=>eh(e.target.value),value:l,inputProps:{"data-testid":h()("field")},placeholder:L.formatMessage({id:"search_by_location"})}),y.createElement(d.A,{title:L.formatMessage({id:"your_location"}),placement:"bottom"},y.createElement(M,{onClick:eA},y.createElement(n.s4,{icon:"ico-target-o"})))),y.createElement(I,{open:eo,anchorEl:a.current,placement:"bottom-start",sx:{borderRadius:1}},y.createElement(F,null,y.createElement(g.A,{in:eo},et.loading?y.createElement(p.A,null,y.createElement(u.A,{animation:"wave",height:30,width:"100%"}),y.createElement(u.A,{animation:"wave",height:30,width:"100%"}),y.createElement(u.A,{animation:"wave",height:30,width:"100%"})):J.map(e=>y.createElement(z,{key:e.lat,onClick:()=>el(e)},y.createElement(B,{icon:"ico-checkin"}),y.createElement(_,null,e.name),y.createElement($,null,e.address)))))))))))},defaults:{fixedView:!0},custom:{fixedView:{name:"fixedView",component:"Checkbox",label:"Layout fixed",fullWidth:!0,checkedValue:!0}}})}}]);