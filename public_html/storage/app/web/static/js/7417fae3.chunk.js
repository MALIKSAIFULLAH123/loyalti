(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chatplus-components-FlyChatRoomPanel-index"],{72761(e,t,r){"use strict";r.d(t,{A:()=>w});var o=r(98587),n=r(58168),l=r(96540),a=r(20053),i=r(5004),s=r(75659),c=r(38413),d=r(31609);function u(e){return(0,d.A)("MuiBadge",e)}(0,c.A)("MuiBadge",["root","badge","invisible"]);var g=r(99977),m=r(74848);let v=["badgeContent","component","children","invisible","max","slotProps","slots","showZero"],h=e=>{let{invisible:t}=e;return(0,s.A)({root:["root"],badge:["badge",t&&"invisible"]},u,void 0)},p=l.forwardRef(function(e,t){let{component:r,children:l,max:a=99,slotProps:s={},slots:c={},showZero:d=!1}=e,u=(0,o.A)(e,v),{badgeContent:p,max:f,displayValue:b,invisible:y}=function(e){let{badgeContent:t,invisible:r=!1,max:o=99,showZero:n=!1}=e,l=(0,i.A)({badgeContent:t,max:o}),a=r;!1!==r||0!==t||n||(a=!0);let{badgeContent:s,max:c=o}=a?l:e,d=s&&Number(s)>c?`${c}+`:s;return{badgeContent:s,invisible:a,max:c,displayValue:d}}((0,n.A)({},e,{max:a})),A=(0,n.A)({},e,{badgeContent:p,invisible:y,max:f,showZero:d}),x=h(A),O=r||c.root||"span",M=(0,g.A)({elementType:O,externalSlotProps:s.root,externalForwardedProps:u,additionalProps:{ref:t},ownerState:A,className:x.root}),R=c.badge||"span",S=(0,g.A)({elementType:R,externalSlotProps:s.badge,ownerState:A,className:x.badge});return(0,m.jsxs)(O,(0,n.A)({},M,{children:[l,(0,m.jsx)(R,(0,n.A)({},S,{children:b}))]}))});var f=r(3556),b=r(92353),y=r(87447),A=r(75630);function x(e){return(0,d.A)("MuiBadge",e)}let O=(0,c.A)("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),M=["anchorOrigin","className","component","components","componentsProps","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],R=e=>{let{color:t,anchorOrigin:r,invisible:o,overlap:n,variant:l,classes:a={}}=e,i={root:["root"],badge:["badge",l,o&&"invisible",`anchorOrigin${(0,A.A)(r.vertical)}${(0,A.A)(r.horizontal)}`,`anchorOrigin${(0,A.A)(r.vertical)}${(0,A.A)(r.horizontal)}${(0,A.A)(n)}`,`overlap${(0,A.A)(n)}`,"default"!==t&&`color${(0,A.A)(t)}`]};return(0,s.A)(i,x,a)},S=(0,f.Ay)("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,t)=>t.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),C=(0,f.Ay)("span",{name:"MuiBadge",slot:"Badge",overridesResolver(e,t){let{ownerState:r}=e;return[t.badge,t[r.variant],t[`anchorOrigin${(0,A.A)(r.anchorOrigin.vertical)}${(0,A.A)(r.anchorOrigin.horizontal)}${(0,A.A)(r.overlap)}`],"default"!==r.color&&t[`color${(0,A.A)(r.color)}`],r.invisible&&t.invisible]}})(({theme:e,ownerState:t})=>(0,n.A)({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:20,lineHeight:1,padding:"0 6px",height:20,borderRadius:10,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen})},"default"!==t.color&&{backgroundColor:(e.vars||e).palette[t.color].main,color:(e.vars||e).palette[t.color].contrastText},"dot"===t.variant&&{borderRadius:4,height:8,minWidth:8,padding:0},"top"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${O.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${O.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}},"top"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${O.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${O.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}},"top"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${O.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${O.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}},"top"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${O.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${O.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}},t.invisible&&{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})})),E=l.forwardRef(function(e,t){var r,l,s,c,d,u;let g;let v=(0,b.A)({props:e,name:"MuiBadge"}),{anchorOrigin:h={vertical:"top",horizontal:"right"},className:f,component:A="span",components:x={},componentsProps:O={},overlap:E="rectangular",color:w="default",invisible:B=!1,max:k,badgeContent:_,slots:$,slotProps:I,showZero:z=!1,variant:T="standard"}=v,P=(0,o.A)(v,M),H=(0,i.A)({anchorOrigin:h,color:w,overlap:E,variant:T}),F=B;!1!==B||(0!==_||z)&&(null!=_||"dot"===T)||(F=!0);let{color:D=w,overlap:L=E,anchorOrigin:N=h,variant:W=T}=F?H:v,j=(0,n.A)({},v,{anchorOrigin:N,invisible:F,color:D,overlap:L,variant:W}),J=R(j);"dot"!==W&&(g=_&&Number(_)>k?`${k}+`:_);let Z=null!=(r=null!=(l=null==$?void 0:$.root)?l:x.Root)?r:S,Q=null!=(s=null!=(c=null==$?void 0:$.badge)?c:x.Badge)?s:C,U=null!=(d=null==I?void 0:I.root)?d:O.root,X=null!=(u=null==I?void 0:I.badge)?u:O.badge;return(0,m.jsx)(p,(0,n.A)({invisible:B,badgeContent:g,showZero:z,max:k},P,{slots:{root:Z,badge:Q},className:(0,a.default)(null==U?void 0:U.className,J.root,f),slotProps:{root:(0,n.A)({},U,(0,y.A)(Z)&&{as:A,ownerState:(0,n.A)({},null==U?void 0:U.ownerState,{anchorOrigin:N,color:D,overlap:L,variant:W})}),badge:(0,n.A)({},X,{className:(0,a.default)(J.badge,null==X?void 0:X.className)},(0,y.A)(Q)&&{ownerState:(0,n.A)({},null==X?void 0:X.ownerState,{anchorOrigin:N,color:D,overlap:L,variant:W})})},ref:t}))}),w=E},97648(e,t,r){var o=r(83915),n=r(83120),l=r(15389),a=r(69302),i=r(83693),s=r(68090),c=a(function(e,t){var r=s(t);return i(r)&&(r=void 0),i(e)?o(e,n(t,1,i,!0),l(r,2)):[]});e.exports=c},24713(e,t,r){var o=r(2523),n=r(15389),l=r(61489),a=Math.max;e.exports=function(e,t,r){var i=null==e?0:e.length;if(!i)return -1;var s=null==r?0:l(r);return s<0&&(s=a(i+s,0)),o(e,n(t,3),s)}},63233(e,t,r){"use strict";r.r(t),r.d(t,{default:()=>F});var o=r(96540),n=r(88485),l=r(97837),a=r(65121),i=r(91557),s=r(84680),c=r(40515),d=r(67725),u=r(3556),g=r(8051),m=r(84058),v=r.n(m),h=r(56449),p=r.n(h),f=r(62193),b=r.n(f),y=r(93624),A=r(76799),x=r(98820),O=r(86898),M=r(35319),R=r(9880),S=r(36338),C=r(54075),E=r(61341);let w="FlyChatRoomPanel",B=(0,u.Ay)("div",{name:w,slot:"UIChatMsgStart"})(({theme:e})=>({textAlign:"center",padding:e.spacing(2,2,1),fontStyle:"italic",color:e.palette.text.primary,fontSize:e.spacing(1.75)})),k=(0,u.Ay)("div",{name:w,slot:"ReplyEditWrapper"})(({theme:e})=>({padding:e.spacing(.625,1.25),height:"50px",width:"100%",borderTop:e.mixins.border("secondary"),display:"flex",justifyContent:"space-between",backgroundColor:"dark"===e.palette.mode?e.palette.grey["600"]:e.palette.grey["100"]})),_=(0,u.Ay)(c.mE,{name:w,slot:"SelectedMsg"})(({theme:e})=>({color:e.palette.text.primary,a:{pointerEvents:"none",color:e.palette.text.primary}})),$=(0,u.Ay)(c.s4,{name:w,slot:"LineIconClose"})(({theme:e})=>({cursor:"pointer",alignSelf:"center"})),I=(0,u.Ay)("div",{name:w,slot:"SelectedMsgAttachment"})(({theme:e})=>({fontSize:e.spacing(1.5),margin:e.spacing(.5,0),"& .ico":{marginRight:e.spacing(.5)}})),z=(0,u.Ay)("div",{name:w,slot:"ContentWrapper"})(({theme:e})=>({overflow:"hidden"})),T=(0,u.Ay)(y.$6,{name:"SearchWrapper"})(({theme:e})=>({"& input::placeholder, .ico":{color:e.palette.text.hint}})),P=(0,u.Ay)(c.dl,{name:w,slot:"DropFileBox"})(({theme:e})=>({position:"relative",flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"})),H=(0,u.Ay)(g.A,{name:w,slot:"DropFileBackground"})(({theme:e})=>({backgroundColor:e.palette.background.secondary,width:"100%",height:"100%",position:"absolute",top:0,left:0,right:0,zIndex:"9999",opacity:.9,display:"flex",alignItems:"center",justifyContent:"center"})),F=o.memo(function({rid:e,active:t,textDefault:r}){let{i18n:u,useActionControl:m,dispatch:h,jsxBackend:f,getSetting:w}=(0,i.PCX)(),F=o.useRef(),D=o.useRef(),L=f.get("ChatComposer"),N=(0,n.nb)(e),W=(0,n.iW)(e),j=(0,n.GV)(e),J=(0,n.Im)(e),Z=(0,n.hB)(),Q=null==W?void 0:W.userId,U=(0,n.Iv)(e),X=o.useRef(),q=o.useRef(),G=o.useRef(),V=o.useRef();if(!Q&&(null==W?void 0:W.t)===l.CJ.Direct){var K;let Y=null==W?void 0:null===(K=W.uids)||void 0===K?void 0:K.filter(e=>(null==e?void 0:e.id)!==(null==Z?void 0:Z._id));(null==Y?void 0:Y.length)&&(Q=Y[0])}let ee=(0,n.Fz)(Q);(null==W?void 0:W.usersCount)===1&&(ee=Z);let et=(null==W?void 0:W.t)===l.CJ.Direct?null==ee?void 0:ee.status:null,er=(0,a.cR)(et,null==ee?void 0:ee.invisible),[eo]=m(e,{}),en=(0,n.sz)(),el=(0,n.y8)(e),[ea,ei]=(0,o.useState)("no_react"),[es,ec]=(0,o.useState)(),[ed,eu]=o.useState(!1),[eg,em]=o.useState(!1),ev=o.useCallback(()=>{(null==j?void 0:j.alert)&&h({type:"chatplus/room/markAsRead",payload:{identity:e}})},[j,e,h]);o.useEffect(()=>{e&&em(!1)},[]),o.useEffect(()=>{if(e)return h({type:"chatplus/room/active",payload:{rid:e}}),()=>{h({type:"chatplus/room/inactive",payload:{rid:e}})}},[]);let eh=o.useMemo(()=>{var e,t,r,o;return b()(null==N?void 0:N.msgSearch)||(null==N?void 0:null===(e=N.msgSearch)||void 0===e?void 0:e.mode)===E.Dn?null:(null==N?void 0:null===(t=N.msgSearch)||void 0===t?void 0:t.mQuoteId)?null==N?void 0:N.searchMessages[null==N?void 0:null===(o=N.msgSearch)||void 0===o?void 0:o.mQuoteId]:null==N?void 0:N.searchMessages[null==N?void 0:null===(r=N.msgSearch)||void 0===r?void 0:r.id]},[null==N?void 0:N.msgSearch,null==N?void 0:N.searchMessages]),ep=o.useMemo(()=>(null==N?void 0:N.searching)||!b()(eh),[eh,null==N?void 0:N.searching]),ef=null==N?void 0:N.searching,eb=!!(null==j?void 0:j.archived),ey=!((null==j?void 0:j.allowMessageFrom)!=="noone"),eA=null==N?void 0:N.newest,ex=null==N?void 0:N.roomProgress,eO=(null==j?void 0:j.fname)||(null==W?void 0:W.name)||(null==W?void 0:W.fname),eM=W&&(null==W?void 0:W.typing)||[],eR=Z&&W&&W.muted&&p()(W.muted)&&!!W.muted.find(e=>e===Z.username),eS=(null==W?void 0:W.ro)&&(null==W?void 0:W.t)!==l.CJ.Direct&&!(null==el?void 0:el.postReadonly)||!!eb,eC=!!((null==W?void 0:W.t)===l.CJ.Direct&&((null==j?void 0:j.metafoxBlocked)||(null==j?void 0:j.metafoxBlocker))),eE=!!((null==W?void 0:W.t)===l.CJ.Direct&&((null==j?void 0:j.blocked)||(null==j?void 0:j.blocker))),ew=!!(eE||eC),eB=null==W?void 0:W.isBotRoom,ek=eB||ey||ew||!w("preaction"),e_=(0,n.FX)(),e$=o.useMemo(()=>(0,d.Ue)(e_,{room:W,subscription:j,groups:null==N?void 0:N.groups,pinned:null==N?void 0:N.pinned,favorite:null==j?void 0:j.f,starred:null==N?void 0:N.starred,searching:null==N?void 0:N.searching,settings:en,perms:el,isSelfChat:U,isBlocked:ew,isMetaFoxBlocked:eC,allowMsgNoOne:ey,isReadOnly:eS}),[N,j,W,en,el,e_,U,ew,eC,ey,eS]),eI=(e,t)=>{if(!e)return;let r=e.split(/.,| /);r.forEach(e=>{switch(e){case"chatplus/replyMessage":ei("reply"),ec(t);break;case"chatplus/editMessage":ei("edit"),ec(t)}})},ez=()=>{ei("no_react"),ec(void 0)},eT=()=>{if(ez(),!b()(eh)){h({type:"chatplus/room/modeSearch",payload:{rid:e,mode:E.Dn},meta:{onSuccess(){(null==G?void 0:G.current)&&(em(!1),G.current.scrollToBottom())}}});return}(null==G?void 0:G.current)&&G.current.scrollToBottom()},{isQuote:eP}=(0,M.checkIsQuote)(null==es?void 0:es.attachments),eH=o.useMemo(()=>(null==es?void 0:es.msg)?(0,S.Nj)(null==es?void 0:es.msg,{mentions:null==es?void 0:es.mentions}):"",[es]),eF=o.useRef(),eD=t=>{if(!ef||b()(J)){if(t.target.scrollHeight-t.target.scrollTop-2*t.target.clientHeight>0?em(!0):em(!1),b()(eh)){if(t.target.scrollTop<100&&!ed){let{oldest:r,endLoadmoreMessage:o}=N||{};if(!r||o)return;eF.current=t.target.scrollHeight-t.target.clientHeight,eu(!0),h({type:"chatplus/room/loadHistory",payload:{rid:e,oldest:r},meta:{onSuccess(){eu(!1)}}})}return}(null==V?void 0:V.current)&&V.current.handleScroll(t)}};o.useEffect(()=>{if(!(null==eh?void 0:eh.oldest)||!eF.current)return;let e=D.current.scrollHeight-D.current.clientHeight;D.current.scrollTop=0+(e-eF.current),eF.current=0},[null==eh?void 0:eh.oldest]),o.useEffect(()=>{if(!(null==N?void 0:N.oldest)||!eF.current)return;let e=D.current.scrollHeight-D.current.clientHeight;D.current.scrollTop=0+(e-eF.current),eF.current=0},[null==N?void 0:N.oldest]);let eL=e=>{if(e.length&&X&&X.current){var t,r,o;let n=(null===(t=q.current)||void 0===t?void 0:t.getPreviewFiles())||[];null===(r=q.current)||void 0===r||r.attachFiles([...n,...e]),null===(o=X.current)||void 0===o||o.attachFiles([...n,...e])}};return o.createElement(y.Zk,{ref:F},o.createElement(y.aO,{searching:ef},o.createElement(y.xw,{room:W,status:er,user:ee,isSelfChat:U},eO),o.createElement(y.qC,{items:e$,handleAction:eo,variant:"roomPanel"})),o.createElement(T,{hide:!ef,roomId:e,searching:ef,chatRoom:N,isBuddy:!0}),o.createElement(P,{"data-testid":v()("Chat Dock content"),onClick:ev,onDrop(e){eL(e)},render({canDrop:t,isOver:n}){var l,a;return o.createElement(o.Fragment,null,t&&o.createElement(H,null,o.createElement(c.mE,{variant:"h5",lines:1},u.formatMessage({id:"drop_files_here"}))),o.createElement(g.A,{sx:{flex:1,minHeight:0,position:"relative"}},o.createElement(s.P,{autoHide:!1,autoHeight:!0,autoHeightMax:"100%",ref:D,onScroll:eD},ef&&!b()(J)?o.createElement(x.A,{user:Z,items:J,archived:eb,room:W,isMobile:!1,settings:en,perms:el,disableReact:ek,type:(null==N?void 0:N.pinned)?"pin":"star",subscription:j,ref:G}):ep?o.createElement(C.A,{setReactMode:ei,setSelectedMsg:ec,searchMessages:eh,loadingMsgs:ed,setLoadingMsgs:eu,oldScrollOffset:eF,ref:V,chatRoom:N,rid:e,handleAction:eI,isPageFull:!1}):o.createElement(o.Fragment,null,!ef&&(null==N?void 0:N.endLoadmoreMessage)?o.createElement(B,{"data-testid":v()("start of conversation")},u.formatMessage({id:"start_of_conversation"})):null,o.createElement(A.Ay,{rid:e,typing:eM,groupIds:null==N?void 0:N.groupIds,groups:null==N?void 0:N.groups,newest:eA,archived:eb,roomProgress:ex,room:W,subscription:j,isMobile:!1,settings:en,perms:{},user:Z,containerRef:D,disableReact:ek,handleAction:eI,ref:G}))),eg&&!ef?o.createElement(R.A,{reactMode:ea,refMessage:G,setShowLatestMsg:em,searchMessages:eh,rid:e,showText:!1}):null),"no_react"!==ea&&o.createElement(k,null,o.createElement(z,null,o.createElement("div",null,"reply"===ea?u.formatMessage({id:"chatplus_reply_to_user"},{user_name:null==es?void 0:null===(l=es.u)||void 0===l?void 0:l.name,is_owner:(null==Z?void 0:Z._id)===(null==es?void 0:null===(a=es.u)||void 0===a?void 0:a._id)?1:0}):u.formatMessage({id:"editing"})),b()(null==es?void 0:es.attachments)?o.createElement(_,{lines:1,dangerouslySetInnerHTML:{__html:eH}}):eP&&!b()(eH)?o.createElement(_,{lines:1,dangerouslySetInnerHTML:{__html:eH}}):o.createElement(I,null,o.createElement(c.s4,{icon:"ico-paperclip-alt"}),o.createElement("span",null,u.formatMessage({id:"file_attachment"})," "))),o.createElement($,{icon:"ico-close",onClick:ez})),o.createElement(O.A,{ref:X,filesUploadRef:q}),o.createElement(y.WH,{archived:eb,isReadOnly:eS,isMuted:eR,searching:ef,isBlocked:ew,reactMode:ea,allowMsgNoOne:ey},o.createElement(L,{rid:e,room:W,msgId:null==es?void 0:es.id,reactMode:ea,user:Z,text:"edit"===ea?eH:r||"",onSuccess:eT,subscription:j,previewRef:X,ref:q})))}}))},(e,t)=>e.rid===t.rid)}}]);