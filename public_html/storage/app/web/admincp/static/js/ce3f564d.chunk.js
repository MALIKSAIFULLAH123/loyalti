(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-admincp-blocks-AdminChartStats-Block"],{63945(e){e.exports=function(e,t,a,l){for(var n=-1,r=null==e?0:e.length;++n<r;){var o=e[n];t(l,o,a(o),e)}return l}},62429(e,t,a){var l=a(80909);e.exports=function(e,t,a,n){return l(e,function(e,l,r){t(n,e,a(e),r)}),n}},93599(e,t,a){var l=a(44394);e.exports=function(e,t,a){for(var n=-1,r=e.length;++n<r;){var o=e[n],i=t(o);if(null!=i&&(void 0===u?i==i&&!l(i):a(i,u)))var u=i,s=o}return s}},3335(e){e.exports=function(e,t){return e>t}},56176(e){e.exports=function(e,t){return e<t}},17721(e){e.exports=function(e,t){for(var a,l=-1,n=e.length;++l<n;){var r=t(e[l]);void 0!==r&&(a=void 0===a?r:a+r)}return a}},42e3(e,t,a){var l=a(63945),n=a(62429),r=a(15389),o=a(56449);e.exports=function(e,t){return function(a,i){var u=o(a)?l:n,s=t?t():{};return u(a,e,r(i,2),s)}}},94394(e,t,a){var l=a(43360),n=a(42e3),r=Object.prototype.hasOwnProperty,o=n(function(e,t,a){r.call(e,a)?e[a].push(t):l(e,a,[t])});e.exports=o},55378(e,t,a){var l=a(34932),n=a(15389),r=a(5128),o=a(56449);e.exports=function(e,t){return(o(e)?l:r)(e,n(t,3))}},94506(e,t,a){var l=a(93599),n=a(3335),r=a(83488);e.exports=function(e){return e&&e.length?l(e,r,n):void 0}},31684(e,t,a){var l=a(93599),n=a(56176),r=a(83488);e.exports=function(e){return e&&e.length?l(e,r,n):void 0}},31126(e,t,a){var l=a(15389),n=a(17721);e.exports=function(e,t){return e&&e.length?n(e,l(t,2)):0}},21362(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>V});var l=a(91557),n=a(84680),r=a(96540),o=a(10149),i=a(44731),u=a(3556),s=a(8051),d=a(20687),c=a(89335),m=a(50203),p=a(57660),v=a(94394),f=a.n(v),g=a(68090),h=a.n(g),y=a(55378),b=a.n(y),x=a(94506),k=a.n(x),A=a(31126),w=a.n(A),E=a(58156),C=a.n(E),M=a(31684),S=a.n(M),_=a(95093),B=a.n(_);o.t1.register(o.PP,o.kc,o.FN,o.No,o.hE,o.m_,o.s$);let $=(e,t,a="data")=>t?"sum"===e?w()(t,a):"min"===e?S()(t.map(e=>C()(e,a))):"max"===e?k()(t.map(e=>C()(e,a))):w()(t,a):0,D=(0,u.Ay)(n.tD,{slot:"BlockContent"})(({theme:e})=>({height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"})),W=(0,u.Ay)("div",{slot:"HeaderWrapper"})(({theme:e})=>({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:e.spacing(3),[e.breakpoints.down("lg")]:{flexDirection:"column"}})),H=(0,u.Ay)("div",{slot:"HeaderLeftWrapper"})(({theme:e})=>({height:"auto",[e.breakpoints.down("lg")]:{marginBottom:e.spacing(2)}})),P=(0,u.Ay)("div",{slot:"HeaderRightWrapper"})(({theme:e})=>({height:"auto","& .MuiSelect-select":{paddingTop:e.spacing(1),paddingBottom:e.spacing(1)}})),j=(0,u.Ay)("h3",{slot:"TitleHeader"})(({theme:e})=>({fontSize:e.spacing(2.5),margin:e.spacing(0),fontWeight:"normal"})),z=(0,u.Ay)("span",{slot:"Time"})(({theme:e})=>({color:e.palette.grey[700],height:e.spacing(2),display:"block"})),L=(0,u.Ay)("div",{slot:"Chart"})(({theme:e})=>({color:e.palette.grey[700],position:"relative",flex:1,minHeight:0,"&.loading canvas":{opacity:.1}})),N=(0,u.Ay)(s.A,{slot:"Loading"})(({theme:e})=>({height:"100%",width:"100%",justifyContent:"center",display:"flex",position:"absolute"})),O={},T=e=>{let t=null;return"1d"===e&&(t="day"),"1w"===e&&(t="week"),"1M"===e&&(t="month"),t},V=(0,l.WvA)({extendBlock:function(e){var t,a,o;let{useFetchDetail:u,apiClient:s,jsxBackend:v,i18n:g,useTheme:y}=(0,l.PCX)(),[x,A]=r.useState({data:[]}),[w,E]=r.useState("user"),[C,M]=r.useState("1d"),[S,_]=r.useState(!0),V=y(),Y=r.useRef(null),R=(0,l.wVH)(),[F]=u({dataSource:{apiUrl:"admincp/dashboard/stat-type"}}),I=(null==F?void 0:null===(t=F.types)||void 0===t?void 0:t.find(e=>e.value===w))||{},q=r.useCallback(async(e,t)=>{if(Y.current&&Y.current.abort(),O[`${e}_${t}`]){A(O[`${e}_${t}`]),_(!1);return}Y.current=new AbortController;let a=Y.current.signal;_(!0);try{let l=await s.request({method:"get",url:`admincp/dashboard/chart?name=${e}&period=${t}`,signal:a});if(l){var n,r,o,i,u;let d={data:null==l?void 0:null===(n=l.data)||void 0===n?void 0:n.data,from:null==l?void 0:null===(r=l.data)||void 0===r?void 0:null===(o=r.meta)||void 0===o?void 0:o.from,to:null==l?void 0:null===(i=l.data)||void 0===i?void 0:null===(u=i.meta)||void 0===u?void 0:u.to};O[`${e}_${t}`]=d,A(d),_(!1)}}catch(c){}},[s]),U=e=>{E(e.target.value),q(e.target.value,C)},X=e=>{M(e.target.value),q(w,e.target.value)};(0,r.useEffect)(()=>{q(w,C)},[]);let Z=r.useCallback((e,t)=>{let a=null!=t?t:C;if("1d"===a)return B()(e).format("DD MMM");if("1w"===a){let l=B()().week()===B()(e).week()?B()():B()(e).endOf("week");return l.format("DD MMM")}if("1M"===a)return B()(e).format("MMM YYYY")},[C]),G=r.useCallback((e,t,a)=>{if(!t||!a)return e.sort((e,t)=>B()(e.time).unix()-B()(t.time).unix());let l=[],n=B()(t),r=T(C);for(;n.isSameOrBefore(a,r);){let o=Z(n),i=e.find(e=>e.label===o);l.push(i||{label:o,data:0}),n.add(1,r)}return l},[C,Z]),J=f()(null==x?void 0:x.data,({date:e})=>Z(e)),K=b()(J,(e,t)=>{var a;let l=$(I.operation,e,"data");return{label:t,data:l,time:null===(a=h()(e))||void 0===a?void 0:a.date}}),Q=G(K,null==x?void 0:x.from,null==x?void 0:x.to),{labels:ee,dataValues:et}=Q.reduce((e,t)=>(e.labels.push(t.label),e.dataValues.push(t.data),e),{labels:[],dataValues:[]}),ea={labels:ee,datasets:[{data:et,borderColor:V.palette.primary.main,backgroundColor:V.palette.primary.main}]},el={responsive:!0,maintainAspectRatio:!1,clip:!1,plugins:{legend:!1,title:{display:!1}},scales:{y:{beginAtZero:!0,min:0,ticks:{stepSize:parseInt(k()(et),10)>50?10:1}}}};return r.createElement(n.eB,null,r.createElement(D,null,r.createElement(W,null,r.createElement(H,null,r.createElement(j,null,g.formatMessage({id:"welcome_back_username"},{username:R.user.full_name})),r.createElement(z,null,S?null:r.createElement(r.Fragment,null,ee[0]," - ",ee[ee.length-1]," "))),r.createElement(P,null,r.createElement(d.A,{sx:{m:1,minWidth:200},size:"small"},r.createElement(c.A,null,g.formatMessage({id:"type"})),r.createElement(m.A,{value:w,label:"Type",onChange:U},null==F?void 0:null===(a=F.types)||void 0===a?void 0:a.map((e,t)=>r.createElement(p.A,{key:t,value:e.value},e.label)))),r.createElement(d.A,{sx:{m:1,minWidth:200},size:"small"},r.createElement(c.A,null,g.formatMessage({id:"view"})),r.createElement(m.A,{value:C,label:"View",onChange:X},null==F?void 0:null===(o=F.period)||void 0===o?void 0:o.map((e,t)=>r.createElement(p.A,{key:t,value:e.value},e.label)))))),r.createElement(L,{className:S?"loading":""},S?r.createElement(N,null,v.render({component:"form.DefaultLoading"})):r.createElement(i.N1,{width:500,data:ea,options:el}))))},defaults:{title:"Chart",blockLayout:"Admin - Block - Contained",blockProps:{blockStyle:{sx:{height:"calc(100% - 16px)"}}}}})}}]);