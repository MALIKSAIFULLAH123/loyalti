"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-livestreaming-components-LiveVideoPlayer"],{43498(e,t,i){i.d(t,{Ui:()=>f,ET:()=>m}),i(96602);var n=i(96540),a=i(91557),l=i(70223),s=i(11497),o=i(656),r=i(78292);let d=new class{bootstrap(e,t){this.manager=e,this.settingApp=this.manager.getSetting("firebase"),this.settingApp&&this.init(this.settingApp,t)}checkActive(){return this.isActive}init(e,t){if(this.mounted)return this.firebaseApp;this.mounted=!0;let i={apiKey:a.z0J,authDomain:a.wRL,projectId:a.wWR,storageBucket:a.npo,messagingSenderId:a.AfL,appId:a.Kou};this.config=e;try{let n=(0,l.Wp)(i),s=(0,o.xI)(n),{user_firebase_email:r,user_firebase_password:d,requiredSignin:u}=this.settingApp||{};return u&&(0,o.x9)(s,r,d).then(e=>{}).catch(e=>{console.log("Live Video - Firebase signInWithEmailAndPassword error",e),"auth/user-not-found"===e.code&&(0,o.eJ)(s,r,d)}),t(!0),this.firebaseApp=n,this.isActive=!0,n}catch(c){this.isActive=!1}}getFirebaseApp(){return this.firebaseApp}getFirestore(){if(!this.firebaseApp)return null;if(!this.firestore){let e=(0,s.aU)(this.firebaseApp);e&&(this.firestore=e)}return this.firestore}getMessaging(){if(!this.firebaseApp)return null;if(!this.cloudMessage){let e=(0,r.dG)(this.firebaseApp);e&&(this.cloudMessage=e)}return this.cloudMessage}},u=!1,c=!1;function f(){let[e,t]=function(){let e=(0,a.PCX)(),[t,i]=n.useState(!1);return t||u||(u=!0,d.bootstrap(e,()=>{c=!0,i(!0)})),[t||c,d]}();if(!e)return!1;let i=t.getFirestore();return i}let p=(e,t)=>{let[i,a]=(0,n.useState)();return(0,n.useEffect)(()=>{let i;if(e&&(null==t?void 0:t.collection)&&(null==t?void 0:t.docID)){try{let n=(0,s.H9)(e,t.collection,t.docID);i=(0,s.aQ)(n,async e=>{a(e.data())})}catch(l){}return()=>{null==i||i()}}},[]),i},m=p},71927(e,t,i){i.r(t),i.d(t,{default:()=>v});var n=i(91557),a=i(96540),l=i(3556),s=i(8051),o=i(60780),r=i(67725),d=i(67338),u=i(40515),c=i(43498),f=i(62193),p=i.n(f);let m=(0,l.Ay)(s.A,{name:"EndPlayer",shouldForwardProp:e=>"dialog"!==e})(({theme:e,dialog:t})=>({position:"relative",backgroundColor:"#333",color:"#fff",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:"24px",...t&&{width:"100%",height:"100%"},"&:before":{content:'""',display:"block",paddingBottom:"56.25%"}})),h=(0,l.Ay)(s.A,{name:"EndPlayer",shouldForwardProp:e=>"dialog"!==e})(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"absolute",top:0,left:0,right:0,bottom:0})),g=(0,l.Ay)(s.A)(({theme:e})=>({display:"flex",justifyContent:"center",alignItems:"center","& > *":{marginRight:`${e.spacing(1)} !important`}})),v=function({item:e,dialog:t,actions:i,dashboard:l}){let{i18n:s,dialogBackend:f,moment:v,dispatch:_,jsxBackend:b}=(0,n.PCX)(),{video_url:y,thumbnail_url:A,is_owner:E,is_streaming:x,extra:w,is_pending:I,stream_key:k,webcamConfig:D={}}=e||{},C=(0,c.Ui)(),M=(0,c.ET)(C,{collection:"live_video",docID:k}),P=b.get("livevideo.ui.webcamPlayer"),F=a.useCallback(()=>{i.deleteItem()},[]),L=["idle","deleted"].includes(null==M?void 0:M.status)||!x,S=null==M?void 0:M.is_approved,W=x&&E&&l&&(null==M?void 0:M.time_limit_warning),z=(null==M?void 0:M.end_date)?v(null==M?void 0:M.end_date).diff(new Date,"minutes"):"",R=()=>{E&&l&&f.alert({message:s.formatMessage({id:"live_video_approved_successfully_notification"})})};if(a.useEffect(()=>{e._identity&&S&&I&&_({type:n.yDX,payload:{identity:e._identity},meta:{onSuccess:R}})},[S,I,e._identity]),a.useEffect(()=>(L&&i&&i.updateStatusOffline(),()=>{L&&i&&i.removeLiveWatching()}),[L,i]),a.useEffect(()=>{W&&z>0&&f.alert({title:s.formatMessage({id:"timeout"}),message:s.formatMessage({id:"the_live_video_will_end_in_n_minutes"},{value:z})})},[W,z]),!e)return null;let V=(0,r.AE)(A,"500","");return L?a.createElement(m,{dialog:t},a.createElement(h,null,a.createElement(u.s4,{icon:"ico-video",sx:{fontSize:40,mb:2}}),s.formatMessage({id:E?"your_live_video_has_ended":"live_video_had_ended"}),E?a.createElement(g,{mt:2},(null==w?void 0:w.can_delete)?a.createElement(o.A,{"data-testid":"buttonDeleteLiveVideo",role:"button",tabIndex:1,autoFocus:!0,variant:"contained",disableRipple:!0,size:"medium",color:"error",onClick:F,sx:{minWidth:100}},s.formatMessage({id:"delete"})):null,a.createElement(o.A,{"data-testid":"buttonViewLiveVideo",role:"button",tabIndex:2,variant:"contained",disableRipple:!0,size:"medium",color:"primary",href:e.link||`/live-video/${null==e?void 0:e.id}`,sx:{minWidth:100}},s.formatMessage({id:"view"}))):null)):l&&E&&!p()(D)?a.createElement(P,{sxDeviceWrapper:{p:2},streamKey:k,deviceDefault:D,id:e.id}):a.createElement(d.A,{src:y,thumb_url:V,autoPlay:!0})}}}]);