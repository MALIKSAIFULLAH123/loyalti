"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-music-blocks-SongDetail-Block"],{17085(e,t,n){n.r(t),n.d(t,{default:()=>T});var a=n(91557),i=n(58494),l=n(90243),r=n(84680),o=n(40515),s=n(3556),c=n(8051),m=n(87773),d=n(96540),u=n(70189),p=n(60655),g=n(67725),f=n(84058),v=n.n(f);let h="SongDetailView",y=(0,s.Ay)("div",{name:h,slot:"MusicContent"})(({theme:e})=>({fontSize:e.mixins.pxToRem(15),lineHeight:1.33})),b=(0,s.Ay)("div",{name:h,slot:"tagItem",overridesResolver:(e,t)=>[t.tagItem]})(({theme:e})=>({fontSize:e.mixins.pxToRem(13),fontWeight:e.typography.fontWeightBold,borderRadius:e.shape.borderRadius/2,background:"light"===e.palette.mode?e.palette.background.default:e.palette.action.hover,marginRight:e.spacing(1),marginBottom:e.spacing(1),padding:e.spacing(0,1.5),height:e.spacing(3),lineHeight:e.spacing(3),color:"light"===e.palette.mode?"#121212":"#fff",display:"flex",alignItems:"center",justifyContent:"center"})),E=(0,s.Ay)("div",{name:h,slot:"BgCoverWrapper"})(({theme:e})=>({height:320,overflow:"hidden",position:"relative"})),x=(0,s.Ay)("div",{name:h,slot:"BgCoverInner"})(({theme:e})=>({position:"absolute",left:0,right:0,top:0,bottom:0,zIndex:-1})),A=(0,s.Ay)("div",{name:h,slot:"BgCover"})(({theme:e})=>({height:"100%",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",filter:"brightness(0.4) blur(50px)"})),S=(0,s.Ay)("div",{name:h,slot:"Header"})(({theme:e})=>({marginLeft:e.spacing(2),marginRight:"auto",color:"#fff",paddingTop:e.spacing(4),display:"flex",justifyContent:"space-between"})),w=(0,s.Ay)("div",{name:h,slot:"HeaderInner"})(({theme:e})=>({flex:1,minWidth:0,margin:e.spacing(0,3,0,2),display:"flex",flexDirection:"column"})),_=(0,s.Ay)(o._V,{name:h,slot:"ImgSong"})(({theme:e})=>({width:212,height:212})),k=(0,s.Ay)("div",{name:h,slot:"viewContainer"})(({theme:e})=>({margin:e.spacing(0,2,0,2),borderRadius:e.shape.borderRadius,backgroundColor:e.mixins.backgroundColor("paper"),border:e.mixins.border("secondary"),padding:e.spacing(0,2,2,2),position:"relative",marginTop:-44})),C=(0,s.Ay)(c.A)(({theme:e})=>({position:"absolute",right:8,top:8})),W=(0,s.Ay)("div",{name:h,slot:"TitleWrapper"})(({theme:e})=>({display:"flex"})),I=(0,s.Ay)(c.A,{name:h,slot:"PageTitle"})(({theme:e})=>({margin:e.spacing(1.5,0),fontWeight:e.typography.fontWeightSemiBold,minWidth:0,fontSize:e.spacing(3),lineHeight:1.3,maxHeight:72,overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-word",wordWrap:"break-word",whiteSpace:"normal",WebkitLineClamp:1,display:"-webkit-box",WebkitBoxOrient:"vertical","& .ico-heart":{color:e.palette.primary.main}})),N=(0,s.Ay)(c.A,{name:h,slot:"SongAlbum"})(({theme:e})=>({display:"flex",fontWeight:e.typography.fontWeightSemiBold,marginTop:1.5})),R=(0,s.Ay)("div",{name:h,slot:"MinorInfo"})(({theme:e})=>({marginTop:e.spacing(1),color:e.palette.text.hint,fontSize:13,fontWeight:e.typography.fontWeightBold})),P=(0,s.Ay)(c.A,{name:h,slot:"AlbumWrapper"})(({theme:e})=>({fontWeight:"normal",color:e.palette.text.hint})),z=(0,s.Ay)("div",{name:h,slot:"SoundWave"})(({theme:e})=>({marginTop:"auto"})),B=(0,a.$MH)((0,i.Ay)(function({item:e,user:t,blockProps:n,identity:i,handleAction:s,state:f}){let{ItemActionMenu:h,ItemDetailInteraction:B,i18n:T,assetUrl:M,jsxBackend:$,getSetting:L}=(0,a.PCX)(),D=(0,a.UfA)(null==e?void 0:e.genres),H=L("music.music_song.auto_play"),V=(0,a.dx2)(null==e?void 0:e.album);if(!e)return null;let{description:F,text:X,name:j,statistic:G,destination:O,is_featured:U,is_sponsor:q,resource_name:Y,image:J}=e,K=$.get("core.itemView.pendingReviewCard"),Q=(0,g.AE)(J,"500",M("music.song_no_image"));return d.createElement(r.eB,{testid:`detailview ${Y}`},d.createElement(r.tD,null,d.createElement(c.A,null,d.createElement(E,null,d.createElement(x,null,d.createElement(A,{style:{backgroundImage:`url(${Q})`}})),d.createElement(S,null,d.createElement(_,{"data-testid":"imgSong",src:Q,aspectRatio:"11"}),d.createElement(w,{"data-testid":"headerInner"},d.createElement(W,null,d.createElement(o.Et,{"data-testid":"itemTitle"},d.createElement(o.rL,{variant:"itemView",value:U}),d.createElement(o.FN,{variant:"itemView",value:q,item:e}))),d.createElement(I,{"data-testid":v()("music song title")},j),d.createElement(N,{"data-testid":v()("music song album")},V&&d.createElement(d.Fragment,null,d.createElement(c.A,{ml:.5,mr:.5},"â€¢"),d.createElement(P,{mr:.5},T.formatMessage({id:"album"})),d.createElement(a.N_E,{to:(null==V?void 0:V.link)||(null==V?void 0:V.url)},null==V?void 0:V.name))),Number.isInteger(null==G?void 0:G.music_song_total_play)?d.createElement(R,{"data-testid":v()("music song total play")},T.formatMessage({id:"music_song_total_play"},{value:null==G?void 0:G.music_song_total_play})):null,d.createElement(z,{"data-testid":v()("music song soundwave")},O&&d.createElement(u.A,{autoPlay:H,url:O,isPlaylist:!1,selectedSong:e}))))),d.createElement(k,null,d.createElement(C,null,d.createElement(h,{menuName:"detailActionMenu",identity:i,icon:"ico-dottedmore-vertical-o",state:f,handleAction:s,size:"smaller"})),d.createElement(o.at,{item:e,statisticDisplay:!1}),d.createElement(c.A,{mt:2},d.createElement(K,{item:e})),F&&d.createElement(y,{"data-testid":"descriptionSong"},d.createElement(o.np,null,d.createElement(l.Ay,{html:X||F}))),(null==D?void 0:D.length)>0&&d.createElement(c.A,{mt:4,display:"flex",flexWrap:"wrap","data-testid":"genreSong"},D.map(e=>d.createElement(b,{"data-testid":`${null==e?void 0:e.name} genreSong`,key:null==e?void 0:e.id},e.is_active?d.createElement(a.N_E,{to:null==e?void 0:e.url},null==e?void 0:e.name):d.createElement(m.A,{variant:"h6"},e.name)))),d.createElement(p.A,{attachments:null==e?void 0:e.attachments,size:"large"}),d.createElement(B,{identity:i,handleAction:s})))))})),T=(0,a.WvA)({extendBlock:B,defaults:{placeholder:"Search"}})},70189(e,t,n){n.d(t,{A:()=>S});var a=n(40515),i=n(8051),l=n(81502),r=n(97763),o=n(14931),s=n(56525),c=n(85838),m=n(96540),d=n(13007),u=n.n(d),p=n(91557),g=n(71468),f=n(20053),v=n(62193),h=n.n(v),y=n(68090),b=n.n(y);let E=(0,s.A)(e=>(0,c.A)({root:{display:"flex",alignItems:"flex-end","& .ico":{color:"#fff",fontSize:18,cursor:"pointer"}},hover:{position:"absolute",left:0,top:0,zIndex:10,pointerEvents:"none",height:"100%",width:0,mixBlendMode:"overlay",background:"rgba(255, 255, 255, 0.3)",opacity:0,transition:"opacity 0.2s ease"},waveForm:{cursor:"pointer",margin:e.spacing(0,1,1),height:77,overflow:"hidden",flex:1,position:"relative","&:hover $hover":{opacity:1},"&::before":{content:"''",height:"2px",background:"#eee",width:"100%",position:"absolute",bottom:0},"& > wave":{overflowX:"inherit !important",cursor:"pointer !important"},"& wave > wave::before":{content:"''",position:"absolute",top:"50%",height:"2px",width:"100%",background:"#2682d5"}},btnControlWrapper:{marginRight:e.spacing(2)},btnControl:{border:"none",background:"transparent",outline:"none",padding:0,"& + $btnControl":{paddingLeft:e.spacing(2)}},btnPlayPause:{},btnShuffle:{marginLeft:e.spacing(2)},btnRepeat:{marginLeft:e.spacing(2)},activeIcon:{color:`${e.palette.primary.main} !important`},timePlaying:{minWidth:e.spacing(5),textAlign:"right",fontSize:15},timeSong:{fontSize:15},volumeWrapper:{width:e.spacing(2),position:"relative",marginLeft:e.spacing(1.5),"&:hover $volumeSlider":{visibility:"visible",opacity:1}},volumeSlider:{height:70,visibility:"hidden",opacity:0,transition:"all 300ms ease",position:"absolute",left:e.spacing(-.5),bottom:e.spacing(4.5)},volumeSliderItem:{color:"#fff","& .MuiSlider-thumb":{width:"15px",height:"15px",boxShadow:"none !important",color:"#fff"}},progress:{flex:1,margin:e.spacing(0,1,1),position:"absolute",bottom:0},hide:{display:"none!important"},visibility:{visibility:"hidden"},disabledIcon:{color:`${e.palette.grey[500]}!important`}}),{name:"Waveform"}),x=e=>Array.from(Array(null==e?void 0:e.length).keys()),A=e=>({container:e,waveColor:"#eee",progressColor:"#2682d5",cursorColor:"transparent",barWidth:3,barHeight:2,barRadius:0,barGap:2,responsive:!0,height:150,loopSelection:!0,normalize:!0,partialRender:!1,minPxPerSec:100});function S({url:e,isPlaylist:t,isPlaying:n,setIsPlaying:s,songs:c,selectedSong:d,setSelectedSong:v,autoPlay:y}){let S=new AudioContext,w=E(),_=(0,m.useRef)(null),k=(0,m.useRef)(null),[C,W]=(0,m.useState)(!1),[I,N]=(0,m.useState)(!1),R=(0,m.useRef)([]),[P,z]=(0,m.useState)(!1),[B,T]=(0,m.useState)(!1),[M,$]=(0,m.useState)("0:00"),[L,D]=(0,m.useState)("0:00"),[H,V]=(0,m.useState)(.5),[F,X]=(0,m.useState)(!1),[j,G]=(0,m.useState)(!1),{dispatch:O,useLoggedIn:U,i18n:q}=(0,p.PCX)(),Y=(0,g.d4)(e=>(0,p.OG_)(e,c)),J=U();(0,m.useEffect)(()=>{W(!1),G(!1);let n=A(_.current);if(k.current=u().create(n),e)return k.current.load(e),$("0:00"),_.current.addEventListener("pointermove",e=>{let t=document.querySelector("#hover");t.style.width=`${e.offsetX}px`}),k.current.on("ready",()=>{G(!0),"running"===S.state&&!t&&y&&(k.current.play(),W(!0)),t&&s(e=>(e&&k.current.play(),e)),k.current.setVolume(I?0:H),V(H);let e=K(k.current.getDuration());D(e)}),k.current.on("audioprocess",()=>{let e=K(k.current.getCurrentTime());$(e)}),k.current.on("seek",e=>{let t=K(k.current.getCurrentTime());$(t)}),k.current.on("finish",()=>{Z(),z(e=>(e?k.current.play():(X(e=>(T(e=>{var t;return e&&1===Y.length?k.current.play():!e&&(null===(t=b()(Y))||void 0===t?void 0:t.id)!==(null==d?void 0:d.id)||e?ei(1):s(!1),e}),e)),W(!1)),e))}),()=>k.current.destroy()},[e]);let K=e=>{let t=Math.floor(e/60),n=`0${Math.floor(e-60*t)}`.slice(-2);return`${t}:${n}`},Q=()=>{t?s(!n):(W(!C),k.current.playPause())};m.useEffect(()=>{var e;(null===(e=k.current)||void 0===e?void 0:e.isPlaying())!==n&&k.current.playPause()},[n]);let Z=()=>{if(!J)return;let e=null==d?void 0:d._identity;O({type:"music/updateTotalPlayItem",payload:{identity:e}})},ee=(e,t)=>{k.current.setVolume(t),V(t),0===t?N(!0):N(!1)},et=()=>{N(e=>(k.current.setVolume(e?H:0),!e))},en=()=>{if(!t){z(!P);return}P||B||T(!0),B&&!P&&(T(!1),z(!0)),P&&!B&&z(!1)},ea=()=>{X(e=>!e)};m.useEffect(()=>{h()(Y)||(F?R.current=x(Y).sort((e,t)=>.5-Math.random()):R.current=x(Y))},[F,c]);let ei=e=>{if(!t)return;s(!0);let n=Y.findIndex(e=>(null==e?void 0:e.id)===(null==d?void 0:d.id)),a=R.current.findIndex(e=>n===e);X(t=>(t?a+e===R.current.length?v(Y[R.current[0]]):a+e<0?v(Y[b()(R.current)]):v(Y[R.current[a+e]]):n+e===(null==Y?void 0:Y.length)?v(Y[0]):n+e<0?v(b()(Y)):v(Y[n+e]),t))};return m.createElement("div",{className:w.root},m.createElement("div",{className:w.btnControlWrapper},t?m.createElement("button",{className:w.btnControl,onClick:()=>ei(-1)},m.createElement(a.s4,{icon:"ico-play-prev"})):null,m.createElement("button",{onClick:Q,className:(0,f.default)(w.btnControl,w.btnPlayPause),disabled:!j},(t?n:C)?m.createElement(a.s4,{icon:"ico-pause"}):m.createElement(a.s4,{icon:"ico-play",className:!j&&w.disabledIcon})),t?m.createElement("button",{className:w.btnControl,onClick:()=>ei(1)},m.createElement(a.s4,{icon:"ico-play-next"})):null),m.createElement("div",{className:w.timePlaying},M),m.createElement(i.A,{position:"relative",flex:1},m.createElement("div",{ref:_,className:(0,f.default)(w.waveForm,!j&&w.visibility)},m.createElement("div",{id:"hover",className:(0,f.default)(w.hover)})),m.createElement(l.A,{color:"inherit",className:(0,f.default)(j&&w.hide,w.progress)})),m.createElement("div",{className:w.timeSong},L),t?m.createElement(r.A,{title:q.formatMessage({id:F?"turn_off_shuffle":"turn_on_shuffle"})},m.createElement(a.s4,{icon:"ico-shuffle",className:`${w.btnShuffle} ${F?w.activeIcon:""}`,onClick:ea})):null,m.createElement(r.A,{title:q.formatMessage({id:B||P?B?"turn_on_repeat_one":"turn_off_repeat":"turn_on_repeat"})},m.createElement(a.s4,{icon:P&&t?"ico-play-repeat-one-o":"ico-play-repeat",className:(0,f.default)(w.btnRepeat,(P||B)&&w.activeIcon,!j&&w.disabledIcon),onClick:en})),m.createElement("div",{className:w.volumeWrapper},I?m.createElement(a.s4,{icon:"ico-volume-del",onClick:et,className:!j&&w.disabledIcon}):m.createElement(a.s4,{icon:"ico-volume-increase",onClick:et,className:!j&&w.disabledIcon}),m.createElement("div",{className:w.volumeSlider},j&&m.createElement(o.Ay,{orientation:"vertical",value:I?0:H,min:0,max:1,step:.01,onChange:ee,"aria-labelledby":"vertical-slider",valueLabelDisplay:"auto",valueLabelFormat:e=>Math.round(100*e),className:w.volumeSliderItem}))))}},60655(e,t,n){n.d(t,{A:()=>u});var a=n(91557),i=n(40515),l=n(3556),r=n(8051),o=n(96540);let s=(0,l.Ay)("div",{name:"attachmentTitle"})(({theme:e})=>({fontSize:e.mixins.pxToRem(18),color:e.palette.text.secondary,fontWeight:e.typography.fontWeightBold})),c=(0,l.Ay)("div",{name:"attachment"})(({theme:e})=>({width:"100%",display:"flex",flexWrap:"wrap",justifyContent:"space-between",[e.breakpoints.down("sm")]:{flexDirection:"column"}})),m=(0,l.Ay)("div",{name:"attachmentItemWrapper"})(({theme:e})=>({marginTop:e.spacing(2),flexGrow:0,flexShrink:0,flexBasis:"calc(50% - 8px)",minWidth:300,maxWidth:"100%"})),d=({attachments:e,size:t,sx:n})=>{let{i18n:l}=(0,a.PCX)(),d=(0,a.UfA)(e);return d.length?o.createElement(r.A,{mt:2,sx:n},o.createElement(s,null,l.formatMessage({id:"attachments"})),o.createElement(c,null,d.map((e,n)=>o.createElement(m,{key:e.id.toString()},o.createElement(i.Hg,{fileName:e.file_name,downloadUrl:e.download_url,isImage:e.is_image,fileSizeText:e.file_size_text,size:t,image:null==e?void 0:e.image,identity:null==e?void 0:e._identity,index:n}))))):null},u=d},58494(e,t,n){n.d(t,{Ay:()=>s});var a=n(91557),i=n(58156),l=n.n(i);let r=(0,a.vYD)({},()=>({})),o=(0,a.NgA)(function(e,t){let n=l()(e,t.identity);if(!n)return{};let a=n.songs?n.songs.map(t=>l()(e,t)).filter(Boolean):[];return{item:n,songs:a,user:l()(e,n.user)}});function s(e){return o(r(e))}}}]);