"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chat-components-MsgContent-MessageText"],{15535(e,t,n){n.d(t,{A:()=>s});var a=n(3556),i=n(37131),r=n(96540);function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let o=(0,a.Ay)("div",{name:"MsgAttachment",slot:"UIMsgAttachment",shouldForwardProp:e=>"isOwner"!==e&&"isAudio"!==e&&"isTypeFile"!==e&&"isOther"!==e})(({theme:e})=>({maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",paddingBottom:e.spacing(.5),marginTop:e.spacing(.25),overflow:"hidden"}));function s({item:e,isOwner:t,allowOpenPreview:n=!0}){let{is_image:a,image:s,file_name:m,download_url:d,file_size_text:c}=e;return r.createElement(o,{isOwner:t},r.createElement(i.A,l({isOwner:t,image:s,is_image:a,download_url:d,file_name:m,file_size_text:c},e,{allowOpenPreview:n})))}},37131(e,t,n){n.d(t,{A:()=>I});var a=n(12561),i=n(3556),r=n(96540);let l="UIMsgAttachmentImgWrapper",o=(0,i.Ay)("div",{name:l,slot:"RootStyled"})(({theme:e})=>({position:"relative",width:"100%"})),s=(0,i.Ay)("figure",{name:l,slot:"MediaWrapper"})(({theme:e})=>({margin:0,display:"block"})),m=(0,i.Ay)("div",{name:l,slot:"ImgRatioWrapper",shouldForwardProp:e=>"isOwner"!==e&&"isPageAllMessages"!==e})(({theme:e,isOwner:t,isPageAllMessages:n})=>({width:"100%",minWidth:t?"200px":"180px",maxWidth:"100%",cursor:"pointer",...n&&{width:"300px",[e.breakpoints.down("sm")]:{width:t?"200px":"180px"}}}));function d({children:e,ratioImage:t,isPageAllMessages:n,isOwner:a}){return r.createElement(o,null,r.createElement(s,null,r.createElement(m,{isOwner:!!a,isPageAllMessages:n,style:{paddingBottom:`${t?100*t:100}%`}},e)))}let c="UIMsgAttachMultiImgWrapper",g=(0,i.Ay)("div",{name:c,slot:"RootStyled"})(({theme:e})=>({position:"relative",width:"100%"})),u=(0,i.Ay)("figure",{name:c,slot:"MediaWrapper"})(({theme:e})=>({margin:0,display:"block"})),p=(0,i.Ay)("div",{name:c,slot:"ImgRatioWrapper",shouldForwardProp:e=>"isPageAllMessages"!==e})(({theme:e,isPageAllMessages:t})=>({maxWidth:"100%",cursor:"pointer",marginBottom:"1px",width:"100%",height:"100%",...t&&{width:"100%",height:"100%"}}));function h({children:e,isPageAllMessages:t,ratioImage:n=1}){return r.createElement(g,null,r.createElement(u,null,r.createElement(p,{isPageAllMessages:t,style:{paddingBottom:`${n?100*n:100}%`}},e)))}var f=n(91557),w=n(67725);let y=(0,i.Ay)("img",{name:"MsgAttachmentImage"})(({theme:e})=>({position:"absolute",left:0,top:0,width:"100%",borderRadius:e.spacing(1),border:e.mixins.border("secondary")})),v=(e,t)=>{let n=new Image;n.src=t,n.onload=()=>{e({height:n.height,width:n.width})},n.onerror=t=>{e(t)}};function A({isOwner:e,image:t,download_url:n,file_name:a,id:i,allowOpenPreview:l=!0}){let{dispatch:o,usePageParams:s,assetUrl:m}=(0,f.PCX)(),c=s(),g=(null==c?void 0:c.rid)||!1,[u,p]=r.useState(null),h=(0,w.AE)(t,"500",m("photo.no_image")),A=(0,w.AE)(t,"origin",m("photo.no_image"));r.useEffect(()=>{h&&v(p,h)},[h]);let x=!!u&&u.height/u.width,E=()=>{l&&o({type:"chat/room/presentImageView",payload:{image:{id:"img0",src:A,download_url:n,is_image:!0,file_name:a,imageId:i}}})};return r.createElement(d,{isPageAllMessages:g,ratioImage:x,isOwner:e},r.createElement(y,{src:h,onClick:E,alt:a}))}let x=(0,i.Ay)("img",{name:"MsgAttachmentImage"})(({theme:e})=>({position:"absolute",left:0,top:0,width:"100%",objectFit:"cover",borderRadius:e.spacing(1),border:e.mixins.border("secondary"),height:"100%"}));function E({image:e,download_url:t,images:n,isOwner:a,file_name:i,keyIndex:l,id:o}){let{dispatch:s,usePageParams:m,assetUrl:d}=(0,f.PCX)(),c=m(),g=(null==c?void 0:c.rid)||!1,u=r.useMemo(()=>n&&n.length?n.map((e,t)=>{let n=(0,w.AE)(e.image,"origin",d("photo.no_image"));return{id:t,src:n,download_url:e.download_url,file_name:e.file_name,imageId:e.id}}):[],[n]),p=(0,w.AE)(e,"500",d("photo.no_image")),y=(0,w.AE)(e,"origin",d("photo.no_image")),v=()=>{s({type:"chat/room/presentImageView",payload:{image:{id:parseInt(l),src:y,download_url:t,file_name:i,imageId:o},images:u}})};return r.createElement(h,{isPageAllMessages:g},r.createElement(x,{src:p,onClick:v,alt:"dwq"}))}let _=(0,i.Ay)("div",{name:"MsgAttachmentMedia",slot:"TitleLink",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({borderRadius:e.spacing(1),fontSize:e.spacing(1.75),padding:e.spacing(1),overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",display:"inline-block",maxWidth:"100%",wordBreak:"break-word",wordWrap:"break-word",backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},...t&&{backgroundColor:e.palette.primary.main,color:"#fff"}})),k=(0,i.Ay)("div")(({theme:e})=>({display:"flex",alignItems:"center",cursor:"pointer","& .ico":{marginRight:e.spacing(1)}}));function I({isOwner:e,layout:t,totalImages:n,is_image:i,image:l,file_name:o,download_url:s,file_size_text:m,keyIndex:d,id:c,allowOpenPreview:g=!0}){return l&&"multi-image"===t?r.createElement(E,{images:n,file_name:o,image:l,download_url:s,isOwner:e,keyIndex:d,id:c,allowOpenPreview:g}):i&&l?r.createElement(A,{isOwner:e,image:l,file_name:o,download_url:s,id:c,allowOpenPreview:g}):i?null:r.createElement(_,{isOwner:e},r.createElement(k,{onClick:()=>(0,a.NK)(s)},r.createElement("i",{className:"ico ico-arrow-down-circle mr-1"}),o))}},55737(e,t,n){n.d(t,{Ay:()=>w,Xc:()=>f,tr:()=>h});var a=n(91557),i=n(96540),r=n(15535),l=n(3556),o=n(37131);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let m="MsgAttachmentMultiMedia",d=(0,l.Ay)("div",{name:m,slot:"uiMsgImageAttachmentWrapper",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",alignItems:"center",flexWrap:"wrap",justifyContent:t?"flex-end":"flex-start",marginTop:e.spacing(.25),width:"100%",gap:e.spacing(.5)})),c=(0,l.Ay)("div",{name:m,slot:"uiMsgImageAttachmentItem"})(({theme:e})=>({flexBasis:`calc(100% / 3 - ${e.spacing(.5)})`}));function g({mediaItems:e,isOwner:t}){return i.createElement(d,{isOwner:t},e.map((n,a)=>i.createElement(c,{key:`k${a}`},i.createElement(o.A,s({},n,{keyIndex:a,layout:"multi-image",totalImages:e,isOwner:t})))))}var u=n(62193),p=n.n(u);let h=e=>{if(p()(e))return{multiImageFile:[],otherFile:[],attachments:[]};let t=[],n=[];return e.map(e=>{e.is_image?t.push(e):n.push(e)}),{multiImageFile:t,otherFile:n,attachments:e}},f=e=>{let{useGetItems:t}=(0,a.PCX)(),n=t(e)||[];if(p()(n))return{multiImageFile:[],otherFile:[],attachments:[]};let i=[],r=[];return n.map(e=>{e.is_image?i.push(e):r.push(e)}),{multiImageFile:i,otherFile:r,attachments:n}};function w({message:e,isOwner:t}){var n;let{multiImageFile:a,otherFile:l,attachments:o}=f(null==e?void 0:e.attachments);return(null===(n=e.attachments)||void 0===n?void 0:n.length)&&(a.length||l.length)?a.length>1?i.createElement(i.Fragment,null,i.createElement(g,{mediaItems:a,isOwner:t}),l.length?l.map((e,n)=>i.createElement(r.A,{item:e,key:`k${n}`,isOwner:t})):null):o.map((e,n)=>i.createElement(r.A,{item:e,key:`k${n}`,isOwner:t})):null}},62068(e,t,n){n.r(t),n.d(t,{default:()=>p});var a=n(96610),i=n(3556),r=n(97763),l=n(96540),o=n(55737),s=n(68536),m=n(19740),d=n(69709);let c="MessageText",g=(0,i.Ay)("div",{name:c,slot:"uiChatMsgItemMsg",shouldForwardProp:e=>"isOwner"!==e&&"isQuote"!==e&&"activeSearch"!==e})(({theme:e,isOwner:t,isQuote:n,activeSearch:a})=>({borderRadius:e.spacing(1),fontSize:e.mixins.pxToRem(15),padding:e.spacing(1.25),backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},overflowWrap:"break-word",maxWidth:"100%",zIndex:2,"& a":{color:t?"#fff":e.palette.text.primary,textDecoration:"underline",cursor:"pointer",overflowWrap:"break-word"},...t&&{backgroundColor:e.palette.primary.main,color:"#fff !important"},...a&&{background:"#000",color:"#fff"}})),u=(0,i.Ay)("div",{name:c,slot:"uiChatMsgItemBodyInnerWrapper",shouldForwardProp:e=>"isOwner"!==e&&"filter"!==e&&"isSearch"!==e})(({theme:e,isOwner:t,filter:n,isSearch:a})=>({display:"flex",flexDirection:"column",alignItems:"flex-start",...!a&&t&&!n&&{alignItems:"flex-end"}}));function p({message:e,isOwner:t,createdDate:n,tooltipPosition:i,isSearch:c=!1,showActiveSearch:p=!0}){let h=e.message?(0,a.Ay)(e.message,{mentions:e.mentions}):null,f=null==e?void 0:e.extra,w=(0,m.nb)(null==e?void 0:e.room_id),{msgSearch:y}=w||{},v=p&&y&&((null==y?void 0:y.mQuoteId)===(null==e?void 0:e.id)||(null==y?void 0:y.id)===(null==e?void 0:e.id))&&(null==y?void 0:y.mode)!==d.Dn;return l.createElement(r.A,{title:n,placement:i,PopperProps:{disablePortal:!0}},l.createElement(u,{isOwner:t,filter:null==e?void 0:e.filtered,isSearch:c},f?l.createElement(s.A,{dataQuote:f,isOwner:t,isSearch:c}):null,h?l.createElement(g,{activeSearch:v,isQuote:Boolean(f),isOwner:t,className:"uiChatMsgItemMsg",dangerouslySetInnerHTML:{__html:h}}):null,l.createElement(o.Ay,{message:e,isOwner:t})))}},68536(e,t,n){n.d(t,{A:()=>W});var a=n(96610),i=n(91557),r=n(3556),l=n(87773),o=n(89481),s=n(8051),m=n(96540),d=n(40515),c=n(55737),g=n(15535),u=n(62193),p=n.n(u),h=n(12561),f=n(19740),w=n(69709),y=n(771);let v="MsgQuote",A=(0,r.Ay)("div",{name:v,slot:"RootMsg",shouldForwardProp:e=>"isOwner"!==e&&"isSearch"!==e})(({theme:e,isOwner:t,isSearch:n})=>({marginBottom:e.spacing(-2),marginLeft:e.spacing(1),marginRight:0,marginTop:e.spacing(.25),paddingBottom:e.spacing(3),maxWidth:"calc(100% - 8px)",display:"flex",flexDirection:"row",overflow:"hidden",border:e.mixins.border("secondary"),borderRadius:e.spacing(1),minHeight:"70px",position:"relative",...!n&&{cursor:"pointer"},"& a:not(.MuiAvatar-root)":{color:e.palette.text.primary,textDecoration:"underline",cursor:"pointer"},...t&&{color:e.palette.text.secondary,marginRight:e.spacing(1),marginLeft:0}})),x=(0,r.Ay)("div",{name:v,slot:"Author"})(({theme:e})=>({display:"flex",justifyContent:"flex-start",alignItems:"center","& .MuiAvatar-root":{fontSize:e.mixins.pxToRem(7)},strong:{padding:e.spacing(0,.5)}})),E=(0,r.Ay)("div",{name:v,slot:"MsgAttachmentFlex",shouldForwardProp:e=>"isAttachment"!==e})(({theme:e,isAttachment:t})=>({textAlign:"start",...t&&{maxWidth:"300px"}})),_=(0,r.Ay)(d.mE,{name:v,slot:"Text"})(({theme:e})=>({color:e.palette.text.secondary,margin:e.spacing(.5,0)})),k=(0,r.Ay)("div",{name:v,slot:"TextDelete"})(({theme:e})=>({margin:e.spacing(.5),marginLeft:0,fontStyle:"italic"})),I=(0,r.Ay)("div",{name:v,slot:"AttachmentInfo"})(({theme:e})=>({overflow:"hidden",margin:e.spacing(1,1,0,0)})),b=(0,r.Ay)("div")(({theme:e})=>({width:e.spacing(.5),height:"100%",backgroundColor:e.palette.grey["100"]})),M=(0,r.Ay)("div")(({theme:e})=>({width:e.spacing(3),minWidth:e.spacing(3),marginTop:e.spacing(1.5),display:"flex",justifyContent:"center",alignItems:"center"})),O=(0,r.Ay)(l.A)(({theme:e})=>({color:"light"===e.palette.mode?e.palette.grey.A200:e.palette.text.primary})),C=(0,r.Ay)(d.mE,{name:v,slot:"uiMsgAttachmentLink"})(({theme:e})=>({"& .ico":{fontSize:e.mixins.pxToRem(12),marginRight:e.spacing(.5)}})),P=(0,r.Ay)("div",{name:v,slot:"LoadingStyled"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",width:"100%",height:"100%",backgroundColor:(0,y.X4)(e.palette.background.paper,.7)}));function W({dataQuote:e,isOwner:t,isSearch:n=!1}){let{i18n:r,dispatch:l}=(0,i.PCX)(),u=(0,f.Zq)(null==e?void 0:e.room_id)||[],[y,v]=m.useState(!1),W=(0,f.nb)(null==e?void 0:e.room_id),{msgSearch:S}=W||{},{multiImageFile:F,attachments:R}=(0,c.tr)(null==e?void 0:e.attachments);if(!e)return null;let{user:$,message:T}=e,D=(0,h.R$)({msg:e,messagesDelete:u}),j=()=>{v(!1)},B=()=>{n||"messageDeleted"===D||y||(v(!0),l({type:w.H5,payload:{roomId:null==e?void 0:e.room_id,mid:null==e?void 0:e.id,limit:20,operate:"all",mode:"quote"},meta:{onSuccess:j}}))};return m.createElement(A,{isOwner:t,onClick:B,isSearch:n},!p()(S)&&y?m.createElement(P,{"data-testid":"loadingIndicator"},m.createElement(o.A,{size:20})):null,m.createElement(M,null,m.createElement(b,null)),m.createElement(I,null,$?m.createElement(x,null,m.createElement(O,{component:"h2",variant:"h5"},$.full_name||$.user_name)):null,m.createElement(E,{isAttachment:R.length},"messageDeleted"===D?m.createElement(k,null,r.formatMessage({id:"message_was_deleted"})):null,p()(T)||"messageDeleted"===D?null:m.createElement(_,{lines:1,dangerouslySetInnerHTML:{__html:(0,a.Ay)(T)}}),"messageDeleted"!==D&&R&&(null==R?void 0:R.length)?m.createElement(s.A,{sx:{mt:1}},F.length>1?m.createElement(_,{lines:1},r.formatMessage({id:"total_photo"},{value:F.length})):m.createElement(m.Fragment,null,R.map((e,n)=>m.createElement(m.Fragment,{key:`k${n}`},e.is_image&&e.image?m.createElement(g.A,{item:e,isOwner:t,allowOpenPreview:!1}):m.createElement(C,{lines:1},m.createElement(d.s4,{icon:"ico-paperclip-alt"}),e.file_name))))):null)))}},19740(e,t,n){n.d(t,{nb:()=>o,Zq:()=>s,iw:()=>l,In:()=>u,f3:()=>c,EH:()=>d,wg:()=>m,eL:()=>g,Dr:()=>r.A,iW:()=>p,oT:()=>h});var a=n(71468),i=n(99477),r=n(44031);function l(){return(0,a.d4)(e=>(0,i.Tr)(e))}let o=e=>(0,a.d4)(t=>(0,i.rS)(t,e)),s=e=>(0,a.d4)(t=>(0,i.vF)(t,e));function m(e){return(0,a.d4)(t=>(0,i.Ax)(t,e))}let d=()=>(0,a.d4)(i.x2),c=()=>(0,a.d4)(i.yr),g=()=>(0,a.d4)(i.Eq),u=()=>(0,a.d4)(i.pR),p=e=>(0,a.d4)(t=>(0,i.gQ)(t,e)),h=()=>(0,a.d4)(i.t8)},44031(e,t,n){n.d(t,{A:()=>l,a:()=>m});var a=n(91557),i=n(71468),r=n(1081);function l(){let{getSetting:e}=(0,a.PCX)(),t=e("preaction.reaction_list",[]).filter(e=>e.is_active),n=e("preaction.inactive_reaction_list",[]),i=[...t,...n];return(null==i?void 0:i.length)?i:[]}let o=e=>(e.preaction.data.reactions||[]).filter(e=>e.is_active),s=(0,r.Mz)(o,e=>e);function m(){return(0,i.d4)(s)}},96610(e,t,n){n.d(t,{Ay:()=>g,Nj:()=>c,XC:()=>u});var a=n(69709),i=n(12561),r=n(14425),l=n.n(r);function o(e){return e.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2")}function s(e,t={}){let{mentions:n=[]}=t,a=e.replace(/\[(\s)*\]\(([^\)]+)\)/gm,"");return n&&n.length>0&&(a=a.replace(/@([^\s\\#@:]+)/giu,(e,t)=>{let a=n.find(e=>e.username===t);return a&&a.name?`@${a.name}`:e})),a}function m(e,t={}){let{mentions:n=[]}=t,a=e.replace(/@\[([^\]]+)\]\(([^#@:]+)\)/giu,"<a onclick=\"triggerClick('$2')\">@$1</a>");return n&&n.length>0&&(a=a.replace(/@([^\s\\#@:]+)/giu,(e,t)=>{let a=n.find(e=>e.username===t);return a&&a.name?`<a onclick="triggerClick('/${t}')">@${a.name}</a>`:e})),a}window.triggerClick=i.NK;let d=e=>e.replace(/:\w+:/gi,e=>e),c=(e,t={})=>e?s(e,t):null;function g(e,t={}){var n;return e?o(d(m((n=s(e),l()(n)).replace(a._t,e=>{let t=e.startsWith("http")?e:`https://${e}`;return`<a href="${t}" target="_blank">${t}</a>`}),t))):null}function u(e,t=null,n=!0){var a;let i=null==e?void 0:e.type;if(["messageDelete","delete"].includes(i)){let r=[{id:"you_deleted_a_message"}];return n||(r=t?[{id:"user_message_is_removed",user:t.full_name||t.user_name}]:[{id:"message_was_deleted"}]),r}return(null==e?void 0:e.message)?o(d(m((a=s(null==e?void 0:e.message),l()(a)),{mentions:[]}))):null}}}]);