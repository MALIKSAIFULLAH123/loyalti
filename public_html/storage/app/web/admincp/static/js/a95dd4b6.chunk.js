"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-livestreaming-blocks-LiveComment-CommentContainer"],{43498(e,t,i){i.d(t,{Ui:()=>u,ET:()=>v}),i(96602);var n=i(96540),a=i(91557),l=i(70223),o=i(11497),r=i(656),s=i(78292);let m=new class{bootstrap(e,t){this.manager=e,this.settingApp=this.manager.getSetting("firebase"),this.settingApp&&this.init(this.settingApp,t)}checkActive(){return this.isActive}init(e,t){if(this.mounted)return this.firebaseApp;this.mounted=!0;let i={apiKey:a.z0J,authDomain:a.wRL,projectId:a.wWR,storageBucket:a.npo,messagingSenderId:a.AfL,appId:a.Kou};this.config=e;try{let n=(0,l.Wp)(i),o=(0,r.xI)(n),{user_firebase_email:s,user_firebase_password:m,requiredSignin:c}=this.settingApp||{};return c&&(0,r.x9)(o,s,m).then(e=>{}).catch(e=>{console.log("Live Video - Firebase signInWithEmailAndPassword error",e),"auth/user-not-found"===e.code&&(0,r.eJ)(o,s,m)}),t(!0),this.firebaseApp=n,this.isActive=!0,n}catch(d){this.isActive=!1}}getFirebaseApp(){return this.firebaseApp}getFirestore(){if(!this.firebaseApp)return null;if(!this.firestore){let e=(0,o.aU)(this.firebaseApp);e&&(this.firestore=e)}return this.firestore}getMessaging(){if(!this.firebaseApp)return null;if(!this.cloudMessage){let e=(0,s.dG)(this.firebaseApp);e&&(this.cloudMessage=e)}return this.cloudMessage}},c=!1,d=!1;function u(){let[e,t]=function(){let e=(0,a.PCX)(),[t,i]=n.useState(!1);return t||c||(c=!0,m.bootstrap(e,()=>{d=!0,i(!0)})),[t||d,m]}();if(!e)return!1;let i=t.getFirestore();return i}let p=(e,t)=>{let[i,a]=(0,n.useState)();return(0,n.useEffect)(()=>{let i;if(e&&(null==t?void 0:t.collection)&&(null==t?void 0:t.docID)){try{let n=(0,o.H9)(e,t.collection,t.docID);i=(0,o.aQ)(n,async e=>{a(e.data())})}catch(l){}return()=>{null==i||i()}}},[]),i},v=p},92287(e,t,i){i.d(t,{A:()=>f});var n=i(90243),a=i(40515),l=i(3556),o=i(87773),r=i(96540),s=i(91557),m=i(67725);function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}let d="CommentExtraData",u=(0,l.Ay)("div",{name:d,slot:"extraDataPhoto"})(({theme:e})=>({maxWidth:e.spacing(26),cursor:"pointer"})),p=(0,l.Ay)("div",{name:d,slot:"extraDataSticker"})(({theme:e})=>({width:e.spacing(10),height:e.spacing(10)})),v=(0,l.Ay)("div",{name:d,slot:"bubbleExtraData"})(({theme:e})=>({marginTop:e.spacing(1)}));function h(e){let{extra_data:t}=e,{extra_type:i,image:n,params:l}=Object.assign({},t),{dispatch:o,jsxBackend:d}=(0,s.PCX)(),h=d.get("feedArticle.comment.embedItem");if(!t)return null;let g=(0,m.AE)(n,"500"),f=e=>{o({type:"photo/presentSimplePhoto",payload:{src:e,alt:"photo",identity:null==t?void 0:t._identity}})},b=null;switch(i){case"photo":case"storage_file":b=r.createElement(u,{onClick:()=>f(g)},r.createElement(a._V,{src:g,alt:"photo",shape:"radius"}));break;case"sticker":b=r.createElement(p,null,r.createElement(a._V,{src:g,alt:"sticker",aspectRatio:"fixed",imageFit:"contain"}));break;case"link":b=(null==l?void 0:l.is_image)?r.createElement(u,{onClick:()=>f(null==l?void 0:l.image)},r.createElement(a._V,{src:null==l?void 0:l.image,alt:"photo",shape:"radius"})):(null==l?void 0:l.is_hidden)?null:r.createElement(h,c({},l,{widthImage:"90px"}))}return b?r.createElement(v,null,b):null}let g=(0,l.Ay)("div",{name:"CommentContent",slot:"bubbleText"})(({theme:e})=>({display:"block",fontSize:e.mixins.pxToRem(15),transition:"background 300ms ease","& a":{color:e.palette.primary.main,fontWeight:e.typography.fontWeightRegular,"&:hover":{textDecoration:"underline"}}}));function f({text:e,extra_data:t,isHidden:i}){let{i18n:l}=(0,s.PCX)();return r.createElement("div",null,i?r.createElement(g,null,r.createElement(o.A,{component:"h1",variant:"body1",color:"text.hint"},l.formatMessage({id:"comment_hidden"}))):r.createElement(r.Fragment,null,r.createElement(g,null,r.createElement(a.Zn,{truncateProps:{variant:"body1",lines:3}},r.createElement(n.Ay,{html:e}))),r.createElement(h,{extra_data:t})))}},72974(e,t,i){i.r(t),i.d(t,{default:()=>A});var n=i(91557),a=i(96540),l=i(3556),o=i(40515),r=i(8051),s=i(92287);let m="PreFetchComment",c=(0,l.Ay)("div",{name:m,slot:"itemOuter"})(({theme:e})=>({display:"flex",opacity:.6,pointerEvents:"none","&:hover $ItemActionMenu":{visibility:"visible",marginLeft:e.spacing(.5)}})),d=(0,l.Ay)("div",{name:m,slot:"avatarWrapper"})(({theme:e})=>({marginRight:e.spacing(1)})),u=(0,l.Ay)("div",{name:m,slot:"itemInner"})(({theme:e})=>({display:"flex",flexDirection:"column",minWidth:0,wordBreak:"break-word"})),p=(0,l.Ay)("div",{name:m,slot:"itemName"})(({theme:e})=>({display:"flex",fontSize:e.mixins.pxToRem(13),marginBottom:e.spacing(.5)})),v=(0,l.Ay)(o.xE,{name:m,slot:"userName"})(({theme:e})=>({fontSize:e.mixins.pxToRem(13),maxWidth:"100%",fontWeight:"bold"})),h=(0,l.Ay)("div",{name:m,slot:"actions"})(({theme:e})=>({display:"inline-flex",alignItems:"center",height:e.spacing(4)}));function g({text:e}){let{useSession:t,ReactionActButton:i,ReplyActButton:l}=(0,n.PCX)(),{user:m}=t();return a.createElement("div",{"data-testid":"comment"},a.createElement(r.A,{pt:1},a.createElement(c,null,a.createElement(d,null,a.createElement(o.H8,{user:m,size:32})),a.createElement(u,null,a.createElement(r.A,{p:0,borderRadius:2},a.createElement(p,null,a.createElement(v,{to:`/user/${m.id}`,user:m})),a.createElement(s.A,{text:e})),a.createElement(h,{className:"dotSeparators"},i&&a.createElement(i,{minimize:!0}),l&&a.createElement(l,{minimize:!0}))))))}let f=(0,l.Ay)("div",{name:"CommentListRoot"})(({theme:e})=>{var t;return{position:"relative","& $CommentRoot:first-of-type":{marginTop:e.spacing(1)},"& $CommentRoot:last-child":{borderBottom:"solid 1px",borderBottomColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary,paddingBottom:e.spacing(2),[e.breakpoints.down("sm")]:{borderBottom:"none"}}}}),b=(0,l.Ay)("div",{name:"CommentListRoot"})(({theme:e})=>{var t;return{position:"relative","&:before":{content:'""',position:"absolute",top:e.spacing(6),bottom:e.spacing(2),left:e.spacing(2),borderLeft:"solid 1px",borderLeftColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary}}});function y({identity:e,data:t,scrollToBottom:i,setParentReply:l}){let{useGetItem:o,jsxBackend:r}=(0,n.PCX)(),s=r.get("CommentItemViewLiveStreaming"),m=o(e),{preFetchingComment:c}=m||{},d=c&&Object.values(c).some(e=>(null==e?void 0:e.isLoading)===!0);return(a.useEffect(()=>{i&&i()},[d,i]),s)?a.createElement(f,null,(null==t?void 0:t.length)?t.map(e=>a.createElement(b,{key:null==e?void 0:e.id},a.createElement(s,{itemLive:e,identity:`comment.entities.comment.${null==e?void 0:e.id}`,setParentReply:l}))):null,c?Object.values(c).filter(e=>(null==e?void 0:e.isLoading)===!0).map(e=>a.createElement(b,{key:e},a.createElement(g,{text:e.text}))):null):null}var E=i(43498);let A=(0,n.G5k)(function({streamKey:e,identity:t,scrollToBottom:i,setParentReply:l}){var o;let{dispatch:r,useGetItem:s,getSetting:m}=(0,n.PCX)(),c=s(t),d=m("comment"),u=(0,E.Ui)(),p=(0,E.ET)(u,{collection:"live_video_comment",docID:e}),v=null==p?void 0:p.total_comment;if(a.useEffect(()=>{var e,i;(null==c?void 0:null===(e=c.statistic)||void 0===e?void 0:e.total_comment)!==v&&r({type:"livestreaming/updateStatistic",payload:{identity:t,statistic:{total_comment:v||(null==c?void 0:null===(i=c.statistic)||void 0===i?void 0:i.total_comment)}}})},[v,null==c?void 0:null===(o=c.statistic)||void 0===o?void 0:o.total_comment]),a.useEffect(()=>{r({type:"livestreaming/updateComment",payload:{data:null==p?void 0:p.comment}})},[null==p?void 0:p.comment]),!e||!p)return null;let h=null==p?void 0:p.comment.slice(Math.max((null==p?void 0:p.comment.length)-20,0));return d?a.createElement(y,{data:h,identity:t,scrollToBottom:i,setParentReply:l}):null})}}]);