(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-story-blocks-ViewStoryMobile-Block"],{24713(e,t,i){var o=i(2523),l=i(15389),n=i(61489),a=Math.max;e.exports=function(e,t,i){var d=null==e?0:e.length;if(!d)return -1;var r=null==i?0:n(i);return r<0&&(r=a(d+r,0)),o(e,l(t,3),r)}},44237(e,t,i){"use strict";i.r(t),i.d(t,{default:()=>A});var o=i(91557),l=i(44562),n=i(32113),a=i(51147),d=i(85332),r=i(3556),s=i(8051),u=i(62193),v=i.n(u),y=i(96540),p=i(71468);let c="StoryViewMobile",f=(0,r.Ay)(s.A,{name:c,slot:"Root",overridesResolver:(e,t)=>[t.root]})(({theme:e})=>({display:"flex",width:"100%",height:"100%",position:"fixed",top:0,right:0,left:0})),g=(0,r.Ay)(s.A,{name:c,slot:"SideBarWrapper",overridesResolver:(e,t)=>[t.buddyWrap]})(({theme:e})=>({width:"360px",backgroundColor:e.palette.background.paper})),S=(0,r.Ay)(s.A,{name:c,slot:"room-wrap"})(({theme:e})=>({flex:1,minWidth:0,display:"flex",justifyContent:"center",alignItems:"center"})),m=(0,o.WvA)({name:"StoryViewBlock",extendBlock:function(e){let{jsxBackend:t,dispatch:i,createErrorPage:r,useGetItem:s}=(0,o.PCX)(),[u,c]=(0,y.useReducer)(a.l,{...n.x6}),m=y.useRef(!1),{muted:A,isEditMuted:h=!1}=(0,d.F_)(),{identityStoryActive:_,identityUserStoryActive:b,isReady:w,listUserStories:x}=u||{},k=s(b),I=(0,o.UfA)(null==k?void 0:k.stories),R=(0,p.d4)(e=>(0,o.qRQ)(e,l.Qz)),C=s(_),O=null==I?void 0:I.findIndex(e=>(null==e?void 0:e.id)===(null==C?void 0:C.id)),L=y.useMemo(()=>I.length-1===O,[I,O]),P=t.get("story.block.sidebarHomeStory"),U=t.get("story.block.mainViewHomeMobile");return(y.useEffect(()=>{c({type:"setReady",payload:!1})},[]),y.useEffect(()=>{var e,t;if(m.current||!(null==I?void 0:I.length))return;m.current=!0;let i=null==I?void 0:I.findIndex(e=>{var t;return e.type===l.UZ&&null!=e&&null!==(t=e.extra_params)&&void 0!==t&&!!t.is_streaming||!1===e.has_seen});c({type:"setIdentityStoryActive",payload:-1===i?null===(e=I[0])||void 0===e?void 0:e._identity:null===(t=I[i])||void 0===t?void 0:t._identity})},[null==I?void 0:I.length]),y.useEffect(()=>{var e,t;let i=null==I?void 0:I.findIndex(e=>{var t;return e.type===l.UZ&&null!=e&&null!==(t=e.extra_params)&&void 0!==t&&!!t.is_streaming||!1===e.has_seen});c({type:"setIdentityStoryActive",payload:-1===i?null===(e=I[0])||void 0===e?void 0:e._identity:null===(t=I[i])||void 0===t?void 0:t._identity})},[null==k?void 0:k.id,null==x?void 0:x.length]),y.useEffect(()=>{if(!v()(C)){if(!(null==C?void 0:C.in_process)&&!C.has_seen){var e,t;if(!w&&!(null===(e=window.navigator)||void 0===e?void 0:null===(t=e.userActivation)||void 0===t?void 0:t.hasBeenActive))return;i({type:"story/updateView",payload:{story:C,lastStory:L,identityUser:b}})}c({type:"setReactions",payload:[]}),c({type:"setOpenViewComment",payload:!1})}},[null==C?void 0:C._identity,L,w]),y.useEffect(()=>{var e,t;!v()(C)&&h&&(null===(e=window.navigator)||void 0===e?void 0:null===(t=e.userActivation)||void 0===t?void 0:t.hasBeenActive)&&c({type:"setMuted",payload:A})},[h,A,c,C]),null==R?void 0:R.error)?r(null==R?void 0:R.error,{loginRequired:!0}):y.createElement(n.MO.Provider,{value:{...u,fire:c,indexStoryActive:O}},y.createElement(f,null,y.createElement(g,{style:{display:"none"}},y.createElement(P,null)),y.createElement(S,null,y.createElement(U,null))))}}),A=m},32113(e,t,i){"use strict";i.d(t,{vZ:()=>a,MO:()=>r,x6:()=>s});var o=i(91262),l=i(96540);let n=l.createContext({status:null,setStatus(){},setFilePhoto(){},filePhoto:null,setUploading(){},uploading:!1,setIsDirty(){},isDirty:!1,isSubmitting:!1,setIsSubmitting(){}}),a=n,d=l.createContext({}),r=d,s={identityStoryActive:void 0,identityUserStoryActive:void 0,listUserStories:[],pauseStatus:o.ZR.No,reactions:[],indexStoryActive:void 0,openStoryDetail:!1,openViewComment:!1,openActionItem:!1,readyStateFile:!1,progressVideoPlay:0,isLastStory:!1,isReady:!1,mutedStatus:!0,buffer:!1}},51147(e,t,i){"use strict";i.d(t,{l:()=>l});var o=i(16535);let l=(0,o.Ay)((e,t)=>{switch(t.type){case"setListUserStories":e.listUserStories=t.payload;break;case"setReactions":e.reactions=t.payload;break;case"setIdentityStoryActive":e.identityStoryActive=t.payload;break;case"setIdentityUserS_Active":e.identityUserStoryActive=t.payload;break;case"setForcePause":e.pauseStatus=t.payload;break;case"setOpenStoryDetail":e.openStoryDetail=t.payload;break;case"setOpenViewComment":e.openViewComment=t.payload;break;case"setOpenActionItem":e.openActionItem=t.payload;break;case"setReadyStateFile":e.readyStateFile=t.payload;break;case"setProgressVideoPlay":e.progressVideoPlay=t.payload;break;case"setIndexStoryActive":e.indexStoryActive=t.payload;break;case"setLastStory":e.isLastStory=t.payload;break;case"setReady":e.isReady=t.payload;break;case"setMuted":e.mutedStatus=t.payload;break;case"setDuration":e.durationVideo=t.payload;break;case"setBuffer":e.buffer=t.payload}})},79655(e,t,i){"use strict";i.d(t,{A:()=>p,n:()=>v});var o=i(91557),l=i(24713),n=i.n(l),a=i(58156),d=i.n(a),r=i(44562),s=i(95093),u=i.n(s);let v=(e,t,i=3)=>t<i?"prev":t>e-i-1?"next":"",y=(e,t)=>{let{identity:i}=t,o=d()(e,i),l=new URL(window.location.href),a=new URLSearchParams(l.search).get("date");if(!o)return{};let s=u()(a).format("L"),y=`${r.Lp}/${s}`,p=d()(e,`pagination.${y}.ids`),c=d()(e,`pagination.${y}.pagesOffset.total`),f=d()(e,`pagination.${y}.ended`),g=d()(e,`pagination.${y}.pagesOffset.next_date`),S=d()(e,`pagination.${y}.pagesOffset.prev_date`),m=f?1:d()(e,`pagination.${y}.pagesOffset.current_page`),A=d()(e,`pagination.${y}.pagesOffset.per_page`),h=(null==o?void 0:o.user)?d()(e,o.user):void 0,_=null==p?void 0:p.length,b=1<_?n()(p,e=>e===i):-1,w=-1!==b?b:0,x=f?w:d()(e,`pagination.${y}.pagesOffset.pos`)||0,k={item:o,stories:p,user:h,total:c,nextDate:g,prevDate:S,pagingId:y,date:a,indexStoryActive:w,positionStory:A*(m-1)+x,shouldPreload:v(_,x+1)};return k},p=(0,o.NgA)(y)},85332(e,t,i){"use strict";i.d(t,{Ay:()=>v,F_:()=>f,P3:()=>p,Tq:()=>g,Uf:()=>c,aN:()=>A,vC:()=>y});var o=i(96540),l=i(32113),n=i(91557),a=i(44562),d=i(71468),r=i(69634),s=i(79655),u=i(1081);function v(){return o.useContext(l.vZ)}function y(){return o.useContext(l.MO)}function p(){var e,t;let{navigate:i,useGetItem:l}=(0,n.PCX)(),{listUserStories:a,identityUserStoryActive:d,identityStoryActive:r,fire:s}=y(),u=l(d),v=l(r),p=(0,n.UfA)(null==u?void 0:u.stories),c=null==p?void 0:p.findIndex(e=>(null==e?void 0:e.id)===(null==v?void 0:v.id)),f=null==a?void 0:a.findIndex(e=>(null==e?void 0:e.id)===(null==u?void 0:u.id)),g=(null==p?void 0:null===(e=p[0])||void 0===e?void 0:e.id)===(null==v?void 0:v.id),S=(null==u?void 0:u.stories.length)-1===c,m=(null==a?void 0:null===(t=a[0])||void 0===t?void 0:t.id)===(null==u?void 0:u.id)&&g,A=(null==a?void 0:a.length)-1===f&&S,h=!m,_=!A,b=o.useCallback(()=>{var e,t;if(h&&-1!==c){if(g){s({type:"setIdentityUserS_Active",payload:null===(t=a[f-1])||void 0===t?void 0:t._identity});return}s({type:"setIdentityStoryActive",payload:null==p?void 0:null===(e=p[c-1])||void 0===e?void 0:e._identity})}},[h,c,g,a,p,f]),w=o.useCallback(()=>{var e,t;if(A){i("/");return}if(_&&-1!==c){if(S){s({type:"setIdentityUserS_Active",payload:null===(t=a[f+1])||void 0===t?void 0:t._identity});return}s({type:"setIdentityStoryActive",payload:null==p?void 0:null===(e=p[c+1])||void 0===e?void 0:e._identity})}},[A,_,c,S,a,f,p]);return{hasPrev:h,hasNext:_,handlePrev:b,handleNext:w}}function c(e){let[t,i]=o.useState(0),[l,n]=o.useState(0),d=o.useRef(),r=o.useCallback(()=>{var o;if(!(null==e?void 0:e.current))return[t,l];let d=null==e?void 0:null===(o=e.current)||void 0===o?void 0:o.getBoundingClientRect(),r=(null==d?void 0:d.height)/a.us,s=null==d?void 0:d.height;window.screen.width<=r&&(s=(r=window.screen.width)*a.us),n(s),i(r)},[null==e?void 0:e.current]);return o.useEffect(()=>{var t;let i=e.current;if(i)return d.current=new ResizeObserver(()=>{r()}),r(),null===(t=d.current)||void 0===t||t.observe(i),()=>{null==d||d.current.disconnect()}},[r,null==e?void 0:e.current]),[t,l,r]}function f(){return(0,d.d4)(e=>(0,r.s)(e))}function g(){var e,t;let i=y(),{fire:l,stories:a,indexStoryActive:r,nextDate:u,prevDate:v,identityStoryActive:p,loading:c,total:f,positionStory:g,pagingId:S}=i,m=(0,d.d4)(e=>(0,n.qRQ)(e,S))||{},{prev_page:A,last_page:h,current_page:_}=(null==m?void 0:m.pagesOffset)||{},{useGetItem:b,useGetItems:w,dispatch:x,usePageParams:k}=(0,n.PCX)(),I=k(),R=b(p),C=w(a),O=(null==C?void 0:null===(e=C[0])||void 0===e?void 0:e.id)===(null==R?void 0:R.id)&&0===A,L=(null==a?void 0:a[(null==a?void 0:a.length)-1])===p&&h===_,P=!(!v&&O),U=!(!u&&L),E=(null==a?void 0:a[(null==a?void 0:a.length)-1])===p&&h!==_,V=(null==C?void 0:null===(t=C[0])||void 0===t?void 0:t.id)===(null==R?void 0:R.id)&&0!==A,M=(e,t=()=>{})=>{var o;let n=e=>{var t;let i=null==e?void 0:e.pagingId,o=null==e?void 0:e.ids;if(!i||!(null==o?void 0:o.length))return;let n=null==e?void 0:null===(t=e.pagesOffset)||void 0===t?void 0:t.total;l({type:"setInit",payload:{stories:o,total:n,loading:!1}})},a=(0,s.n)(null==i?void 0:null===(o=i.stories)||void 0===o?void 0:o.length,e);if(!a){t&&t();return}t&&t(),x({type:"story/story_archive/LOAD",payload:{user_id:null==I?void 0:I.user_id,date:null==i?void 0:i.date,direction:a},meta:{onSuccess:n}})},D=(e,t)=>{var i,o,n;let a=null==e?void 0:e.pagingId,d=null==e?void 0:e.ids;if(!a||!(null==d?void 0:d.length))return;let r=null==e?void 0:null===(i=e.pagesOffset)||void 0===i?void 0:i.total,s=null==e?void 0:null===(o=e.pagesOffset)||void 0===o?void 0:o.next_date,u=null==e?void 0:null===(n=e.pagesOffset)||void 0===n?void 0:n.prev_date;l({type:"setLoading",payload:!1}),l({type:"setInit",payload:{isReady:!1,stories:d,total:r,nextDate:s,prevDate:u,indexStoryActive:0,positionStory:0,identityStoryActive:null==d?void 0:d[0],pagingId:a,date:t}})},$=()=>{l({type:"setLoading",payload:!1})},F=o.useCallback(()=>{if(V&&l({type:"setLoading",payload:!0}),!c&&P&&!V){if(O){l({type:"setLoading",payload:!0}),x({type:"story/story_archive/LOAD",payload:{user_id:null==I?void 0:I.user_id,date:v},meta:{onSuccess:e=>D(e,v),onError:$}});return}M(r-1),l({type:"setStoryActive",payload:{identity:null==a?void 0:a[r-1],index:r-1,positionStory:g-1}})}},[P,a,r,O,c,V,M,g,C,v]),B=o.useCallback(()=>{if(E&&l({type:"setLoading",payload:!0}),!c&&U&&!E){if(L){l({type:"setLoading",payload:!0}),x({type:"story/story_archive/LOAD",payload:{user_id:null==I?void 0:I.user_id,date:u},meta:{onSuccess:e=>D(e,u),onError:$}});return}M(r+1),l({type:"setStoryActive",payload:{identity:null==a?void 0:a[r+1],index:r+1,positionStory:g+1}})}},[U,a,r,L,f,E,c,M,u,g,C]);return{hasPrev:P,hasNext:U,handlePrev:F,handleNext:B,loadmore:M}}let S=e=>(e.preaction.data.reactions||[]).filter(e=>e.is_active),m=(0,u.Mz)(S,e=>e);function A(){return(0,d.d4)(m)}},91262(e,t,i){"use strict";var o,l,n,a,d,r,s,u;i.d(t,{ZR:()=>o,Zw:()=>l,dw:()=>a,gw:()=>n}),(d=o||(o={}))[d.No=0]="No",d[d.Pause=1]="Pause",d[d.Force=2]="Force",(r=l||(l={})).LANDSCAPE="landscape",r.PORTRAIT="portrait",(s=n||(n={})).Avatar="1",s.ThumbnailAndAvatar="2",(u=a||(a={})).Viewers="1",u.Comments="2"}}]);