(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["storyDetail"],{24713(e,t,n){var i=n(2523),l=n(15389),o=n(61489),a=Math.max;e.exports=function(e,t,n){var r=null==e?0:e.length;if(!r)return -1;var d=null==n?0:o(n);return d<0&&(d=a(r+d,0)),i(e,l(t,3),d)}},97326(e,t,n){"use strict";n.r(t),n.d(t,{default:()=>m});var i=n(96540),l=n(3556),o=n(8051),a=n(87773),r=n(88980),d=n(62193),s=n.n(d),u=n(91557);let c=(0,r.i7)`
    0% {
        bottom:0;
        opacity: 1;
    }
    30% {
        transform:translateX(30px);
        bottom: 30%;
        opacity: 1
    }
    70% {
       transform:translateX(0px);
       bottom: 70%;
       opacity: 1
    }
    100% {
        transform:translateX(30px);
        bottom: 100%;
        opacity: 0;
    }
`,p="FlyReaction",v=(0,l.Ay)(o.A,{name:p,slot:"ReactionIcon",shouldForwardProp:e=>"index"!==e})(({theme:e,index:t})=>({display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",animation:`${c} linear 2s forwards `,left:`calc(50% - ${Math.max(10*Math.floor(10*Math.random()),30)}%)`,bottom:"-32px",width:"24px",height:"24px","& img":{width:"100%",height:"100%"}})),y=(0,l.Ay)(a.A,{name:p,slot:"Wrapper",shouldForwardProp:e=>"backgroundColor"!==e})(({theme:e})=>({position:"absolute",left:"50%",transform:"translate(-50%,0)",bottom:0,width:"120px",height:"70%",pointerEvents:"none"})),m=i.memo(function({identity:e,data:t}){let n=(0,u.dx2)(e);return s()(t)||s()(n)?null:i.createElement(y,null,t.map((e,t)=>i.createElement(v,{key:`story_reaction_${t}`,index:t},i.createElement("img",{src:null==e?void 0:e.src,alt:null==e?void 0:e.title}))))},(e,t)=>{var n,i;return(null==e?void 0:e.identity)===(null==t?void 0:t.identity)&&(null===(n=e.data)||void 0===n?void 0:n.length)===(null==t?void 0:null===(i=t.data)||void 0===i?void 0:i.length)})},45192(e,t,n){"use strict";n.r(t),n.d(t,{default:()=>k});var i=n(96540),l=n(3556),o=n(8051),a=n(62193),r=n.n(a),d=n(97200),s=n.n(d),u=n(91557),c=n(40515),p=n(90243),v=n(85015),y=n.n(v);let m=(0,l.Ay)("div",{name:"CommentExtraData",slot:"bubbleExtraData"})(({theme:e})=>({display:"inline"}));function f(e){let{useGetItem:t,i18n:n}=(0,u.PCX)(),{extra_data:l,text:o}=e,a=l;y()(l)&&(a=t(l));let{extra_type:r}=Object.assign({},a);if(!a)return null;let d=null;switch(r){case"photo":case"storage_file":d=n.formatMessage({id:"comment_add_photo"});break;case"sticker":d=o?null:n.formatMessage({id:"comment_add_sticker"})}return d?i.createElement(c.mE,{variant:"body1",lines:1,style:{fontSize:"13px",color:"rgba(255, 255, 255, 0.9)"}},i.createElement(m,null,d)):null}var g=n(85332);let x="CommentStatisticStory",h=(0,l.Ay)(o.A,{name:x,slot:"root",shouldForwardProp:e=>"active"!==e})(({theme:e,active:t})=>({display:"flex",flexDirection:"column"})),b=(0,l.Ay)("div",{name:x,slot:"itemOuter"})(({theme:e})=>({width:"fit-content",display:"flex",marginTop:e.spacing(1),backgroundColor:"rgba(0, 0, 0, 0.4)",padding:e.spacing(.75,1.5),borderRadius:40,maxWidth:"100%",cursor:"pointer"})),A=(0,l.Ay)("div",{name:x,slot:"itemInner"})(({theme:e})=>({display:"flex",flexDirection:"column",minWidth:0,wordBreak:"break-word"})),S=(0,l.Ay)("div",{name:x,slot:"AvatarWrapper"})(({theme:e})=>({marginRight:e.spacing(1),display:"flex",alignItems:"center"})),E=(0,l.Ay)(c.mE,{name:x,slot:"ItemName"})(({theme:e})=>({display:"flex",fontSize:e.mixins.pxToRem(13),alignItems:"center"})),_=(0,l.Ay)(c.xE,{name:x,slot:"userName"})(({theme:e})=>({fontSize:e.mixins.pxToRem(13),maxWidth:"100%",pointerEvents:"none"})),w=(0,l.Ay)(o.A,{name:x,slot:"BoxMessageWrapper",overridesResolver:(e,t)=>[t.boxMessageWrapper]})(({theme:e})=>({color:"#fff",position:"relative","&:before":{content:'""',position:"absolute",left:"-4px",top:"-4px",right:"-4px",bottom:"-4px",borderRadius:e.shape.borderRadius,transition:"background 300ms ease",background:"none",pointerEvents:"none"}})),C=(0,l.Ay)("div",{name:"CommentContent",slot:"bubbleText"})(({theme:e})=>({display:"block",fontSize:e.mixins.pxToRem(15),transition:"background 300ms ease","& a":{color:"rgba(255, 255, 255, 0.9)",fontWeight:e.typography.fontWeightRegular,PointerEvent:"none"}})),R=({identity:e})=>{let{useGetItem:t}=(0,u.PCX)(),n=t(e),l=t(null==n?void 0:n.user),{openStoryDetail:a,fire:d,openViewComment:s}=(0,g.vC)(),v=()=>{a&&d({type:"setOpenStoryDetail",payload:!1}),d({type:"setOpenViewComment",payload:!s})};if(r()(n))return null;let{text:y,extra_data:m}=n||{};return i.createElement(b,{"data-testid":"statisticStory",onClick:v},i.createElement(S,null,i.createElement(c.H8,{user:l,size:32,noStory:!0,noLink:!0,hoverCard:!1})),i.createElement(A,null,i.createElement(w,{p:0,borderRadius:2},i.createElement(o.A,{sx:{position:"relative",zIndex:2}},i.createElement(E,{variant:"h5",lines:1,style:{fontSize:"13px"}},i.createElement(_,{to:`/user/${l.id}`,user:l,hoverCard:!1})),i.createElement(o.A,null,y?i.createElement(C,null,i.createElement(c.mE,{variant:"body1",lines:2,style:{fontSize:"13px",color:"rgba(255, 255, 255, 0.9)"}},i.createElement(p.Ay,{html:y}))):null,i.createElement(f,{text:y,extra_data:m}))))))},k=i.memo(function({identity:e}){let{useGetItem:t}=(0,u.PCX)(),n=t(e),{related_comments:l}=n||{};return r()(l)||r()(n)?null:i.createElement(h,null,l.slice(0,3).map(e=>i.createElement(R,{key:s()(e),identity:e})))},(e,t)=>(null==e?void 0:e.identity)===(null==t?void 0:t.identity))},14948(e,t,n){"use strict";n.r(t),n.d(t,{default:()=>h});var i=n(96540),l=n(3556),o=n(8051),a=n(97763),r=n(62193),d=n.n(r),s=n(97200),u=n.n(s),c=n(91557),p=n(40515);let v="StatisticSendReaction",y=(0,l.Ay)(o.A,{name:v,slot:"root",shouldForwardProp:e=>"active"!==e})(({theme:e})=>({display:"flex",flexDirection:"row",marginTop:e.spacing(1.5),"&:after":{position:"absolute",bottom:0,left:0,right:0,height:"42px",backgroundImage:"linear-gradient(0deg, rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.12) 50%, transparent)",content:'""',zIndex:2}})),m=(0,l.Ay)(o.A,{name:v,slot:"root",shouldForwardProp:e=>"active"!==e})(({theme:e})=>({display:"flex",marginRight:e.spacing(.5),width:"100%","& img":{minWidth:"18px"}})),f=(0,l.Ay)(p.mE,{name:v,slot:"SendReactionText"})(({theme:e})=>({marginLeft:e.spacing(1),flex:1,minWidth:0,zIndex:3})),g=(0,l.Ay)(o.A,{name:v,slot:"WrapperIcon"})(({theme:e})=>({display:"flex",zIndex:3})),x=({identity:e})=>{let{useGetItem:t}=(0,c.PCX)(),n=t(e);return d()(n)?null:i.createElement(m,{"aria-label":n.title,"data-testid":"itemReaction"},i.createElement(a.A,{title:n.title},i.createElement("img",{role:"button","aria-label":n.title,"data-testid":"itemReaction",src:n.icon,draggable:!1,width:"18px",height:"18px",alt:n.title})))},h=i.memo(function({identity:e}){let{i18n:t,useGetItem:n}=(0,c.PCX)(),l=n(e),o=n(null==l?void 0:l.user),{reactions:a}=l||{};return d()(a)||d()(l)?null:i.createElement(y,{"data-testid":"sendReaction"},i.createElement(g,null,a.slice(0,5).map(e=>i.createElement(x,{key:u()(e),identity:e}))),o?i.createElement(f,{component:"span",variant:"body2",lines:1,style:{color:"#fff"}},t.formatMessage({id:"sent_reation_to_user"},{name:null==o?void 0:o.full_name})):null)},(e,t)=>(null==e?void 0:e.identity)===(null==t?void 0:t.identity))},32113(e,t,n){"use strict";n.d(t,{vZ:()=>a,MO:()=>d,x6:()=>s});var i=n(91262),l=n(96540);let o=l.createContext({status:null,setStatus(){},setFilePhoto(){},filePhoto:null,setUploading(){},uploading:!1,setIsDirty(){},isDirty:!1,isSubmitting:!1,setIsSubmitting(){}}),a=o,r=l.createContext({}),d=r,s={identityStoryActive:void 0,identityUserStoryActive:void 0,listUserStories:[],pauseStatus:i.ZR.No,reactions:[],indexStoryActive:void 0,openStoryDetail:!1,openViewComment:!1,openActionItem:!1,readyStateFile:!1,progressVideoPlay:0,isLastStory:!1,isReady:!1,mutedStatus:!0,buffer:!1}},79655(e,t,n){"use strict";n.d(t,{A:()=>v,n:()=>c});var i=n(91557),l=n(24713),o=n.n(l),a=n(58156),r=n.n(a),d=n(44562),s=n(95093),u=n.n(s);let c=(e,t,n=3)=>t<n?"prev":t>e-n-1?"next":"",p=(e,t)=>{let{identity:n}=t,i=r()(e,n),l=new URL(window.location.href),a=new URLSearchParams(l.search).get("date");if(!i)return{};let s=u()(a).format("L"),p=`${d.Lp}/${s}`,v=r()(e,`pagination.${p}.ids`),y=r()(e,`pagination.${p}.pagesOffset.total`),m=r()(e,`pagination.${p}.ended`),f=r()(e,`pagination.${p}.pagesOffset.next_date`),g=r()(e,`pagination.${p}.pagesOffset.prev_date`),x=m?1:r()(e,`pagination.${p}.pagesOffset.current_page`),h=r()(e,`pagination.${p}.pagesOffset.per_page`),b=(null==i?void 0:i.user)?r()(e,i.user):void 0,A=null==v?void 0:v.length,S=1<A?o()(v,e=>e===n):-1,E=-1!==S?S:0,_=m?E:r()(e,`pagination.${p}.pagesOffset.pos`)||0,w={item:i,stories:v,user:b,total:y,nextDate:f,prevDate:g,pagingId:p,date:a,indexStoryActive:E,positionStory:h*(x-1)+_,shouldPreload:c(A,_+1)};return w},v=(0,i.NgA)(p)},85332(e,t,n){"use strict";n.d(t,{Ay:()=>c,F_:()=>m,P3:()=>v,Tq:()=>f,Uf:()=>y,aN:()=>h,vC:()=>p});var i=n(96540),l=n(32113),o=n(91557),a=n(44562),r=n(71468),d=n(69634),s=n(79655),u=n(1081);function c(){return i.useContext(l.vZ)}function p(){return i.useContext(l.MO)}function v(){var e,t;let{navigate:n,useGetItem:l}=(0,o.PCX)(),{listUserStories:a,identityUserStoryActive:r,identityStoryActive:d,fire:s}=p(),u=l(r),c=l(d),v=(0,o.UfA)(null==u?void 0:u.stories),y=null==v?void 0:v.findIndex(e=>(null==e?void 0:e.id)===(null==c?void 0:c.id)),m=null==a?void 0:a.findIndex(e=>(null==e?void 0:e.id)===(null==u?void 0:u.id)),f=(null==v?void 0:null===(e=v[0])||void 0===e?void 0:e.id)===(null==c?void 0:c.id),g=(null==u?void 0:u.stories.length)-1===y,x=(null==a?void 0:null===(t=a[0])||void 0===t?void 0:t.id)===(null==u?void 0:u.id)&&f,h=(null==a?void 0:a.length)-1===m&&g,b=!x,A=!h,S=i.useCallback(()=>{var e,t;if(b&&-1!==y){if(f){s({type:"setIdentityUserS_Active",payload:null===(t=a[m-1])||void 0===t?void 0:t._identity});return}s({type:"setIdentityStoryActive",payload:null==v?void 0:null===(e=v[y-1])||void 0===e?void 0:e._identity})}},[b,y,f,a,v,m]),E=i.useCallback(()=>{var e,t;if(h){n("/");return}if(A&&-1!==y){if(g){s({type:"setIdentityUserS_Active",payload:null===(t=a[m+1])||void 0===t?void 0:t._identity});return}s({type:"setIdentityStoryActive",payload:null==v?void 0:null===(e=v[y+1])||void 0===e?void 0:e._identity})}},[h,A,y,g,a,m,v]);return{hasPrev:b,hasNext:A,handlePrev:S,handleNext:E}}function y(e){let[t,n]=i.useState(0),[l,o]=i.useState(0),r=i.useRef(),d=i.useCallback(()=>{var i;if(!(null==e?void 0:e.current))return[t,l];let r=null==e?void 0:null===(i=e.current)||void 0===i?void 0:i.getBoundingClientRect(),d=(null==r?void 0:r.height)/a.us,s=null==r?void 0:r.height;window.screen.width<=d&&(s=(d=window.screen.width)*a.us),o(s),n(d)},[null==e?void 0:e.current]);return i.useEffect(()=>{var t;let n=e.current;if(n)return r.current=new ResizeObserver(()=>{d()}),d(),null===(t=r.current)||void 0===t||t.observe(n),()=>{null==r||r.current.disconnect()}},[d,null==e?void 0:e.current]),[t,l,d]}function m(){return(0,r.d4)(e=>(0,d.s)(e))}function f(){var e,t;let n=p(),{fire:l,stories:a,indexStoryActive:d,nextDate:u,prevDate:c,identityStoryActive:v,loading:y,total:m,positionStory:f,pagingId:g}=n,x=(0,r.d4)(e=>(0,o.qRQ)(e,g))||{},{prev_page:h,last_page:b,current_page:A}=(null==x?void 0:x.pagesOffset)||{},{useGetItem:S,useGetItems:E,dispatch:_,usePageParams:w}=(0,o.PCX)(),C=w(),R=S(v),k=E(a),I=(null==k?void 0:null===(e=k[0])||void 0===e?void 0:e.id)===(null==R?void 0:R.id)&&0===h,P=(null==a?void 0:a[(null==a?void 0:a.length)-1])===v&&b===A,O=!(!c&&I),L=!(!u&&P),D=(null==a?void 0:a[(null==a?void 0:a.length)-1])===v&&b!==A,$=(null==k?void 0:null===(t=k[0])||void 0===t?void 0:t.id)===(null==R?void 0:R.id)&&0!==h,z=(e,t=()=>{})=>{var i;let o=e=>{var t;let n=null==e?void 0:e.pagingId,i=null==e?void 0:e.ids;if(!n||!(null==i?void 0:i.length))return;let o=null==e?void 0:null===(t=e.pagesOffset)||void 0===t?void 0:t.total;l({type:"setInit",payload:{stories:i,total:o,loading:!1}})},a=(0,s.n)(null==n?void 0:null===(i=n.stories)||void 0===i?void 0:i.length,e);if(!a){t&&t();return}t&&t(),_({type:"story/story_archive/LOAD",payload:{user_id:null==C?void 0:C.user_id,date:null==n?void 0:n.date,direction:a},meta:{onSuccess:o}})},M=(e,t)=>{var n,i,o;let a=null==e?void 0:e.pagingId,r=null==e?void 0:e.ids;if(!a||!(null==r?void 0:r.length))return;let d=null==e?void 0:null===(n=e.pagesOffset)||void 0===n?void 0:n.total,s=null==e?void 0:null===(i=e.pagesOffset)||void 0===i?void 0:i.next_date,u=null==e?void 0:null===(o=e.pagesOffset)||void 0===o?void 0:o.prev_date;l({type:"setLoading",payload:!1}),l({type:"setInit",payload:{isReady:!1,stories:r,total:d,nextDate:s,prevDate:u,indexStoryActive:0,positionStory:0,identityStoryActive:null==r?void 0:r[0],pagingId:a,date:t}})},W=()=>{l({type:"setLoading",payload:!1})},F=i.useCallback(()=>{if($&&l({type:"setLoading",payload:!0}),!y&&O&&!$){if(I){l({type:"setLoading",payload:!0}),_({type:"story/story_archive/LOAD",payload:{user_id:null==C?void 0:C.user_id,date:c},meta:{onSuccess:e=>M(e,c),onError:W}});return}z(d-1),l({type:"setStoryActive",payload:{identity:null==a?void 0:a[d-1],index:d-1,positionStory:f-1}})}},[O,a,d,I,y,$,z,f,k,c]),T=i.useCallback(()=>{if(D&&l({type:"setLoading",payload:!0}),!y&&L&&!D){if(P){l({type:"setLoading",payload:!0}),_({type:"story/story_archive/LOAD",payload:{user_id:null==C?void 0:C.user_id,date:u},meta:{onSuccess:e=>M(e,u),onError:W}});return}z(d+1),l({type:"setStoryActive",payload:{identity:null==a?void 0:a[d+1],index:d+1,positionStory:f+1}})}},[L,a,d,P,m,D,y,z,u,f,k]);return{hasPrev:O,hasNext:L,handlePrev:F,handleNext:T,loadmore:z}}let g=e=>(e.preaction.data.reactions||[]).filter(e=>e.is_active),x=(0,u.Mz)(g,e=>e);function h(){return(0,r.d4)(x)}},91262(e,t,n){"use strict";var i,l,o,a,r,d,s,u;n.d(t,{ZR:()=>i,Zw:()=>l,dw:()=>a,gw:()=>o}),(r=i||(i={}))[r.No=0]="No",r[r.Pause=1]="Pause",r[r.Force=2]="Force",(d=l||(l={})).LANDSCAPE="landscape",d.PORTRAIT="portrait",(s=o||(o={})).Avatar="1",s.ThumbnailAndAvatar="2",(u=a||(a={})).Viewers="1",u.Comments="2"}}]);