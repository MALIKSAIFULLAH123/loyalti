(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-story-blocks-SidebarHome-Block"],{24713(e,t,i){var n=i(2523),l=i(15389),o=i(61489),r=Math.max;e.exports=function(e,t,i){var a=null==e?0:e.length;if(!a)return -1;var d=null==i?0:o(i);return d<0&&(d=r(a+d,0)),n(e,l(t,3),d)}},77054(e,t,i){"use strict";i.r(t),i.d(t,{default:()=>C});var n=i(91557),l=i(84680),o=i(85332),r=i(3556),a=i(87773),d=i(52705),s=i(8051),u=i(23181),v=i.n(u),c=i(58156),y=i.n(c),p=i(62193),f=i.n(p),g=i(84058),m=i.n(g),h=i(96540),S=i(71468);function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}let _=(0,r.Ay)(a.A,{name:"title"})(({theme:e})=>({marginBottom:e.spacing(2),padding:e.spacing(0,2)})),A=(0,r.Ay)(d.A,{name:"SkeletonSession"})(({theme:e})=>({margin:e.spacing(1,2),marginBottom:e.spacing(2)})),x=(0,r.Ay)(s.A,{name:"session"})(({theme:e})=>({marginBottom:e.spacing(1),marginTop:e.spacing(1.5)})),k=(0,n.hS2)(function({blockId:e,title:t,itemView:i,itemProps:r={},gridItemProps:a={},displayLimit:d=4,displayRowsLimit:u,pagingId:c,canLoadMore:p,handleUpdateLastRead:g,canLoadSmooth:k,loadMore:w,numberOfItemsPerPage:C,emptyPage:b="core.block.no_content",emptyPageProps:L,isLoadMoreScroll:I,errorPage:O}){let{jsxBackend:P,usePageParams:U,i18n:R,useWidthBreakpoint:D,useCachedBlockEmpty:B,useSession:M,useIsMobile:$,useGetItem:N}=(0,n.PCX)(),T=$(!0),F=U(),{user:V}=M(),{related_user_id:Z}=F||{},{identityUserStoryActive:q,fire:z,isLastStory:Q}=(0,o.vC)(),W=N(q),X=P.get(i),j=P.get("button.addCreateStory"),H=P.get(`${i}.skeleton`),[K,G]=(0,n.xWD)(!0),J=D(),Y=12/parseInt(y()(a,J)||12,10),ee=u?u*Y:d,[et,ei]=B(e),en=h.useRef(!1),[el,eo]=h.useState(1),er=(0,S.d4)(e=>(0,n.qRQ)(e,c))||(0,n.KCW)(),ea=h.useCallback(()=>{I&&el<=er.page&&eo(e=>e+1)},[I,el,er.page]);(0,n.ksV)(ea);let ed=h.useCallback(()=>{w(),eo(e=>e+1)},[c]);h.useEffect(()=>{G&&G()},[null==er?void 0:er.page,G]),h.useEffect(()=>{T||!I||(null==er?void 0:er.ended)||(null==er?void 0:er.loading)||K||(null==er?void 0:er.dirty)||ed()},[T,null==er?void 0:er.loading,null==er?void 0:er.page,I,null==er?void 0:er.ended,null==er?void 0:er.dirty,K,ed]);let es=2*Y;!p&&ee&&(es=ee);let{refreshing:eu,error:ev,ended:ec,initialized:ey,dirty:ep}=null!=er?er:{},ef=k&&I&&!ec,eg=p?er.ids.slice(0,el*(C||20)):er.ids.slice(0,ee||er.ids.length),em=(0,n.UfA)(eg);h.useEffect(()=>{let e=null==em?void 0:em.findIndex(e=>(null==e?void 0:e.id)===(null==W?void 0:W.id));(null==er?void 0:er.ended)||(null==er?void 0:er.loading)||-1===e||!(e>=em.length-1-4)||ed()},[null==er?void 0:er.loading,null==er?void 0:er.ended,ed,em,null==W?void 0:W.id]),h.useEffect(()=>{g&&g()},[el]),h.useEffect(()=>{eu&&!ep&&w()},[ey,eu]);let eh=em.findIndex(e=>e.id==Z);h.useEffect(()=>{if(ev||f()(em)){z({type:"setListUserStories",payload:[]});return}z({type:"setListUserStories",payload:em})},[em.length,ev]),h.useEffect(()=>{if(!en.current&&em.length){var e,t;if(en.current=!0,em[eh]){z({type:"setIdentityUserS_Active",payload:null===(t=em[eh])||void 0===t?void 0:t._identity});return}z({type:"setIdentityUserS_Active",payload:null===(e=em[0])||void 0===e?void 0:e._identity})}},[em.length,eh]);let eS=em.find(({id:e})=>(null==V?void 0:V.id)===e),eE=[...em];eS&&eE.shift();let e_=({item:e,isOwner:t})=>{var i,n;if(Q&&z({type:"setLastStory",payload:!1}),(null==W?void 0:W.id)===(null==e?void 0:e.id))return;if(t){z({type:"setIdentityUserS_Active",payload:null===(i=em[0])||void 0===i?void 0:i._identity});return}let l=em.findIndex(t=>(null==t?void 0:t.id)===(null==e?void 0:e.id));(null==em?void 0:em[l])&&z({type:"setIdentityUserS_Active",payload:null===(n=em[l])||void 0===n?void 0:n._identity})};if(!X)return null;if(a.xs||(a.xs=12),ev){if("hide"===O)return null;let eA=y()(ev,"response.data.error")||y()(ev,"response.data.message"),ex=403===y()(ev,"response.status")?"core.block.error403":"core.block.error404",ek=P.get(ex);return"default"===O?h.createElement(l.eB,null,h.createElement(l.Tw,{title:t,data:eg}),h.createElement(l.tD,null,h.createElement(ek,{title:eA}))):h.createElement(ek,{title:eA})}if(!eg.length&&(ec||et)||ev){if(et||ei(!0),"hide"===b)return null;if("string"!=typeof b)return b;let ew=P.get(b);if(!ew)return null;let{noBlock:eC,contentStyle:eb}=L||{};return eC?h.createElement(ew,E({},L)):h.createElement(l.eB,null,h.createElement(l.tD,E({},eb),h.createElement(x,null,h.createElement(_,{variant:"h5"},R.formatMessage({id:"my_story"})),j&&h.createElement(j,null)),h.createElement(x,null,h.createElement(_,{variant:"h5",mb:0},R.formatMessage({id:"all_stories"})),h.createElement(ew,{...L}))))}if(et&&ei(!1),!ey)return H?h.createElement(l.eB,null,h.createElement(l.tD,null,h.createElement(x,null,h.createElement(A,{height:20,width:"25%"}),v()(0,2).map(e=>h.createElement(H,{itemProps:r,key:e.toString()}))),h.createElement(x,null,h.createElement(A,{height:20,width:"25%"}),v()(0,es).map(e=>h.createElement(H,{itemProps:r,key:e.toString()}))))):h.createElement("div",null,R.formatMessage({id:"loading_dots"}));if(!eg.length)return;let eL=P.get(b);if(!eL)return null;let{noBlock:eI}=L||{};return eI?h.createElement(eL,E({},L)):h.createElement(l.eB,null,h.createElement(l.tD,null,h.createElement(x,{"data-testid":m()("my_story")},h.createElement(_,{variant:"h5"},R.formatMessage({id:"my_story"})),j&&h.createElement(j,null),eS&&h.createElement(s.A,{onClick:()=>e_({item:eS,isOwner:!0})},h.createElement(X,{identity:eS._identity,itemProps:r}))),h.createElement(x,{"data-testid":m()("all_stories")},h.createElement(_,{variant:"h5",mb:0},R.formatMessage({id:"all_stories"})),f()(eE)&&!ef?h.createElement(eL,{...L}):eE.map((e,t)=>h.createElement(s.A,{key:t.toString(),onClick:()=>e_({item:e})},h.createElement(X,{identity:e._identity,itemProps:r})))),ef&&em?h.createElement(s.A,{sx:{display:"flex",flexFlow:"wrap"}},v()(6).map(e=>h.createElement(H,{key:e.toString()}))):null))});var w=i(44562);let C=(0,n.WvA)({extendBlock:k,defaults:{blockLayout:"sidebar home story",itemView:"story.itemView.storyAvatar",itemLayout:"Story - Cards",gridLayout:"Story - Cards",moduleName:"story",resourceName:"story",actionName:"viewAll",canLoadMore:!0,canLoadSmooth:!0,clearDataOnUnMount:!0,pagingId:w.Qz,emptyPageProps:{title:"no_stories_found",contentStyle:{sx:{paddingTop:"8px",paddingBottom:"8px"}}}}})},32113(e,t,i){"use strict";i.d(t,{vZ:()=>r,MO:()=>d,x6:()=>s});var n=i(91262),l=i(96540);let o=l.createContext({status:null,setStatus(){},setFilePhoto(){},filePhoto:null,setUploading(){},uploading:!1,setIsDirty(){},isDirty:!1,isSubmitting:!1,setIsSubmitting(){}}),r=o,a=l.createContext({}),d=a,s={identityStoryActive:void 0,identityUserStoryActive:void 0,listUserStories:[],pauseStatus:n.ZR.No,reactions:[],indexStoryActive:void 0,openStoryDetail:!1,openViewComment:!1,openActionItem:!1,readyStateFile:!1,progressVideoPlay:0,isLastStory:!1,isReady:!1,mutedStatus:!0,buffer:!1}},79655(e,t,i){"use strict";i.d(t,{A:()=>y,n:()=>v});var n=i(91557),l=i(24713),o=i.n(l),r=i(58156),a=i.n(r),d=i(44562),s=i(95093),u=i.n(s);let v=(e,t,i=3)=>t<i?"prev":t>e-i-1?"next":"",c=(e,t)=>{let{identity:i}=t,n=a()(e,i),l=new URL(window.location.href),r=new URLSearchParams(l.search).get("date");if(!n)return{};let s=u()(r).format("L"),c=`${d.Lp}/${s}`,y=a()(e,`pagination.${c}.ids`),p=a()(e,`pagination.${c}.pagesOffset.total`),f=a()(e,`pagination.${c}.ended`),g=a()(e,`pagination.${c}.pagesOffset.next_date`),m=a()(e,`pagination.${c}.pagesOffset.prev_date`),h=f?1:a()(e,`pagination.${c}.pagesOffset.current_page`),S=a()(e,`pagination.${c}.pagesOffset.per_page`),E=(null==n?void 0:n.user)?a()(e,n.user):void 0,_=null==y?void 0:y.length,A=1<_?o()(y,e=>e===i):-1,x=-1!==A?A:0,k=f?x:a()(e,`pagination.${c}.pagesOffset.pos`)||0,w={item:n,stories:y,user:E,total:p,nextDate:g,prevDate:m,pagingId:c,date:r,indexStoryActive:x,positionStory:S*(h-1)+k,shouldPreload:v(_,k+1)};return w},y=(0,n.NgA)(c)},85332(e,t,i){"use strict";i.d(t,{Ay:()=>v,F_:()=>f,P3:()=>y,Tq:()=>g,Uf:()=>p,aN:()=>S,vC:()=>c});var n=i(96540),l=i(32113),o=i(91557),r=i(44562),a=i(71468),d=i(69634),s=i(79655),u=i(1081);function v(){return n.useContext(l.vZ)}function c(){return n.useContext(l.MO)}function y(){var e,t;let{navigate:i,useGetItem:l}=(0,o.PCX)(),{listUserStories:r,identityUserStoryActive:a,identityStoryActive:d,fire:s}=c(),u=l(a),v=l(d),y=(0,o.UfA)(null==u?void 0:u.stories),p=null==y?void 0:y.findIndex(e=>(null==e?void 0:e.id)===(null==v?void 0:v.id)),f=null==r?void 0:r.findIndex(e=>(null==e?void 0:e.id)===(null==u?void 0:u.id)),g=(null==y?void 0:null===(e=y[0])||void 0===e?void 0:e.id)===(null==v?void 0:v.id),m=(null==u?void 0:u.stories.length)-1===p,h=(null==r?void 0:null===(t=r[0])||void 0===t?void 0:t.id)===(null==u?void 0:u.id)&&g,S=(null==r?void 0:r.length)-1===f&&m,E=!h,_=!S,A=n.useCallback(()=>{var e,t;if(E&&-1!==p){if(g){s({type:"setIdentityUserS_Active",payload:null===(t=r[f-1])||void 0===t?void 0:t._identity});return}s({type:"setIdentityStoryActive",payload:null==y?void 0:null===(e=y[p-1])||void 0===e?void 0:e._identity})}},[E,p,g,r,y,f]),x=n.useCallback(()=>{var e,t;if(S){i("/");return}if(_&&-1!==p){if(m){s({type:"setIdentityUserS_Active",payload:null===(t=r[f+1])||void 0===t?void 0:t._identity});return}s({type:"setIdentityStoryActive",payload:null==y?void 0:null===(e=y[p+1])||void 0===e?void 0:e._identity})}},[S,_,p,m,r,f,y]);return{hasPrev:E,hasNext:_,handlePrev:A,handleNext:x}}function p(e){let[t,i]=n.useState(0),[l,o]=n.useState(0),a=n.useRef(),d=n.useCallback(()=>{var n;if(!(null==e?void 0:e.current))return[t,l];let a=null==e?void 0:null===(n=e.current)||void 0===n?void 0:n.getBoundingClientRect(),d=(null==a?void 0:a.height)/r.us,s=null==a?void 0:a.height;window.screen.width<=d&&(s=(d=window.screen.width)*r.us),o(s),i(d)},[null==e?void 0:e.current]);return n.useEffect(()=>{var t;let i=e.current;if(i)return a.current=new ResizeObserver(()=>{d()}),d(),null===(t=a.current)||void 0===t||t.observe(i),()=>{null==a||a.current.disconnect()}},[d,null==e?void 0:e.current]),[t,l,d]}function f(){return(0,a.d4)(e=>(0,d.s)(e))}function g(){var e,t;let i=c(),{fire:l,stories:r,indexStoryActive:d,nextDate:u,prevDate:v,identityStoryActive:y,loading:p,total:f,positionStory:g,pagingId:m}=i,h=(0,a.d4)(e=>(0,o.qRQ)(e,m))||{},{prev_page:S,last_page:E,current_page:_}=(null==h?void 0:h.pagesOffset)||{},{useGetItem:A,useGetItems:x,dispatch:k,usePageParams:w}=(0,o.PCX)(),C=w(),b=A(y),L=x(r),I=(null==L?void 0:null===(e=L[0])||void 0===e?void 0:e.id)===(null==b?void 0:b.id)&&0===S,O=(null==r?void 0:r[(null==r?void 0:r.length)-1])===y&&E===_,P=!(!v&&I),U=!(!u&&O),R=(null==r?void 0:r[(null==r?void 0:r.length)-1])===y&&E!==_,D=(null==L?void 0:null===(t=L[0])||void 0===t?void 0:t.id)===(null==b?void 0:b.id)&&0!==S,B=(e,t=()=>{})=>{var n;let o=e=>{var t;let i=null==e?void 0:e.pagingId,n=null==e?void 0:e.ids;if(!i||!(null==n?void 0:n.length))return;let o=null==e?void 0:null===(t=e.pagesOffset)||void 0===t?void 0:t.total;l({type:"setInit",payload:{stories:n,total:o,loading:!1}})},r=(0,s.n)(null==i?void 0:null===(n=i.stories)||void 0===n?void 0:n.length,e);if(!r){t&&t();return}t&&t(),k({type:"story/story_archive/LOAD",payload:{user_id:null==C?void 0:C.user_id,date:null==i?void 0:i.date,direction:r},meta:{onSuccess:o}})},M=(e,t)=>{var i,n,o;let r=null==e?void 0:e.pagingId,a=null==e?void 0:e.ids;if(!r||!(null==a?void 0:a.length))return;let d=null==e?void 0:null===(i=e.pagesOffset)||void 0===i?void 0:i.total,s=null==e?void 0:null===(n=e.pagesOffset)||void 0===n?void 0:n.next_date,u=null==e?void 0:null===(o=e.pagesOffset)||void 0===o?void 0:o.prev_date;l({type:"setLoading",payload:!1}),l({type:"setInit",payload:{isReady:!1,stories:a,total:d,nextDate:s,prevDate:u,indexStoryActive:0,positionStory:0,identityStoryActive:null==a?void 0:a[0],pagingId:r,date:t}})},$=()=>{l({type:"setLoading",payload:!1})},N=n.useCallback(()=>{if(D&&l({type:"setLoading",payload:!0}),!p&&P&&!D){if(I){l({type:"setLoading",payload:!0}),k({type:"story/story_archive/LOAD",payload:{user_id:null==C?void 0:C.user_id,date:v},meta:{onSuccess:e=>M(e,v),onError:$}});return}B(d-1),l({type:"setStoryActive",payload:{identity:null==r?void 0:r[d-1],index:d-1,positionStory:g-1}})}},[P,r,d,I,p,D,B,g,L,v]),T=n.useCallback(()=>{if(R&&l({type:"setLoading",payload:!0}),!p&&U&&!R){if(O){l({type:"setLoading",payload:!0}),k({type:"story/story_archive/LOAD",payload:{user_id:null==C?void 0:C.user_id,date:u},meta:{onSuccess:e=>M(e,u),onError:$}});return}B(d+1),l({type:"setStoryActive",payload:{identity:null==r?void 0:r[d+1],index:d+1,positionStory:g+1}})}},[U,r,d,O,f,R,p,B,u,g,L]);return{hasPrev:P,hasNext:U,handlePrev:N,handleNext:T,loadmore:B}}let m=e=>(e.preaction.data.reactions||[]).filter(e=>e.is_active),h=(0,u.Mz)(m,e=>e);function S(){return(0,a.d4)(h)}},91262(e,t,i){"use strict";var n,l,o,r,a,d,s,u;i.d(t,{ZR:()=>n,Zw:()=>l,dw:()=>r,gw:()=>o}),(a=n||(n={}))[a.No=0]="No",a[a.Pause=1]="Pause",a[a.Force=2]="Force",(d=l||(l={})).LANDSCAPE="landscape",d.PORTRAIT="portrait",(s=o||(o={})).Avatar="1",s.ThumbnailAndAvatar="2",(u=r||(r={})).Viewers="1",u.Comments="2"}}]);