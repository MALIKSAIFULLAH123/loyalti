"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-music-blocks-SongDetail-Mini-Block"],{50916(e,t,n){n.r(t),n.d(t,{default:()=>R});var a=n(91557),i=n(90243),l=n(84680),r=n(40515),o=n(3556),c=n(8051),s=n(96540),m=n(60655),u=n(67725),d=n(70189);let p=(0,o.Ay)("div",{name:"MusicContent"})(({theme:e})=>({fontSize:e.mixins.pxToRem(15),lineHeight:1.33})),g=(0,o.Ay)("div",{name:"SongDetailView",slot:"tagItem",overridesResolver:(e,t)=>[t.tagItem]})(({theme:e})=>({fontSize:e.mixins.pxToRem(13),fontWeight:e.typography.fontWeightBold,borderRadius:e.shape.borderRadius/2,background:"light"===e.palette.mode?e.palette.background.default:e.palette.action.hover,marginRight:e.spacing(1),marginBottom:e.spacing(1),padding:e.spacing(0,1.5),height:e.spacing(3),lineHeight:e.spacing(3),display:"block",color:"light"===e.palette.mode?"#121212":"#fff"})),f=(0,o.Ay)("div",{name:"BgCoverWrapper"})(({theme:e})=>({height:320,overflow:"hidden",position:"relative"})),v=(0,o.Ay)("div",{name:"BgCoverInner"})(({theme:e})=>({position:"absolute",left:0,right:0,top:0,bottom:0,zIndex:-1})),h=(0,o.Ay)("div",{name:"BgCover"})(({theme:e})=>({height:"100%",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",filter:"brightness(0.4) blur(50px)"})),y=(0,o.Ay)("div",{name:"Header"})(({theme:e})=>({marginLeft:e.spacing(2),marginRight:"auto",color:"#fff",paddingTop:e.spacing(4),display:"flex",justifyContent:"space-between"})),b=(0,o.Ay)("div",{name:"HeaderInner"})(({theme:e})=>({flex:1,minWidth:0,margin:e.spacing(0,3,0,2),display:"flex",flexDirection:"column"})),E=(0,o.Ay)(r._V,{name:"ImgSong"})(({theme:e})=>({width:120,height:120})),x=(0,o.Ay)("div",{name:"viewContainer"})(({theme:e})=>({margin:e.spacing(0,2,0,2),borderRadius:e.shape.borderRadius,backgroundColor:e.mixins.backgroundColor("paper"),border:e.mixins.border("secondary"),padding:e.spacing(0,2,2,2),position:"relative",marginTop:-44})),A=(0,o.Ay)(c.A)(({theme:e})=>({position:"absolute",right:8,top:8})),w=(0,o.Ay)("div",{name:"TitleWrapper"})(({theme:e})=>({display:"flex"})),S=(0,o.Ay)(c.A,{name:"PageTitle"})(({theme:e})=>({margin:e.spacing(1.5,0),fontWeight:e.typography.fontWeightSemiBold,minWidth:0,fontSize:e.spacing(3),lineHeight:1.3,maxHeight:72,overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-word",wordWrap:"break-word",whiteSpace:"normal",WebkitLineClamp:1,display:"-webkit-box",WebkitBoxOrient:"vertical","& .ico-heart":{color:e.palette.primary.main}})),k=(0,o.Ay)(c.A,{name:"SongAlbum"})(({theme:e})=>({display:"flex",fontWeight:e.typography.fontWeightSemiBold,marginTop:1.5})),_=(0,o.Ay)("div",{name:"MinorInfo"})(({theme:e})=>({marginTop:e.spacing(1),color:e.palette.text.hint,fontSize:13,fontWeight:e.typography.fontWeightBold})),C=(0,o.Ay)(c.A,{name:"AlbumWrapper"})(({theme:e})=>({fontWeight:"normal",color:e.palette.text.hint})),W=(0,o.Ay)("div",{name:"SoundWave"})(({theme:e})=>({margin:e.spacing(2,4,0,2),color:"#fff","& .MuiLinearProgress-root":{position:"absolute",width:"calc(100% - 16px)"}}));var I=n(58494);let N=(0,a.$MH)((0,I.Ay)(function({item:e,user:t,blockProps:n,identity:o,handleAction:I,state:N}){let{ItemActionMenu:R,ItemDetailInteraction:P,i18n:z,assetUrl:B,jsxBackend:M,getSetting:T}=(0,a.PCX)(),$=(0,a.UfA)(null==e?void 0:e.genres),L=T("music.music_song.auto_play"),D=(0,a.dx2)(null==e?void 0:e.album);if(!e)return null;let{description:H,text:V,name:F,statistic:X,destination:G,is_featured:O,is_sponsor:U,resource_name:j,image:q}=e,Y=M.get("core.itemView.pendingReviewCard"),J=(0,u.AE)(q,"500",B("music.song_no_image"));return s.createElement(l.eB,{testid:`detailview ${j}`},s.createElement(l.tD,null,s.createElement(c.A,null,s.createElement(f,null,s.createElement(v,null,s.createElement(h,{style:{backgroundImage:`url(${J})`}})),s.createElement(y,null,s.createElement(E,{src:J,aspectRatio:"11"}),s.createElement(b,null,s.createElement(w,null,s.createElement(r.Et,null,s.createElement(r.rL,{variant:"itemView",value:O}),s.createElement(r.FN,{variant:"itemView",value:U,item:e}))),s.createElement(S,null,F),s.createElement(k,null,D&&s.createElement(s.Fragment,null,s.createElement(c.A,{ml:.5,mr:.5},"â€¢"),s.createElement(C,{mr:.5},z.formatMessage({id:"album"})),s.createElement(a.N_E,{to:(null==D?void 0:D.link)||(null==D?void 0:D.url)},null==D?void 0:D.name))),Number.isInteger(null==X?void 0:X.music_song_total_play)?s.createElement(_,null,z.formatMessage({id:"music_song_total_play"},{value:null==X?void 0:X.music_song_total_play})):null)),s.createElement(W,null,G&&s.createElement(d.A,{autoPlay:L,url:G,isPlaylist:!1,selectedSong:e}))),s.createElement(x,null,s.createElement(A,null,s.createElement(R,{menuName:"detailActionMenu",identity:o,icon:"ico-dottedmore-vertical-o",state:N,handleAction:I,size:"smaller"})),s.createElement(r.at,{item:e,statisticDisplay:!1}),s.createElement(c.A,{mt:2},s.createElement(Y,{item:e})),H&&s.createElement(p,null,s.createElement(r.np,null,s.createElement(i.Ay,{html:V||H}))),(null==$?void 0:$.length)>0&&s.createElement(c.A,{mt:4,display:"flex",flexWrap:"wrap"},$.map(e=>s.createElement(g,{key:null==e?void 0:e.id},s.createElement(a.N_E,{to:null==e?void 0:e.url},null==e?void 0:e.name)))),s.createElement(m.A,{attachments:null==e?void 0:e.attachments,size:"large"}),s.createElement(P,{identity:o,handleAction:I})))))})),R=(0,a.WvA)({extendBlock:N,defaults:{placeholder:"Search"}})},70189(e,t,n){n.d(t,{A:()=>w});var a=n(40515),i=n(8051),l=n(81502),r=n(97763),o=n(14931),c=n(56525),s=n(85838),m=n(96540),u=n(13007),d=n.n(u),p=n(91557),g=n(71468),f=n(20053),v=n(62193),h=n.n(v),y=n(68090),b=n.n(y);let E=(0,c.A)(e=>(0,s.A)({root:{display:"flex",alignItems:"flex-end","& .ico":{color:"#fff",fontSize:18,cursor:"pointer"}},hover:{position:"absolute",left:0,top:0,zIndex:10,pointerEvents:"none",height:"100%",width:0,mixBlendMode:"overlay",background:"rgba(255, 255, 255, 0.3)",opacity:0,transition:"opacity 0.2s ease"},waveForm:{cursor:"pointer",margin:e.spacing(0,1,1),height:77,overflow:"hidden",flex:1,position:"relative","&:hover $hover":{opacity:1},"&::before":{content:"''",height:"2px",background:"#eee",width:"100%",position:"absolute",bottom:0},"& > wave":{overflowX:"inherit !important",cursor:"pointer !important"},"& wave > wave::before":{content:"''",position:"absolute",top:"50%",height:"2px",width:"100%",background:"#2682d5"}},btnControlWrapper:{marginRight:e.spacing(2)},btnControl:{border:"none",background:"transparent",outline:"none",padding:0,"& + $btnControl":{paddingLeft:e.spacing(2)}},btnPlayPause:{},btnShuffle:{marginLeft:e.spacing(2)},btnRepeat:{marginLeft:e.spacing(2)},activeIcon:{color:`${e.palette.primary.main} !important`},timePlaying:{minWidth:e.spacing(5),textAlign:"right",fontSize:15},timeSong:{fontSize:15},volumeWrapper:{width:e.spacing(2),position:"relative",marginLeft:e.spacing(1.5),"&:hover $volumeSlider":{visibility:"visible",opacity:1}},volumeSlider:{height:70,visibility:"hidden",opacity:0,transition:"all 300ms ease",position:"absolute",left:e.spacing(-.5),bottom:e.spacing(4.5)},volumeSliderItem:{color:"#fff","& .MuiSlider-thumb":{width:"15px",height:"15px",boxShadow:"none !important",color:"#fff"}},progress:{flex:1,margin:e.spacing(0,1,1),position:"absolute",bottom:0},hide:{display:"none!important"},visibility:{visibility:"hidden"},disabledIcon:{color:`${e.palette.grey[500]}!important`}}),{name:"Waveform"}),x=e=>Array.from(Array(null==e?void 0:e.length).keys()),A=e=>({container:e,waveColor:"#eee",progressColor:"#2682d5",cursorColor:"transparent",barWidth:3,barHeight:2,barRadius:0,barGap:2,responsive:!0,height:150,loopSelection:!0,normalize:!0,partialRender:!1,minPxPerSec:100});function w({url:e,isPlaylist:t,isPlaying:n,setIsPlaying:c,songs:s,selectedSong:u,setSelectedSong:v,autoPlay:y}){let w=new AudioContext,S=E(),k=(0,m.useRef)(null),_=(0,m.useRef)(null),[C,W]=(0,m.useState)(!1),[I,N]=(0,m.useState)(!1),R=(0,m.useRef)([]),[P,z]=(0,m.useState)(!1),[B,M]=(0,m.useState)(!1),[T,$]=(0,m.useState)("0:00"),[L,D]=(0,m.useState)("0:00"),[H,V]=(0,m.useState)(.5),[F,X]=(0,m.useState)(!1),[G,O]=(0,m.useState)(!1),{dispatch:U,useLoggedIn:j,i18n:q}=(0,p.PCX)(),Y=(0,g.d4)(e=>(0,p.OG_)(e,s)),J=j();(0,m.useEffect)(()=>{W(!1),O(!1);let n=A(k.current);if(_.current=d().create(n),e)return _.current.load(e),$("0:00"),k.current.addEventListener("pointermove",e=>{let t=document.querySelector("#hover");t.style.width=`${e.offsetX}px`}),_.current.on("ready",()=>{O(!0),"running"===w.state&&!t&&y&&(_.current.play(),W(!0)),t&&c(e=>(e&&_.current.play(),e)),_.current.setVolume(I?0:H),V(H);let e=K(_.current.getDuration());D(e)}),_.current.on("audioprocess",()=>{let e=K(_.current.getCurrentTime());$(e)}),_.current.on("seek",e=>{let t=K(_.current.getCurrentTime());$(t)}),_.current.on("finish",()=>{Z(),z(e=>(e?_.current.play():(X(e=>(M(e=>{var t;return e&&1===Y.length?_.current.play():!e&&(null===(t=b()(Y))||void 0===t?void 0:t.id)!==(null==u?void 0:u.id)||e?ei(1):c(!1),e}),e)),W(!1)),e))}),()=>_.current.destroy()},[e]);let K=e=>{let t=Math.floor(e/60),n=`0${Math.floor(e-60*t)}`.slice(-2);return`${t}:${n}`},Q=()=>{t?c(!n):(W(!C),_.current.playPause())};m.useEffect(()=>{var e;(null===(e=_.current)||void 0===e?void 0:e.isPlaying())!==n&&_.current.playPause()},[n]);let Z=()=>{if(!J)return;let e=null==u?void 0:u._identity;U({type:"music/updateTotalPlayItem",payload:{identity:e}})},ee=(e,t)=>{_.current.setVolume(t),V(t),0===t?N(!0):N(!1)},et=()=>{N(e=>(_.current.setVolume(e?H:0),!e))},en=()=>{if(!t){z(!P);return}P||B||M(!0),B&&!P&&(M(!1),z(!0)),P&&!B&&z(!1)},ea=()=>{X(e=>!e)};m.useEffect(()=>{h()(Y)||(F?R.current=x(Y).sort((e,t)=>.5-Math.random()):R.current=x(Y))},[F,s]);let ei=e=>{if(!t)return;c(!0);let n=Y.findIndex(e=>(null==e?void 0:e.id)===(null==u?void 0:u.id)),a=R.current.findIndex(e=>n===e);X(t=>(t?a+e===R.current.length?v(Y[R.current[0]]):a+e<0?v(Y[b()(R.current)]):v(Y[R.current[a+e]]):n+e===(null==Y?void 0:Y.length)?v(Y[0]):n+e<0?v(b()(Y)):v(Y[n+e]),t))};return m.createElement("div",{className:S.root},m.createElement("div",{className:S.btnControlWrapper},t?m.createElement("button",{className:S.btnControl,onClick:()=>ei(-1)},m.createElement(a.s4,{icon:"ico-play-prev"})):null,m.createElement("button",{onClick:Q,className:(0,f.default)(S.btnControl,S.btnPlayPause),disabled:!G},(t?n:C)?m.createElement(a.s4,{icon:"ico-pause"}):m.createElement(a.s4,{icon:"ico-play",className:!G&&S.disabledIcon})),t?m.createElement("button",{className:S.btnControl,onClick:()=>ei(1)},m.createElement(a.s4,{icon:"ico-play-next"})):null),m.createElement("div",{className:S.timePlaying},T),m.createElement(i.A,{position:"relative",flex:1},m.createElement("div",{ref:k,className:(0,f.default)(S.waveForm,!G&&S.visibility)},m.createElement("div",{id:"hover",className:(0,f.default)(S.hover)})),m.createElement(l.A,{color:"inherit",className:(0,f.default)(G&&S.hide,S.progress)})),m.createElement("div",{className:S.timeSong},L),t?m.createElement(r.A,{title:q.formatMessage({id:F?"turn_off_shuffle":"turn_on_shuffle"})},m.createElement(a.s4,{icon:"ico-shuffle",className:`${S.btnShuffle} ${F?S.activeIcon:""}`,onClick:ea})):null,m.createElement(r.A,{title:q.formatMessage({id:B||P?B?"turn_on_repeat_one":"turn_off_repeat":"turn_on_repeat"})},m.createElement(a.s4,{icon:P&&t?"ico-play-repeat-one-o":"ico-play-repeat",className:(0,f.default)(S.btnRepeat,(P||B)&&S.activeIcon,!G&&S.disabledIcon),onClick:en})),m.createElement("div",{className:S.volumeWrapper},I?m.createElement(a.s4,{icon:"ico-volume-del",onClick:et,className:!G&&S.disabledIcon}):m.createElement(a.s4,{icon:"ico-volume-increase",onClick:et,className:!G&&S.disabledIcon}),m.createElement("div",{className:S.volumeSlider},G&&m.createElement(o.Ay,{orientation:"vertical",value:I?0:H,min:0,max:1,step:.01,onChange:ee,"aria-labelledby":"vertical-slider",valueLabelDisplay:"auto",valueLabelFormat:e=>Math.round(100*e),className:S.volumeSliderItem}))))}},60655(e,t,n){n.d(t,{A:()=>d});var a=n(91557),i=n(40515),l=n(3556),r=n(8051),o=n(96540);let c=(0,l.Ay)("div",{name:"attachmentTitle"})(({theme:e})=>({fontSize:e.mixins.pxToRem(18),color:e.palette.text.secondary,fontWeight:e.typography.fontWeightBold})),s=(0,l.Ay)("div",{name:"attachment"})(({theme:e})=>({width:"100%",display:"flex",flexWrap:"wrap",justifyContent:"space-between",[e.breakpoints.down("sm")]:{flexDirection:"column"}})),m=(0,l.Ay)("div",{name:"attachmentItemWrapper"})(({theme:e})=>({marginTop:e.spacing(2),flexGrow:0,flexShrink:0,flexBasis:"calc(50% - 8px)",minWidth:300,maxWidth:"100%"})),u=({attachments:e,size:t,sx:n})=>{let{i18n:l}=(0,a.PCX)(),u=(0,a.UfA)(e);return u.length?o.createElement(r.A,{mt:2,sx:n},o.createElement(c,null,l.formatMessage({id:"attachments"})),o.createElement(s,null,u.map((e,n)=>o.createElement(m,{key:e.id.toString()},o.createElement(i.Hg,{fileName:e.file_name,downloadUrl:e.download_url,isImage:e.is_image,fileSizeText:e.file_size_text,size:t,image:null==e?void 0:e.image,identity:null==e?void 0:e._identity,index:n}))))):null},d=u},58494(e,t,n){n.d(t,{Ay:()=>c});var a=n(91557),i=n(58156),l=n.n(i);let r=(0,a.vYD)({},()=>({})),o=(0,a.NgA)(function(e,t){let n=l()(e,t.identity);if(!n)return{};let a=n.songs?n.songs.map(t=>l()(e,t)).filter(Boolean):[];return{item:n,songs:a,user:l()(e,n.user)}});function c(e){return o(r(e))}}}]);