"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-livestreaming-blocks-LiveComment-Block","metafox-livestreaming-blocks-LiveComment-CommentContainer"],{43498(e,t,n){n.d(t,{Ui:()=>d,ET:()=>v}),n(96602);var i=n(96540),l=n(91557),o=n(70223),a=n(11497),r=n(656),s=n(78292);let m=new class{bootstrap(e,t){this.manager=e,this.settingApp=this.manager.getSetting("firebase"),this.settingApp&&this.init(this.settingApp,t)}checkActive(){return this.isActive}init(e,t){if(this.mounted)return this.firebaseApp;this.mounted=!0;let n={apiKey:l.z0J,authDomain:l.wRL,projectId:l.wWR,storageBucket:l.npo,messagingSenderId:l.AfL,appId:l.Kou};this.config=e;try{let i=(0,o.Wp)(n),a=(0,r.xI)(i),{user_firebase_email:s,user_firebase_password:m,requiredSignin:c}=this.settingApp||{};return c&&(0,r.x9)(a,s,m).then(e=>{}).catch(e=>{console.log("Live Video - Firebase signInWithEmailAndPassword error",e),"auth/user-not-found"===e.code&&(0,r.eJ)(a,s,m)}),t(!0),this.firebaseApp=i,this.isActive=!0,i}catch(u){this.isActive=!1}}getFirebaseApp(){return this.firebaseApp}getFirestore(){if(!this.firebaseApp)return null;if(!this.firestore){let e=(0,a.aU)(this.firebaseApp);e&&(this.firestore=e)}return this.firestore}getMessaging(){if(!this.firebaseApp)return null;if(!this.cloudMessage){let e=(0,s.dG)(this.firebaseApp);e&&(this.cloudMessage=e)}return this.cloudMessage}},c=!1,u=!1;function d(){let[e,t]=function(){let e=(0,l.PCX)(),[t,n]=i.useState(!1);return t||c||(c=!0,m.bootstrap(e,()=>{u=!0,n(!0)})),[t||u,m]}();if(!e)return!1;let n=t.getFirestore();return n}let p=(e,t)=>{let[n,l]=(0,i.useState)();return(0,i.useEffect)(()=>{let n;if(e&&(null==t?void 0:t.collection)&&(null==t?void 0:t.docID)){try{let i=(0,a.H9)(e,t.collection,t.docID);n=(0,a.aQ)(i,async e=>{l(e.data())})}catch(o){}return()=>{null==n||n()}}},[]),n},v=p},41971(e,t,n){n.r(t),n.d(t,{default:()=>c});var i=n(91557),l=n(84680),o=n(96540),a=n(72974),r=n(8051);let s=(0,i.G5k)(function({item:e,identity:t,handleAction:n,state:s,title:m}){let{i18n:c,jsxBackend:u,getSetting:d}=(0,i.PCX)(),p=d("comment"),v=u.get("CommentComposer"),f=u.get("livestreaming.ui.composerReplyInfo"),[g,h]=o.useState(),[y,E]=o.useState(0),b=o.useRef();if(!e||!p)return null;let{extra:x}=e,A=()=>{var e,t;if(!(null==b?void 0:b.current))return;let n=(null===(e=b.current)||void 0===e?void 0:e.scrollHeight)+0;null===(t=b.current)||void 0===t||t.scrollTo({top:n})},C=()=>{h(void 0)},k=()=>{h(void 0)},_=e=>{h(e),E(e=>e+1)};return o.createElement(l.eB,{testid:`detailview ${e.resource_name}`},o.createElement(l.Tw,{title:c.formatMessage({id:m})}),o.createElement(l.tD,null,o.createElement(r.A,{sx:{display:"flex",flexDirection:"column",height:"100%"}},o.createElement(r.A,{sx:{flex:1,minHeight:0}},o.createElement(l.P,{autoHide:!0,autoHeight:!0,autoHeightMax:"100%",ref:b},o.createElement(r.A,{px:2,pb:2},o.createElement(a.default,{identity:t,scrollToBottom:A,streamKey:null==e?void 0:e.stream_key,setParentReply:_})))),(null==x?void 0:x.can_comment)?o.createElement(r.A,{px:2},g?o.createElement(f,{item:g,removeReply:k}):null,o.createElement(v,{open:!0,identity:(null==g?void 0:g.parent_comment_identity)||t,onSuccess:C,editorConfig:{disable_photo:!0},focus:y})):null)))}),m=(0,i.$MH)(s),c=(0,i.WvA)({extendBlock:m,defaults:{blockLayout:"LiveStreaming Comment"}})},92287(e,t,n){n.d(t,{A:()=>h});var i=n(90243),l=n(40515),o=n(3556),a=n(87773),r=n(96540),s=n(91557),m=n(67725);function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}let u="CommentExtraData",d=(0,o.Ay)("div",{name:u,slot:"extraDataPhoto"})(({theme:e})=>({maxWidth:e.spacing(26),cursor:"pointer"})),p=(0,o.Ay)("div",{name:u,slot:"extraDataSticker"})(({theme:e})=>({width:e.spacing(10),height:e.spacing(10)})),v=(0,o.Ay)("div",{name:u,slot:"bubbleExtraData"})(({theme:e})=>({marginTop:e.spacing(1)}));function f(e){let{extra_data:t}=e,{extra_type:n,image:i,params:o}=Object.assign({},t),{dispatch:a,jsxBackend:u}=(0,s.PCX)(),f=u.get("feedArticle.comment.embedItem");if(!t)return null;let g=(0,m.AE)(i,"500"),h=e=>{a({type:"photo/presentSimplePhoto",payload:{src:e,alt:"photo",identity:null==t?void 0:t._identity}})},y=null;switch(n){case"photo":case"storage_file":y=r.createElement(d,{onClick:()=>h(g)},r.createElement(l._V,{src:g,alt:"photo",shape:"radius"}));break;case"sticker":y=r.createElement(p,null,r.createElement(l._V,{src:g,alt:"sticker",aspectRatio:"fixed",imageFit:"contain"}));break;case"link":y=(null==o?void 0:o.is_image)?r.createElement(d,{onClick:()=>h(null==o?void 0:o.image)},r.createElement(l._V,{src:null==o?void 0:o.image,alt:"photo",shape:"radius"})):(null==o?void 0:o.is_hidden)?null:r.createElement(f,c({},o,{widthImage:"90px"}))}return y?r.createElement(v,null,y):null}let g=(0,o.Ay)("div",{name:"CommentContent",slot:"bubbleText"})(({theme:e})=>({display:"block",fontSize:e.mixins.pxToRem(15),transition:"background 300ms ease","& a":{color:e.palette.primary.main,fontWeight:e.typography.fontWeightRegular,"&:hover":{textDecoration:"underline"}}}));function h({text:e,extra_data:t,isHidden:n}){let{i18n:o}=(0,s.PCX)();return r.createElement("div",null,n?r.createElement(g,null,r.createElement(a.A,{component:"h1",variant:"body1",color:"text.hint"},o.formatMessage({id:"comment_hidden"}))):r.createElement(r.Fragment,null,r.createElement(g,null,r.createElement(l.Zn,{truncateProps:{variant:"body1",lines:3}},r.createElement(i.Ay,{html:e}))),r.createElement(f,{extra_data:t})))}},72974(e,t,n){n.r(t),n.d(t,{default:()=>x});var i=n(91557),l=n(96540),o=n(3556),a=n(40515),r=n(8051),s=n(92287);let m="PreFetchComment",c=(0,o.Ay)("div",{name:m,slot:"itemOuter"})(({theme:e})=>({display:"flex",opacity:.6,pointerEvents:"none","&:hover $ItemActionMenu":{visibility:"visible",marginLeft:e.spacing(.5)}})),u=(0,o.Ay)("div",{name:m,slot:"avatarWrapper"})(({theme:e})=>({marginRight:e.spacing(1)})),d=(0,o.Ay)("div",{name:m,slot:"itemInner"})(({theme:e})=>({display:"flex",flexDirection:"column",minWidth:0,wordBreak:"break-word"})),p=(0,o.Ay)("div",{name:m,slot:"itemName"})(({theme:e})=>({display:"flex",fontSize:e.mixins.pxToRem(13),marginBottom:e.spacing(.5)})),v=(0,o.Ay)(a.xE,{name:m,slot:"userName"})(({theme:e})=>({fontSize:e.mixins.pxToRem(13),maxWidth:"100%",fontWeight:"bold"})),f=(0,o.Ay)("div",{name:m,slot:"actions"})(({theme:e})=>({display:"inline-flex",alignItems:"center",height:e.spacing(4)}));function g({text:e}){let{useSession:t,ReactionActButton:n,ReplyActButton:o}=(0,i.PCX)(),{user:m}=t();return l.createElement("div",{"data-testid":"comment"},l.createElement(r.A,{pt:1},l.createElement(c,null,l.createElement(u,null,l.createElement(a.H8,{user:m,size:32})),l.createElement(d,null,l.createElement(r.A,{p:0,borderRadius:2},l.createElement(p,null,l.createElement(v,{to:`/user/${m.id}`,user:m})),l.createElement(s.A,{text:e})),l.createElement(f,{className:"dotSeparators"},n&&l.createElement(n,{minimize:!0}),o&&l.createElement(o,{minimize:!0}))))))}let h=(0,o.Ay)("div",{name:"CommentListRoot"})(({theme:e})=>{var t;return{position:"relative","& $CommentRoot:first-of-type":{marginTop:e.spacing(1)},"& $CommentRoot:last-child":{borderBottom:"solid 1px",borderBottomColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary,paddingBottom:e.spacing(2),[e.breakpoints.down("sm")]:{borderBottom:"none"}}}}),y=(0,o.Ay)("div",{name:"CommentListRoot"})(({theme:e})=>{var t;return{position:"relative","&:before":{content:'""',position:"absolute",top:e.spacing(6),bottom:e.spacing(2),left:e.spacing(2),borderLeft:"solid 1px",borderLeftColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary}}});function E({identity:e,data:t,scrollToBottom:n,setParentReply:o}){let{useGetItem:a,jsxBackend:r}=(0,i.PCX)(),s=r.get("CommentItemViewLiveStreaming"),m=a(e),{preFetchingComment:c}=m||{},u=c&&Object.values(c).some(e=>(null==e?void 0:e.isLoading)===!0);return(l.useEffect(()=>{n&&n()},[u,n]),s)?l.createElement(h,null,(null==t?void 0:t.length)?t.map(e=>l.createElement(y,{key:null==e?void 0:e.id},l.createElement(s,{itemLive:e,identity:`comment.entities.comment.${null==e?void 0:e.id}`,setParentReply:o}))):null,c?Object.values(c).filter(e=>(null==e?void 0:e.isLoading)===!0).map(e=>l.createElement(y,{key:e},l.createElement(g,{text:e.text}))):null):null}var b=n(43498);let x=(0,i.G5k)(function({streamKey:e,identity:t,scrollToBottom:n,setParentReply:o}){var a;let{dispatch:r,useGetItem:s,getSetting:m}=(0,i.PCX)(),c=s(t),u=m("comment"),d=(0,b.Ui)(),p=(0,b.ET)(d,{collection:"live_video_comment",docID:e}),v=null==p?void 0:p.total_comment;if(l.useEffect(()=>{var e,n;(null==c?void 0:null===(e=c.statistic)||void 0===e?void 0:e.total_comment)!==v&&r({type:"livestreaming/updateStatistic",payload:{identity:t,statistic:{total_comment:v||(null==c?void 0:null===(n=c.statistic)||void 0===n?void 0:n.total_comment)}}})},[v,null==c?void 0:null===(a=c.statistic)||void 0===a?void 0:a.total_comment]),l.useEffect(()=>{r({type:"livestreaming/updateComment",payload:{data:null==p?void 0:p.comment}})},[null==p?void 0:p.comment]),!e||!p)return null;let f=null==p?void 0:p.comment.slice(Math.max((null==p?void 0:p.comment.length)-20,0));return u?l.createElement(E,{data:f,identity:t,scrollToBottom:n,setParentReply:o}):null})}}]);